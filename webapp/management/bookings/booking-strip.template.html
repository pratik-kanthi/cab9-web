<div class="booking-strip">
    <div class="booking" ng-class="::booking.BookingStatus">
        <div class="info">
            <div class="row">
                <div class="col-lg-2 col-md-3 col-sm-4 id date-time">
                    #{{booking.LocalId}} |
                    <span class="date">{{::booking.BookedDateTime | companyDate: 'DD/MM/YYYY'}}</span>
                    <span class="time">{{::booking.BookedDateTime | companyDate: 'HH:mm'}}</span>
                    <span class="flight" ng-show="::booking.FlightInfo" tooltip="{{::booking.FlightInfo.$Status}}">
                        <i class="material-icons">airplanemode_active</i>
                        <span ng-bind="::booking.FlightInfo.FlightNumber"></span>
                    </span>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-2 from-to" style="line-height: 27px">
                    <strong class="black">{{::booking._FromSummary}}</strong>
                    <br />
                    <span>{{::booking._ToSummary}}</span>
                    <b class="additional" ng-show="::booking.BookingStops.length > 2">+{{booking.BookingStops.length - 2 + (booking.BookingStops.length > 3 ? 's':'')}}</b>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-3 passenger hidden-xs">
                    <div class="profile" style="background:url({{::booking.Client._ImageUrl}})" ng-if="booking.Client"></div>
                    <div class="profile" style="background:url({{::booking.LeadPassenger._ImageUrl}})" ng-if="!booking.Client"></div>
                    <strong ng-class="(!booking.Client)? 'lh50':''" class="black">
                        <span class="payment-method">
                            <i class="material-icons" ng-if="booking.PaymentMethod == 'OnAccount'" tooltip="Paying On Account" tooltip_placement="bottom">account_balance</i>
                            <i class="material-icons" ng-if="booking.PaymentMethod == 'Card'" tooltip="Paying By Card" tooltip_placement="bottom">credit_card</i>
                            <i class="material-icons" ng-if="booking.PaymentMethod == 'Cash'" tooltip="Paying Cash" tooltip_placement="bottom">account_balance_wallet</i>
                        </span>
                        <span ng-if="::(booking.LeadPassenger.VIP)">(VIP) </span>{{::booking._LeadPassengerName}}</strong
                    >
                    <br />
                    <span ng-if="booking.Client"><span class="label client-priority" ng-class="booking.Client.Priority">{{booking.Client.Priority}}</span> {{::booking.Client.Name}}</span>
                </div>
                <div class="col-lg-2 col-md-2 col-sm-3 driver hidden-xs">
                    <div class="" ng-if="booking.Driver">
                        <div class="profile" style="background:url({{::booking.Driver._ImageUrl}})"></div>
                        <strong class="black">{{::booking.Driver._Fullname}}</strong>
                        <br />
                        <span>{{::booking.Driver.Callsign}}</span>
                    </div>
                    <div class="" ng-if="booking.PartnerDriver">
                        <div class="profile" style="background:url({{::booking.PartnerDriver._ImageUrl}})"></div>
                        <strong class="black">{{::booking.PartnerDriver.Name}}</strong>
                        <br />
                        <span ng-if="booking.Partner && booking.Partner.PartnerName">WS({{::booking.Partner.PartnerName.split(" ")[0]}})</span>
                        <span ng-if="booking.Partner && !booking.Partner.PartnerName">{{::booking.Partner.PartnerType}}</span>
                    </div>
                    <div ng-if="!booking.Driver && !booking.PartnerDriver">
                        <strong ng-class="(booking.Partner && booking.Partner.PartnerName)?'':'lh50'"> Not Assigned </strong>
                        <br ng-if="booking.Partner && booking.Partner.PartnerName" />
                        <span ng-if="booking.Partner && booking.Partner.PartnerName">WS({{::booking.Partner.PartnerName.split(" ")[0]}})</span>
                    </div>
                </div>
                <div class="col-lg-2 hidden-md hidden-sm vehicle hidden-xs">
                    <div ng-if="booking.Vehicle && !booking.PartnerVehicle">
                        <span class="text-center registration">{{::booking.Vehicle.Registration}}</span>
                    </div>
                    <div ng-if="!booking.Vehicle && booking.PartnerVehicle">
                        <span class="text-center registration">{{::booking.PartnerVehicle.Reg}}</span>
                    </div>
                    <div ng-if="!booking.Vehicle && !booking.PartnerVehicle">
                        <span class="text-center registration na">N/A</span>
                    </div>
                    <span class="text-center vehicle-type" ng-class="::booking.VehicleType.Name" style="background-color: {{::booking.VehicleType.Colour}}">{{::booking.VehicleType.Name}}</span>
                </div>
            </div>
        </div>
        <div class="status">
            <span ng-bind="::booking.BookingStatus"></span>
        </div>
        <a class="status" ng-show="::booking.DriverPaymentId" style="right: 119px; background-color: green" ui-sref="root.driverpayments.viewer.summary({Id: booking.DriverPaymentId})">
            <span>PAID</span>
        </a>
        <a class="status" ng-show="::booking.InvoiceId" style="right: 91px; background-color: green" ui-sref="root.invoices.viewer({Id: booking.InvoiceId})">
            <span>INV</span>
        </a>
        <div class="actions">
            <a class="btn btn-primary" ng-show="!booking.$expanded" ng-click="expandBooking(booking)"><i class="material-icons">expand_more</i></a>
            <a class="btn btn-primary" ng-if="PERMISSIONS.test('bookings', 'W')" ng-show="!booking.$expanded" ng-click="openEditModal(booking)"><i class="material-icons">create</i></a>
        </div>
    </div>
    <div class="expanded-area" ng-class="::booking.BookingStatus" ng-if="booking.$expanded">
        <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" ng-class="{ 'active': tab.current == 'Info' }">
                <a ng-click="tab.current = 'Info'" role="tab" data-toggle="tab">Info</a>
            </li>
            <li role="presentation" ng-class="{ 'active': tab.current == 'History' }">
                <a ng-click="tab.current = 'History'" role="tab" data-toggle="tab">History</a>
            </li>
            <li role="presentation" ng-class="{ 'active': tab.current == 'Finance' }">
                <a ng-click="tab.current = 'Finance'" role="tab" data-toggle="tab">Finance</a>
            </li>
            <li role="presentation" ng-class="{ 'active': tab.current == 'Calls' }" ng-show="booking.$Calls && booking.$Calls.length > 0">
                <a ng-click="tab.current = 'Calls'" role="tab" data-toggle="tab">Calls</a>
            </li>
        </ul>
        <br />
        <div class="expanded-actions">
            <a class="btn btn-primary" ng-click="closeBooking($parent.booking)">
                <i class="material-icons">keyboard_arrow_up</i>
            </a>
            <a class="btn btn-primary" ng-if="PERMISSIONS.test('bookings', 'W')" ng-click="openEditModal(booking)">
                <i class="material-icons">create</i>
            </a>
        </div>
        <div ng-show="tab.current == 'Calls'" class="tab-content">
            <h6 ng-if="fetchingCalls" class="pb20"><i class="fa fa-circle-o-notch fa-spin"></i> Fetching Phone Calls...</h6>
            <div class="phone-calls" ng-if="!fetchingCalls">
                <table class="table table-condensed info-table">
                    <thead>
                        <tr>
                            <th style="width: 17.5%">Caller</th>
                            <th style="width: 17.5%">Answered By</th>
                            <th style="width: 17.5%">Duration</th>
                            <th style="width: 17.5%">Timestamp</th>
                            <th style="width: 30%">Recording</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="call in booking.$Calls">
                            <td><span class="caller" ng-bind="call.Caller"></span></td>
                            <td><strong>{{call.Staff.Firstname}} {{call.Staff.Surname}}</strong><br />{{call.AnsweredTime | date:'dd/MM/yyyy HH:mm:ss'}}</td>
                            <td>
                                <strong>Ringing:</strong> {{call.$RingingDuration}}s<br />
                                <strong>Duration:</strong> {{call.$CallDuration}}s
                            </td>
                            <td>
                                <strong>Ringing:</strong> {{call.StartTime | date:'HH:mm:ss'}}<br />
                                <strong>Ended:</strong> {{call.EndTime | date:'HH:mm:ss'}}
                            </td>
                            <td>
                                <audio controls>
                                    <source src="{{call.RecordingUrl}}" type="audio/mpeg" />
                                    Your browser does not support the audio element.
                                </audio>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div ng-show="tab.current == 'Finance'" class="tab-content">
            <h6 ng-if="fetchingFinance" class="pb20"><i class="fa fa-circle-o-notch fa-spin"></i> Fetching Finance Info...</h6>
            <div class="row" ng-if="fetchingFinance == false">
                <div class="col-sm-4 journey-cost">
                    <div ng-if="booking.$FinanceInfo">
                        <h6>Booking Finance Details</h6>
                        <div class="actions">
                            <ul>
                                <li>
                                    <a class="btn btn-primary btn-xs" ng-if="booking.DriverId != null" ng-click="recalculateBooking(booking)"> <i class="material-icons">refresh</i>Recalculate </a>
                                </li>
                                <li ng-if="!booking.DriverPaymentId && booking.CardPaymentStatus != 'Success' && booking.PaymentMethod === 'Card'">
                                    <a class="btn btn-primary btn-xs" ng-click="updateBookingPaymentType(booking.Id, 'OnAccount')"> <i class="material-icons">account_balance</i> Convert to Account </a>
                                    <a class="btn btn-primary btn-xs" ng-click="updateBookingPaymentType(booking.Id, 'Cash')"> <i class="material-icons">account_balance_wallet</i> Convert to Cash </a>
                                </li>
                                <li ng-if="!booking.InvoiceId && !booking.DriverPaymentId && booking.PaymentMethod === 'OnAccount'">
                                    <a class="btn btn-primary btn-xs" ng-click="converToCardParams.showCards = true" ng-if="CARD_PAYMENTS_ENABLED && !converToCardParams.showCards"> <i class="material-icons">credit_card</i> Convert to Card </a>
                                    <a class="btn btn-primary btn-xs" ng-click="updateBookingPaymentType(booking.Id, 'Cash')" ng-if="!converToCardParams.showCards"> <i class="material-icons">account_balance_wallet</i> Convert to Cash </a>
                                    <div class="" ng-if="converToCardParams.showCards == true">
                                        <div class="form-group">
                                            <label class="control-label">Choose Card</label>
                                            <select class="form-control" ng-model="converToCardParams.paymentCardId" name="PaymentTypeInput">
                                                <optgroup label="Client Cards" ng-if="clientCards.length > 0">
                                                    <option ng-value="item.Id" ng-repeat="item in clientCards">{{item.CardNumber}}</option>
                                                </optgroup>
                                                <optgroup label="Passenger Cards" ng-if="passengerCards.length > 0">
                                                    <option ng-value="item.Id" ng-repeat="item in passengerCards">{{item.CardNumber}}</option>
                                                </optgroup>
                                            </select>
                                        </div>
                                        <button class="btn btn-primary btn-xs" ng-disabled="converToCardParams.paymentCardId == null" ng-click="updateBookingPaymentType(booking.Id, 'Card')" ng-if="converToCardParams.showCards"><i class="material-icons">credit_card</i>Convert</button>
                                        <button class="btn btn-warning btn-xs" ng-click="converToCardParams.showCards = false" ng-if="converToCardParams.showCards"><i class="material-icons">arrow_back</i>Cancel</button>
                                    </div>
                                </li>
                                <li ng-if="!booking.DriverPaymentId && booking.PaymentMethod === 'Cash'">
                                    <a class="btn btn-primary btn-xs" ng-click="updateBookingPaymentType(booking.Id, 'OnAccount')" ng-if="!converToCardParams.showCards"> <i class="material-icons">account_balance</i> Convert to Account </a>
                                    <a class="btn btn-primary btn-xs" ng-click="converToCardParams.showCards = true" ng-if="CARD_PAYMENTS_ENABLED && !converToCardParams.showCards"> <i class="material-icons">credit_card</i> Convert to Card </a>
                                    <div class="" ng-if="converToCardParams.showCards == true">
                                        <div class="form-group">
                                            <label class="control-label">Choose Card</label>
                                            <select class="form-control" ng-model="converToCardParams.paymentCardId" name="PaymentTypeInput">
                                                <optgroup label="Client Cards" ng-if="clientCards.length > 0">
                                                    <option ng-value="item.Id" ng-repeat="item in clientCards">{{item.CardNumber}}</option>
                                                </optgroup>
                                                <optgroup label="Passenger Cards" ng-if="passengerCards.length > 0">
                                                    <option ng-value="item.Id" ng-repeat="item in passengerCards">{{item.CardNumber}}</option>
                                                </optgroup>
                                            </select>
                                        </div>
                                        <button class="btn btn-primary" ng-disabled="converToCardParams.paymentCardId == null" ng-click="updateBookingPaymentType(booking.Id, 'Card')" ng-if="converToCardParams.showCards"><i class="material-icons">credit_card</i>Convert</button>
                                        <button class="btn btn-warning ml10" ng-click="converToCardParams.showCards = false" ng-if="converToCardParams.showCards"><i class="material-icons">arrow_back</i>Cancel</button>
                                    </div>
                                </li>
                            </ul>
                            <br class="clearfix" />
                        </div>
                        <div class="row mt20">
                            <div class="col-md-6">
                                <div class="info-box">
                                    <div class="title">Distance</div>
                                    <div class="content">
                                        <span class="cost" ng-bind="::(booking.$FinanceInfo.EstimatedDistance) + ' mi.'"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-box">
                                    <div class="title">Waiting Time</div>
                                    <div class="content">
                                        <span class="cost" ng-bind="::(booking.$FinanceInfo.WaitingTime) + ' mins'"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-box">
                                    <div class="title">Fare</div>
                                    <div class="content">
                                        <span class="cost" ng-bind="::(booking.$FinanceInfo.ActualCost * (booking.CurrencyRate || 1) | currency:booking.Currency.Prepend)"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-box">
                                    <div class="title">Waiting Cost</div>
                                    <div class="content">
                                        <span class="cost" ng-bind="::(booking.$FinanceInfo.WaitingCost * (booking.CurrencyRate || 1) | currency:booking.Currency.Prepend)"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="info-box">
                                    <div class="title">Adjustments</div>
                                    <div class="content">
                                        <span class="cost" ng-bind="::(booking.$FinanceInfo.AdjustmentsTotal * (booking.CurrencyRate || 1) | currency:booking.Currency.Prepend)"></span>
                                    </div>
                                </div>
                                <div class="info-box mt0" ng-if="booking.$FinanceInfo.Adjustments.length > 0">
                                    <div class="content">
                                        <table class="table table-striped table-bordered info-table">
                                            <thead>
                                                <tr>
                                                    <th style="width: 50%">Details</th>
                                                    <th style="width: 25%">Cost</th>
                                                    <th style="width: 25%">Tax</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="item in booking.$FinanceInfo.Adjustments">
                                                    <td>
                                                        <strong class="brand-primary">{{item.Name}}</strong>
                                                    </td>
                                                    <td class="text-right">{{item.Amount | currency}}</td>
                                                    <td class="text-right">{{item.TaxAmount | currency}}</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="info-box">
                                    <div class="title">Extras</div>
                                    <div class="content">
                                        <span class="cost" ng-bind="::(booking.$FinanceInfo.ExtrasTotal * (booking.CurrencyRate || 1) | currency:booking.Currency.Prepend)"></span>
                                    </div>
                                </div>
                                <div class="info-box mt0" ng-if="booking.$FinanceInfo.Extras.length > 0">
                                    <div class="content">
                                        <table class="table table-striped table-bordered info-table">
                                            <thead>
                                                <tr>
                                                    <th style="width: 50%">Details</th>
                                                    <th style="width: 25%">Cost</th>
                                                    <th style="width: 25%">Tax</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="item in booking.$FinanceInfo.Extras">
                                                    <td>
                                                        <strong class="brand-primary">{{item.Expense}}</strong>
                                                    </td>
                                                    <td class="text-right">{{item.Amount | currency}}</td>
                                                    <td class="text-right">{{item.TaxAmount | currency}}</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-box">
                                    <div class="title">Total</div>
                                    <div class="content">
                                        <span class="cost" ng-bind="::(booking.$FinanceInfo.ActualCost + booking.$FinanceInfo.WaitingCost + booking.$FinanceInfo.AdjustmentsTotal + booking.$FinanceInfo.ExtrasTotal) * (booking.CurrencyRate || 1) | currency:booking.Currency.Prepend"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-box">
                                    <div class="title">Total VAT</div>
                                    <div class="content">
                                        <span class="cost" ng-bind="::(booking.$FinanceInfo.ActualTax + booking.$FinanceInfo.WaitingTax + booking.$FinanceInfo.AdjustmentsTax + booking.$FinanceInfo.ExtrasTax) * (booking.CurrencyRate || 1) | currency:booking.Currency.Prepend"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <h6>Card Payment Details</h6>
                        <p ng-if="booking.CardPaymentStatus == null">No card payment currently exists.</p>
                        <p ng-if="booking.CardPaymentStatus == 'PreauthTaken'">Preauth has been collected for this booking.</p>
                        <p ng-if="booking.CardPaymentStatus == 'Success'">Card Payment for this booking has successfully been taken.</p>
                        <p ng-if="booking.CardPaymentStatus == 'Failure'">Card Payment for this booking has failed.</p>
                        <div class="card-payment mb20" ng-if="CARD_PAYMENTS_ENABLED && booking.CardPaymentStatus != 'Success'">
                            <a class="btn btn-primary btn-xs" ng-click="paymentParams.showCardPayment = true" ng-if="!paymentParams.showCardPayment"> <i class="material-icons">credit_card</i> Take Card Payment </a>
                            <div class="" ng-if="paymentParams.showCardPayment == true">
                                <div class="form-group">
                                    <label class="control-label">Choose Card</label>
                                    <select class="form-control" ng-model="paymentParams.PaymentCardId" name="PaymentTypeInput">
                                        <optgroup label="Client Cards" ng-if="clientCards.length > 0">
                                            <option ng-value="item.Id" ng-repeat="item in clientCards">{{item.CardNumber}}</option>
                                        </optgroup>
                                        <optgroup label="Passenger Cards" ng-if="passengerCards.length > 0">
                                            <option ng-value="item.Id" ng-repeat="item in passengerCards">{{item.CardNumber}}</option>
                                        </optgroup>
                                    </select>
                                </div>
                                <button class="btn btn-primary" ng-disabled="paymentParams.PaymentCardId == null" ng-click="takeCardPayment()" ng-if="!paymentParams.collectingPayment"><i class="material-icons">credit_card</i>Take Payment</button>
                                <button class="btn btn-primary" ng-disabled="true" ng-if="paymentParams.collectingPayment"><i class="fa fa-circle-o-notch fa-spin"></i>Please Wait...</button>
                                <button class="btn btn-warning ml10" ng-click="paymentParams.showCardPayment = false" ng-if="!paymentParams.collectingPayment"><i class="material-icons">arrow_back</i>Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-8">
                    <h6>Credit Card Transactions</h6>
                    <div ng-if="booking.$Transactions == null || booking.$Transactions.length==0">
                        <strong>This section populates credit card transactions for the booking. </strong>
                    </div>
                    <div id="credit-cards-transactions" class="mt20" ng-if="booking.$Transactions.length > 0">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th style="width: 10%">Status</th>
                                    <th style="width: 10%">Type</th>
                                    <th style="width: 15%">Date/Time</th>
                                    <th style="width: 30%">Card Number</th>
                                    <th style="width: 12.5%">Provider</th>
                                    <th style="width: 12.5%" class="text-center">Details</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-if="booking.$Transactions.length==0">
                                    <td colspan="6" height="40">
                                        <strong class="brand-primary"> No Transactions Found </strong>
                                    </td>
                                </tr>
                                <tr ng-repeat-start="item in booking.$Transactions">
                                    <td class="status" ng-class="(item.Success)?'SUCCESS':'FAILURE'">
                                        <strong class="brand-primary">{{(item.Success)? 'Success': 'Failure'}}</strong>
                                    </td>
                                    <td class="transaction-type">
                                        <strong ng-bind="item.TransactionType" class="brand-secondary"></strong>
                                        <br />
                                        <strong class="brand-primary" ng-bind="item.Amount | currency"></strong>
                                    </td>
                                    <td>
                                        <span ng-bind="item.CreatedAt | date:'dd/MM/yyyy HH:mm'"></span>
                                    </td>
                                    <td class="card-type">
                                        <div class="credit-card-type small" ng-class="item.PaymentCardType"></div>
                                        <strong ng-bind="item.PaymentCardNumber"></strong>
                                    </td>
                                    <td class="provider-type">
                                        <div class="credit-card-provider-type small" ng-class="item.Provider"></div>
                                    </td>
                                    <td class="text-center">
                                        <button class="btn btn-xs btn-primary" ng-show="!item.$expanded" ng-disabled="card.DefaultCard" ng-click="expandTransaction(item)"><i class="material-icons">expand_more</i>Details</button>
                                        <button class="btn btn-xs btn-warning" ng-show="item.$expanded" ng-disabled="card.DefaultCard" ng-click="item.$expanded = !item.$expanded"><i class="material-icons">expand_less</i>Hide</button>
                                    </td>
                                </tr>
                                <tr ng-repeat-end ng-if="item.$expanded">
                                    <td colspan="6" class="p10">
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <strong class="brand-primary">Payment Request</strong>
                                                <pre>{{item.Request|json:true}}</pre>
                                            </div>
                                            <div class="col-sm-6">
                                                <strong class="brand-primary">Provider Response</strong>
                                                <pre>{{item.Response|json:true}}</pre>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="mt20 mb20">
                            <a class="btn btn-primary btn-xs" ng-click="emailTo('RECEIPT', booking)"><i class="material-icons">receipt</i> Send Receipt</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div ng-show="tab.current == 'History'" class="tab-content">
            <h6>History</h6>
            <div class="events-wrapper" style="max-height: 640px; overflow-y: scroll; margin-right: 48px">
                <div class="empty" ng-if="noHistory">
                    <h4 ng-bind="today" class="day"></h4>
                    <div class="event">
                        <i class="material-icons EDIT">timeline</i>
                        <div class="content">No events have been recorded.</div>
                    </div>
                </div>
                <div class="day" ng-repeat="(date, items) in history">
                    <h4 class="day">{{::date}}</h4>
                    <div class="event" ng-repeat="_ev in items">
                        <i class="material-icons" ng-class="::coloursIndex[_ev.BookingEvent]">{{::iconsIndex[_ev.BookingEvent]}}</i>
                        <img ng-src="{{::_ev.User._ImageUrl}}" alt="{{_ev.User.Name}}" class="event-owner-icon" />
                        <div class="content" ng-switch="_ev.BookingEvent">
                            <div ng-switch-when="Booking Offer Sent">
                                <span><b>{{_ev.User.Name}}</b> Offered the <b>Booking</b> to <b>{{_ev.Properties[0].NewValue}}</b> at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                            </div>
                            <div ng-switch-when="Driver Allocated">
                                <span><b>{{_ev.User.Name}}</b> {{_ev.Properties[0].NewValue}} the <b>Booking</b> to <b>{{_ev.Properties[1].NewValue}}</b> at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                            </div>
                            <div ng-switch-when="Driver Accepted">
                                <span><b>{{_ev.User.Name}}</b> Accepted the <b>Booking</b> at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                                <p ng-if="_ev.Properties[2]">Using vehicle <b>{{_ev.Properties[2].NewValue}}</b></p>
                            </div>
                            <div ng-switch-when="Booking Patched">
                                <span><b>{{_ev.User.Name}}</b> Modified the <b>Booking</b> at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                                <p ng-if="_ev.Properties.length > 0">
                                    <span ng-repeat="p in _ev.Properties">
                                        <b>{{p.PropertyName}}</b>
                                        <span ng-if="p.OldValue && p.NewValue">
                                            was changed from <b>{{p.OldValue}}</b> to
                                            <b>{{p.NewValue}}</b>
                                        </span>
                                        <span ng-if="p.OldValue && !p.NewValue"> was removed. </span>
                                        <span ng-if="!p.OldValue && p.NewValue"> was set to <b>{{p.NewValue}}</b> </span>
                                        <br />
                                    </span>
                                </p>
                            </div>
                            <div ng-switch-when="DriverPaymentIssued">
                                <span><b>{{_ev.User.Name}}</b> Issued a <b>Driver Payment</b> at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                                <p ng-if="booking.DriverPaymentId == _ev.Properties[0].NewValue">
                                    <span ng-if="booking.ManualCommission">
                                        <b>Manual Commission: </b>
                                        <span>{{booking.ManualCommission | currency}}</span>
                                        <br />
                                    </span>
                                    <span ng-if="!booking.ManualCommission">
                                        <b>Journey Commission: </b>
                                        <span>{{booking.JourneyCommission | currency}}</span>
                                        <br />
                                    </span>
                                    <span ng-if="!booking.ManualCommission">
                                        <b>Waiting Commission: </b>
                                        <span>{{booking.WaitingCommission | currency}}</span>
                                        <br />
                                    </span>
                                    <span ng-if="!booking.ManualCommission">
                                        <b>Extras Commission: </b>
                                        <span>{{booking.ExtrasCommission | currency}}</span>
                                        <br />
                                    </span>
                                    <span>
                                        <b>Total Commission: </b>
                                        <span>{{booking.ExtrasCommission || (booking.JourneyCommission + booking.WaitingCommission + booking.ExtrasCommission) | currency}}</span>
                                        <br />
                                    </span>
                                    <span>
                                        <a ui-sref="root.driverpayments.viewer.summary({Id: booking.DriverPaymentId})" target="_blank"><i class="material-icons green-bg" style="position: static; display: inline-block; width: 20px; height: 20px; line-height: 17px">forward</i> Open Payment</a>
                                        <br />
                                    </span>
                                </p>
                            </div>
                            <div ng-switch-when="DriverPaymentGenerated">
                                <span><b>{{_ev.User.Name}}</b> Issued a <b>Driver Payment</b> at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                                <p ng-if="booking.DriverPaymentId == _ev.Properties[0].NewValue">
                                    <span ng-if="booking.ManualCommission">
                                        <b>Manual Commission: </b>
                                        <span>{{booking.ManualCommission | currency}}</span>
                                        <br />
                                    </span>
                                    <span ng-if="!booking.ManualCommission">
                                        <b>Journey Commission: </b>
                                        <span>{{booking.JourneyCommission | currency}}</span>
                                        <br />
                                    </span>
                                    <span ng-if="!booking.ManualCommission">
                                        <b>Waiting Commission: </b>
                                        <span>{{booking.WaitingCommission | currency}}</span>
                                        <br />
                                    </span>
                                    <span ng-if="!booking.ManualCommission">
                                        <b>Extras Commission: </b>
                                        <span>{{booking.ExtrasCommission | currency}}</span>
                                        <br />
                                    </span>
                                    <span>
                                        <b>Total Commission: </b>
                                        <span>{{booking.ExtrasCommission || (booking.JourneyCommission + booking.WaitingCommission + booking.ExtrasCommission) | currency}}</span>
                                        <br />
                                    </span>
                                    <span>
                                        <a ui-sref="root.driverpayments.viewer.summary({Id: booking.DriverPaymentId})" target="_blank"><i class="material-icons green-bg" style="position: static; display: inline-block; width: 20px; height: 20px; line-height: 17px">forward</i> Open Payment</a>
                                        <br />
                                    </span>
                                </p>
                            </div>
                            <div ng-switch-when="DriverPaymentCancelled">
                                <span><b>{{_ev.User.Name}}</b> Cancelled a <b>Driver Payment</b> at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                            </div>
                            <div ng-switch-when="ClientInvoiceIssued">
                                <span><b>{{_ev.User.Name}}</b> Issued a <b>Client Invoice</b> at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                                <p ng-if="booking.InvoiceId == _ev.Properties[0].NewValue">
                                    <span>
                                        <b>Reference: </b>
                                        <span>{{booking.Invoice.Reference}}</span>
                                        <br />
                                    </span>
                                    <span>
                                        <b>Invoice Fare: </b>
                                        <span>{{booking.InvoiceCost || 0 | currency}}</span>
                                        <br />
                                    </span>
                                    <span>
                                        <b>Waiting: </b>
                                        <span>{{booking.WaitingCost || 0 | currency}}</span>
                                        <br />
                                    </span>
                                    <span>
                                        <b>Adjustments: </b>
                                        <span>{{booking.AdjustmentTotal || 0 | currency}}</span>
                                        <br />
                                    </span>
                                    <span>
                                        <b>Extras: </b>
                                        <span>{{booking.ExtrasCost || 0 | currency}}</span>
                                        <br />
                                    </span>
                                    <span>
                                        <b>Discount: </b>
                                        <span>{{booking.Discount || 0 | currency}}</span>
                                        <br />
                                    </span>
                                    <span>
                                        <b>Tax Amount: </b>
                                        <span>{{(((booking.InvoiceCost || 0) + (booking.WaitingCost || 0) + (booking.ExtrasCost || 0) + (booking.AdjustmentTotal || 0) - (booking.Discount || 0)) * getTaxAmount(booking)) | currency}}</span>
                                        <br />
                                    </span>
                                    <span>
                                        <b>Total Commission: </b>
                                        <span>{{(((booking.InvoiceCost || 0) + (booking.WaitingCost || 0) + (booking.ExtrasCost || 0) + (booking.AdjustmentTotal || 0) - (booking.Discount || 0)) * (1 + getTaxAmount(booking))) | currency}}</span>
                                        <br />
                                    </span>
                                    <span ng-if="booking.InvoiceId == _ev.Properties[0].NewValue">
                                        <a ui-sref="root.invoices.viewer({Id: booking.InvoiceId})" target="_blank"><i class="material-icons green-bg" style="position: static; display: inline-block; width: 20px; height: 20px; line-height: 17px">forward</i> Open Invoice</a>
                                        <br />
                                    </span>
                                </p>
                            </div>
                            <div ng-switch-when="ClientInvoiceCancelled">
                                <span><b>{{_ev.User.Name}}</b> Cancelled a <b>Client Invoice</b> at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                            </div>
                            <div ng-switch-when="FlightTrackingStarted">
                                <span><b>Flight Tracking</b> Started at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                                <p ng-if="_ev.Properties.length > 0">
                                    <span ng-repeat="p in _ev.Properties">
                                        <b>{{p.PropertyName}}: </b><span>{{p.NewValue}}</span>
                                        <br />
                                    </span>
                                </p>
                            </div>
                            <div ng-switch-when="FlightTrackingStopped">
                                <span><b>Flight Tracking</b> Stopped at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                                <p ng-if="_ev.Properties.length > 0">
                                    <span ng-repeat="p in _ev.Properties">
                                        <b>{{p.PropertyName}}: </b><span>{{p.OldValue}}</span>
                                        <br />
                                    </span>
                                </p>
                            </div>
                            <div ng-switch-when="Booking Created">
                                <span><b>{{_ev.User.Name}}</b> Created the <b>Booking</b> at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                            </div>
                            <div ng-switch-when="Booking Cancelled|Infinity Cancelled|OT Cancelled" ng-switch-when-separator="|">
                                <span><b>{{_ev.User.Name}}</b> Cancelled the <b>Booking</b> at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                            </div>
                            <div ng-switch-when="Flight Update">
                                <span><b>Flight Time</b> Updated at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                                <p>
                                    <span ng-repeat="p in _ev.Properties">
                                        <b>{{p.PropertyName}}</b>
                                        <span ng-if="p.OldValue && p.NewValue">
                                            was updated from <b>{{p.OldValue}}</b> to
                                            <b>{{p.NewValue}}</b>
                                        </span>
                                        <br />
                                    </span>
                                </p>
                            </div>
                            <div ng-switch-when="Email Client Confirmation|Email Manual Confirmation" ng-switch-when-separator="|">
                                <span><b>Confirmation Email Sent</b> to <b>{{_ev.Properties[0].NewValue}}</b> at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                            </div>
                            <div ng-switch-when="SMS Confirmation">
                                <span><b>Confirmation SMS Sent</b> to <b>{{_ev.Properties[0].NewValue}}</b> at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                            </div>
                            <div ng-switch-when="SMS Driver Arrived">
                                <span><b>Arrival SMS Sent</b> to <b>{{_ev.Properties[0].NewValue}}</b> at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                            </div>
                            <div ng-switch-when="Call Driver Arrived">
                                <span><b>Arrival Call Placed</b> to <b>{{_ev.Properties[0].NewValue}}</b> at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                            </div>
                            <div ng-switch-default>
                                <span><b>{{_ev.User.Name}}</b> {{_ev.Action}} {{_ev.EntityType == 'Booking' ? 'the' : 'a'}} <b>{{_ev.EntityType}}</b> at {{_ev.Timestamp | date: 'HH:mm'}}</span>
                                <br />
                                <p ng-if="_ev.Properties.length > 0">
                                    <span ng-repeat="p in _ev.Properties">
                                        <b>{{p.PropertyName}}</b>
                                        <span ng-if="p.OldValue && p.NewValue">
                                            was changed from <b>{{p.OldValue}}</b> to
                                            <b>{{p.NewValue}}</b>
                                        </span>
                                        <span ng-if="p.OldValue && !p.NewValue && _ev.Action != 'Deleted'"> was removed. </span>
                                        <span ng-if="p.OldValue && !p.NewValue && _ev.Action == 'Deleted'"> was {{p.OldValue}}. </span>
                                        <span ng-if="!p.OldValue && p.NewValue"> was set to <b>{{p.NewValue}}</b> </span>
                                        <br />
                                    </span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="empty" ng-hide="noMoreHistory">
                    <div class="event" style="padding-bottom: 0">
                        <i class="material-icons green-bg">expand_more</i>
                        <div class="content">
                            <a class="btn btn-link" ng-click="fetchMoreHistory(booking)">Show More</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div ng-show="tab.current == 'Info'" class="tab-content">
            <div class="actions">
                <ul>
                    <li>
                        <a class="btn btn-primary btn-xs" ng-click="emailTo('CLIENT', booking)"><i class="material-icons">mail</i> Send Email</a>
                        <a class="btn btn-primary btn-xs" ng-click="textTo('CLIENT', booking)"><i class="material-icons">message</i> Send Text</a>
                        <a class="btn btn-primary btn-xs" ng-click="emailTo('PAYMENT', booking)"><i class="material-icons">payment</i> Send Payment Link</a>
                    </li>
                    <li>
                        <a class="btn btn-xs btn-primary mr5" ng-click="updateBookingStatus(booking,'Completed')" ng-if="PERMISSIONS.test('bookings', 'W') && booking.BookingStatus != 'Completed' && booking.DriverId"><i class="material-icons">directions_car</i>Complete</a>
                        <a class="btn btn-xs btn-primary mr5" ng-click="updateBookingStatus(booking,'Incoming')" ng-if="PERMISSIONS.test('bookings', 'W') && booking.BookingStatus != 'Incoming' && !booking.DriverId"><i class="material-icons">directions_car</i>Un-Cancel</a>
                        <a class="btn btn-xs btn-warning mr5" ng-click="updateBookingStatus(booking,'COA')" ng-if="PERMISSIONS.test('bookings', 'D') && booking.BookingStatus != 'COA'"><i class="material-icons">local_car_wash</i>COA</a>
                        <a class="btn btn-xs btn-danger" ng-click="updateBookingStatus(booking,'Cancelled')" ng-if="PERMISSIONS.test('bookings', 'D') && booking.BookingStatus != 'Cancelled'"><i class="material-icons">block</i>Cancel</a>
                    </li>
                    <li ng-show="::((booking.DriverId || booking.PartnerDriverId) && booking.BookingStatus!='Completed' && booking.BookingStatus!='COA' && booking.BookingStatus!='Cancelled')">
                        <a class="btn btn-primary btn-xs" ng-click="trackBooking(booking)"><i class="material-icons">gps_fixed</i> Track</a>
                    </li>
                </ul>
                <br class="clearfix" />
            </div>
            <div class="row">
                <div class="col-sm-3 journey-map">
                    <h6>Journey</h6>
                    <img ng-src="{{::booking._ImageUrl}}" class="booking-map" alt="{{::booking.LocalId}}" />
                    <div class="journey-details">
                        <div class="info-box" ng-repeat="stop in ::booking.BookingStops">
                            <div class="title" ng-bind="::(($first)?'From':($last)?'To':'Via')"></div>
                            <div class="content">
                                <span ng-bind="::stop.StopSummary"></span>
                            </div>
                        </div>
                        <div class="info-box" ng-if="(booking.FlightNo && booking.FlightNo.length > 0)">
                            <div class="title">Flight No</div>
                            <div class="content">{{::booking.FlightNo}}</div>
                        </div>
                        <div class="info-box">
                            <div class="title">Passengers &amp; Bags</div>
                            <div class="content">
                                <div class="passengers">
                                    <div class="icon-small">
                                        <i class="material-icons">person_outline</i>
                                    </div>
                                    <div class="number">
                                        <span>{{::booking.Pax}}</span>
                                    </div>
                                </div>
                                <div class="bags">
                                    <div class="icon-small">
                                        <i class="material-icons">business_center</i>
                                    </div>
                                    <div class="number">
                                        <span>{{::booking.Bax}}</span>
                                    </div>
                                </div>
                            </div>
                            <br class="clearfix" />
                        </div>
                    </div>
                </div>
                <div class="col-sm-5 booking-details">
                    <h6>Information</h6>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="info-box">
                                <div class="title">Driver</div>
                                <div class="content">
                                    <div ng-if="booking.Driver">
                                        {{::booking.Driver._Fullname}}
                                        <br />
                                        {{::booking.Driver.Callsign}}
                                        <br />
                                        <a href="" class="link red" ng-click="removeDriver(booking)" ng-if="PERMISSIONS.test('bookings', 'W')"> Remove Driver</a>
                                    </div>
                                    <div ng-if="!booking.Driver">No Driver Assigned</div>
                                    <small class="text-muted" ng-show="booking.$driverUpdate"><i class="fa fa-circle-o-notch fa-spin mr5"></i>Updating</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="info-box">
                                <div class="title">Vehicle</div>
                                <div class="content">
                                    <div ng-if="booking.Vehicle">
                                        {{::booking.Vehicle.Make}} {{::booking.Vehicle.Model}} {{::booking.Vehicle.Colour}}
                                        <br />
                                        {{::booking.Vehicle.Registration}}
                                    </div>
                                    <div ng-if="booking.PartnerVehicle">
                                        {{::booking.PartnerVehicle.Make}} {{::booking.PartnerVehicle.Model}} {{::booking.PartnerVehicle.Colour}}
                                        <br />
                                        {{::booking.PartnerVehicle.Reg}}
                                    </div>
                                    <div ng-if="!booking.Vehicle && !booking.PartnerVehicle">
                                        <span class="text-muted">Not Assigned</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div ng-if="booking.Partner" class="row">
                        <div class="col-xs-6">
                            <div class="info-box">
                                <div class="title">Partner Name</div>
                                <div class="content">{{::booking.Partner.PartnerName?booking.Partner.PartnerName:booking.Partner.PartnerType}}</div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6">
                            <div class="info-box">
                                <div class="title">Passenger Info</div>
                                <div class="content">
                                    {{::booking.LeadPassenger._Fullname}}
                                    <br />
                                    <a href={{'tel:'+booking.PassengerNotificationPhone}} style="font-size: 14px;">{{::booking.PassengerNotificationPhone}}</a>
                                    <!-- {{::booking.PassengerNotificationPhone}} -->
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6">
                            <div class="info-box" ng-show="booking.Client">
                                <div class="title">Client Info</div>
                                <div class="content">
                                    {{::booking.Client.Name}}
                                    <br />
                                    <a href={{'tel:'+booking.Client.Phone}} style="font-size: 14px;">{{::booking.Client.Phone}}</a>
                                    <!-- {{::booking.Client.Phone}} -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6">
                            <div class="info-box mb20">
                                <div class="title">Booker</div>
                                <div class="content">
                                    {{::booking.ClientStaff._Fullname}}
                                    <br />
                                    <a href={{'tel:'+booking.ClientStaff.Phone}} style="font-size: 14px;">{{::booking.ClientStaff.Phone}}</a>
                                    <!-- {{::booking.ClientStaff.Phone}} -->
                                </div>
                            </div>
                            <div class="info-box">
                                <div class="title">Created By</div>
                                <div class="content">
                                    {{::booking.CreationUser.Name}}
                                    <br />
                                    {{::booking.CreationTime | date:'dd/MM/yyyy HH:mm'}}
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6">
                            <div class="info-box">
                                <div class="title">Client Services</div>
                                <div class="content">
                                    <input class="check" type="checkbox" id="ClientServicesCheck" ng-disabled="true" ng-model="booking.Dispute" />
                                    <label class="check-label" for="ClientServicesCheck"></label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6">
                            <div ng-show="::booking.FlightInfo">
                                <h6 class="mt20">Flight Info</h6>
                                <div class="form-box">
                                    <label>Departs</label>
                                    <div class="info">
                                        <span ng-bind="::'(' + booking.FlightInfo.OriginCode + ') ' + booking.FlightInfo.Origin">(DXB) Dubai Airport </span>
                                    </div>
                                </div>
                                <div class="form-box">
                                    <label>Scheduled</label>
                                    <div class="info">
                                        <span ng-bind="::booking.FlightInfo.ScheduledArrivalTime | date: 'dd/MM/yyyy HH:mm'"></span>
                                    </div>
                                </div>
                                <div class="form-box">
                                    <label>Actual</label>
                                    <div class="info">
                                        <span ng-bind="::booking.FlightInfo.ArrivalTime | date: 'dd/MM/yyyy HH:mm'"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6"></div>
                    </div>
                </div>
                <div class="col-sm-3 journey-cost">
                    <h6 ng-if="fetchingFinance"><i class="fa fa-circle-o-notch fa-spin"></i> Fetching Finance Info...</h6>
                    <div ng-if="booking.$FinanceInfo && fetchingFinance == false">
                        <h6>Finance Info</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-box">
                                    <div class="title">Distance</div>
                                    <div class="content">
                                        <span class="cost" ng-bind="::(booking.$FinanceInfo.EstimatedDistance) + ' mi.'"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-box">
                                    <div class="title">Waiting Time</div>
                                    <div class="content">
                                        <span class="cost" ng-bind="::(booking.$FinanceInfo.WaitingTime) + ' mins'"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-box">
                                    <div class="title">Fare</div>
                                    <div class="content">
                                        <span class="cost" ng-bind="::(booking.$FinanceInfo.ActualCost * (booking.CurrencyRate || 1) | currency:booking.Currency.Prepend)"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-box">
                                    <div class="title">Waiting Cost</div>
                                    <div class="content">
                                        <span class="cost" ng-bind="::(booking.$FinanceInfo.WaitingCost * (booking.CurrencyRate || 1) | currency:booking.Currency.Prepend)"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-box">
                                    <div class="title">Adjustments</div>
                                    <div class="content">
                                        <span class="cost" ng-bind="::(booking.$FinanceInfo.AdjustmentsTotal * (booking.CurrencyRate || 1) | currency:booking.Currency.Prepend)"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-box">
                                    <div class="title">Extras</div>
                                    <div class="content">
                                        <span class="cost" ng-bind="::(booking.$FinanceInfo.ExtrasTotal * (booking.CurrencyRate || 1) | currency:booking.Currency.Prepend)"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-box">
                                    <div class="title">Loyalty Points Gained</div>
                                    <div class="content">
                                        <span ng-if="booking.loyaltyTransaction.PointsGained" class="cost" ng-bind="booking.loyaltyTransaction.PointsGained | currency"></span>
                                        <span ng-if="!booking.loyaltyTransaction.PointsGained" class="cost">--</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-box">
                                    <div class="title">Loyalty Points Used</div>
                                    <div class="content">
                                        <span ng-if="booking.loyaltyTransaction.PointsUsed" class="cost" ng-bind="booking.loyaltyTransaction.PointsUsed | currency"></span>
                                        <span ng-if="!booking.loyaltyTransaction.PointsUsed" class="cost">--</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <h6>Total</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-box">
                                    <div class="title">Cost</div>
                                    <div class="content">
                                        <span class="cost" ng-bind="::(booking.$FinanceInfo.ActualCost + booking.$FinanceInfo.WaitingCost + booking.$FinanceInfo.AdjustmentsTotal + booking.$FinanceInfo.ExtrasTotal) * (booking.CurrencyRate || 1) | currency:booking.Currency.Prepend"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-box">
                                    <div class="title">VAT</div>
                                    <div class="content">
                                        <span class="cost" ng-bind="::(booking.$FinanceInfo.ActualTax + booking.$FinanceInfo.WaitingTax + booking.$FinanceInfo.AdjustmentsTax + booking.$FinanceInfo.ExtrasTax) * (booking.CurrencyRate || 1) | currency:booking.Currency.Prepend"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <h6>References</h6>
                    <div class="info-box">
                        <div class="content">
                            <table class="table table-striped table-bordered info-table" ng-if="booking.BookingValidations.length>0 && !loading">
                                <thead>
                                    <tr>
                                        <th class="title">Reference</th>
                                        <th class="title">Value</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="validation in booking.BookingValidations">
                                        <td>
                                            <span ng-bind="validation.ClientReference.ReferenceName"></span>
                                        </td>
                                        <td><span ng-bind="validation.Value"></span></td>
                                    </tr>
                                </tbody>
                            </table>
                            <span ng-if="booking.BookingValidations.length==0 && !loading">No References added.</span>
                            <span ng-if="loading">Loading...</span>
                        </div>
                    </div>
                    <h6>Special Requirements</h6>
                    <div class="info-box">
                        <div class="content">
                            <table class="table table-striped table-bordered info-table" ng-if="booking.BookingRequirements.length>0 && !loading">
                                <thead>
                                    <tr>
                                        <th class="title">Requirement</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="req in booking.BookingRequirements">
                                        <td><span ng-bind="req.Name"></span></td>
                                    </tr>
                                </tbody>
                            </table>
                            <span ng-if="booking.BookingRequirements.length==0 && !loading">No Requirements added.</span>
                            <span ng-if="loading">Loading...</span>
                        </div>
                    </div>
                    <h6>Tags</h6>
                    <div class="info-box">
                        <div class="content">
                            <table class="table table-striped table-bordered info-table" ng-if="booking.BookingTags.length>0 && !loading">
                                <thead>
                                    <tr>
                                        <th class="title">Name</th>
                                        <th class="title">Type</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="tag in booking.BookingTags">
                                        <td>
                                            <span ng-bind="tag.Tag.Name"></span>
                                        </td>
                                        <td><span ng-bind="tag.Type"></span></td>
                                    </tr>
                                </tbody>
                            </table>
                            <span ng-if="booking.BookingTags.length==0 && !loading">No Tags added.</span>
                            <span ng-if="loading">Loading...</span>
                        </div>
                    </div>
                    <div ng-if="booking.Client.SignatureRequired && booking.PassengerSignatureImageUrl">
                        <h6>Passenger Signature</h6>
                        <img ng-src="{{::booking._PassengerSignatureImageUrl}}" alt="{{::booking.LocalId}}" />
                    </div>
                </div>
            </div>
            <div class="row mt20">
                <div class="col-xs-4">
                    <div class="info-box">
                        <div class="title">Office Notes</div>
                        <div class="content">
                            <span class="text-muted">{{::booking.OfficeNotes || 'No Notes Added' }}</span>
                        </div>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class="info-box">
                        <div class="title">Driver Notes</div>
                        <div class="content">
                            <span class="text-muted">{{::booking.DriverNotes || 'No Notes Added' }}</span>
                        </div>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class="info-box">
                        <div class="title">Passenger Notes</div>
                        <div class="content">
                            <span class="text-muted">{{::booking.PassengerNotes || 'No Notes Added' }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
