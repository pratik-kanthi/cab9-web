!function(e,t){function n(e,n,r,o,a,i,s,u,l,c,d){if(n.enabled(!1),c.setEndpoint(e.API_ENDPOINT+"signalr/hubs"),c.setHub("locationHub"),item=localStorage.getItem("AUTH_TKN"))try{var g=t.fromJson(item);c.setQueryValue("token",g.access_token)}catch(m){console.log(m)}c.registerEvent("updateDriverLocation"),c.registerEvent("updateDriverStatus"),c.registerEvent("updateBookingStatus"),c.registerEvent("updateBookingOffer"),c.registerEvent("updateBooking"),l.showWeeks=!1,l.showButtonBar=!1,s.setGlobalLoggingLevel(5),s.addProvider("ConsoleLoggingProvider"),s.hideCatagory("APP RUN"),o.otherwise("/"),o.when("","/"),r.state("root",{"abstract":!0,onEnter:function(){setTimeout(function(){jQuery(".animation-root").removeClass("animation-root")},1e3)},views:{layout:{templateUrl:"/e9_components/layouts/structure/page.layout.html"},"sidebar-left@root":{templateUrl:"/webapp/layout/sidebar-left/sidebar-left.partial.html",controller:"SidebarController"},"topbar@root":{templateUrl:"/webapp/layout/topbar/topbar.partial.html",controller:"TopBarController"},"sidebar-right@root":{templateUrl:"/webapp/layout/sidebar-right/sidebar-right.partial.html"}}}),d.setOptions({delay:3e3,startTop:20,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"right",positionY:"top"})}function r(e,t,n,r,a,i,s,u,l,c,d,g,m,h,f,p){function y(){var a=r.createLogger("ROUTER"),l=f.currency(),m=l.currencies(),h=null;n.$on("$stateChangeStart",function(e,t,r,o,i){e.defaultPrevented||(a.debug("$stateChangeStart triggered"),h=s(function(){n.loading=!0},500))}),n.$on("$stateNotFound",function(e,t,r,o){a.warning("$stateNotFound triggered"),u.go("root"),n.loading=!1}),n.$on("$stateChangeSuccess",function(e,t,r,o,i){a.debug("$stateChangeSuccess triggered"),l.getCurrent()&&n.COMPANY&&l.getCurrent().Id!=n.COMPANY.DefaultCurrencyId&&l.setCurrent(n.COMPANY.DefaultCurrencyId),h&&(s.cancel(h),h=null),n.loading=!1}),n.$on("$stateChangeError",function(e,t,n,r,o,i){a.warning("$stateChangeError triggered"),a.debug("Route Error: Redirecting to Dashboard"),a.debug(i),u.go("root")}),n.$on("$viewContentLoading",function(e,t,n){a.debug("$viewContentLoading triggered")}),n.$on("$viewContentLoaded",function(e,t,n){a.debug("$viewContentLoaded triggered"),$("html,body").animate({scrollTop:0},0,function(){})}),d.AUTH_TKN&&(t.setQueryValue("token",d.AUTH_TKN.access_token),C(),I(),i.Company.query().include("DefaultDriverPaymentModel").filter("Id eq guid'"+g.getSession().TenantId+"'").execute().then(function(e){n.COMPANY=e[0],m.then(function(t){l.setCurrent(e[0].DefaultCurrencyId),o=l.getCurrent().Prepend}),e[0].DefaultLocale?p.set(e[0].DefaultLocale):p.set(c.DEFAULT_LOCALE),e[0].DefaultTimezone&&(moment.tz.setDefault(e[0].DefaultTimezone),f.timeZone().setTimeZone(e[0].DefaultTimezone)),f.useMetric(e[0].UseMetric)}),g.getSession().Claims.PassengerId&&g.getSession().Claims.PassengerId[0]&&(n.PASSENGERID=g.getSession().Claims.PassengerId[0])),n.$on(e.LOGIN_SUCCESS,function(e,r){t.setQueryValue("token",r.access_token),C(),I(),i.Company.query().filter("Id eq guid'"+r.TenantId+"'").execute().then(function(e){n.COMPANY=e[0]})}),t.start().then(function(){a.info("SignalR Started")})}function C(){i.DriverType.query().execute().then(function(e){l.DriverType=e,l.DriverType.$updated=new moment}),i.VehicleType.query().execute().then(function(e){l.VehicleType=e,l.VehicleType.$updated=new moment}),i.VehicleClass.query().execute().then(function(e){l.VehicleClass=e,l.VehicleClass.$updated=new moment}),i.ClientType.query().execute().then(function(e){l.ClientType=e,l.ClientType.$updated=new moment})}function I(){i.Driver.query().select("Id,Firstname,Surname").parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname}).execute().then(function(e){m.Driver=e}),i.Client.query().select("Id,Name").execute().then(function(e){m.Client=e}),i.Passenger.query().select("Id,Firstname,Surname").parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname}).execute().then(function(e){m.Passenger=e}),i.Vehicle.query().select("Id,Registration").parseAs(function(e){this.Id=e.Id,this.Name=e.Registration}).execute().then(function(e){m.Vehicle=e}),i.Staff.query().select("Id,Firstname,Surname").parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname}).execute().then(function(e){m.Staff=e})}r.createLogger("APP RUN");n.COMPANY={},n.PASSENGERID=null,n.filters={From:null,To:null,DriverIds:[],ClientIds:[],PassengerIds:[],VehicleTypeIds:[],VehicleClassIds:[],CurrencyIds:[],PaymentMethods:null,BookingSources:null,PeriodLength:""},y(),n.API_ENDPOINT=c.API_ENDPOINT}var o="Â£",a=t.module("cab9.passenger",["cab9.common","cab9.passenger.dashboard","cab9.passenger.bookings","cab9.passenger.profile","rzModule"]);a.config(n),a.run(r),a.constant("$UI",{COLOURS:{brandPrimary:"#455674",brandSecondary:"#A88ADC",menuLight:"#2B303B",menuDark:"#21252D",blue:"#008FFB",red:"#F55753",orange:"#e67e22",yellow:"#F8D053",cyan:"#10CFBD",sky:"#48B0F7",green:"#64c458",purple:"#6D5CAE",brandGrey:"#3B4752",darkGrey:"#2B303B",lightGrey:"rgba(100,100,100,0.1)",grey:"#788195",lighterGrey:"rgba(0,0,0,0.2)"}}),n.$inject=["$config","$sceProvider","$stateProvider","$urlRouterProvider","$compileProvider","MenuServiceProvider","LoggerProvider","ModelProvider","datepickerConfig","SignalRProvider","NotificationProvider"],r.$inject=["AUTH_EVENTS","SignalR","$rootScope","Logger","$modal","Model","$timeout","$state","LookupCache","$config","$localStorage","Auth","ViewerCache","$http","Localisation","tmhDynamicLocale"]}(window,angular);;;;
!function(r,o){function a(r,o,a){r.state("root.dashboard",{url:"/",showTimeControl:!0,views:{"content-wrapper@root":{controller:"DashboardController",templateUrl:"/webapp/management/dashboard/dashboard.partial.html"}}}),o.registerMenuItem({state:"root.dashboard",icon:"dashboard",title:"Dashboard"})}function e(){}var t=o.module("cab9.passenger.dashboard",[]);t.config(a),t.run(e),a.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider"],e.$inject=[]}(window,angular);;;;
!function(e){function t(e,t,a,o,n,r,u,d){function s(){l=new Packery(g,{itemSelector:".grid-item",isInitLayout:!1,percentPosition:!0,gutter:0});var e=JSON.parse(localStorage.getItem("dashboardOrder"));if(e){var t=l.items.slice(0);for(i=0;i<t.length;i++){var a=t[i].element.parentElement.getAttributeNode("order").value,o=e.indexOf(a);l.items[o]=t[i]}}l.layout(),l.on("dragItemPositioned",function(e,t){var a=$(l.getItemElements()),o=[];for(i=0;i<a.length;i++)o.push(a[i].parentElement.getAttributeNode("order").value);localStorage.setItem("dashboardOrder",JSON.stringify(o))});var n=$(g).find(".grid-item").draggable();l.bindUIDraggableEvents(n)}e.dataRequestsCount=null;var l=null,g=document.querySelector(".grid");d.$on("Data Loading",function(){e.dataRequestsCount?e.dataRequestsCount+=1:e.dataRequestsCount=1}),d.$on("Data Loaded",function(){e.dataRequestsCount-=1,0==e.dataRequestsCount&&u(function(){s(),e.$apply()},10)})}var a=e.module("cab9.passenger.dashboard");a.controller("DashboardController",t),t.$inject=["$scope","$UI","$config","$http","$q","$filter","$timeout","$rootScope"]}(angular);;;;
!function(e){function r(e,r,t){e.state("root.bookings",{url:"/bookings",views:{"content-wrapper@root":{controller:"BookingsTableController",templateUrl:"/webapp/passenger/bookings/bookings-table.partial.html"}}}),e.state("root.bookings.create",{url:"/create",views:{"content-wrapper@root":{controller:"BookingCreateController",templateUrl:"/webapp/passenger/bookings/edit/booking-edit.partial.html",resolve:{rPassenger:["Model","Auth",function(e,r){var t=r.getSession().Claims.PassengerId?r.getSession().Claims.PassengerId[0]:null;return e.Passenger.query().select("Id,Firstname,Surname,ClientId,Mobile,ImageUrl,Client/Name").include("Client").filter("Id","==","guid'"+t+"'").parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname,this.Description=e.Mobile?e.Mobile:"No Mobile",this.ClientId=e.ClientId,this.ImageUrl=window.formatImage(e.ImageUrl,e.Firstname)}).execute()}],rClient:["Model","rPassenger",function(e,r){var t=e.Client.query().select("Id,Name,ImageUrl,ClientType/Name,DefaultCurrencyId").include("ClientType");return r[0].ClientId&&t.filter("Id","==","guid'"+r[0].ClientId+"'"),t.parseAs(function(e){this.Id=e.Id,this.Name=e.Name,this.Description=e.ClientType.Name,this.ImageUrl=window.formatImage(e.ImageUrl,e.Name),this.DefaultCurrencyId=e.DefaultCurrencyId}).execute()}],rVehicleTypes:["Model",function(e){return e.VehicleType.query().execute()}],rVehicleClasses:["Model",function(e){return e.VehicleClass.query().execute()}],rCurrencies:["Model",function(e){return e.Currency.query().execute()}],rTaxes:["Model",function(e){return e.Tax.query().include("TaxType").execute()}]}}}}),e.state("root.bookings.viewer",{url:"/:Id","default":"root.bookings.viewer.details",resolve:{rBooking:["Model","$stateParams",function(e,r){return e.Booking.query().filter("Id","==","guid'"+r.Id+"'").include("Driver,Client,Vehicle,BookingStops,BookingStops/PassengerStops,Passengers,LeadPassenger,Currency,BookingRequirements,Notifications").trackingEnabled().execute().then(function(e){return e[0]})}],rClients:["Model",function(e){return e.Client.query().select("Id,Name,ImageUrl,ClientType/Name, DefaultCurrencyId").include("ClientType").parseAs(function(e){this.Id=e.Id,this.Name=e.Name,this.Description=e.ClientType.Name,this.ImageUrl=window.formatImage(e.ImageUrl,e.Name),this.DefaultCurrencyId=e.DefaultCurrencyId}).execute()}],rVehicleTypes:["Model",function(e){return e.VehicleType.query().select("Id,Name").execute()}],rVehicleClasses:["Model",function(e){return e.VehicleClass.query().select("Id,Name").execute()}],rDrivers:["Model",function(e){return e.Driver.query().select("Id,Firstname,Surname,Callsign,ImageUrl,DriverType/Name").include("DriverType").parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname+" ("+e.Callsign+")",this.Description=e.DriverType.Name,this.ImageUrl=window.formatImage(e.ImageUrl,e.Callsign)}).execute()}],rVehicles:["Model",function(e){return e.Vehicle.query().select("Id,Registration,Colour,Make,Model,Class,Type").include("Class,Type").parseAs(function(e){this.Id=e.Id,this.Name=e.Registration,this.Description=e.Colour+" "+e.Make+" "+e.Model,this.DriverId=e.DriverId,this.ImageUrl=window.formatImage(e.ImageUrl,e.Registration)}).execute()}],rPassengers:["Model",function(e){return e.Passenger.query().select("Id,Firstname,Surname,ClientId,ImageUrl,Client/Name").include("Client").parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname,this.Description=e.Mobile?e.Mobile:"No Mobile",this.ClientId=e.ClientId,this.ImageUrl=window.formatImage(e.ImageUrl,e.Firstname)}).execute()}],rTabs:function(){return[{heading:"Details",route:"root.bookings.viewer.details"}]},rTaxes:["Model",function(e){return e.Tax.query().include("TaxType").execute()}]},views:{"content-wrapper@root":{controller:"BookingsViewerController",templateUrl:"/webapp/passenger/bookings/bookings-viewer.partial.html"}}}),e.state("root.bookings.viewer.details",{url:"/details",templateUrl:"/webapp/passenger/bookings/edit/booking-edit.partial.html",controller:"BookingEditController"}),r.registerMenuItem({state:"root.bookings",icon:"event_note",title:"Bookings"})}function t(){}var i=e.module("cab9.passenger.bookings",[]);i.config(r),i.run(t),r.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider"],t.$inject=[]}(angular);;;;
!function(e){function t(t,o,r,n,a,i,s){function l(e){if(t.bookingGroups=[],t.paging.currentPage=e,t.searchTerm.$.length>0)s.get(n.API_ENDPOINT+"api/booking",{params:{search:t.searchTerm.$,$expand:"Driver,Client,Vehicle,BookingStops,LeadPassenger,Currency,BookingRequirements",$top:20,$skip:t.paging.resultsPerPage*(t.paging.currentPage-1),$orderby:"BookedDateTime desc"}}).success(function(e){var t=[];[].push.apply(t,e.map(function(e){return new o.Booking(e)})),g(t)});else{var r=o.Booking.query().trackingEnabled().filter("BookedDateTime","ge","datetimeoffset'"+new moment(t.filter.date.from).startOf("day").format()+"'").filter("BookedDateTime","le","datetimeoffset'"+new moment(t.filter.date.to).endOf("day").format()+"'").filter("LeadPassengerId","==","guid'"+t.PASSENGERID+"'").include("Driver,Client,Vehicle,BookingStops,LeadPassenger,Currency,BookingRequirements").select("Id,DriverId,ClientId,VehicleId,LeadPassengerId,Currency,CurrencyRate, Tax, BookedDateTime,Driver/Firstname,Driver/Surname,Driver/Callsign,Driver/ImageUrl,Driver/Email,Client/Name,Client/ImageUrl,Client/Email,Vehicle/Class,Vehicle/Registration,Vehicle/Colour,Vehicle/Make,Vehicle/Model,Vehicle/Registration,BookingStops/StopSummary,BookingStops/WaitTime,BookingStops/WaitTimeChargable,BookingStops/Address1,BookingStops/StopOrder,BookingStops/Address2,BookingStops/Area,BookingStops/TownCity,BookingStops/County,BookingStops/Postcode,BookingStops/Country,BookingStops/Latitude,BookingStops/Longitude,LeadPassenger/Firstname,LeadPassenger/Surname,LeadPassenger/Mobile,LeadPassenger/ImageUrl,LeadPassenger/Email").skip(t.paging.resultsPerPage*(t.paging.currentPage-1)).top(t.paging.resultsPerPage).orderBy("BookedDateTime desc");r.execute().then(function(e){g(e),c()},function(e){swal("Error","Please try again or contact admin","error")})}}function g(e){if(e.length>0){for(var o={date:e[0].BookedDateTime,bookings:[]},r=0;r<e.length;r++){var n=e[r];n.BookingStops=a("orderBy")(n.BookingStops,"StopOrder"),new moment(n.BookedDateTime).format("DD/MM/YYYY")==new moment(o.date).format("DD/MM/YYYY")?o.bookings.push(n):(t.bookingGroups.push(o),o={date:n.BookedDateTime,bookings:[]},o.bookings.push(n))}t.bookingGroups.push(o)}}function c(){var e=new moment(t.filter.date.from),o=new moment(t.filter.date.to);t.filterSummary=t.fetchStatus,e.format("DD/MM/YYYY")==o.format("DD/MM/YYYY")?t.filterSummary+=" Bookings for "+a("date")(e.toDate(),"shortDate"):(console.log,t.filterSummary+=" Bookings from "+a("date")(e.toDate(),"shortDate")+" to "+a("date")(o.toDate(),"shortDate"))}function m(){t.showSearch=!t.showSearch,t.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):t.searchTerm.$=""}function u(){i.open({templateUrl:"/webapp/passenger/bookings/modals/filter.modal.partial.html",controller:["$scope","rFilter","$modalInstance",function(t,o,r){function n(){r.close(t.filterOptions)}t.filterOptions=e.copy(o),t.datePickers={from:!1,to:!1},t.openDatePicker=function(e,o){t.datePickers[o]=!t.datePickers[o],event.preventDefault(),event.stopPropagation()},t.confirmFilters=n}],resolve:{rFilter:function(){return t.filter}}}).result.then(function(e){t.filter=e})}t.toggleSearch=m,t.searchTerm={$:""},t.paging={currentPage:1,resultsPerPage:20,totalResults:null,maxPages:null},t.setPage=l,t.filter={date:{from:new Date((new moment).startOf("day")),to:new Date((new moment).add(3,"months"))},ShowCompletedBookings:!1},t.setPage=l,t.bookingGroups=[],t.showFilterModal=u,t.$watchGroup(["filter","searchTerm.$"],function(e,r){if(t.bookingGroups.length=0,t.fetchStatus="Fetching",e[1])t.filterSummary="Searching Bookings for : '"+e[1]+"'",s.get(n.API_ENDPOINT+"api/search",{params:{searchText:e[1],$select:"Id"}}).success(function(o){t.paging.totalResults=o.length,t.filterSummary="Showing Bookings for : '"+e[1]+"'",t.paging.maxPages=Math.ceil(t.paging.totalResults/t.paging.resultsPerPage),l(1)});else{c();var a=null;a=t.filter.ShowCompletedBookings?"==":"!=";var i=o.Booking.query().select("Id").parseAs(function(e){this.Id=e.Id}).filter("BookedDateTime","ge","datetimeoffset'"+new moment(t.filter.date.from).startOf("day").format()+"'").filter("BookedDateTime","le","datetimeoffset'"+new moment(t.filter.date.to).endOf("day").format()+"'").filter("LeadPassengerId","==","guid'"+t.PASSENGERID+"'");i.execute().then(function(e){t.paging.totalResults=e.length,t.fetchStatus="Showing "+e.length,c(),t.paging.maxPages=Math.ceil(t.paging.totalResults/t.paging.resultsPerPage),l(1)},function(e){swal("Error","Please try again or contact admin","error")})}}),t.drivers=[],t.vehicles=[],o.Driver.query().execute().then(function(e){t.drivers=e}),o.Vehicle.query().execute().then(function(e){t.vehicles=e})}var o=e.module("cab9.passenger.bookings");o.controller("BookingsTableController",t),t.$inject=["$scope","Model","$q","$config","$filter","$modal","$http"]}(angular);;;;
!function(){function e(e,o,n,t,i,a,s){function l(e){o.open({templateUrl:"/webapp/common/views/conversations/conversations-list.partial.html",controller:"ConversationsModalController",windowClass:"chat",backdropClass:"chatBG",resolve:{rBooking:function(){return e}}})}var r=a.currency().getCurrent();e.booking.Client?e.CurrencyId=e.booking.Client.DefaultCurrencyId:e.CurrencyId=r.Id,e.assignDriver=function(e,o){e.DriverId=o.Id,e.$patch(!0).then(function(){e.Driver=o,e.$commit(!0)})},e.assignVehicle=function(e,o){e.VehicleId=o.Id,e.$patch(!0).then(function(){e.Vehicle=o,e.$commit(!0)})},e.removeDriver=function(e){e.DriverId=null,e.$patch(!0).then(function(){e.Driver=null,e.$commit(!0)})},e.removeVehicle=function(e){e.VehicleId=null,e.$patch(!0).then(function(){e.Vehicle=null,e.$commit(!0)})},e.toggleComplete=function(o,n){"Completed"==o.BookingStatus?(o.BookingStatus="Allocated",$(n.target).removeClass("animated tada")):(o.BookingStatus="Completed",$(n.target).addClass("animated tada")),o.$patch(!0).then(function(){s.success("Booking Saved"),setTimeout(function(){e.onCompleted()},1e3)})},e.getLocation=function(o){var t=[],i=new google.maps.DirectionsService,a={origin:o._FromSummary,destination:o._ToSummary,waypoints:t,optimizeWaypoints:!0,travelMode:google.maps.TravelMode.DRIVING};i.route(a,function(t,i){i==google.maps.DirectionsStatus.OK&&(staticMapUrl=encodeURI(n.GMAPS_STATIC_URL+"&markers=shadow:false|scale:2|icon:http://d1a3f4spazzrp4.cloudfront.net/receipt-new/marker-start@2x.png|"+o._FromSummary+"&markers=shadow:false|scale:2|icon:http://d1a3f4spazzrp4.cloudfront.net/receipt-new/marker-finish@2x.png|"+o._ToSummary+"&path=weight:5|color:0x2dbae4ff|enc:"+t.routes[0].overview_polyline),e.booking.mapUrl=staticMapUrl),e.$apply()})},e.emailTo=function(e,i){var a=o.open({templateUrl:"/webapp/common/modals/email-to.modal.html",controller:["$scope","emailAddress","$modalInstance",function(e,o,n){null!=o&&(e.email=o),e.sendEmail=function(){n.close(e.email)}}],resolve:{emailAddress:function(){var o=null;switch(e){case"DRIVER":o=i.Driver?i.Driver.Email:null;break;case"PAX":o=i.LeadPassenger?i.LeadPassenger.Email:null;break;case"CLIENT":o=i.Client?i.Client.Email:null}return o}}});a.result.then(function(o){null!=o&&(swal("Success","User will receive the email soon..","success"),"DRIVER"==e?t.post(n.API_ENDPOINT+"api/email",{Type:"DriverConfirmation",BookingId:i.Id,DriverId:i.DriverId,EmailId:o}).success(function(){s.success("Email Sent")}):"PAX"==e?t.post(n.API_ENDPOINT+"api/email",{Type:"PassengerConfirmation",BookingId:i.Id,PassengerId:i.LeadPassengerId,EmailId:o}).success(function(){s.success("Email Sent")}):"CLIENT"==e&&t.post(n.API_ENDPOINT+"api/email",{Type:"ClientConfirmation",BookingId:i.Id,ClientId:i.ClientId,EmailId:o}).success(function(){s.success("Email Sent")}))})};var c={toggle:!1,cancel:function(){e.booking.$rollback(),this.toggle=!1},save:function(){e.booking.$patch(),this.toggle=!1}};e.API_ENDPOINT=n.API_ENDPOINT;var d={toggle:!1,editDestination:function(i,a){this.toggle=!0;var s=o.open({templateUrl:"/webapp/passenger/bookings/stop-edit.modal.html",controller:"BookingDestinationStopModal",resolve:{dropOffLoc:function(){if(i)return e.booking._ToSummary}}});s.result["finally"](function(){d.toggle=!1}),s.result.then(function(o){if(i){var a=e.booking.BookingStops.length-1,s=e.booking.BookingStops.splice(a,1,o);o.Id=s[0].Id,o.BookingId=e.booking.Id,t({method:"PATCH",url:n.API_ENDPOINT+"api/BookingStops?id="+o.Id,data:o})}else{o.Type="Via";var a=e.booking.BookingStops.length-1;e.booking.BookingStops.splice(a,0,o),o.BookingId=e.booking.Id,t.post(n.API_ENDPOINT+"api/BookingStops",o)}})}};e.stopSummary=function(e){return e.Address1+" "+e.Area+", "+e.TownCity+", "+e.Postcode},e.editing={any:function(){return this.expenses.toggle||this.waiting.toggle||this.notes.toggle||this.stops.toggle},expenses:angular.copy(c),waiting:angular.copy(c),notes:angular.copy(c),stops:d},e.showConversations=l}function o(e,o,n){if(n){var t=new google.maps.Geocoder;t.geocode({address:n},function(o,n){e.choosen=o[0]})}else e.choosen=null;e.destinationValid=!1,e.map={center:{latitude:45,longitude:-73},zoom:17},e.markers=[],e.$watch("choosen",function(o){o&&angular.isObject(o)&&o.geometry?(console.log(o),e.destinationValid=!0,e.map.center={latitude:o.geometry.location.lat(),longitude:o.geometry.location.lng()},e.markers=[{id:"5WnUJbhPEg",coords:{latitude:o.geometry.location.lat(),longitude:o.geometry.location.lng()}}]):e.destinationValid=!1}),e.confirmDestination=function(){var n={};angular.forEach(e.choosen.address_components,function(e){var o=e.types[0];switch(o){case"street_number":n.Address2=e.long_name;break;case"route":n.Address1=e.long_name;break;case"locality":n.Area=e.long_name;break;case"postal_town":n.TownCity=e.long_name;break;case"administrative_area_level_2":n.County=e.long_name;break;case"postal_code":n.Postcode=e.long_name}}),e.choosen.types.filter(function(e){return"airport"===e||"transit_station"===e}).length?n.Alias=e.choosen.name:n.Alias=e.choosen.formatted_address;try{n.Latitude=e.choosen.geometry.lat(),n.Longitude=e.choosen.geometry.lng()}catch(t){}o.close(n)}}var n=angular.module("cab9.passenger.bookings");n.controller("BookingDestinationStopModal",o),n.directive("bookingStrip",function(){return{restrict:"E",templateUrl:"/webapp/passenger/bookings/booking-strip.template.html",scope:{booking:"=",drivers:"=",vehicles:"=",onCompleted:"&"},controller:e,link:function(e,o,n){e.$expanded=!1}}}),e.$inject=["$scope","$modal","$config","$http","Model","Localisation","Notification"],o.$inject=["$scope","$modalInstance","dropOffLoc"]}();;;;
!function(){function o(o,n,r,e){o.booking=n,o.tabDefs=r,o.accessors={LogoUrl:function(){return o.booking._ImageUrl}}}var n=angular.module("cab9.passenger.bookings");n.controller("BookingsViewerController",o),o.$inject=["$scope","rBooking","rTabs","$config"]}();;;;
!function(e){function t(t,o,n,s,i,r,c,l,a,d,u,g,C,k,B,m,p,f){function I(){t.selectedBooking=new a.Booking,t.selectedBooking.BookingStops.length=0;var e=new a.BookingStop;t.selectedBooking.BookingStops.push(e),t.selectedBooking.Pax=1,t.selectedBooking.Bax=0,t.selectedBooking.TaxId=t.COMPANY.DefaultTaxId,1==t.COMPANY.ChauffeurModeActive&&(t.selectedBooking.ChauffeurMode=!0),t.selectedBooking.VehicleTypeId=l.defaultVehicleType,t.selectedBooking.VehicleClassId=l.defaultVehicleClass;var o=new moment.tz(k.timeZone().getTimeZone());t.selectedBooking.BookedDateTime=o.toDate(),t.selectedBooking.Time=o.startOf("minute").add(15,"minutes").toDate(),t.selectedBooking.CurrencyId=t.COMPANY.DefaultCurrencyId,t.EstimatedCost=0,t.selectedBooking.ClientId=t.clients[0].Id.toLowerCase(),t.selectedBooking.LeadPassengerId=t.passengers[0].Id.toLowerCase()}function h(e){var o=t.selectedBooking.Passengers.filter(function(t){return t.Id==e})[0];if(o)return o.Firstname+" "+o.Surname}function D(){var e=new a.BookingStop;t.selectedBooking.BookingStops.push(e)}function v(){o.post(n.API_ENDPOINT+"api/quote",t.selectedBooking).success(function(e){e.FinalCost=e.FinalCost.toFixed(2),t.selectedBooking.CurrencyId!=t.COMPANY.DefaultCurrencyId?(t.selectedBooking.EstimatedCost=B("Convert")(e.FinalCost),t.selectedBooking.ActualCost=B("Convert")(e.FinalCost),t.EstimatedCost=e.FinalCost,t.ActualCost=e.FinalCost):(t.selectedBooking.EstimatedMins=e.EstimatedMins,t.selectedBooking.EstimatedCost=e.FinalCost,t.selectedBooking.ActualCost=e.FinalCost,t.EstimatedCost=e.FinalCost,t.ActualCost=e.FinalCost)}).error(function(e){console.log(e)})}function y(e){var i=new moment(t.selectedBooking.Time).add(moment.tz.zone(k.timeZone().getTimeZone()).offset(new Date),"minutes"),r=new moment(t.selectedBooking.BookedDateTime).format("YYYY-MM-DD")+"T"+i.format("HH:mm")+moment.tz(k.timeZone().getTimeZone()).format("Z");if("amount"!=t.discount.type){t.discount.type="amount";var c=t.selectedBooking.ActualCost*t.selectedBooking.Discount/100;t.selectedBooking.Discount=Math.round(100*c)/100}var l=t.selectedBooking,e={BookingStatus:"Confirmed",BookingSource:"Manual",BookedDateTime:r,Bax:l.Bax,Pax:l.Pax,EstimatedCost:l.EstimatedCost,ActualCost:l.ActualCost,DriverCost:l.DriverCost,InvoiceCost:l.InvoiceCost,VehicleClassId:l.VehicleClassId,VehicleTypeId:l.VehicleTypeId,DriverId:l.DriverId,VehicleId:l.VehicleId,ClientId:l.ClientId,BookingStops:t.selectedBooking.BookingStops,PassengerNotes:l.PassengerNotes,DriverNotes:l.DriverNotes,OfficeNotes:l.OfficeNotes,AutoDispatch:!l.DriverId,AsDirected:l.AsDirected,EncodedRoute:l.EncodedRoute,CurrencyId:l.CurrencyId,CurrencyRate:A.getCurrent().CurrentRate,TaxId:l.TaxId,Discount:l.Discount,ChauffeurMode:l.ChauffeurMode,EstimatedMins:l.EstimatedMins,EstimatedDuration:l.EstimatedDuration,EstimatedDistance:l.EstimatedDistance};if(t.paxMode.value){if(!l._LeadPassenger)return void swal("Invalid","Please add passenger details.","error");var a=l._LeadPassenger.split(" ");e.LeadPassenger={Firstname:a[0],Surname:a.slice(1).join(" "),Mobile:l._LeadPassengerNumber,ClientId:l.ClientId}}else{if(!l.LeadPassengerId)return void swal("Invalid","Please add passenger details.","error");e.LeadPassengerId=l.LeadPassengerId}e.CurrencyId&&t.COMPANY.DefaultCurrencyId!=e.CurrencyId&&(e.ActualCost=B("Convert")(e.ActualCost,t.COMPANY.DefaultCurrencyId,e.CurrencyId),e.EstimatedCost=B("Convert")(e.EstimatedCost,t.COMPANY.DefaultCurrencyId,e.CurrencyId),e.DriverCost&&(e.DriverCost=B("Convert")(e.DriverCost,t.COMPANY.DefaultCurrencyId,e.CurrencyId)),e.InvoiceCost&&(e.InvoiceCost=B("Convert")(e.InvoiceCost,t.COMPANY.DefaultCurrencyId,e.CurrencyId))),o.post(n.API_ENDPOINT+"api/bookings",e).success(function(e){swal("Success","Booking Saved","success"),s.go("root.bookings")}).error(function(){swal("Error","Something didn't work, please check input and try again","error")})}function E(e){c.Maps.Directions.route(e).then(function(e){t.directions.setDirections(e)})}function T(e){t.startNew(),A.setCurrent(t.COMPANY.DefaultCurrencyId)}var w=null;t.viewMode="CREATE",t.paxMode={value:!1},t.showTraffic=!1,t.selectedBooking=null,t.clients=d,t.vehicleTypes=g,t.vehicleClasses=C,t.passengers=u,t.taxes=p,t.setupComplete=!1,t.startNew=I,t.book=y,t.cancel=T,t.addStop=D,t.getQuote=v,t.getPassengerName=h,t.discount={type:"amount"},t.available=m;var A=k.currency();t.map={center:{latitude:t.COMPANY.BaseLatitude||51.471507,longitude:t.COMPANY.BaseLongitude||-.487904},disableDefaultUI:!0,styles:[{featureType:"landscape",stylers:[{hue:"#FFBB00"},{saturation:43.400000000000006},{lightness:37.599999999999994},{gamma:1}]},{featureType:"road.highway",stylers:[{hue:"#FFC200"},{saturation:-61.8},{lightness:45.599999999999994},{gamma:1}]},{featureType:"road.arterial",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:51.19999999999999},{gamma:1}]},{featureType:"road.local",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:52},{gamma:1}]},{featureType:"water",stylers:[{hue:"#0078FF"},{saturation:-13.200000000000003},{lightness:2.4000000000000057},{gamma:1}]},{featureType:"poi",stylers:[{hue:"#00FF6A"},{saturation:-1.0989010989011234},{lightness:11.200000000000017},{gamma:1}]}],zoom:t.COMPANY.BaseZoom||7,traffic:{show:!1,options:{}}},t.paxFilter=function(e){return!t.selectedBooking.ClientId||e.ClientId==t.selectedBooking.ClientId},t.directions={renderer:null,current:null,currentRoute:null,currentStep:null,setRoute:function(e){e!=this.currentRoute&&(this.currentRoute=e,this.currentStep=null,this.renderer.setRouteIndex(this.current.routes.indexOf(e)))},viewStep:function(e){this.currentStep=e,t.map.center.latitude=e.start_point.lat(),t.map.center.longitude=e.start_point.lng()},setDirections:function(e){this.current=e,this.currentStep=null,this.currentRoute=e?e.routes[0]:null,this.options.directions=e,e?(t.selectedBooking.EncodedRoute=this.currentRoute.overview_polyline,this.renderer?(this.renderer.setDirections(e),this.renderer.setMap(t.map.getGMap())):(this.options.map=t.map.getGMap(),this.renderer=new google.maps.DirectionsRenderer(this.options))):(this.current=null,this.options.directions=null,this.renderer&&this.renderer.setMap(null)),this.currentRoute&&this.currentRoute.legs&&this.currentRoute.legs[0]&&(t.selectedBooking.EstimatedDuration=10*Math.ceil(this.currentRoute.legs[0].duration.value/600),t.selectedBooking.EstimatedDistance=this.currentRoute.legs[0].distance.value)},options:{suppressInfoWindows:!0,suppressMarkers:!1,directions:null,panel:document.getElementById("google-directions")}},t.$watch("selectedBooking.AsDirected",function(e){if(e)t.selectedBooking.BookingStops.length--;else{var o=new a.BookingStop;t.selectedBooking.BookingStops.push(o)}}),t.$watch("selectedBooking.BookingStops",function(){if(t.selectedBooking.AsDirected);else if(t.selectedBooking.BookingStops.length<2)return t.selectedBooking.EstimatedCost=0,void(t.selectedBooking.validStops=!1);var o=!0;e.forEach(t.selectedBooking.BookingStops,function(e){e.Latitude&&e.Longitude||(o=!1)}),o?(E(t.selectedBooking.BookingStops.map(function(e){return new google.maps.LatLng(e.Latitude,e.Longitude)})),t.selectedBooking.validStops=!0,v()):(t.directions.setDirections(null),t.selectedBooking.EstimatedCost=0,t.selectedBooking.ActualCost=0,t.selectedBooking.Discount=0,t.selectedBooking.validStops=!1)},!0),t.$watch("selectedBooking.ClientId",function(){if(t.selectedBooking.ClientId){var e=t.clients.filter(function(e){return e.Id==t.selectedBooking.ClientId})[0];e&&(t.selectedBooking.CurrencyId=e.DefaultCurrencyId)}},!0),t.$watchGroup(["selectedBooking.BookingStops.length","selectedBooking.ClientId","selectedBooking.VehicleTypeId","selectedBooking.ChauffeurMode","selectedBooking.EstimatedMins"],function(){w&&(i.cancel(w),w=null),1==t.setupComplete&&(w=i(v,500))}),t.$watch("selectedBooking.VehicleTypeId",function(e){a.Vehicle.query().select("Id,Registration,Colour,Make,Model,Class,Type").where("VehicleTypeId","==","guid'"+e+"'").include("Class,Type").parseAs(function(e){this.Id=e.Id,this.Name=e.Registration,this.Description=e.Colour+" "+e.Make+" "+e.Model,this.DriverId=e.DriverId,this.ImageUrl=window.formatImage(e.ImageUrl,e.Registration)}).execute().then(function(e){t.vehicles=e})}),t.$watch("selectedBooking.Discount",function(){t.selectedBooking.Currency&&(t.Discount=t.selectedBook)}),t.$watch("selectedBooking.DriverCost",function(){t.selectedBooking.Currency&&(t.DriverCost=t.selectedBo)}),t.$watch("selectedBooking.InvoiceCost",function(){t.selectedBooking.Currency&&(t.InvoiceCost=t.selectedB)}),t.$watch("selectedBooking.CurrencyId",function(){A.setCurrent(t.selectedBooking.CurrencyId);var e=t.available.filter(function(e){return e.Id==t.selectedBooking.CurrencyId})[0];t.selectedBooking.CurrencyRate=e.CurrentRate,t.symbol=e.Prepend,t.selectedBooking.Currency=e,t.selectedBooking.ActualCost=((t.ActualCost||0)*e.CurrentRate).toFixed(2),t.selectedBooking.EstimatedCost=((t.EstimatedCost||0)*e.CurrentRate).toFixed(2),t.selectedBooking.DriverCost&&(t.selectedBooking.DriverCost=((t.DriverCost||t.selectedBooking.DriverCost)*e.CurrentRate).toFixed(2)),t.selectedBooking.InvoiceCost&&(t.selectedBooking.InvoiceCost=((t.InvoiceCost||t.selectedBooking.InvoiceCost)*e.CurrentRate).toFixed(2)),"amount"==t.discount.type&&(t.selectedBooking.Discount=((t.Discount||t.selectedBooking.Discount)*e.CurrentRate).toFixed(2)),t.setupComplete=!0}),t.startNew()}function o(t,o,n,s,i,r,c,l,a,d,u,g,C,k,B,m,p,f,I,h){function D(){var e=f.getSession().access_token,o=window.encodeURIComponent(s.API_ENDPOINT+"Exports/BookingReceipt/template.html#/?token="+e+"&bookingid="+t.selectedBooking.Id);p.open("http://h2p.utilities.e9ine.com/?url="+o+"&filename="+t.selectedBooking.Id,"_blank")}function v(e){r.Maps.Directions.route(e).then(function(e){t.directions.setDirections(e)})}function y(){t.viewMode="EDIT"}function E(){var e={ActualCost:t.selectedBooking.ActualCost,EstimatedCost:t.selectedBooking.EstimatedCost,DriverCost:t.selectedBooking.DriverCost,InvoiceCost:t.selectedBooking.InvoiceCost,DiscountCost:t.selectedBooking.DiscountCost};t.selectedBooking.$rollback(!0),t.selectedBooking.ActualCost=e.ActualCost,t.selectedBooking.EstimatedCost=e.EstimatedCost,t.selectedBooking.DriverCost=e.DriverCost,t.selectedBooking.InvoiceCost=e.InvoiceCost,t.selectedBooking.DiscountCost=e.DiscountCost,t.selectedBooking.Client?S.setCurrent(t.selectedBooking.Client.DefaultCurrencyId):S.setCurrent(t.COMPANY.DefaultCurrencyId),t.viewMode="VIEW"}function T(e){var o=t.selectedBooking.Passengers.filter(function(t){return t.Id==e})[0];if(o)return o.Firstname+" "+o.Surname}function w(){n({url:s.API_ENDPOINT+"api/bookings",params:{Id:t.selectedBooking.Id},method:"PATCH",data:{Id:t.selectedBooking.Id,BookingStatus:"Cancelled"}}).success(function(){t.selectedBooking.BookingStatus="Cancelled",swal("Booking Cancelled","This Booking has been cancelled","success")}).error(function(){swal("Error","Something didn't work, please check input and try again","error")})}function A(){var o=(t.selectedBooking.BookedDateTime,t.selectedBooking.Time),i=new moment(t.selectedBooking.Time).add(moment.tz.zone(k.timeZone().getTimeZone()).offset(new Date),"minutes"),r=new moment(t.selectedBooking.BookedDateTime).format("YYYY-MM-DD")+"T"+i.format("HH:mm")+moment.tz(k.timeZone().getTimeZone()).format("Z");if(t.selectedBooking.BookedDateTime=r,t.selectedBooking.LeadPassenger=null,"amount"!=t.discount.type){t.discount.type="amount";var c=t.selectedBooking.ActualCost*t.selectedBooking.Discount/100;t.selectedBooking.Discount=Math.round(100*c)/100}t.EstimatedCost=t.selectedBooking.EstimatedCost,t.ActualCost=t.selectedBooking.ActualCost,t.DriverCost=t.selectedBooking.DriverCost,t.InvoiceCost=t.selectedBooking.InvoiceCost,t.DiscountCost=t.selectedBooking.Discount,t.selectedBooking.ActualCost=t.selectedBooking.ActualCost/t.selectedBooking.CurrencyRate,t.selectedBooking.DriverCost=t.selectedBooking.DriverCost/t.selectedBooking.CurrencyRate,t.selectedBooking.EstimatedCost=t.selectedBooking.EstimatedCost/t.selectedBooking.CurrencyRate,t.selectedBooking.InvoiceCost=t.selectedBooking.InvoiceCost/t.selectedBooking.CurrencyRate,t.selectedBooking.Discount=t.selectedBooking.Discount/t.selectedBooking.CurrencyRate,delete t.selectedBooking.Time;var l=e.copy(t.selectedBooking);delete l.Currency,delete l.Client,delete l.Time,delete l.Vehicle,delete l.LeadPassenger,n.put(s.API_ENDPOINT+"api/bookings",l,{params:{Id:l.Id}}).success(function(){t.selectedBooking.BookedDateTime=new moment(t.selectedBooking.BookedDateTime).format(),swal("Booking Updated","This Booking has been updated","success"),t.viewMode="VIEW",t.selectedBooking.ActualCost=t.ActualCost,t.selectedBooking.DriverCost=t.DriverCost,t.selectedBooking.EstimatedCost=t.EstimatedCost,t.selectedBooking.InvoiceCost=t.InvoiceCost,t.selectedBooking.Discount=t.DiscountCost,t.selectedBooking.Time=o}).error(function(){t.selectedBooking.BookedDateTime=new moment(t.selectedBooking.BookedDateTime).format(),swal("Error","Something didn't work, please check input and try again","error"),t.selectedBooking.ActualCost=t.ActualCost,t.selectedBooking.DriverCost=t.DriverCost,t.selectedBooking.EstimatedCost=t.EstimatedCost,t.selectedBooking.InvoiceCost=t.InvoiceCost,t.selectedBooking.Discount=t.DiscountCost,t.selectedBooking.Time=o})}function P(){n.post(s.API_ENDPOINT+"api/quote",t.selectedBooking).success(function(e){t.EstimatedCost=e.FinalCost,t.selectedBooking.EstimatedCost=(t.EstimatedCost*t.selectedBooking.CurrencyRate).toFixed(2),t.selectedBooking.EstimatedMins=e.EstimatedMins}).error(function(e){console.log(e)})}t.viewMode="VIEW";var M=null;t.showTraffic=!1,t.setupComplete=!1,t.paxMode={value:!1},t.discount={type:"amount"},t.selectedBooking=a,t.selectedBooking.BookedDateTime=new Date(t.selectedBooking.BookedDateTime);var R=new moment.tz(a.BookedDateTime,k.timeZone().getTimeZone());R.subtract(moment.tz.zone(k.timeZone().getTimeZone()).offset(new Date),"minutes"),t.selectedBooking.Time=R.toDate(),t.selectedBooking.$commit(!0),t.selectedBooking.BookingStops.map(function(e){e.id=idCounter++}),t.clients=d,t.vehicleTypes=u,t.vehicleClasses=g,t.passengers=C,t.taxes=m,t.symbol=t.selectedBooking.Currency.Prepend,t.startEdits=y,t.cancel=E,t.save=A,t.cancelBooking=w,t.getPassengerName=T,t.EstimatedCost=t.selectedBooking.EstimatedCost,t.ActualCost=t.selectedBooking.ActualCost,t.DriverCost=t.selectedBooking.DriverCost,t.InvoiceCost=t.selectedBooking.InvoiceCost,t.Discount=t.selectedBooking.Discount,t.selectedBooking.ActualCost=t.ActualCost*t.selectedBooking.CurrencyRate,t.selectedBooking.DriverCost=t.DriverCost*t.selectedBooking.CurrencyRate,t.selectedBooking.EstimatedCost=t.EstimatedCost*t.selectedBooking.CurrencyRate,t.selectedBooking.InvoiceCost=t.InvoiceCost*t.selectedBooking.CurrencyRate,t.selectedBooking.Discount=t.Discount*t.selectedBooking.CurrencyRate,t.selectedBooking.ActualCost&&(t.selectedBooking.ActualCost=t.selectedBooking.ActualCost.toFixed(2)),t.selectedBooking.DriverCost&&(t.selectedBooking.DriverCost=t.selectedBooking.DriverCost.toFixed(2)),t.selectedBooking.EstimatedCost&&(t.selectedBooking.EstimatedCost=t.selectedBooking.EstimatedCost.toFixed(2)),t.selectedBooking.InvoiceCost&&(t.selectedBooking.InvoiceCost=t.selectedBooking.InvoiceCost.toFixed(2)),t.selectedBooking.Discount&&(t.selectedBooking.Discount=t.selectedBooking.Discount.toFixed(2)),t.getQuote=P;var S=k.currency();t.exportReceipt=D,t.paxFilter=function(e){return!t.selectedBooking.ClientId||e.ClientId==t.selectedBooking.ClientId},t.map={center:{latitude:t.COMPANY.BaseLatitude||51.471507,longitude:t.COMPANY.BaseLongitude||-.487904},disableDefaultUI:!0,styles:[{featureType:"landscape",stylers:[{hue:"#FFBB00"},{saturation:43.400000000000006},{lightness:37.599999999999994},{gamma:1}]},{featureType:"road.highway",stylers:[{hue:"#FFC200"},{saturation:-61.8},{lightness:45.599999999999994},{gamma:1}]},{featureType:"road.arterial",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:51.19999999999999},{gamma:1}]},{featureType:"road.local",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:52},{gamma:1}]},{featureType:"water",stylers:[{hue:"#0078FF"},{saturation:-13.200000000000003},{lightness:2.4000000000000057},{gamma:1}]},{featureType:"poi",stylers:[{hue:"#00FF6A"},{saturation:-1.0989010989011234},{lightness:11.200000000000017},{gamma:1}]}],zoom:t.COMPANY.BaseZoom||7,traffic:{show:!1,options:{}}},t.directions={renderer:null,current:null,currentRoute:null,currentStep:null,setRoute:function(e){e!=this.currentRoute&&(this.currentRoute=e,this.currentStep=null,this.renderer.setRouteIndex(this.current.routes.indexOf(e)))},viewStep:function(e){this.currentStep=e,t.map.center.latitude=e.start_point.lat(),t.map.center.longitude=e.start_point.lng()},setDirections:function(e){this.current=e,this.currentStep=null,this.currentRoute=e?e.routes[0]:null,this.options.directions=e,e?(t.selectedBooking.EncodedRoute=this.currentRoute.overview_polyline,this.renderer?(this.renderer.setDirections(e),this.renderer.setMap(t.map.getGMap())):(this.options.map=t.map.getGMap(),this.renderer=new google.maps.DirectionsRenderer(this.options))):(this.current=null,this.options.directions=null,this.renderer&&this.renderer.setMap(null))},options:{suppressInfoWindows:!0,suppressMarkers:!1,directions:null,panel:document.getElementById("google-directions")}},t.$watchGroup(["selectedBooking.BookingStops.length","selectedBooking.ClientId","selectedBooking.VehicleTypeId","selectedBooking.ChaffuerMode","selectedBooking.EstimatedMins"],function(){return 0==t.setupComplete?void(t.setupComplete=!0):(M&&(i.cancel(M),M=null),void(M=i(P,500)))}),t.$watch("selectedBooking.BookingStops",function(){if("EDIT"===t.viewMode){if(t.selectedBooking.AsDirected);else if(t.selectedBooking.BookingStops.length<2)return t.selectedBooking.EstimatedCost=0,void(t.selectedBooking.validStops=!1);var o=!0;e.forEach(t.selectedBooking.BookingStops,function(e){e.Latitude&&e.Longitude||(o=!1)}),o?(v(t.selectedBooking.BookingStops.map(function(e){return new google.maps.LatLng(e.Latitude,e.Longitude)})),t.selectedBooking.validStops=!0):(t.directions.setDirections(null),t.selectedBooking.EstimatedCost=0,t.selectedBooking.validStops=!1)}},!0),v(t.selectedBooking.BookingStops.map(function(e){return new google.maps.LatLng(e.Latitude,e.Longitude)})),t.emailTo=function(e,t){var o=h.open({templateUrl:"/webapp/common/modals/email-to.modal.html",controller:["$scope","emailAddress","$modalInstance",function(e,t,o){null!=t&&(e.email=t),e.sendEmail=function(){o.close(e.email)}}],resolve:{emailAddress:function(){var o=null;switch(e){case"DRIVER":o=t.Driver?t.Driver.Email:null;break;case"PAX":o=t.LeadPassenger?t.LeadPassenger.Email:null;break;case"CLIENT":o=t.Client?t.Client.Email:null}return o}}});o.result.then(function(o){null!=o&&(swal("Success","User will receive the email soon..","success"),"DRIVER"==e?n.post(s.API_ENDPOINT+"api/email",{Type:"DriverConfirmation",BookingId:t.Id,DriverId:t.DriverId,EmailId:o}).success(function(){I.success("Email Sent")}):"PAX"==e?n.post(s.API_ENDPOINT+"api/email",{Type:"PassengerConfirmation",BookingId:t.Id,PassengerId:t.LeadPassengerId,EmailId:o}).success(function(){I.success("Email Sent")}):"CLIENT"==e&&n.post(s.API_ENDPOINT+"api/email",{Type:"ClientConfirmation",BookingId:t.Id,ClientId:t.ClientId,EmailId:o}).success(function(){I.success("Email Sent")}))})}}var n=e.module("cab9.passenger.bookings");n.controller("BookingCreateController",t),n.controller("BookingEditController",o),t.$inject=["$scope","$http","$config","$state","$timeout","Auth","Google","$tenantConfig","Model","rClient","rPassenger","rVehicleTypes","rVehicleClasses","Localisation","$filter","rCurrencies","rTaxes","$window"],o.$inject=["$scope","$q","$http","$config","$timeout","Google","$tenantConfig","Model","rBooking","rClients","rVehicleTypes","rVehicleClasses","rPassengers","Localisation","$filter","rTaxes","$window","Auth","Notification","$modal"]}(angular);;;;
!function(e){function r(e,r,t){e.state("root.profile",{url:"/profile",views:{"content-wrapper@root":{controller:"ProfileController",templateUrl:"/webapp/passenger/profile/profile.partial.html"}},resolve:{rData:["Model","$stateParams","Auth","$q",function(e,r,t,n){var i=n.defer();return e.User.query().where("Id","==","'"+t.getSession().UserId+"'").include("Claims").trackingEnabled().execute().then(function(r){var t=r[0].Claims.filter(function(e){return"PassengerId"==e.ClaimType})[0];t&&e.Passenger.query().where("Id","==","guid'"+t.ClaimValue+"'").trackingEnabled().execute().then(function(e){i.resolve(e)})}),i.promise}]}}),r.registerMenuItem({state:"root.profile",icon:"settings",title:"Profile"})}function t(){}var n=e.module("cab9.passenger.profile",[]);n.config(r),n.run(t),r.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider"],t.$inject=[]}(angular);;;;
!function(e){function s(e,s,r,n,a,o,d,t,c,i){function g(){r.openPicker({type:"Passenger",id:e.passenger.Id,searchTerm:e.passenger._Fullname}).then(function(s){e.passenger.ImageUrl=s,l()},function(e){})}function p(){e.viewMode="EDIT"}function u(){e.passenger.$rollback(!0),e.viewMode="VIEW"}function l(){var s=[];e.passenger.HomeAddress&&!e.passenger.HomeAddress.StopSummary&&(e.passenger.HomeAddress=null),e.passenger.WorkAddress&&!e.passenger.WorkAddress.StopSummary&&(e.passenger.WorkAddress=null),s.push(e.passenger.$patch()),a.all(s).then(function(){swal({title:"Profile Saved.",text:"Changes have been updated.",type:"success",confirmButtonColor:n.COLOURS.brandSecondary}),e.viewMode="VIEW"},function(){alert("Error"),console.log(arguments)})}function m(){e.user={UserName:d.getSession().UserName}}function f(){c.put($config.API_ENDPOINT+"api/account",e.user).success(function(e){swal({title:"Password updated",text:"Try login using new password!",type:"success"},function(e){t.$broadcast(i.LOGOUT)})}).error(function(e){swal("Error","Something didn't work, please check input and try again","error")})}e.passenger=s[0],e.accessors={LogoUrl:function(){return s[0]._ImageUrl}},e.user={UserName:d.getSession().UserName},e.viewMode="VIEW",e.displayMode="VIEW",e.passenger.HomeAddressId||(e.passenger.HomeAddress=new o.PassengerAddress,e.passenger.HomeAddress.PassengerId=e.passenger.Id),e.passenger.WorkAddressId||(e.passenger.WorkAddress=new o.PassengerAddress,e.passenger.WorkAddress.PassengerId=e.passenger.Id),e.chooseImage=g,e.startEditing=p,e.cancelEditing=u,e.saveEdits=l,e.cancelChangePassword=m,e.savePassword=f}var r=e.module("cab9.passenger.profile");r.controller("ProfileController",s),s.$inject=["$scope","rData","ImageUpload","$UI","$q","Model","Auth","$rootScope","$http","AUTH_EVENTS"]}(angular);;;;