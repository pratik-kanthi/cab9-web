!function(r,o){function a(r,o,a){r.state("root.dashboard",{url:"/",showTimeControl:!0,views:{"content-wrapper@root":{controller:"DashboardController",templateUrl:"/webapp/management/dashboard/dashboard.partial.html"}}}),o.registerMenuItem({state:"root.dashboard",icon:"dashboard",title:"Dashboard"})}function e(){}var t=o.module("cab9.dashboard",[]);t.config(a),t.run(e),a.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider"],e.$inject=[]}(window,angular);;;;
!function(e){function t(e,t,o,n,r,a,l,u){function c(){d=new Packery(m,{itemSelector:".grid-item",isInitLayout:!1,percentPosition:!0,columnWidth:"#width-sizer",gutter:0});var e=JSON.parse(localStorage.getItem("managementDashboardOrder"));if(e){var t=d.items.slice(0);for(i=0;i<t.length;i++){var o=t[i].element.parentElement.getAttributeNode("order").value,n=e.indexOf(o);d.items[n]=t[i]}}d.layout(),d.on("dragItemPositioned",function(e,t){var o=$(d.getItemElements()),n=[];for(i=0;i<o.length;i++)n.push(o[i].parentElement.getAttributeNode("order").value);localStorage.setItem("managementDashboardOrder",JSON.stringify(n))})}var d=null,m=document.querySelector(".grid");l(function(){c()},0);var s=!1;u.$on("Data Loaded",function(){s||(l(function(){c()},100),s=!0),l(function(){d.shiftLayout()},1e3),l(function(){e.$apply()},1e3)})}var o=e.module("cab9.dashboard");o.controller("DashboardController",t),t.$inject=["$scope","$UI","$config","$http","$q","$filter","$timeout","$rootScope"]}(angular);;;;
window.dispatchCleanup=[],function(e,t){function a(a,i,n,r){r.test("dispatch")&&(a.state("dispatch",{url:"/dispatch",permission:"Dispatch",onExit:function(){t.forEach(e.dispatchCleanup,function(e){return e()}),e.dispatchCleanup.length=0},resolve:{rCompany:["Model","Auth",function(e,t){return e.Company.query().select("Id,BaseLatitude,BaseLongitude,BaseZoom,DispatchLatitude,RequiresContactNumber,DispatchLongitude,DispatchZoom,AutoCopyPassengerNotes,RequiresClient,RequiresBooker,DefaultPax,DefaultBax,TextConfirmation,EmailConfirmation,TextOnArrival,CallOnArrival,TextAssigned,EmailAssigned,TextOnCompletion,TextOnOnRoute").filter("Id eq guid'"+t.getSession().TenantId+"'").execute()}],rTags:["Model","Auth",function(e,t){return e.Tag.query().filter("TenantId eq guid'"+t.getSession().TenantId+"'").execute()}]},views:{layout:{controller:"DispatchController",templateUrl:"/webapp/management/dispatch/dispatch.layout.html"},"map@dispatch":{controller:"DispatchMapController",templateUrl:"/webapp/management/dispatch/map/partial.html"},"drivers@dispatch":{templateUrl:"/webapp/management/dispatch/drivers/partial.html",controller:"DispatchDriversController"},"bookings@dispatch":{templateUrl:"/webapp/management/dispatch/bookings/partial.html",controller:"DispatchBookingsController"},"workshare@dispatch":{templateUrl:"/webapp/management/dispatch/workshare/partial.html",controller:"DispatchWorkshareController"},"unconfirmed@dispatch":{templateUrl:"/webapp/management/dispatch/unconfirmed/partial.html",controller:"DispatchUnconfirmedBookingController"}}}),a.state("dispatch.bookings",{url:"/bookings",views:{},onEnter:function(){setTimeout(function(){$(e).trigger("resize")},250)}}),a.state("dispatch.drivers",{url:"/drivers",onEnter:function(){},views:{}}),a.state("dispatch.workshare",{url:"/workshare",onEnter:function(){setTimeout(function(){$(e).trigger("resize")},250)}}),a.state("dispatch.newbooking",{url:"/new-booking",resolve:{},views:{"newbooking@dispatch":{templateUrl:"/webapp/management/dispatch/new/partial.html",controller:"DispatchNewBookingController"}}}),a.state("dispatch.unconfirmed",{url:"/unconfirmed",onEnter:function(){},onExit:function(){},resolve:{},views:{}}),n.registerMenuItem({state:"dispatch.bookings",icon:"map",title:"Dispatch"}))}var i=t.module("cab9.dispatch",["framework.services.data","framework.services.google"]);i.config(a),a.$inject=["$stateProvider","$urlRouterProvider","MenuServiceProvider","$permissions"]}(window,angular);;;;
!function(o){function n(n,e,t,a,r,s,d,c,l,u){function m(o){var e=n.dispatchObj.bookings.items.indexOf(o);n.dispatchObj.bookings.items.splice(e,1),n.dispatchObj.bookings.formatBookings(n.dispatchObj.bookings.items)}function g(o){var e=n.dispatchObj.bookings.items.indexOf(o);n.dispatchObj.bookings.items.splice(e,1),n.dispatchObj.bookings.formatBookings(n.dispatchObj.bookings.items)}function p(o,n){return"Cancelled"!=n&&"COA"!=n&&("Completed"==o.BookingStatus||void 0)}function f(o,n){var e=new a.Booking(o);if(o.$updating=!0,"Cancelled"==n)swal({title:"Are you sure?",text:"The Booking will be cancelled and not billed to client. Are you sure?",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top"},function(){return e.BookingStatus=n,e.$patch(!0).then(function(){o.$updating=!1,e.$commit(!0)}),swal("Cancelled","Booking is cancelled.","success"),!0}),o.$updating=!1;else if("COA"==n)swal({title:"Are you sure?",text:"The Booking will be marked COA and client may be billed a minimum amount. Are you sure?",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top"},function(){return e.BookingStatus=n,e.$patch(!0).then(function(){o.$updating=!1,e.$commit(!0)}),swal("Cancelled","Booking has been Cancelled on Arrival.","success"),!0}),o.$updating=!1;else{if(e.DriverPaymentId||e.InvoiceId)return swal("Warning","Booking status cannot be modified as the booking is Invoiced/Driver Paid","warning"),void(o.$updating=!1);if(("Completed"==n||"Allocated"==n||"OnRoute"==n||"Arrived"==n||"InProgress"==n||"COA"==n)&&!e.DriverId)return swal("Complete Warning","Booking cannot be completed as there is no driver attached to it.","warning"),void(o.$updating=!1);if("OpenToBid"==n&&o.PartnerId)return swal("Bid Warning","Shared booking cannot be sent for bidding","warning"),void(o.$updating=!1);swal({title:"Are you sure?",text:"Status of the booking will be updated and if applicable a message/phone call will be sent to the passenger.",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm"},function(){e.BookingStatus=n,e.$patch(!0).then(function(){o.$updating=!1,e.$commit(!0)})})}}function h(o){n.$parent.bookingGroups=[];for(var e=0;e<o.length;e++)o[e].ImageUrl="NA";var t=s("filter")(o,n.dispatchObj.bookingSearch),i=s("orderBy")(t,[function(o){return new moment(o.BookedDateTime).valueOf()},"LocalId"]);n.$parent.orderedBookings=i,n.dispatchObj.bookings.reload=n.dispatchObj.bookings.reload+1;for(var e=0;e<i.length;e++){var r=i[e],d=moment(r.BookedDateTime).diff(moment(),"minutes"),c=moment(r.BookedDateTime).diff(moment(),"hours");c>24?r.$countdown=moment(r.BookedDateTime).format("dddd"):d>120?r.$countdown=(d/60).toFixed(0)+" hours":d>=0?1==d?r.$countdown=d+" min":r.$countdown=d+" mins":d<-120?r.$countdown=(Math.abs(d)/60).toFixed(0)+" hours ago":d==-1?r.$countdown=Math.abs(d)+" min ago":r.$countdown=Math.abs(d)+" mins ago",r.AutoDispatch&&r.DispatchDateTime&&(d=moment(r.DispatchDateTime).diff(moment(),"minutes"),c=moment(r.DispatchDateTime).diff(moment(),"hours"),d-=5,c>24?r.$ad="AutoDispatch Eligable":d>120?r.$ad="AutoDispatch Eligable in "+(d/60).toFixed(0)+" hours":d>=0?1==d?r.$ad="AutoDispatch Eligable in <1 min":r.$ad="AutoDispatch Eligable in "+d+" mins":r.$ad="AutoDispatch Eligable"),r.BookingStops=s("orderBy")(r.BookingStops,"StopOrder"),r.Summary=r._JourneySummary;for(var l=0;l<r.BookingStops.length;l++)r.BookingStops[l]=new a.BookingStop(r.BookingStops[l])}}function b(o,e){var t=e[0];for(i=0;i<t.length;i++){var a=n.dispatchObj.bookings.items.filter(function(o){return o.Id==t[i].BookingId})[0];a&&(a.$eta=t[i].Time+" mins",a.$etaDesc=t[i].Description+" mins")}n.dispatchObj.bookings.reload=n.dispatchObj.bookings.reload+1}function k(o){e.get(t.API_ENDPOINT+"api/bookings/ClearEdits",{params:{bookingId:o.Id}})}function B(o){window.open("/webapp/common/modals/bookings/edit-booking/window.html#?id="+o.Id+"&clientId="+o.ClientId,"EDIT:"+o.Id,"height=850,width=1000,left=0,top=0")}function w(o){var n=new a.Booking(o);swal({title:"Are you sure?",text:"Driver will be unallocated and will be taken off this booking.",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm"},function(){n.DriverId?e.post(t.API_ENDPOINT+"api/bookings/UnallocateDriver",null,{params:{bookingId:n.Id}}).then(function(){n.BookingStatus="Incoming",n.DriverId=null,n.Driver=null,n.Partner=null,n.$commit(!0)}):n.PartnerId&&(n.PartnerId=null,n.BookingStatus="Incoming",n.$patch(!0).then(function(){n.Driver=null,n.Partner=null,n.$commit(!0)}))})}function I(o){var n=new a.Booking(o);swal({title:"Are you sure?",text:"Booking will be marked completed.",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm"},function(){n.BookingStatus="Completed",n.$patch(!0).then(function(){n.$commit(!0)})})}function O(o){var n=new a.Booking(o);swal({title:"Are you sure?",text:"Booking will be cancelled and handed back.",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm"},function(){n.BookingStatus="Cancelled",n.$patch(!0).then(function(){n.$commit(!0)})})}function v(n,i,a){o.isDefined(a)&&e.get(t.API_ENDPOINT+"api/dispatch/tracking",{params:{bookingId:n.Id,driverId:i,accepted:1==a?"true":"false"}}),c.open({templateUrl:"/webapp/management/dispatch/modals/allocation/modal.html",controller:"DispatchBookingAllocateModalController",size:"md",windowClass:"allocation-modal",backdrop:"static",keyboard:!1,resolve:{rBooking:function(){return n},rChoosen:function(){return i}}})}function D(o,n,i,a){e.post(t.API_ENDPOINT+"api/bookings/ChooseDriver",null,{params:{driverId:a,bookingId:i.Id,hard:"HARD"==o,notify:n}}).success(function(){swal("Assigned","Booking has been assigned.","success")})}function C(o){c.open({templateUrl:"/webapp/management/dispatch/modals/expenses/modal.html",controller:"DispatchBookingExpensesModalController",resolve:{rBooking:function(){return o},rExpenseTypes:["Model",function(o){return o.BookingExpenseType.query().execute()}],rTaxes:["Model",function(o){return o.Tax.query().execute()}]}})}function j(o,e){n.dispatchObj.history.unshift({status:e||"info",text:o,time:(new moment).format("HH:mm:ss")}),n.dispatchObj.history.length=Math.min(n.dispatchObj.history.length,F)}function A(){n.fetching=!0;for(var i=(new moment).add(n.dispatchObj.filters.fromSpan,"seconds").format(),s=(new moment).add(n.dispatchObj.filters.toSpan,"seconds").format(),d={from:i,to:s},c=Object.keys(n.dispatchObj.filters.bookingStatuses),l=0;l<c.length;l++)n.dispatchObj.filters.bookingStatuses[c[l]]?(d[c[l]]=!0,"Cancelled"==c[l]&&(d.COA=!0)):d[c[l]]=!1;e.get(t.API_ENDPOINT+"api/bookings/fordispatch",{params:d}).then(function(e){var t=e.data.map(function(o){return new a.Booking(o)});t.map(function(o){o.$pre=E(o),o.FlightInfo&&(moment().diff(moment(o.FlightInfo.LastUpdate),"hours")>10?o.FlightInfo.$Status="No updates yet.":o.FlightInfo.$Status="Last Updated "+moment(o.FlightInfo.LastUpdate).fromNow())});var i={},s={},d={},c={},l={};o.forEach(n.dispatchObj.bookings.items,function(o){o.$offer&&(i[o.$offer.BookingId]=o.$offer),o.$selected&&(s[o.Id]=!0),o.$recommendation&&(d[o.Id]=o.$recommendation),o.$warning&&(c[o.Id]=o.$warning),o.$eta&&(l[o.Id]=o.$eta)}),n.dispatchObj.bookings.items.length=0,r(function(){o.forEach(t,function(o){if(o.OneTransportReceived&&"Unconfirmed"==o.BookingStatus&&"Accepted"!=o.OneTransportStatus&&"AutoAccepted"!=o.OneTransportStatus){var e=moment(o.OneTransportReceived).add(90,"seconds").diff(moment(),"seconds");if(o.$countup=e+" secs",e<0)return}o.$offer=i[o.Id],o.$selected=s[o.Id],o.$recommendation=d[o.Id],o.$warning=c[o.Id],o.$eta=l[o.Id],o.DriverBids&&o.DriverBids.length>0&&(o.Bids="active bids"),n.dispatchObj.bookings.items.push(o)}),n.dispatchObj.map.updateBookingMarkers(),n.dispatchObj.bookings.formatBookings(n.dispatchObj.bookings.items),n.fetching=!1,r(function(){M()},0)},0),j("Bookings Fetched","SUCCESS")},function(){j("Bookings Failed","FAIL")})}function S(o){window.open("/webapp/common/modals/bookings/edit-booking/window.html#?id="+o.Id+"&editnow=true&clientId="+o.ClientId,"EDIT:"+o.Id,"height=850,width=1200,left=0,top=0")}function y(o){o&&c.open({templateUrl:"/webapp/management/dispatch/modals/booking-info.modal.html",size:"lg",scope:n,controller:"DispatchBookingModalController",resolve:{rBooking:function(){return e({method:"GET",url:t.API_ENDPOINT+"/api/bookings/GetDetailsForBooking?bookingId="+o.Id}).then(function(o){return new a.Booking(o.data)},function(o){swal("Error Occured","Some issue while pulling the details for the booking","error")})},rDispatchObj:function(){return n.dispatchObj},rWarning:function(){return o.$warning}}})}function T(o){o.$selected=!o.$selected,n.dispatchObj.bookings.reload++}function x(){1==n.COMPANY.EnableBidding?c.open({templateUrl:"/webapp/management/dispatch/modals/driver-bid/modal.html",size:"lg",controller:"DispatchBookingsBidController",resolve:{rBookings:function(){return n.orderedBookings.filter(function(o){return o.$selected})}}}).result.then(function(o){o&&(n.orderedBookings.map(function(o){o.$selected=!1}),n.dispatchObj.bookings.reload++)}):swal("Setting Disabled","Please enable auction settings for bidding facility or feel free to contact admin.","warning")}function P(o){if(n.dispatchObj.map.selected.bookingId&&n.dispatchObj.map.selected.bookingId==o.Id)n.dispatchObj.selectedBooking=null,n.dispatchObj.map.select(null,null),n.dispatchObj.selectedRow=null;else{var e=null,t=null;o&&o.DriverId&&(e=n.dispatchObj.drivers.items.filter(function(n){return n.DriverId==o.DriverId})[0]),o&&o.PartnerId&&o.PartnerDriverId&&(t=o.PartnerDriver),n.dispatchObj.map.select(o,e,t),n.dispatchObj.selectedRow=n.orderedBookings.indexOf(o)}}function E(o){var n=new moment(o.BookedDateTime),e=new moment(o.CreationTime),t=moment.duration(n.diff(e)).asMinutes();return t>30}function N(o,e){"13"==o.keyCode?(n.dispatchObj.selectedBooking=e,n.dispatchObj.map.drawRoute(e)):"27"==o.keyCode&&P(null)}function M(){$("#dispatch .booking").bind("keydown",function(o){if(o.preventDefault(),"40"==o.keyCode){var n=$(this).attr("tabindex");n++,$("[tabindex="+n+"]").focus()}else if("38"==o.keyCode){var n=$(this).attr("tabindex");n--,$("[tabindex="+n+"]").focus()}})}n.dispatchObj.bookings={items:[],formatBookings:h,selectBooking:P,openBooking:y,editBooking:S,addToBidQueue:T,startBid:x,confirm:D,refetchBookings:A,allocateDriver:v,addExpense:C,removeCompleted:m,removeCancelled:g,reload:0},n.fetching=!0,n.isPreBooking=E,n.manageKeyPress=N,n.driverETAs=[],n.today=(new moment).format("DD/MM/YYYY"),n.unallocateBooking=w,n.updateBookingStatus=f,n.completeBooking=I,n.cancelBooking=O,n.openEditModal=B,n.approveChanges=k,n.disabledStatus=p,r(function(){A()},0);var F=20;n.history=[];var U=d(function(){A(),console.log("refetchBookings - $interval")},6e4);window.dispatchCleanup.push(function(){n.$destroy(),U&&d.cancel(U)}),n.BS=["OnRoute","Arrived","InProgress","Completed","Cancelled","COA","OpenToBid"],n.$on("SIGNALR_sendDriverETA",b),n.getScoreClass=function(o){return o>=75?"label-success":o>=30?"label-warning":"label-danger"},n.$watch("dispatchObj.bookingSearch.$",function(){h(n.dispatchObj.bookings.items)}),n.confirm=D,n.$watch("SIGNALR.status",function(o,n){})}var e=o.module("cab9.dispatch");e.controller("DispatchBookingsController",n),n.$inject=["$scope","$http","$config","Model","$timeout","$filter","$interval","$modal","Localisation","Auth"]}(angular);;;;
!function(o){function i(o,i,t,n,a,e,r,s,c,h){function d(){i.get(t.API_ENDPOINT+"api/bookings/workshare-bookings").then(function(i){var t=i.data.map(function(o){var i=new n.Booking(o);return i.Summary=i._JourneySummary,i});o.dispatchObj.workshare.bookings.length=0,o.dispatchObj.workshare.bookings=e("filter")(t,o.dispatchObj.bookingSearch),o.fetching=!1},function(){})}function g(n){n.$loading=!0,o.dispatchObj.bookings.reload++,i.put(t.API_ENDPOINT+"api/partners/booking/accept?bookingId="+n.Id).success(function(){n.$loading=!1,o.dispatchObj.bookings.reload++,k("Booking Accepted","SUCCESS"),d()}).error(function(){n.$loading=!1,o.dispatchObj.bookings.reload++,k("Booking Accept Failed","FAIL"),d()})}function b(n){swal({title:"Are you sure?",text:"Booking will be handed back.",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm"},function(){n.$loading=!0,o.dispatchObj.bookings.reload++,i.put(t.API_ENDPOINT+"api/partners/booking/reject?bookingId="+n.Id).success(function(){n.$loading=!1,o.dispatchObj.bookings.reload++,k("Booking Rejected","SUCCESS"),d()}).error(function(){n.$loading=!1,o.dispatchObj.bookings.reload++,k("Booking Reject Failed","FAIL"),d()})})}function k(i,t){o.dispatchObj.history.unshift({status:t||"info",text:i,time:(new moment).format("HH:mm:ss")}),o.dispatchObj.history.length=Math.min(o.dispatchObj.history.length,maxHistory)}o.dispatchObj.workshare.refetchBookings=d,o.dispatchObj.workshare.acceptBooking=g,o.dispatchObj.workshare.rejectBooking=b,o.dispatchObj.workshare.items=[],o.dispatchObj.workshare.bookings=[],o.fetching=!0,d()}var t=o.module("cab9.dispatch");t.controller("DispatchWorkshareController",i),i.$inject=["$scope","$http","$config","Model","$timeout","$filter","$interval","$modal","Localisation","Auth"]}(angular);;;;
!function(){function e(e,d,a,n){function s(){e.$broadcast("rzSliderForceRender")}function o(){var d=r(e.timeSlider.minValue),a=r(e.timeSlider.maxValue);return window.allow7Days.indexOf(e.COMPANY.Id.toUpperCase())>-1?a-d>691200&&a-d:a-d>266400&&a-d}function l(){e.filters.fromSpan=r(e.timeSlider.minValue),e.filters.toSpan=r(e.timeSlider.maxValue),e.filters.bookingStatuses=e.status,d.close()}function r(e){return i.find(function(d){return d.Id==e}).Seconds}function t(e){return i.find(function(d){return d.Seconds==e}).Id}e.filters=a,e.confirmFilters=l,e.blockFilters=function(){var e=o();return e},e.$safeApply=function(e){var d=this.$root.$$phase;"$apply"==d||"$digest"==d?e&&"function"==typeof e&&e():this.$apply(e)};var i=[{Id:1,Label:"-24hr",Seconds:-86400},{Id:2,Label:"-12hr",Seconds:-43200},{Id:3,Label:"-6hr",Seconds:-21600},{Id:4,Label:"-4hr",Seconds:-14400},{Id:5,Label:"-2hr",Seconds:-7200},{Id:6,Label:"-1hr",Seconds:-3600},{Id:7,Label:"Now",Seconds:0},{Id:8,Label:"+1hr",Seconds:3600},{Id:9,Label:"+2hrs",Seconds:7200},{Id:10,Label:"+4hrs",Seconds:14400},{Id:11,Label:"+6hrs",Seconds:21600},{Id:12,Label:"+12hrs",Seconds:43200},{Id:13,Label:"+1 day",Seconds:86400},{Id:14,Label:"+2 days",Seconds:172800},{Id:15,Label:"+3 days",Seconds:259200},{Id:16,Label:"+4 days",Seconds:345600},{Id:17,Label:"+5 days",Seconds:432e3},{Id:18,Label:"+6 days",Seconds:518400},{Id:19,Label:"+7 days",Seconds:604800},{Id:20,Label:"+8 days",Seconds:691200},{Id:21,Label:"+9 days",Seconds:777600},{Id:22,Label:"+10 days",Seconds:864e3},{Id:23,Label:"+11 days",Seconds:950400},{Id:24,Label:"+12 days",Seconds:1036800},{Id:25,Label:"+13 days",Seconds:1123200},{Id:26,Label:"+14 days",Seconds:1209600},{Id:27,Label:"+15 days",Seconds:1296e3},{Id:28,Label:"+16 days",Seconds:1382400},{Id:29,Label:"+17 days",Seconds:1468800},{Id:30,Label:"+18 days",Seconds:1555200},{Id:31,Label:"+19 days",Seconds:1641600},{Id:32,Label:"+20 days",Seconds:1728e3},{Id:33,Label:"+21 days",Seconds:1814400},{Id:34,Label:"+22 days",Seconds:1900800},{Id:35,Label:"+23 days",Seconds:1987200},{Id:36,Label:"+24 days",Seconds:2073600},{Id:37,Label:"+25 days",Seconds:216e4},{Id:38,Label:"+26 days",Seconds:2246400},{Id:39,Label:"+27 days",Seconds:2332800},{Id:40,Label:"+28 days",Seconds:2419200},{Id:41,Label:"+29 days",Seconds:2505600},{Id:42,Label:"+30 days",Seconds:2592e3}];e.status=angular.copy(e.filters.bookingStatuses),e.timeSlider={minValue:t(e.filters.fromSpan),maxValue:t(e.filters.toSpan),options:{floor:1,ceil:42,step:1,pushRange:!0,draggableRange:!0,ticksArray:[0,6,25],noSwitching:!0,translate:function(e){return i.find(function(d){return d.Id==e}).Label}}};var c=!0;e.$watch("timeSlider.maxValue",function(d){if(c)c=!1;else if(o()){var a=266400;window.allow7Days.indexOf(e.COMPANY.Id.toUpperCase())>-1&&(a=691200);var s=i.filter(function(e){return e.Seconds>=r(d)-a});e.timeSlider.minValue=s[0].Id,c=!0,n(function(){e.$broadcast("rzSliderForceRender")})}}),e.$watch("timeSlider.minValue",function(d){if(c)c=!1;else if(o()){var a=266400;window.allow7Days.indexOf(e.COMPANY.Id.toUpperCase())>-1&&(a=691200);var s=i.filter(function(e){return e.Seconds<=r(d)+a});e.timeSlider.maxValue=s[s.length-1].Id,c=!0,n(function(){e.$broadcast("rzSliderForceRender")})}}),n(function(){s()},0)}function d(e,d,a,n){function s(){e.filters.driverStatuses=e.status,d.close()}e.filters=a,e.confirmFilters=s,e.status=angular.copy(a.driverStatuses)}var a=angular.module("cab9.dispatch");a.controller("DispatchBookingFilterModalController",e),a.controller("DispatchDriverFilterModalController",d),e.$inject=["$scope","$modalInstance","rFilters","$timeout"],d.$inject=["$scope","$modalInstance","rFilters","$timeout"]}();;;;
!function(){function e(e,n,o,r,t,a,s,d){function c(n){e.choosen.partner=null,e.choosen.driver=n;var o=e.drivers.filter(function(e){return e.Id==n.Id})[0];if(o)e.choosenFromBidded=!1;else{var o=e.biddeddrivers.filter(function(e){return e.Id==n.Id})[0];o&&(e.choosenFromBidded=!0)}}function l(n,o){e.choosen.driver=null,e.choosen.worksharePartner=n,e.choosen.workshareProduct=o,e.choosen.partner=null}function u(n){e.choosen.driver=null,e.choosen.worksharePartner=null,e.choosen.workshareProduct=null,e.choosen.partner=n}function g(){e.fetchingWorkshare=!0;var n=e.booking.BookingStops;n.length>1?t.get(a.API_ENDPOINT+"api/partner-products/all",{params:{bookingId:e.booking.Id,pickupLatitude:n[0].latitude,pickupLongitude:n[0].longitude,dropLatitude:n[n.length-1].latitude,dropLongitude:n[n.length-1].longitude}}).then(function(n){e.fetchingWorkshare=!1,e.worksharePartnerQuotes=n.data},function(n){e.fetchingWorkshare=!1}):t.get(a.API_ENDPOINT+"api/partner-products/all",{params:{bookingId:e.booking.Id,pickupLatitude:n[0].latitude,pickupLongitude:n[0].longitude}}).then(function(n){e.fetchingWorkshare=!1,e.worksharePartnerQuotes=n.data},function(n){e.fetchingWorkshare=!1})}function h(){e.fetchingPartners=!0;var n=e.booking.BookingStops;n.length>1?t.get(a.API_ENDPOINT+"api/Partner/Products",{params:{pLatitude:n[0].latitude,pLongitude:n[0].longitude,dLatitude:n[n.length-1].latitude,dLongitude:n[n.length-1].longitude}}).then(function(n){e.fetchingPartners=!1,e.partners=n.data.map(function(e){return e.Name=e.Name.substr(e.Name.indexOf(" ")+1),e})},function(n){e.fetchingPartners=!1}):t.get(a.API_ENDPOINT+"api/Partner/Products",{params:{pLatitude:n[0].latitude,pLongitude:n[0].longitude}}).then(function(n){e.fetchingPartners=!1,e.partners=n.data},function(n){e.fetchingPartners=!1})}function f(n,o){t.get(a.API_ENDPOINT+"api/bookings/CheckDriver",{params:{driverId:e.choosen.driver.Id,bookingId:e.booking.Id}}).success(function(e){e&&e.Conflict&&"Vehicle Mismatch"===e.Message?swal({title:e.Message,text:"Possible conflict as this vehicle does not match bookings Pax/Bags values.",type:"warning",showCancelButton:!0,closeOnConfirm:!1},function(){p(n,o)}):e&&e.Conflict?swal({title:"Booking Conflict",text:e.Message,type:"warning",showCancelButton:!0,closeOnConfirm:!1},function(){p(n,o)}):p(n,o)})}function p(n,r){e.inprogress=!0,t.post(a.API_ENDPOINT+"api/bookings/ChooseDriver",null,{params:{driverId:e.choosen.driver.Id,bookingId:e.booking.Id,hard:"HARD"==n,notify:r}}).success(function(){}),swal("Assigned","Booking has been assigned.","success"),o.close()}function I(){e.inprogress=!0,e.choosen.partner?t.post(a.API_ENDPOINT+"api/Partner/Booking",null,{params:{bookingId:e.booking.Id,pType:e.choosen.partner.PartnerType,pId:e.choosen.partner.Id}}).then(function(n){console.log(n),swal("Assigned","Booking has been assigned to "+e.choosen.partner.PartnerType+". Reference: "+n.data.ride_id,"success"),o.close()},function(e){swal("Partner Error",JSON.parse(e.data.Message).error_description,"error")}):e.choosen.worksharePartner&&t.post(a.API_ENDPOINT+"api/partner-products/offer",null,{params:{partnerId:e.choosen.worksharePartner.PartnerId,bookingId:e.booking.Id,vehicleTypeId:e.choosen.workshareProduct.VehicleTypeId}}).then(function(n){swal("Assigned","Booking assignment request created for partner "+e.choosen.worksharePartner.PartnerName,"success"),o.close()},function(e){swal("Partner Error",JSON.parse(e.data.Message).error_description,"error")})}e.drivers=null,e.booking=r,e.choosen={driver:null,partner:null,allocateType:"SOFT",notify:!0,fixedNotify:!1,pre:!1,worksharePartner:null,workshareProduct:null},e.fetchingWorkshare=!1,e.fetchingPartners=!1;var k=!0;e.inprogress=!1,e.confirm=f,e.chooseDriver=c,e.choosePartner=u,e.chooseWorkshareProduct=l,e.allocatePartner=I,g(),e.getScoreClass=function(e){return e>=75?"success":e>=30?"warning":"danger"};var P=!1;e.$watchGroup(["searchTerm","includeOffline"],function(){P&&(P=!1),e.searchTerm&&(prestate=e.includeOffline,e.includeOffline=!0,prestate||(P=!0)),t.get(a.API_ENDPOINT+"api/Bookings/BestSuitedDrivers",{params:{bookingId:e.booking.Id,includeOffline:!!e.includeOffline,searchText:e.searchTerm}}).then(function(n){var o=n.data,r=e.booking.BookingStops;if("OpenToBid"==e.booking.BookingStatus)t.get(a.API_ENDPOINT+"api/Bid/AvailableBids",{params:{pLatitude:r[0].latitude,pLongitude:r[0].longitude,bookingId:e.booking.Id,searchText:e.searchTerm}}).then(function(n){for(e.biddeddrivers=n.data,e.biddeddrivers.length>0&&e.biddeddrivers.map(function(e){e._ImageUrl=window.formatImage(e.ImageUrl,e.Callsign)}),i=0;i<e.biddeddrivers.length;i++){value=e.biddeddrivers[i].Id;var r=o.findIndex(function(e){return e.Id==value});r>-1&&o.splice(r,1)}if(e.drivers=o,e.drivers.map(function(e){e._ImageUrl=window.formatImage(e.ImageUrl,e.Callsign)}),k){if(d){var t=e.drivers.filter(function(e){return e.Id==d})[0];if(t)e.choosen.driver=t,e.choosen.pre=!0,e.choosenFromBidded=!1;else{var t=e.biddeddrivers.filter(function(e){return e.Id==d})[0];t&&(e.choosen.driver=t,e.choosen.pre=!0,e.choosenFromBidded=!0)}}k=!0}});else if(e.drivers=o,e.drivers.map(function(e){e._ImageUrl=window.formatImage(e.ImageUrl,e.Callsign)}),k){if(d){var s=e.drivers.filter(function(e){return e.Id==d})[0];s&&(e.choosen.driver=s,e.choosen.pre=!0,e.choosenFromBidded=!1)}k=!0}})}),h(),s(function(){$("#allocate-search").focus()},100),new moment(e.booking.BookedDateTime).isAfter((new moment).add(2,"hour"))&&(e.choosen.notify=!1)}var n=angular.module("cab9.dispatch");n.controller("DispatchBookingAllocateModalController",e),e.$inject=["$scope","$rootScope","$modalInstance","rBooking","$http","$config","$timeout","rChoosen"]}();;;;
!function(){function e(e,n,o,s,i,a,d,t){function c(){e.expense.$save().then(function(){swal("Expense Added","New Expense added to booking.","success"),n.dismiss()})}e.viewMode="CREATE",e.expense=new o.BookingExpense({BookingId:a.Id}),e.booking=a,e.expenseTypes=i,e.taxes=s,e.save=c}var n=angular.module("cab9.dispatch");n.controller("DispatchBookingExpensesModalController",e),e.$inject=["$scope","$modalInstance","Model","rTaxes","rExpenseTypes","rBooking","$http","$config"]}();;;;
!function(){function e(e,r,s,t,n,t,a,d){function o(){r.get(s.API_ENDPOINT+"api/drivers",{params:{$expand:"DriverType",$select:"Id,Firstname,Surname,Callsign,Active,DriverTypeId,DriverType/Name"}}).then(function(r){e.drivers=r.data.map(function(e){return e._Fullname=e.Firstname+" "+e.Surname,e}),e.filteredDrivers=e.drivers},function(e){swal("Error","Error occurred while fetching drivers.","error")})}function c(i){r.get(s.API_ENDPOINT+"api/Drivers/ForBiddedBooking?BookingId="+i.Id,{headers:{Authorization:"Bearer "+s.TOKEN}}).then(function(r){r.data.Drivers;e.filteredBiddedDrivers=[],r.data&&(e.drivers=r.data.Drivers.map(function(e){return e._Fullname=e.Firstname+" "+e.Surname,e}),e.filteredDrivers=e.drivers,e.filteredBiddedDrivers=r.data.BiddedDrivers.map(function(e){return e._Fullname=e.Firstname+" "+e.Surname,e}))},function(e){swal("Error","Error occurred while fetching drivers.","error")})}function l(i){var n={DriverIds:e.selected.DriverIds,Amount:e.bidConfig.amount,EnableDriverBidding:e.bidConfig.enableAuctionBidding,NotifyDrivers:i,BookingIds:e.bookings.map(function(e){return e.Id})};r.post(s.API_ENDPOINT+"api/bookings/startbidding",n).success(function(){t.close(!0),swal({title:"Drivers Informed.",text:"Drivers are invited to bid on the selected booking.",type:"success",confirmButtonColor:a.COLOURS.brandSecondary})}).error(function(e){t.close(!0),"Driver auction settings are disabled."==e.Message?swal("Error","Driver auction settings are disabled, Please enable auction or contact admin","error"):swal("Error","Please try again or contact admin","error")})}function v(){var i=e.bookings.map(function(e){return e.Id});swal({title:"Are you sure?",text:"All the biddings and invitation to drivers to bid will be cancelled.",type:"warning",showCancelButton:!0,confirmButtonColor:a.COLOURS.brandPrimary,confirmButtonText:"Confirm Cancel!",closeOnConfirm:!1},function(){r.post(s.API_ENDPOINT+"api/bookings/cancelbidding",i).success(function(){t.close(!0),swal({title:"Cancelled.",text:"All the biddings and invitation to drivers to bid are cancelled",type:"success",confirmButtonColor:a.COLOURS.brandSecondary})}).error(function(e){t.close(!0),swal("Error","Please try again or contact admin","error")})})}function u(){r.get(s.API_ENDPOINT+"api/drivertypes",{params:{$select:"Id,Name"}}).then(function(r){e.driverTypes=r.data},function(e){401==e.status?AuthFactory.fetchToken(function(){u()}):ConvoFactory.showErrorMsg()})}function f(r){e.allDriversSelected=!1,r.Id?(e.filteredDrivers=e.drivers.filter(function(e){return e.DriverTypeId===r.Id}),e.selectedCategory=r.Name):e.filteredDrivers=e.drivers}function D(){if(e.allDriversSelected=!e.allDriversSelected,e.selected.DriverTypeId){for(i=0,len=e.searchedDrivers.length;i<len;i++)if(e.searchedDrivers[i].DriverTypeId==e.selected.DriverTypeId){e.searchedDrivers[i].$checked=e.allDriversSelected;var r=e.selected.DriverIds.indexOf(e.searchedDrivers[i].Id);e.allDriversSelected?r===-1&&e.selected.DriverIds.push(e.searchedDrivers[i].Id):r!==-1&&e.selected.DriverIds.splice(r,1)}}else e.searchedDrivers=e.searchedDrivers.map(function(r){r.$checked=e.allDriversSelected;var i=e.selected.DriverIds.indexOf(r.Id);return e.allDriversSelected?i===-1&&e.selected.DriverIds.push(r.Id):i!==-1&&e.selected.DriverIds.splice(i,1),r})}function h(){e.filteredDrivers=e.filteredDrivers.map(function(r){return e.selected.DriverIds.indexOf(r.Id)!==-1?r.$checked=!0:r.$checked=!1,r})}function g(){return e.filteredDrivers&&0!=e.filteredDrivers.length?(e.searchedDrivers=e.filteredDrivers.filter(function(r){var i=r._Fullname+r.Callsign,s=!1;return e.searchTerm.$?(e.searchTerm.$=e.searchTerm.$.toLowerCase(),i.toLowerCase().indexOf(e.searchTerm.$)!=-1&&(e.searchTerm.$callsign?r.Callsign.toLowerCase().startsWith(e.searchTerm.$callsign.toLowerCase())&&(s=!0):s=!0)):e.searchTerm.$callsign?(e.searchTerm.$callsign=e.searchTerm.$callsign.toLowerCase(),r.Callsign.toLowerCase().startsWith(e.searchTerm.$callsign)&&(s=!0)):s=!0,s}),e.searchedDrivers):[]}function m(){return e.filteredBiddedDrivers&&0!=e.filteredBiddedDrivers.length?(e.searchedBiddedDrivers=e.filteredBiddedDrivers.filter(function(r){var i=r._Fullname+r.Callsign,s=!1;return e.searchTerm.$?(e.searchTerm.$=e.searchTerm.$.toLowerCase(),i.toLowerCase().indexOf(e.searchTerm.$)!=-1&&(e.searchTerm.$callsign?r.Callsign.toLowerCase().startsWith(e.searchTerm.$callsign.toLowerCase())&&(s=!0):s=!0)):e.searchTerm.$callsign?(e.searchTerm.$callsign=e.searchTerm.$callsign.toLowerCase(),r.Callsign.toLowerCase().startsWith(e.searchTerm.$callsign)&&(s=!0)):s=!0,s}),e.searchedBiddedDrivers):[]}function I(r){var i=e.selected.DriverIds.indexOf(r.Id);r.$checked?i===-1&&e.selected.DriverIds.push(r.Id):i!==-1&&e.selected.DriverIds.splice(i,1)}function p(){return function(e,r){if(e.Callsign.startsWith(r))return e}}e.bookings=n,e.bidConfig={enableAuctionBidding:!1},e.searchTerm={$:"",$callsign:""},e.selected={DriverIds:[]},e.showhelp=!1,e.driverCount=0,e.fetchDrivers=f,e.selectAllDrivers=D,e.selectDrivers=h,e.modifyDriverList=I,e.callsignStartsWith=p,e.getFilteredDrivers=g,e.getFilteredBiddedDrivers=m,e.SendBidding=l,e.CancelBidding=v,e.bookings.length>1?(e.multiBooking=!0,o()):(e.multiBooking=!1,c(e.bookings[0])),u()}var r=angular.module("cab9.dispatch");r.controller("DispatchBookingsBidController",e),e.$inject=["$scope","$http","$config","$modalInstance","rBookings","$modalInstance","$UI","Auth"]}();;;;
!function(){function e(e,n,o,r,i,t){function a(n){e.activeTab=n,"History"!=e.activeTab||e.history||l(1,e.b)}function g(){e.historyPage++,l(e.historyPage,e.b)}function l(n,o){e.history||(e.history={});var a=10,g=(n-1)*a;e.fetchingHistory=!0,t.get(r.API_ENDPOINT+"api/Audit/ForBooking",{params:{bookingId:o.Id,top:a,skip:g}}).success(function(o){e.fetchingHistory=!1,1==n&&0==o.length&&(e.noHistory=!0),(o.length<a||"Booking Created"==o[o.length-1].BookingEvent)&&(e.noMoreHistory=!0),angular.forEach(o,function(n){var o=moment(n.Timestamp).format("DD MMM");e.history[o]||(e.history[o]=[]),e.history[o].push(new i.AuditRecord(n))})},function(n){swal("Payment Error","Error fetching history","error"),e.fetchingHistory=!1})}function c(n,o){var r=o[0];r.Id==e.b.Id&&(e.b=new i.Booking(angular.extend({},e.b,r)),e.b.BookingStops=e.b.BookingStops.sort(function(e,n){return e.StopOrder-n.StopOrder}),e.b.$pre=e.isPreBooking(e.b),"OnRoute"==e.b.BookingStatus&&(e.b.$eta="ETA: Calculating...",e.b.$etaDesc="Calculating ETA to Pickup"),"InProgress"==e.b.BookingStatus&&(e.b.$eta="ETA: Calculating...",e.b.$etaDesc="Calculating ETA to DropOff")),console.log("onUpdateBookingOfferModel - $scope.$apply"),e.$apply()}e.b=n,e.warning=o,e.activeTab="Info",e.fetchingHistory=!1,e.history=null,e.noHistory=!1,e.noMoreHistory=!1,e.historyPage=1,e.activateTab=a,e.fetchMoreHistory=g,e.b.BookingStops=e.b.BookingStops.sort(function(e,n){return e.StopOrder-n.StopOrder}),e.iconsIndex={"N/A":"assignment","Booking Offer Sent":"assignment","Booking Created":"assignment","Booking Cancelled":"assignment",FlightTrackingStarted:"flight_land",FlightTrackingStopped:"flight_land","SMS Confirmation":"insert_comment","Email Client Confirmation":"email","Email Booker Confirmation":"email","SMS Driver Arrived":"insert_comment","Call Driver Arrived":"phone","Email Manual Confirmation":"email","Driver Read Offer":"person_pin","Driver Accepted":"person_pin","Driver Rejected":"person_pin","Driver Allocated":"person_pin","Booking Offered To Driver":"person_pin","Booking Pre Allocated To Driver":"person_pin","Booking Patched":"assignment","Booking Edited":"assignment",DriverPaymentIssued:"account_balance_wallet",DriverPaymentCancelled:"account_balance_wallet",ClientInvoiceIssued:"check_circle",ClientInvoiceCancelled:"check_circle","Flight Update":"flight_land",Repricing:"border_color"},e.coloursIndex={"N/A":"orange-bg","Booking Offer Sent":"green-bg","Booking Created":"green-bg",FlightTrackingStarted:"green-bg",FlightTrackingStopped:"red-bg","SMS Confirmation":"green-bg","Email Client Confirmation":"green-bg","Email Booker Confirmation":"green-bg","SMS Driver Arrived":"green-bg","Call Driver Arrived":"green-bg","Email Manual Confirmation":"orange-bg","Driver Read Offer":"green-bg","Driver Accepted":"green-bg","Driver Rejected":"orange-bg","Driver Allocated":"green-bg","Booking Offered To Driver":"green-bg","Booking Pre Allocated To Driver":"green-bg","Booking Patched":"orange-bg","Booking Edited":"orange-bg",DriverPaymentIssued:"green-bg",DriverPaymentCancelled:"red-bg",ClientInvoiceIssued:"green-bg",ClientInvoiceCancelled:"red-bg","Booking Cancelled":"red-bg","Flight Update":"orange-bg",Repricing:"orange-bg"},e.BS=["OnRoute","Arrived","InProgress","Completed","Cancelled","COA","OpenToBid"],e.$on("SIGNALR_updateBooking",c)}var n=angular.module("cab9.dispatch");n.controller("DispatchBookingModalController",e),e.$inject=["$scope","rBooking","rWarning","$config","Model","$http"]}();;;;
!function(){function t(t,e,s,i,o){function r(){o({method:"PUT",url:$config.API_ENDPOINT+"api/DriverShift/AddNotesToDriverShift?shiftId="+t.shiftId+"&notes="+t.shiftNotes}).then(function(s){swal({title:"Notes Saved",text:"Driver shift notes have been saved.",type:"success"}),e.close(t.shiftNotes)},function(t){swal({title:"Error",text:t.data.ExceptionMessage||"There was an error saving driver shift notes.",type:"error"})})}t.shiftId=s,t.shiftNotes=i,t.saveNotes=r}var e=angular.module("cab9.dispatch");e.controller("DispatchDriverNotesController",t),t.$inject=["$scope","$modalInstance","rShiftId","rShiftNotes","$http"]}();;;;
!function(t){function e(e,i,r,a,s,d){function n(r,a){var s=a[0];e.dispatchObj.drivers.items.length=0;var d={Available:[],Clearing:[],OnJob:[],OnBreak:[]};i(function(){e.dispatchObj.drivers.items=s,t.forEach(s,function(t){d[t.DriverStatus].push(t)}),e.dispatchObj.drivers.byStatus.length=0,d.Available.length>0&&e.dispatchObj.drivers.byStatus.push({status:"Available",display:"Available",drivers:d.Available}),d.Clearing.length>0&&e.dispatchObj.drivers.byStatus.push({status:"Clearing",display:"Clearing",drivers:d.Clearing}),d.OnJob.length>0&&e.dispatchObj.drivers.byStatus.push({status:"OnJob",display:"On Job",drivers:d.OnJob}),d.OnBreak.length>0&&e.dispatchObj.drivers.byStatus.push({status:"OnBreak",display:"On Break",drivers:d.OnBreak}),e.dispatchObj.map.updateDriverMarkers(),e.dispatchObj.map.updateFocus()},0),e.dispatchObj.drivers.reload=e.dispatchObj.drivers.reload+1}function o(t){e.dispatchObj.map.selected.driverId!=t.DriverId?e.dispatchObj.map.select(null,t):e.dispatchObj.map.select(null,null)}function l(t){if(e.dispatchObj.drivers.routedDriver=null,f&&(f.setMap(null),f=null),t&&t.$marker&&t.EncodedRoute){e.dispatchObj.drivers.routedDriver=t;var i=google.maps.geometry.encoding.decodePath(t.EncodedRoute);f=new google.maps.Polyline({path:i,clickable:!1,map:e.dispatchObj.map.mapObject});for(var r=new google.maps.LatLngBounds,a=0;a<i.length;a++)r.extend(i[a]);e.dispatchObj.map.mapObject.fitBounds(r)}}function c(){a.get(s.API_ENDPOINT+"api/drivershift/ShiftBreakdown").success(function(r){e.dispatchObj.drivers.items.length=0;var a={Available:[],Clearing:[],OnJob:[],OnBreak:[]};i(function(){e.dispatchObj.drivers.items=r,t.forEach(r,function(t){a[t.DriverStatus].push(t)}),e.dispatchObj.drivers.byStatus.length=0,a.Available.length>0&&e.dispatchObj.drivers.byStatus.push({status:"Available",display:"Available",drivers:a.Available}),a.Clearing.length>0&&e.dispatchObj.drivers.byStatus.push({status:"Clearing",display:"Clearing",drivers:a.Clearing}),a.OnJob.length>0&&e.dispatchObj.drivers.byStatus.push({status:"OnJob",display:"On Job",drivers:a.OnJob}),a.OnBreak.length>0&&e.dispatchObj.drivers.byStatus.push({status:"OnBreak",display:"On Break",drivers:a.OnBreak}),e.dispatchObj.map.updateDriverMarkers(),e.dispatchObj.drivers.reload=e.dispatchObj.drivers.reload+1},0)})}function h(t){t.$activity=!0,e.dispatchObj.drivers.reload=e.dispatchObj.drivers.reload+1,a({method:"GET",url:s.API_ENDPOINT+"api/DriverShift/NudgeDriveronShift?shiftId="+t.DriverShiftId}).then(function(i){t.$activity=!1,e.dispatchObj.drivers.reload=e.dispatchObj.drivers.reload+1},function(t){})}function p(t){d.open({templateUrl:"/webapp/management/dispatch/modals/shiftnotes/partial.html",controller:"DispatchDriverNotesController",resolve:{rShiftId:function(){return t.DriverShiftId},rShiftNotes:function(){return t.Notes}},size:"sm"}).result.then(function(t){c()})}function v(t){swal({title:"Are you sure?",text:"Driver shift will be ended and a notification will be sent for the same.",type:"warning",showCancelButton:!0,confirmButtonText:"Yes"},function(){t.$activity=!0,e.dispatchObj.drivers.reload=e.dispatchObj.drivers.reload+1,a({method:"GET",url:s.API_ENDPOINT+"api/DriverShift/EndShiftsForDriver?driverId="+t.DriverId}).then(function(i){t.$activity=!1,e.dispatchObj.drivers.reload=e.dispatchObj.drivers.reload+1},function(t){})})}function u(t,i){swal({title:"Are you sure?",text:i?"Driver will be eligable for AutoDispatch for this shift.":"Driver will no longer be eligable for AutoDispatch during this shift.",type:"warning",showCancelButton:!0,confirmButtonText:"Yes"},function(){t.$activity=!0,e.dispatchObj.drivers.reload=e.dispatchObj.drivers.reload+1,a({method:"GET",url:s.API_ENDPOINT+"api/DriverShift/ToggleAutoDispatch?shiftId="+t.DriverShiftId+"&on="+i}).then(function(r){t.$activity=!1,t.AutoDispatch=i,e.dispatchObj.drivers.reload=e.dispatchObj.drivers.reload+1},function(t){})})}function b(t,i){swal({title:"Are you sure?",text:i?"Driver will only be eligable for bookings that take them closer to home.":"Driver will no longer be restricted to bookings closer to home.",type:"warning",showCancelButton:!0,confirmButtonText:"Yes"},function(){t.$activity=!0,e.dispatchObj.drivers.reload=e.dispatchObj.drivers.reload+1,a({method:"GET",url:s.API_ENDPOINT+"api/DriverShift/ToggleGoingHome?shiftId="+t.DriverShiftId+"&on="+i}).then(function(r){t.$activity=!1,t.GoingHome=i,e.dispatchObj.drivers.reload=e.dispatchObj.drivers.reload+1},function(t){})})}function O(t,i){t.$activity=!0,e.dispatchObj.drivers.reload=e.dispatchObj.drivers.reload+1;var r=e.dispatchObj.map.mapObject.addListener("click",function(i){google.maps.event.removeListener(r);var d=e.dispatchObj.map.driverMarkers[t.DriverId];d.setPosition(i.latLng),t.LastKnownLatitude=i.latLng.lat(),t.LastKnownLongitude=i.latLng.lng(),a({method:"GET",url:s.API_ENDPOINT+"api/DriverShift/DebugDriverLocation?shiftId="+t.DriverShiftId+"&lat="+i.latLng.lat()+"&lon="+i.latLng.lng()}).then(function(){t.$activity=!1,e.dispatchObj.drivers.reload=e.dispatchObj.drivers.reload+1,e.$apply()})})}function g(t){return t.DriverImageUrl?"http"==t.DriverImageUrl.slice(0,4)?t.DriverImageUrl:window.resourceEndpoint+t.DriverImageUrl:window.endpoint+"api/imagegen?text="+(t.DriverCallsign||"").replace(/ /g,"+")}e.dispatchObj.drivers.items=[],e.dispatchObj.drivers.byStatus=[],e.dispatchObj.drivers.plotRoute=l,e.dispatchObj.drivers.selectDriver=o,e.dispatchObj.drivers.refetchDrivers=c,e.dispatchObj.drivers.nudgeDriverOnShift=h,e.dispatchObj.drivers.openNotesModal=p,e.dispatchObj.drivers.endShift=v,e.dispatchObj.drivers.toggleAutoDispatch=u,e.dispatchObj.drivers.toggleGoingHome=b,e.dispatchObj.drivers.setLocation=O,e.dispatchObj.drivers.selectedDriverId=null,e.formatImage=g,e.$on("SIGNALR_updateDriverShifts",n),e.dispatchObj.drivers.routedDriver=null;var f=null;c(),e.$watch("SIGNALR.status",function(t,e){4==t&&t!=e&&c()})}var i=t.module("cab9.dispatch");i.controller("DispatchDriversController",e),e.$inject=["$scope","$timeout","Model","$http","$config","$modal"]}(angular);;;;
!function(e){function t(t,a,i,r,n,o,s,p){function d(){var e=new google.maps.LatLng($.DispatchLatitude||51.49638419822335,$.DispatchLongitude||-.12875142186092203);t.dispatchObj.map.mapObject=new google.maps.Map(document.getElementById("dispatch-map"),{center:e,zoom:$.DispatchZoom||11,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},panControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},mapTypeControlOptions:{position:google.maps.ControlPosition.TOP_CENTER}})}function c(){if(t.dispatchObj.map.selected.bookingId){var e=t.dispatchObj.bookings.items.filter(function(e){return e.Id==t.dispatchObj.map.selected.bookingId})[0],a=null,i=null;e&&e.DriverId&&(a=t.dispatchObj.drivers.items.filter(function(t){return t.DriverId==e.DriverId})[0]),e&&e.PartnerDriverId&&(i=e.PartnerDriver),t.dispatchObj.map.select(e,a,i)}else if(t.dispatchObj.map.selected.driverId){var a=t.dispatchObj.drivers.items.filter(function(e){return e.DriverId==t.dispatchObj.map.selected.driverId})[0];t.dispatchObj.map.select(null,a)}}function l(){p.get(a.API_ENDPOINT+"api/partners/drivers").success(function(e){t.dispatchObj.partnerDrivers.items.length=0,n(function(){t.dispatchObj.partnerDrivers.items=e,t.dispatchObj.map.updatePartnerDriverMarkers(),t.dispatchObj.map.updateFocus()},0)})}function m(a,i,r){null!=_&&(_.setMap(null),_=null);var n=new google.maps.LatLngBounds;if(I(),t.dispatchObj.map.selected.bookingId=null,t.dispatchObj.map.selected.driverId=null,a?(delete a.$new,t.dispatchObj.map.selected.bookingId=a.Id,t.loading=!0,D(a),e.forEach(a.BookingStops,function(e){if(e.Latitude&&e.Longitude){var t=new google.maps.LatLng(e.Latitude,e.Longitude);n.extend(t)}}),t.dispatchObj.partnerDrivers.items.length=0,t.dispatchObj.map.updatePartnerDriverMarkers()):l(),i){t.dispatchObj.map.selected.driverId=i.DriverId;var o=t.dispatchObj.map.driverMarkers[i.DriverId];n.extend(o.getPosition())}else a&&(t.dispatchObj.map.selected.driverId=a.DriverId);if(r?r.LastKnownLatitude&&(_=new google.maps.Marker({position:new google.maps.LatLng(r.LastKnownLatitude,r.LastKnownLongitude),zIndex:google.maps.Marker.MAX_ZINDEX+1,icon:{url:"/includes/images/car1.png",scaledSize:new google.maps.Size(32,42)},map:t.dispatchObj.map.mapObject}),t.dispatchObj.map.selected.driverId=a.PartnerDriverId,n.extend(_.getPosition())):a&&(t.dispatchObj.map.selected.driverId=a.DriverId),a)t.dispatchObj.map.mapObject.fitBounds(n);else if(i){var o=t.dispatchObj.map.driverMarkers[i.DriverId];o&&(t.dispatchObj.map.mapObject.panTo(o.getPosition()),t.dispatchObj.map.mapObject.setZoom(16))}else{var s=new google.maps.LatLng($.DispatchLatitude||51.49638419822335,$.DispatchLongitude||-.12875142186092203);t.dispatchObj.map.mapObject.setCenter(s),t.dispatchObj.map.mapObject.setZoom($.DispatchZoom||11)}u(),g()}function u(){var a={};e.forEach(t.dispatchObj.bookings.items,function(e){if(t.dispatchObj.map.bookingMarkers[e.Id]){var i=t.dispatchObj.map.bookingMarkers[e.Id],r=e.BookingStops[0];r&&r.Latitude&&r.Longitude&&(i.setPosition(new google.maps.LatLng(r.Latitude,r.Longitude)),i.setVisible(!1)),a[e.Id]=i,delete t.dispatchObj.map.bookingMarkers[e.Id]}else a[e.Id]=k(e)}),e.forEach(t.dispatchObj.map.bookingMarkers,function(e,t){e&&e.setMap(null)}),t.dispatchObj.map.bookingMarkers=a}function g(){var a={};e.forEach(t.dispatchObj.drivers.items,function(e){var t=v(e,!0);a[e.DriverId]=t}),e.forEach(t.dispatchObj.map.driverMarkers,function(e,t){e&&e.setMap(null)}),t.dispatchObj.map.driverMarkers=a}function b(){var e={};t.dispatchObj.partnerDrivers.items.map(function(t){var a=O(t,!0);e[t.DriverId]=a});for(var a in t.dispatchObj.map.partnerDriverMarkers)!e[a]&&t.dispatchObj.map.partnerDriverMarkers[a]&&t.dispatchObj.map.partnerDriverMarkers[a].remove();t.dispatchObj.map.partnerDriverMarkers=e}function v(e,i){if(t.dispatchObj.map.driverMarkers[e.DriverId]){var r=t.dispatchObj.map.driverMarkers[e.DriverId];return e.LastKnownLatitude&&e.LastKnownLongitude&&(r.setIcon({url:a.API_ENDPOINT+"api/imagegen?driverId="+e.DriverId+"&status="+e.DriverStatus+"&callsign="+e.DriverCallsign,scaledSize:new google.maps.Size(45,58)}),r.setPosition(new google.maps.LatLng(e.LastKnownLatitude,e.LastKnownLongitude)),r.setVisible(!t.dispatchObj.map.selected.bookingId||!t.dispatchObj.map.selected.driverId||t.dispatchObj.map.selected.driverId==e.DriverId)),i&&delete t.dispatchObj.map.driverMarkers[e.DriverId],r}var n=f(e);return i||(t.dispatchObj.map.driverMarkers[e.DriverId]=n),n}function O(e,a){if(t.dispatchObj.map.partnerDriverMarkers[e.DriverId]){var i=t.dispatchObj.map.partnerDriverMarkers[e.DriverId];return e.LastKnownLatitude&&e.LastKnownLongitude&&(i.setPosition(new google.maps.LatLng(e.LastKnownLatitude,e.LastKnownLongitude)),i.setOptions({visible:!t.dispatchObj.map.selected.bookingId})),i}var r=new s(new google.maps.LatLng(e.LastKnownLatitude,e.LastKnownLongitude),t.dispatchObj.map.mapObject,window.formatImage(e.LogoUrl,e.CompanyName));return r.setOptions({visible:!t.dispatchObj.map.selected.bookingId}),r}function h(e){null==e?(I(),w()):(I(),M(),D(e))}function j(e){t.dispatchObj.map.displayOptions.traffic=e,e?(y=new google.maps.TrafficLayer,y.setMap(t.dispatchObj.map.mapObject)):y&&(y.setMap(null),y=null)}function k(e){var a=e.BookingStops[0];if(a&&a.Latitude&&a.Longitude){var i=new google.maps.Marker({position:new google.maps.LatLng(a.Latitude,a.Longitude),zIndex:google.maps.Marker.MAX_ZINDEX+1,title:""+e.LocalId,icon:{url:"/includes/images/marker-pink.png",scaledSize:new google.maps.Size(28,28)},visible:!1,map:t.dispatchObj.map.mapObject});return i.addListener("click",function(){L(e,"booking")}),i}return null}function f(e){if(e&&e.LastKnownLatitude&&e.LastKnownLongitude&&"Offline"!=e.DriverStatus){var i=new google.maps.Marker({position:new google.maps.LatLng(e.LastKnownLatitude,e.LastKnownLongitude),title:e.DriverCallsign,icon:{url:a.API_ENDPOINT+"api/imagegen?driverId="+e.DriverId+"&status="+e.DriverStatus+"&callsign="+e.DriverCallsign,scaledSize:new google.maps.Size(45,58)},visible:!t.dispatchObj.map.selected.bookingId||!t.dispatchObj.map.selected.driverId||t.dispatchObj.map.selected.driverId==e.DriverId,map:t.dispatchObj.map.mapObject});return i.addListener("click",function(){L(e,"driver")}),i}return null}function L(e,a){null==T&&(T=new google.maps.InfoWindow({content:""})),null==e&&T.setMap(null),"booking"==a?(T.setContent('<div class="infowindow booking"><b>Id:</b> '+e.LocalId+"<br /><b>From:</b> "+e._FromSummary+"<br /><b>To:</b> "+e._ToSummary+"<br /><b>Status:</b> "+e.BookingStatus+"<br /></div>"),T.open(t.dispatchObj.map.mapObject,t.dispatchObj.map.bookingMarkers[e.Id])):"driver"==a&&(T.setContent('<div class="infowindow driver"><b>Driver:</b> '+e.Firstname+" "+e.Surname+"<br /><b>Callsign:</b> "+e.Callsign+"<br /><b>Status:</b> "+e.DriverStatus+"<br /></div>"),T.open(t.dispatchObj.map.mapObject,t.dispatchObj.map.driverMarkers[e.Id]))}function I(){N&&(N.setMap(null),N=null);for(var e=0;e<B.length;e++)B[e].setMap(null);B.length=0}function D(a){o.Booking.query().where("Id eq guid'"+a.Id+"'").select("EncodedRoute").execute().then(function(e){if(e[0].EncodedRoute){var a=google.maps.geometry.encoding.decodePath(e[0].EncodedRoute);null==N?N=new google.maps.Polyline({map:t.dispatchObj.map.mapObject,path:a,geodesic:!0,strokeColor:"#63C4E1",strokeOpacity:.8,strokeWeight:6}):(N.setPath(a),N.setMap(t.dispatchObj.map.mapObject))}});var i=!0;e.forEach(a.BookingStops,function(e){if(e.Latitude&&e.Longitude){var a=new google.maps.LatLng(e.Latitude,e.Longitude),r=new google.maps.Marker({position:a,visible:!0,icon:{url:i?"/includes/images/marker-pink.png":"/includes/images/marker.png",scaledSize:new google.maps.Size(28,28)},map:t.dispatchObj.map.mapObject,zIndex:1e3});B.push(r)}i=!1})}function M(){t.dispatchObj.bookings.items.map(function(e){e.$marker&&e.$marker.setVisible(!1)})}function w(){t.dispatchObj.bookings.items.map(function(e){e.$marker&&e.$marker.setVisible(!0)}),C(t.dispatchObj.bookings.items)}function C(e){var a=new google.maps.LatLng($.DispatchLatitude||51.49638419822335,$.DispatchLongitude||-.12875142186092203);t.dispatchObj.map.mapObject.setCenter(a),t.dispatchObj.map.mapObject.setZoom($.DispatchZoom||11)}function P(){plotMarkers(null),S(),z=new MarkerClusterer(t.dispatchObj.map.mapObject,t.dispatchObj.bookings.items.map(function(e){return e.$marker}).filter(function(e){return!!e}),{averageCenter:!0,gridSize:80,ignoreHidden:!0,minimumClusterSize:1,maxZoom:13})}function S(){z&&(z.clearMarkers(),z=null)}function E(e){e?(K&&(K.setMap(null),K=null),K=new google.maps.visualization.HeatmapLayer({data:t.dispatchObj.bookings.items.map(function(e){return{location:e.$marker.getPosition(),weight:1}}).filter(function(e){return!!e}),dissipating:!0,radius:50,opacity:.75}),K.setMap(t.dispatchObj.map.mapObject)):K&&(K.setMap(null),K=null)}var z,y,K,T,$=i[0];t.dispatchObj.map={mapObject:null,displayOptions:{bookings:1,drivers:1,traffic:!1,heatmap:!1},bookingMarkers:{},driverMarkers:{},partnerDriverMarkers:{},updatePartnerDriverMarkers:b,updateDriverMarkers:g,updateDriverMarker:v,drawRoute:h,getMarkerForDriver:f,updateBookingMarkers:u,updateFocus:c,toggleTrafficLayer:j,select:m,selected:{bookingId:null,driverId:null}};var y=null,N=null,B=[];d();var _=null,Z=!0;t.$watch("dispatchObj.map.displayOptions",function(e,a){if(Z)n(function(){Z=!1});else{if(e.bookings!=a.bookings)switch(Number(e.bookings)){case 0:plotMarkers(null),S();break;case 1:plotMarkers(t.dispatchObj.bookings.items),S();break;case 2:plotMarkers(null),P()}E(e.heatmap)}},!0)}var a=e.module("cab9.dispatch");a.controller("DispatchMapController",t),t.$inject=["$scope","$config","rCompany","Google","$timeout","Model","CustomMarker","$http"]}(angular);;;;
!function(e){function n(n,o,t,i,a,s,d,r,l,u,c,g,f,p,m){function h(){n._dbooking.ChauffeurMode=!0,n._dbooking.EstimatedMins="60"}function k(){n._dbooking.ChauffeurMode=!1,n._dbooking.EstimatedMins=null}function b(e){"add-passenger"!==n._dbooking.LeadPassengerId&&(n.searchText=e)}function C(e){for(var n="[a-z]",o="[A-Z]",t="[0-9]",i="^",a=0,s=!1,d=!1,r=0;r<e.length;r++){var l=e[r];if("'"===l)i+=d?")":"(",d=!d;else if(d)["."].indexOf(l)!=-1&&(l="\\"+l),i+=l;else if(">"===l){if(a++,a>1)throw"Bad Mask - Case blocks have consecutive > without ending previous block"}else if("<"===l){if(a--,a<-1)throw"Bad Mask - Case blocks have consecutive < without ending previous block"}else"0"===l?(s=!0,i+="("+t+")"):"9"===l?i+="("+t+"?)":1===a?"A"===l?(s=!0,i+="("+o+"|"+t+")"):"a"===l?i+="("+o+"?|"+t+"?)":"L"===l?(s=!0,i+="("+o+")"):"l"===l&&(i+="("+o+"?)"):0===a?"A"===l?(s=!0,i+="("+n+"|"+o+"|"+t+")"):"a"===l?i+="("+n+"?|"+o+"?|"+t+"?)":"L"===l?(s=!0,i+="("+n+"|"+o+")"):"l"===l&&(i+="("+n+"?|"+o+"?)"):a===-1&&("A"===l?(s=!0,i+="("+n+"|"+t+")"):"a"===l?i+="("+n+"?|"+t+"?)":"L"===l?(s=!0,i+="("+n+")"):"l"===l&&(i+="("+n+"?)"))}if(d)throw"Bad Mask - Quoted section not terminated";if(!s)throw"Bad Mask - Must contain at least 1 mandatory symbol (A, L, 0)";return i+="$",new RegExp(i)}function I(e){e&&e.length>2?n.fetchedClients=f("filter")(n.clients,{Name:e}):n.fetchedClients=[]}function y(o){n.fetchedPassengers.length=0,c.get(i.API_ENDPOINT+"api/Passengers/Search",{params:{searchText:o,clientId:n._dbooking.ClientId}}).success(function(o){e.forEach(o,function(e){0!=e.Active&&(e.Client&&(e.Client.ImageUrl=u.formatUrl(e.Client.ImageUrl,e.Client.Name)),n.fetchedPassengers.push({Id:e.Id,ClientId:e.ClientId,Name:e.Firstname+" "+e.Surname,Description:e.Client&&e.Client.Name?e.Client.Name:"No Client",Mobile:e.Mobile,Phone:e.Phone,Addresses:e.Addresses,Notes:e.Notes,DefaultVehicleTypeId:e.DefaultVehicleTypeId,ImageUrl:u.formatUrl(e.ImageUrl,e.Firstname)}))}),n.fetchedPassengers.push({Id:"add-passenger",Name:"Add Passenger",Description:"Create New Passenger",ImageUrl:"/includes/images/add-icon.png"})})}function T(o){n._dbooking.ClientId&&(n.filteredBookers.length=0,c.get(i.API_ENDPOINT+"api/Bookers/Search",{params:{searchText:o,clientId:n._dbooking.ClientId}}).success(function(o){e.forEach(o,function(e){0!=e.Active&&(e.Client&&(e.Client.ImageUrl=u.formatUrl(e.Client.ImageUrl,e.Client.Name)),n.filteredBookers.push({Id:e.Id,ClientId:e.ClientId,Name:e.Firstname+" "+e.Surname,Description:e.Client&&e.Client.Name?e.Client.Name:"No Client",Mobile:e.Mobile,ImageUrl:u.formatUrl(e.ImageUrl,e.Firstname)}))}),n.filteredBookers.push({Id:"add-booker",Name:"Add Booker",Description:"Create New Booker",ImageUrl:"/includes/images/add-icon.png"})}))}function _(e,o){var t=l.timeZone().getTimeZone(),i=(new Date).getTimezoneOffset(),a=moment.tz.zone(t).offset(new Date),s=new moment.tz(t).add(i-a,"minutes");"day"==o?n._dbooking.Date=s.add(e,"minutes").toDate():"time"==o&&(n._dbooking.Time=s.startOf("minute").add(e,"minutes").toDate())}function A(){n.flightData={Number:"",DateTime:null,MinsAfterLanding:0,GetDate:function(e){var n=this.DateTime&&new moment(this.DateTime).add(this.MinsAfterLanding||0,"minute");return e?n.format(e):n}};var e=n._dbooking=new s.Booking;n.displayMode="CREATE",e.BookingStops=[],e.BookingValidations=[],e.BookingStops.push(new s.BookingStop),e.BookingStops.push(new s.BookingStop),e.Pax=n.company.DefaultPax,e.Bax=n.company.DefaultBax,e.TaxId=n.COMPANY.DefaultTaxId,e.PaymentMethod="Cash",e.AsDirected=!1;var o=l.timeZone().getTimeZone()||"Europe/London",t=(new Date).getTimezoneOffset(),i=moment.tz.zone(o).offset(new Date),a=new moment.tz(o).add(t-i,"minutes");e.Date=a.toDate(),e.Time=a.startOf("minute").add(15,"minutes").toDate(),e.CurrencyId=n.COMPANY.DefaultCurrencyId,e.EstimatedCost=0,e.TextConfirmation=n.company.TextConfirmation,e.EmailConfirmation=n.company.EmailConfirmation,e.TextOnArrival=n.company.TextOnArrival,e.CallOnArrival=n.company.CallOnArrival,e.TextAssigned=n.company.TextAssigned,e.EmailAssigned=n.company.EmailAssigned,e.TextOnCompletion=n.company.TextOnCompletion,e.TextOnOnRoute=n.company.TextOnOnRoute,e._AutoDispatchOffset=15,n.repeatSchedule=new s.RepeatBooking}function w(e,n,o){function t(e,n){var o="000000000"+e;return o.substr(o.length-n)}e||(e=new Date);var i=e.getFullYear(),a=e.getMonth(),s=e.getDate(),d=n.getHours(),r=n.getMinutes(),u=t(i,4)+"-"+t(a+1,2)+"-"+t(s,2)+"T"+t(d,2)+":"+t(r,2)+":00",c=moment.tz(u,"YYYY-MM-DDTHH:mm:ss",l.timeZone().getTimeZone()).subtract(o||0,"minutes").format();return c}function v(){var e=[];n.dataReady=!1;var o=s.Client.query().where("Active eq true").select("Id,Name,AccountNo,AccountPassword,DefaultCurrencyId,ImageUrl,OnHold,Priority,AutoDispatch,ClientType/Name,ClientReferences,Tags,AllVehicleTypeAccess,Phone,DefaultPaymentType,DefaultVehicleTypeId,TextConfirmation,EmailConfirmation,TextOnArrival,CallOnArrival,TextAssigned,EmailAssigned,TextOnCompletion,TextOnOnRoute").include("ClientType,ClientReferences,Tags").parseAs(function(e){this.Id=e.Id,this.Name=(e.AccountNo?e.AccountNo+" - ":"")+e.Name,this.DefaultCurrencyId=e.DefaultCurrencyId,this.Description=e.ClientType.Name,this.Phone=e.Phone,this.OnHold=e.OnHold,this.AccountPassword=e.AccountPassword,this.ImageUrl=u.formatUrl(e.ImageUrl,e.Name),this.AllVehicleTypeAccess=e.AllVehicleTypeAccess,this.DefaultPaymentType=e.DefaultPaymentType,this.DefaultVehicleTypeId=e.DefaultVehicleTypeId,this.TextConfirmation=e.TextConfirmation,this.EmailConfirmation=e.EmailConfirmation,this.TextOnArrival=e.TextOnArrival,this.CallOnArrival=e.CallOnArrival,this.TextAssigned=e.TextAssigned,this.EmailAssigned=e.EmailAssigned,this.TextOnCompletion=e.TextOnCompletion,this.TextOnOnRoute=e.TextOnOnRoute,this.Priority=e.Priority,this.AutoDispatch=e.AutoDispatch,this.Tags=e.Tags,this.ClientReferences=e.ClientReferences.filter(function(e){return e.Active}).map(function(e){return{Id:e.Id,ReferenceName:e.ReferenceName,Mandatory:e.Mandatory,AllowAddToList:e.AllowAddToList,Value:e.Value,ReferenceType:e.ReferenceType,ShowList:e.ShowList}})}).execute().then(function(e){n.clients=e}),t=s.VehicleType.query().parseAs(function(e){this.Id=e.Id,this.Name=e.Name,this.Description=e.Description,this.IsDefault=e.IsDefault,this.ImageUrl=null,this.Priority=e.Priority,this.Order=e.Order}).execute().then(function(e){n.filteredVehicleTypes=n.vehicleTypes=e.sort(function(e,n){return(e.Order||99)-(n.Order||99)})}),i=s.BookingRequirement.query().execute().then(function(e){n.bookingRequirements=n.unlinkedRequirements=e});e.push(o),e.push(t),e.push(i),a.all(e).then(function(){n.dataReady=!0,B()})}function P(){var e=JSON.parse(n.dispatchObj.selectedCaller);e.$Description?(n.fetchedPassengers.push(e),n._dbooking.LeadPassengerId=e.Id):(n.fetchedClients=f("filter")(n.clients,{Id:e.Id}),n._dbooking.LeadPassengerId=null,n._dbooking.ClientId=e.Id)}function B(){n.dispatchObj.phoneCall&&(n._dbooking.Calls=[],n._dbooking.Calls.push(n.dispatchObj.phoneCall))}function O(e,n){n?c({method:"GET",url:i.API_ENDPOINT+"/api/ClientReferences/suggest?ClientReferenceId="+e.Id+"&Value="+n}).then(function(n){e.$suggested=n.data.map(function(e){return{custom:!1,text:e}}),e.AllowAddToList&&e.$suggested.push({custom:!0,text:"Add '{{$select.search}}' to References"})},function(n){e.$suggested=[]}):e.$suggested=[]}function D(e,t,a){e.custom&&(e.text=t,swal({title:"Add New Reference?",text:"Are you sure you want to add '"+t+"' to the list of known '"+a.ReferenceName+"' references?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, Add it!",cancelButtonText:"Cancel",closeOnConfirm:!1,closeOnCancel:!1},function(e){e?c.post(i.API_ENDPOINT+"/api/clientreferences/add?ClientReferenceId="+a.Id+"&ClientReferenceKnownValue="+t).then(function(e){swal({title:"Client Reference Updated.",text:"Changes have been updated.",type:"success",confirmButtonColor:o.COLOURS.brandSecondary})},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:o.COLOURS.brandSecondary}),a.$knownValue=null}):(a.$knownValue=null,swal.close(),console.log("refSelected - $scope.$apply"),n.$apply())}))}function L(){n._dbooking.Coupon=n._dbooking.$Coupon,W(n._dbooking)}function S(e,o){var t=n._dbooking.Tags.find(function(n){return n.Id==e.Id});if(!t){n._dbooking.Tags.push(e);var i=n.unlinkedTags.find(function(n){return n.Id==e.Id});i&&n.unlinkedTags.splice(n.unlinkedTags.indexOf(i),1),n._dbooking.$selectedTag=null,o&&(o.selected=null)}}function x(e){n.unlinkedTags.push(e);var o=n._dbooking.Tags.find(function(n){return n.Id==e.Id});o&&n._dbooking.Tags.splice(n._dbooking.Tags.indexOf(o),1)}function N(e){n._dbooking.BookingRequirements.push(e);var o=n.unlinkedRequirements.filter(function(n){return n.Id==e.Id});o[0]&&n.unlinkedRequirements.splice(n.unlinkedRequirements.indexOf(o[0]),1),n._dbooking.$selectedRequirement=null}function E(e){n.unlinkedRequirements.push(e);var o=n._dbooking.BookingRequirements.filter(function(n){return n.Id==e.Id});o[0]&&n._dbooking.BookingRequirements.splice(n._dbooking.BookingRequirements.indexOf(o[0]),1)}function R(){if(n.clientReferences.length>0)for(var e=0;e<n.clientReferences.length;e++){var o=n.clientReferences[e];if("Mask"==o.ReferenceType)return!(o.$testReg.test(o.$knownValue)||!o.$knownValue&&!o.Mandatory)}return!1}function M(){n._dbooking.BookingStops.reverse();for(var e=0;e<n._dbooking.BookingStops.length;e++)n._dbooking.BookingStops[e].StopOrder=e+1}function V(){var e=n._dbooking.BookingStops[0];n._dbooking.BookingStops[0]=n._dbooking.BookingStops[1],n._dbooking.BookingStops[1]=e;for(var o=0;o<n._dbooking.BookingStops.length;o++)n._dbooking.BookingStops[o].StopOrder=o+1}function q(e){moment(n._dbooking.BookedDateTime).isBefore(moment.utc(),"minute")?swal({title:"Booking in the Past",text:"The booking date & time are in the past. Are you Sure?",type:"warning",showCancelButton:!0,closeOnConfirm:!0,closeOnCancel:!0},function(n){n&&U(e)}):U(e)}function U(e){console.log(n._dbooking),$("#bookingsave").prop("disabled",!0),$("#bookingrepeat").prop("disabled",!0);var t=!1;if(n.week.filter(function(e){return 1==e.selected}).length>0){if(null==n.repeatSchedule.EndDate||null==n.repeatSchedule.Label||0==n.repeatSchedule.Label.length)return swal({title:"Scheduled Booking Error",text:"Scheduled booking should have a label and an end date.",type:"error",confirmButtonColor:o.COLOURS.brandSecondary}),$("#bookingsave").prop("disabled",!1),void $("#bookingrepeat").prop("disabled",!1);t=!0,n.repeatSchedule.DaysOfWeek=n.week.reduce(function(e,n){return n.selected?e+n.value:e},0)}e?$("#bookingrepeat").html("<i class='fa fa-circle-o-notch fa-spin'></i> Saving..."):$("#bookingsave").html("<i class='fa fa-circle-o-notch fa-spin'></i> Saving..."),n.dataReady=!1;var d=[];n.dataReady=!0,n.newBooker&&n.newBooker.Id==n._dbooking.ClientStaffId&&(n.newBooker.Passengers=[],n.newBooker.Passengers.push(n.selectedPassenger),c.post(i.API_ENDPOINT+"api/ClientStaff/ManagePassengers",n.newBooker).then(function(e){},function(e){swal({title:"Error adding passenger to booker",text:"Some error has occured.",type:"error",confirmButtonColor:o.COLOURS.brandSecondary})}));var r=n._dbooking;if(r.$$originalValues.Id=null,n.paxMode.value){if(!r._LeadPassenger)return void swal("Invalid","Please add passenger details.","error");var l=r._LeadPassenger.split(" ");n._dbooking.LeadPassenger={Firstname:l[0],Surname:l.slice(1).join(" "),Mobile:r._LeadPassengerNumber,ClientId:r.ClientId}}if(n._dbooking.BookingValidations=[],n.clientReferences.length>0)for(var u=0;u<n.clientReferences.length;u++){var g=n.clientReferences[u],f=new s.BookingValidation;f.ClientReferenceId=g.Id,"List"==g.ReferenceType?f.Value=g.$knownValue&&g.$knownValue.text:f.Value=g.$knownValue,f.Value&&n._dbooking.BookingValidations.push(f)}if(n._dbooking.BookingTags=[],n._dbooking.Tags&&n._dbooking.Tags.length>0&&n._dbooking.Tags.forEach(function(e){var o={TagId:e.Id,Type:e.Type};n._dbooking.BookingTags.push(o)}),n._dbooking.FlightInfo){n._dbooking.FlightInfo.MinsAfterLanding=n.flightData.MinsAfterLanding;var p=n.flightData.GetDate().toDate();n._dbooking.BookedDateTime=w(p,p)}else n._dbooking.BookedDateTime=w(n._dbooking.Date,n._dbooking.Time);n._dbooking.AutoDispatch&&(n._dbooking.DispatchDateTime=w(n._dbooking.Date,n._dbooking.Time,n._dbooking._AutoDispatchOffset)),1==t?d.push(c.post(i.API_ENDPOINT+"/api/bookings/CreateScheduled",{Schedule:n.repeatSchedule,Booking:n._dbooking})):d.push(n._dbooking.$save()),a.all(d).then(function(t){var i=t[t.length-1].data.LocalId;swal({title:"Booking Saved.",text:"Booking Reference: #"+i,type:"success",confirmButtonColor:o.COLOURS.brandSecondary}),$("#bookingsave").prop("disabled",!1),$("#bookingrepeat").prop("disabled",!1),n.dispatchObj.phoneCall=null,e?(n.dataReady=!0,$("#bookingrepeat").html("<i class='material-icons'>repeat_one</i>Save &amp; Repeat")):(F(),n.dataReady=!0,$("#bookingsave").html("<i class='material-icons'>send</i>Save"))},function(e){n.dataReady=!0,e.data&&e.data.Message?swal({title:"Some Error Occured.",text:e.data.Message,type:"error"}):swal({title:"Some Error Occured.",text:"Something went wrong. Cab9 team have been alrerted.",type:"error"}),$("#bookingsave").prop("disabled",!1),$("#bookingrepeat").prop("disabled",!1),$("#bookingsave").html("<i class='material-icons'>send</i>Save"),$("#bookingrepeat").html("<i class='material-icons'>repeat_one</i>Save &amp; Repeat")})}function F(){H(),A(),X=null,n.paxMode.value=!1,n.paxHistory=null,ee&&(ee.setMap(null),ee=null)}function j(e){n._dbooking.WaitAndReturn&&n._dbooking.BookingStops.length<4?swal("Cannot remove via Stop","WaitAndReturn booking should have a via stop","warning"):n._dbooking.BookingStops.splice(e,1),n._dbooking.BookingStops.length<3&&(n.sortableOptions.disabled=!0)}function Q(e){var o=new s.BookingStop;o.id=idCounter++,n._dbooking.WaitAndReturn?n._dbooking.BookingStops.splice(e,0,o):n._dbooking.BookingStops.splice(e+1,0,o),n._dbooking.BookingStops.length>2&&(n.sortableOptions.disabled=!1)}function Y(){n._dbooking.FlightInfo=null,n.flightData.Number.length>0?c({url:i.API_ENDPOINT+"/api/flightinfo/getflightinfo",method:"GET",params:{flightno:n.flightData.Number,flightDate:w(n._dbooking.Date,n._dbooking.Time)}}).then(function(e){if(e.data){e.data.Id=null,e.data.BookingId=null,e.data.TenantId=null,e.data.MinsAfterLanding=n.flightData.MinsAfterLanding,n._dbooking.FlightInfo=new s.FlightInfo(e.data);var o=l.timeZone().getTimeZone(),t=moment(n._dbooking.FlightInfo.ArrivalTime).toDate(),i=t.getTimezoneOffset(),a=moment.tz.zone(o).offset(t),d=new moment.tz(n._dbooking.FlightInfo.ArrivalTime,o).add(i-a,"minutes");if(n.flightData.DateTime=d,n._dbooking.Time=d.toDate(),n.timeSet=!0,e.data.SuggestedAddressId&&n._dbooking.BookingStops[0].$$Id!=e.data.SuggestedAddressId){var r=e.data.SuggestedAddressId;s.Location.query().where("Id eq guid'"+e.data.SuggestedAddressId+"'").execute().then(function(e){var o=new s.BookingStop;o.Address1=e[0].Name?e[0].Name:"",o.StopSummary=e[0].Name?e[0].Name:"",o.Latitude=e[0].Latitude?e[0].Latitude:null,o.Longitude=e[0].Longitude?e[0].Longitude:null,o.$$Id=r,center_moved=!1,n._dbooking.BookingStops[0]=o})}}else swal("Flight Not Found","Please check flight number.","warning")},function(e){swal("Incorrect Flight Number","Please check flight number.","warning")}):swal("Incorrect Flight Number","Please check flight number.","warning")}function z(){var e=t.open({templateUrl:"/webapp/common/modals/add-payment-card/partial.html",controller:"AddPaymentCardController",windowClass:"add-payment-card-modal-wrapper",resolve:{rPassengerId:function(){return n._dbooking.LeadPassengerId},rClientId:function(){return null},rDriverId:function(){return null}}});e.result.then(function(e){n.card={Id:e.Id,Name:e.CardNumber,Description:e.Type.toUpperCase()+" - Expiring "+e.ExpirationMonth+"/"+e.ExpirationYear},n.filteredPaymentCards.push(n.card),n._dbooking.PaymentCardId=e.Id})}function H(){ee&&(ee.setMap(null),ee=null),e.forEach(J,function(e){e.setMap(null)}),J.length=0}function W(e){n.dataReady=!1;for(var o=0;o<n._dbooking.BookingStops.length;o++)n._dbooking.BookingStops[o].StopOrder=o+1;ee&&(ee.setMap(null),ee=null),e.BookedDateTime=w(n._dbooking.Date||new Date,n._dbooking.Time),e.BookingStatus="Incoming",c.post(i.API_ENDPOINT+"api/quote",e).success(function(t){if(t.Error?(n.quote=t,e.EstimatedCost=0,e.EstimatedDistance=0,e.EstimatedDuration=0,e.ActualCost=0,n.dataReady=!0,n.directions=null):(e.EstimatedCost=t.FinalCost,e.EstimatedDistance=t.EstimatedDistance.toFixed(2),e.EstimatedDuration=t.EstimatedMins,e.ActualCost=t.FinalCost,n.dataReady=!0,n.directions=t.Directions,n.quote=t,e._AutoDispatchOffset=Math.max(15,t.DispatchOffset||15)),t.Directions&&t.Directions.EncodedRoute){var i=google.maps.geometry.encoding.decodePath(t.Directions.EncodedRoute);ee?(ee.setPath(i),ee.setMap(n.dispatchObj.map.mapObject)):ee=new google.maps.Polyline({map:n.dispatchObj.map.mapObject,path:i,geodesic:!0,strokeColor:"#63C4E1",strokeOpacity:.8,strokeWeight:6});var a=new google.maps.LatLngBounds;for(o=0;o<i.length;o++)a.extend(i[o]);g(function(){n.dispatchObj.map.mapObject.fitBounds(a)},500)}else ee&&(ee.setMap(null),ee=null)}).error(function(e){console.log(e),swal("Could not quote","Could not quote, please manually price and set driver payment amount for this booking.","warning"),n.dataReady=!0})}function Z(o){n.journeyCopied=!1,n._dbooking.BookingStops=[],n._dbooking.BookingStops=e.copy(o.BookingStops).map(function(e){return e.Id=null,e.BookingId=null,e.Booking=null,e}),n.journeyCopied=!0,n._dbooking.BookingStops.length>2?n.sortableOptions.disabled=!1:n.sortableOptions.disabled=!0}function G(e){c.post(i.API_ENDPOINT+"api/clientreferences/validate?ClientReferenceId="+e.Id+"&ReferenceValue="+e.$knownValue).then(function(o){e.$valid=!0,n.validReference=!0},function(t){return 404==t.status?(n.validReference=!1,void(e.$valid=!1)):void swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:o.COLOURS.brandSecondary})})}function K(e,o){n.opened[o]=!0,e.preventDefault(),e.stopPropagation()}n.company=p[0],n.bookingTags=n.unlinkedTags=m,A(),v();n.opened={},n.week=[{day:"Su",value:1,selected:!1,full:"Sunday"},{day:"Mo",value:2,selected:!1,full:"Monday"},{day:"Tu",value:4,selected:!1,full:"Tuesday"},{day:"We",value:8,selected:!1,full:"Wednesday"},{day:"Th",value:16,selected:!1,full:"Thursday"},{day:"Fr",value:32,selected:!1,full:"Friday"},{day:"Sa",value:64,selected:!1,full:"Saturday"}],n.paxMode={value:!1},n.current={tab:"Client"},n.newBooker=null,n.sortableOptions={stop:function(e,n){},ondragstart:function(e,n){},disabled:!0},n.addCard=z,n.showPaymentCards=!1,n.selectedPassenger=null,n.flightInfoAvailable=!1,n.vehicleTypes=[],n.save=U,n.repeatBooking=Z,n.cancel=F,n.addTime=_,n.validateClientRef=G,n.getSearchText=b,n.searchPassengers=y,n.searchBookers=T,n.searchClients=I,n.testMaskReferences=R,n.clientReferences=[],n.flipAddress=V,n.reverseStops=M,n.validateBooking=q,n.openCalendar=K,n.prefillInfoSelected=P,n.enableChauffering=h,n.disableChauffering=k,n.fetchedPassengers=[],n.fetchedClients=[],n.filteredBookers=[{Id:"add-booker",Name:"Add Booker",Description:"Create New Booker",ImageUrl:"/includes/images/add-icon.png"}],n.clients=[],n.formatErrorName=function(e){return e.replace("Input","").replace("Id","")},n.suggestReferences=O,n.refSelected=D,n.applyCoupon=L,n.addStop=Q,n.removeStop=j,n.fetchFlightInformation=Y,n.externalLocations={knownLocations:[],historic:[]};var J=[],X=null,ee=null;n.addRequirement=N,n.removeRequirement=E,n.addTag=S,n.removeTag=x,n.$on("CALLNEWBOOKINGREQUESTED",function(){B()}),n.$watch("_dbooking.ClientStaffId",function(e){if("add-booker"===e){var o=t.open({templateUrl:"/webapp/common/modals/booker/modal.html",controller:"BookerCreateController",resolve:{rBooker:function(){var e=new s.ClientStaff;return e.Phone=n.clients.filter(function(e){return e.Id==n._dbooking.ClientId})[0].Phone,e.ClientId=n._dbooking.ClientId,e}}});o.result.then(function(e){var o={Id:e.Id,ClientId:e.ClientId,Name:e.Firstname+" "+e.Surname,Description:e.Email?e.Email:"",Mobile:e.Mobile,ImageUrl:u.formatUrl(e.ImageUrl,e.Name)};n.newBooker=e,n.filteredBookers.push(o),n._dbooking.ClientStaffId=e.Id},function(){n._dbooking.ClientStaffId=null})}e?n.selectedBooker=n.filteredBookers.filter(function(n){return n.Id==e})[0]:n.selectedBooker=null}),n.$watch("selectedPassenger.Mobile",function(e){n._dbooking.PassengerNotificationPhone=e}),n.$watch("selectedPassenger.Phone",function(e){n._dbooking.PassengerNotificationPhone||(n._dbooking.PassengerNotificationPhone=e)}),n.$watch("_dbooking.LeadPassengerId",function(o){function a(){s.Passenger.query().where("Id","eq","guid'"+o+"'").include("Tags").select("Tags").execute().then(function(e){l.Tags=e[0].Tags,n.passengerTags=l.Tags;for(var o=0;o<l.Tags.length;o++)S(l.Tags[o])})}if("add-passenger"===o){var d=t.open({templateUrl:"/webapp/common/modals/passenger/create.modal.html",controller:"PassengerItemCreateModalController",resolve:{rClientId:function(){return n._dbooking.ClientId},rNavigateAfterSave:function(){return!1}}});return void d.result.then(function(e){var o={Id:e.Id,ClientId:e.ClientId,Name:e.Firstname+" "+e.Surname,Description:e.Email?e.Email:"",Mobile:e.Mobile,Phone:e.Phone,ImageUrl:u.formatUrl(e.ImageUrl,e.Name),Notes:e.Notes};n.fetchedPassengers.push(o),n._dbooking.ClientId=e.ClientId,n._dbooking.LeadPassengerId=e.Id},function(){n._dbooking.LeadPassengerId=null})}n.filteredPaymentCards=[],n._dbooking.PaymentCardId=null;var r=n._dbooking;if(o){var l=n.fetchedPassengers.filter(function(e){return e.Id==o})[0];n.selectedPassenger=l,s.Note.query().where("OwnerType eq 'Passenger'").where("OwnerId eq guid'"+o+"'").execute().then(function(e){var o="";for(m=0;m<e.length;m++)o+=e[m].Content,m<e.length-1&&(o+="\r\n\r\n");l.Notes=o,l.Notes&&(n.company.AutoCopyPassengerNotes&&(r.DriverNotes="Passenger Note: \r\n"+l.Notes),g(function(){$("tab-heading:contains(Passenger)")[0].click()}))}),r.ClientId=l.ClientId?l.ClientId:void 0,r.PassengerNotificationPhone=n.selectedPassenger.Mobile?n.selectedPassenger.Mobile:n.selectedPassenger.Phone,e.forEach(l.Addresses,function(e){if(e.Latitude&&e.Longitude){var o="";e.Address1&&e.Address1.length>1&&(o+=e.Address1),e.TownCity?(o.length>0&&(o+=", "),o+=e.TownCity):e.Area&&(o.length>0&&(o+=", "),o+=e.Area),e.Postcode&&(o.length>0&&(o+=", "),o+=e.Postcode),n.externalLocations.knownLocations.push({Address1:e.Address1,Address2:e.Address2,Area:e.Area,TownCity:e.TownCity,County:e.County,Postcode:e.Postcode,Country:e.Country,Latitude:e.Latitude,Longitude:e.Longitude,Name:e.Name,StopSummary:e.StopSummary||o,LocationType:"Passenger Address"})}});var f=n.clients.filter(function(e){return e.Id==l.ClientId})[0];if(f?n.fetchedClients=[f]:n.fetchedClients=[],s.Booking.query().where("LeadPassengerId","eq","guid'"+o+"'").include("BookingStops").orderBy("BookedDateTime desc").top(5).execute().then(function(e){n.paxHistory=e,n.currentTab="HISTORY"}),n.externalLocations.historic.length=0,s.BookingStop.query().where("Booking/LeadPassengerId","eq","guid'"+o+"'").top(10).execute().then(function(e){var o={};uniqueResults=e.filter(function(e){return!o[e.Address1]&&(o[e.Address1]=!0,!0)}),[].push.apply(n.externalLocations.historic,uniqueResults)}),"Card"==n._dbooking.PaymentMethod&&i.CARD_PAYMENTS_ENABLED&&(n.filteredPaymentCards=[],c.get(i.API_ENDPOINT+"api/payments/getcardsforpassenger",{params:{passengerId:n._dbooking.LeadPassengerId}}).success(function(o){n.showPaymentCards=!0,e.forEach(o,function(e){n.filteredPaymentCards.push({Id:e.Id,Name:e.CardNumber,Description:e.Type.toUpperCase()+" - Expiring "+e.ExpirationMonth+"/"+e.ExpirationYear})})})),null!=l.DefaultVehicleTypeId&&(n._dbooking.VehicleTypeId=l.DefaultVehicleTypeId,!n.filteredVehicleTypes.some(function(e){return e.Id==l.DefaultVehicleTypeId}))){var p=n.vehicleTypes.find(function(e){return e.Id==l.DefaultVehicleTypeId});p&&n.filteredVehicleTypes.push(p)}l.Tags||a()}else if(X||(X=!0,n.filteredPassengers=n.passengers),n.selectedPassenger=null,r.PassengerNotificationPhone=null,n.externalLocations.knownLocations=n.externalLocations.knownLocations.filter(function(e){return"Passenger Address"!==e.LocationType}),n.passengerTags)for(var m=0;m<n.passengerTags.length;m++)x(n.passengerTags[m])});var ne=!0;n.$watch("_dbooking.ClientId",function(o){function t(){if(s.Note.query().where("OwnerType eq 'Client'").where("OwnerId eq guid'"+o+"'").execute().then(function(e){var o="";for(d=0;d<e.length;d++)o+=e[d].Content+"\r\n\r\n";n.clientNotes=o}),n.clientReferences=e.copy(a.ClientReferences),n.clientReferences.map(function(e){return"Mask"==e.ReferenceType&&(e.$testReg=C(e.Value)),"List"==e.ReferenceType&&e.ShowList&&c({method:"GET",url:i.API_ENDPOINT+"/api/ClientReferences/list?ClientReferenceId="+e.Id}).then(function(n){e.$list=n.data.map(function(e){return{custom:!1,text:e}}),e.AllowAddToList&&e.$list.push({custom:!0,text:"Add '{{$select.search}}' to References"})}),e}),n.selectedClient=a,a)if(a.AllVehicleTypeAccess===!1?s.Client.query().where("Id eq guid'"+o+"'").include("VehicleTypes").select("VehicleTypes").execute().then(function(e){if(n.filteredVehicleTypes=e[0].VehicleTypes.sort(function(e,n){return(e.Order||99)-(n.Order||99)}).map(function(e){return e.ImageUrl=null,e}),a.DefaultVehicleTypeId){if(n._dbooking.VehicleTypeId=a.DefaultVehicleTypeId,!n.filteredVehicleTypes.some(function(e){return e.Id==a.DefaultVehicleTypeId})){var o=n.vehicleTypes.find(function(e){return e.Id==a.DefaultVehicleTypeId});o&&n.filteredVehicleTypes.push(o)}}else n._dbooking.VehicleTypeId=n.filteredVehicleTypes[0].Id}):(n.filteredVehicleTypes=n.vehicleTypes,a.DefaultVehicleTypeId&&(n._dbooking.VehicleTypeId=a.DefaultVehicleTypeId)),a.DefaultPaymentType&&(n._dbooking.PaymentMethod=a.DefaultPaymentType),n._dbooking.TextConfirmation=e.isDefined(a.TextConfirmation)&&null!==a.TextConfirmation?a.TextConfirmation:n.company.TextConfirmation,n._dbooking.EmailConfirmation=e.isDefined(a.EmailConfirmation)&&null!==a.EmailConfirmation?a.EmailConfirmation:n.company.EmailConfirmation,n._dbooking.TextOnArrival=e.isDefined(a.TextOnArrival)&&null!==a.TextOnArrival?a.TextOnArrival:n.company.TextOnArrival,n._dbooking.CallOnArrival=e.isDefined(a.CallOnArrival)&&null!==a.CallOnArrival?a.CallOnArrival:n.company.CallOnArrival,n._dbooking.TextAssigned=e.isDefined(a.TextAssigned)&&null!==a.TextAssigned?a.TextAssigned:n.company.TextAssigned,n._dbooking.EmailAssigned=e.isDefined(a.EmailAssigned)&&null!==a.EmailAssigned?a.EmailAssigned:n.company.EmailAssigned,n._dbooking.TextOnCompletion=e.isDefined(a.TextOnCompletion)&&null!==a.TextOnCompletion?a.TextOnCompletion:n.company.TextOnCompletion,n._dbooking.TextOnOnRoute=e.isDefined(a.TextOnOnRoute)&&null!==a.TextOnOnRoute?a.TextOnOnRoute:n.company.TextOnOnRoute,n._dbooking.AutoDispatch=a.AutoDispatch,a.Priority){var t=["P1","P2","P3","P4","P5"].indexOf(a.Priority)+1;n._dbooking.Priority=t.toFixed(0)}else n._dbooking.Priority="P1";else n.filteredVehicleTypes=n.vehicleTypes;if(a.Tags)for(var d=0;d<a.Tags.length;d++)S(a.Tags[d]);g(function(){var e=$("#passenger-info").height()-37;$(".form-control.client-notes").css("height",e+"px")},100),s.Client.query().where("Id eq guid'"+o+"'").include("KnownLocations").select("KnownLocations,Address1,Address2,Area,TownCity,County,Postcode,Country,Latitude,Longitude,BillingAddress1,BillingAddress2,BillingArea,BillingTownCity,BillingCounty,BillingPostcode,BillingCountry,BillingLatitude,BillingLongitude").execute().then(function(e){if([].push.apply(n.externalLocations.knownLocations,e[0].KnownLocations),e[0].Latitude&&e[0].Longitude){var o="";e[0].Address1&&e[0].Address1.length>1&&(o+=e[0].Address1),e[0].TownCity?(o.length>0&&(o+=", "),o+=e[0].TownCity):e[0].Area&&(o.length>0&&(o+=", "),o+=e[0].Area),e[0].Postcode&&(o.length>0&&(o+=", "),o+=e[0].Postcode),n.externalLocations.knownLocations.push({Address1:e[0].Address1,Address2:e[0].Address2,Area:e[0].Area,TownCity:e[0].TownCity,County:e[0].County,Postcode:e[0].Postcode,Country:e[0].Country,Latitude:e[0].Latitude,Longitude:e[0].Longitude,Name:"Office Address",StopSummary:o,LocationType:"OFFICE"})}if(e[0].BillingLatitude&&e[0].BillingLongitude&&e[0].BillingLatitude!=e[0].Latitude&&e[0].Longitude!=e[0].BillingLongitude){var o="";e[0].BillingAddress1&&e[0].BillingAddress1.length>1&&(o+=e[0].BillingAddress1),e[0].BillingTownCity?(o.length>0&&(o+=", "),o+=e[0].BillingTownCity):e[0].BillingArea&&(o.length>0&&(o+=", "),o+=e[0].BillingArea),e[0].BillingPostcode&&(o.length>0&&(o+=", "),o+=e[0].BillingPostcode),n.externalLocations.knownLocations.push({Address1:e[0].BillingAddress1,Address2:e[0].BillingAddress2,Area:e[0].BillingArea,TownCity:e[0].BillingTownCity,County:e[0].BillingCounty,Postcode:e[0].BillingPostcode,Country:e[0].BillingCountry,Latitude:e[0].BillingLatitude,Longitude:e[0].BillingLongitude,Name:"Billing Address",StopSummary:o,LocationType:"OFFICE"})}})}if(n._dbooking.$clientOnHold=!1,ne)setTimeout(function(){ne=!1},0);else if(o){n._dbooking.ClientStaffId=null;var a=n.clients.filter(function(e){return e.Id==o})[0];if(a.OnHold)return swal({title:"Account On Hold",text:"This account is currently on hold, new bookings have been disabled.",type:"error",animation:"slide-from-top"}),n._dbooking.$clientOnHold=!0,void(n._dbooking.ClientId=null);a.AccountPassword?swal({title:"Account Password",text:"This account is password enabled.",type:"input",showCancelButton:!0,closeOnConfirm:!1,inputPlaceholder:"Account Password"},function(e){return e===!1?(n._dbooking.ClientId=null,n.$apply(),!1):""===e?(swal.showInputError("You need to write something!"),!1):e!=a.AccountPassword?(swal.showInputError("Incorrect Password"),!1):(n._dbooking.ClientId=o,swal("Accepted","The password is valid. Please continue with the booking.","success"),t(),void 0)}):t()}else n._dbooking.ClientStaffId=null,n._dbooking.LeadPassengerId=null,n._dbooking.ClientId=null,n.fetchedClients=[],n.clientReferences=[],n.selectedClient=null,n.filteredVehicleTypes=n.vehicleTypes,n._dbooking.PaymentMethod="Cash",n.externalLocations.knownLocations.length=0,n._dbooking.Tags.length=0;if(n._dbooking.ClientId){var d=n.clients.filter(function(e){return e.Id==n._dbooking.ClientId})[0];d&&(n._dbooking.CurrencyId=d.DefaultCurrencyId)}else n._dbooking.CurrencyId=n.COMPANY.DefaultCurrencyId;ne||(n.canQuote=!0,e.forEach(n._dbooking.BookingStops,function(e,o){e.Latitude&&e.Longitude||(n.canQuote=!1)}),n.canQuote?W(n._dbooking):(ee&&(ee.setMap(null),ee=null),n.quote=null,n.directions=null,n._dbooking.EstimatedCost=0,n._dbooking.ActualCost=0))},!0),n.$watch("_dbooking.Date",function(e,o){n.flightData.Number&&e&&e!=o&&Y()}),n.$watch("_dbooking.PaymentMethod",function(o){"Card"==o?n._dbooking.TaxId=n.COMPANY.DefaultCardTaxId||n.COMPANY.DefaultTaxId:"Cash"==o?n._dbooking.TaxId=n.COMPANY.DefaultCashTaxId||n.COMPANY.DefaultTaxId:n._dbooking.TaxId=n.COMPANY.DefaultTaxId,n.canQuote=!0,"Card"==o&&void 0!=n._dbooking.LeadPassengerId&&i.CARD_PAYMENTS_ENABLED?(n.filteredPaymentCards=[],c.get(i.API_ENDPOINT+"api/payments/getcardsforpassenger",{params:{passengerId:n._dbooking.LeadPassengerId}}).success(function(o){n.showPaymentCards=!0,e.forEach(o,function(e){n.filteredPaymentCards.push({Id:e.Id,Name:e.CardNumber,Description:e.Type.toUpperCase()+" - Expiring "+e.ExpirationMonth+"/"+e.ExpirationYear})})})):(n.showPaymentCards=!1,n._dbooking.PaymentCard=null,n._dbooking.PaymentCardId=null),e.forEach(n._dbooking.BookingStops,function(e,o){e.Latitude&&e.Longitude||(n.canQuote=!1)}),n.canQuote?W(n._dbooking):(ee&&(ee.setMap(null),ee=null),n.quote=null,n.directions=null,n._dbooking.EstimatedCost=0,n._dbooking.ActualCost=0)},!0),n.$watch("_dbooking.PaymentCardId",function(e){"Card"==n._dbooking.PaymentMethod&&void 0!=n._dbooking.LeadPassengerId&&i.CARD_PAYMENTS_ENABLED&&(null==e||void 0==e?n.canQuote=!1:n.canQuote=!0)}),n.$watch("_dbooking.BookingStops[0]",function(o){if(n._dbooking.WaitAndReturn){var t=new s.BookingStop(e.copy(n._dbooking.BookingStops[0]));
t.id=idCounter++,n._dbooking.BookingStops.splice(n._dbooking.BookingStops.length-1,1,t)}},!0),n.$watch("_dbooking.WaitAndReturn",function(o){if(o===!1)n._dbooking.BookingStops.splice(n._dbooking.BookingStops.length-1,1);else if(o===!0){var t=new s.BookingStop(e.copy(n._dbooking.BookingStops[0]));t.id=idCounter++,t.StopOrder=n._dbooking.BookingStops.length-1,n._dbooking.BookingStops.push(t)}n.canQuote=!0;var i=new google.maps.LatLngBounds,a=0;H(),e.forEach(n._dbooking.BookingStops,function(e,o){if(e.Latitude&&e.Longitude){a++;var t=new google.maps.LatLng(e.Latitude,e.Longitude);J.push(new google.maps.Marker({position:t,visible:!0,icon:0==o?"/includes/images/user.png":"/includes/images/userTo.png",map:n.dispatchObj.map.mapObject,zIndex:1e3})),i.extend(t)}else n.canQuote=!1}),a>0&&n.dispatchObj.map.mapObject.fitBounds(i)}),n.$watchGroup(["_dbooking.Date","_dbooking.Time"],function(o){n._dbooking.BookedDateTime=w(o[0],o[1]),n.canQuote=!0,n.timeSet||(n._dbooking.FlightInfo=null),n.timeSet=!1,e.forEach(n._dbooking.BookingStops,function(e,o){e.Latitude&&e.Longitude||(n.canQuote=!1)}),n.canQuote?W(n._dbooking):(ee&&(ee.setMap(null),ee=null),n.quote=null,n.directions=null,n._dbooking.EstimatedCost=0,n._dbooking.ActualCost=0)}),n.$watch("_dbooking.BookingStops",function(o){n.canQuote=!0;var t=new google.maps.LatLngBounds,i=0;H(),e.forEach(o,function(e,o){if(e.Latitude&&e.Longitude){i++;var a=new google.maps.LatLng(e.Latitude,e.Longitude);J.push(new google.maps.Marker({position:a,visible:!0,icon:0==o?"/includes/images/user.png":"/includes/images/userTo.png",map:n.dispatchObj.map.mapObject,zIndex:1e3})),t.extend(a)}else n.canQuote=!1}),i>0&&n.dispatchObj.map.mapObject.fitBounds(t),n.canQuote?W(n._dbooking):(ee&&(ee.setMap(null),ee=null),n.quote=null,n.directions=null,n._dbooking.EstimatedCost=0,n._dbooking.ActualCost=0)},!0),n.$watchGroup(["_dbooking.AsDirected","_dbooking.ChauffeurMode","_dbooking.EstimatedMins","_dbooking.ActualDistance","_dbooking.BookingStops.length"],function(o,t){if(n._dbooking.AsDirected===!0)n._dbooking.BookingStops.length=1;else if(1==n._dbooking.BookingStops.length){var i=new s.BookingStop;i.id=idCounter++,n._dbooking.BookingStops.push(i)}n.canQuote=!0;var a=new google.maps.LatLngBounds,d=0;H(),e.forEach(n._dbooking.BookingStops,function(e,o){if(e.Latitude&&e.Longitude){d++;var t=new google.maps.LatLng(e.Latitude,e.Longitude);J.push(new google.maps.Marker({position:t,visible:!0,icon:0==o?"/includes/images/user.png":"/includes/images/userTo.png",map:n.dispatchObj.map.mapObject,zIndex:1e3})),a.extend(t)}else n.canQuote=!1}),0==d&&(n.canQuote=!1),d>0&&n.dispatchObj.map.mapObject.fitBounds(a),n.canQuote?W(n._dbooking):(ee&&(ee.setMap(null),ee=null),n.quote=null,n.directions=null,n._dbooking.EstimatedCost=0,n._dbooking.ActualCost=0)}),n.$watch("_dbooking.VehicleTypeId",function(o){n.canQuote=!0;var t=new google.maps.LatLngBounds,i=0;H(),e.forEach(n._dbooking.BookingStops,function(e,o){if(e.Latitude&&e.Longitude){i++;var a=new google.maps.LatLng(e.Latitude,e.Longitude);J.push(new google.maps.Marker({position:a,visible:!0,icon:0==o?"/includes/images/user.png":"/includes/images/userTo.png",map:n.dispatchObj.map.mapObject,zIndex:1e3})),t.extend(a)}else n.canQuote=!1}),i>0&&n.dispatchObj.map.mapObject.fitBounds(t),n.canQuote?W(n._dbooking):(ee&&(ee.setMap(null),ee=null),n.quote=null,n.directions=null,n._dbooking.EstimatedCost=0,n._dbooking.ActualCost=0)})}function o(){return function(e,n){return n.trim().length>0&&(e=e.filter(function(e){return(e.Name+e.Mobile+e.Description+"").toLowerCase().indexOf(n.toLowerCase())>-1||"add-passenger"==e.Id})),e}}var t=e.module("cab9.dispatch");t.controller("DispatchNewBookingController",n),t.filter("PassengerFilter",o),n.$inject=["$scope","$UI","$modal","$config","$q","Model","$stateParams","$rootScope","Localisation","$utilities","$http","$timeout","$filter","rCompany","rTags"]}(angular);;;;
!function(e){function o(o,n,t,i,a,c,r,s){function d(e){if(e.length>0)for(var n=0;n<e.length;n++){var t=e[n],a=moment(t.BookedDateTime).diff(moment(),"minutes");if(a>180?t.$countdown=(a/60).toFixed(2)+" hours":a>=0?1==a?t.$countdown=a+" min":t.$countdown=a+" mins":a<-180?t.$countdown=(Math.abs(a)/60).toFixed(2)+" hours ago":a==-1?t.$countdown=Math.abs(a)+" min ago":t.$countdown=Math.abs(a)+" mins ago","Accepted"!=t.OneTransportStatus&&"AutoAccepted"!=t.OneTransportStatus){var r=moment(t.OneTransportReceived).add(90,"seconds").diff(moment(),"seconds");t.$countup=r+" secs"}t.BookingStops=c("orderBy")(t.BookingStops,"StopOrder");for(var s=0;s<t.BookingStops.length;s++)t.BookingStops[s]=new i.BookingStop(t.BookingStops[s]);("Accepted"==t.OneTransportStatus||"AutoAccepted"==t.OneTransportStatus||r>0)&&o.dispatchObj.unconfirmed.items.push(t)}}function g(e){var a=new i.Booking(e);"WORKSHARE"==a.BookingSource?(e.$loading=!0,o.dispatchObj.bookings.reload++,n.put(t.API_ENDPOINT+"api/partners/booking/accept?bookingId="+e.Id).success(function(){e.$loading=!1,o.dispatchObj.bookings.reload++,f("Booking Accepted","SUCCESS"),p()}).error(function(){e.$loading=!1,o.dispatchObj.bookings.reload++,f("Booking Accept Failed","FAIL"),p()})):a.OneTransportReference?n.post(t.API_ENDPOINT+"api/OneTransport/Accept?BookingId="+e.Id).success(function(){f("Booking Accepted","SUCCESS"),p()}).error(function(){f("Booking Accept Failed","FAIL"),p()}):a.CityFleetReference&&n.post(t.API_ENDPOINT+"api/CityFleet/Accept?BookingId="+e.Id).success(function(){f("Booking Accepted","SUCCESS"),p()}).error(function(){f("Booking Accept Failed","FAIL"),p()})}function l(e){window.open("/webapp/common/modals/bookings/edit-booking/window.html#?id="+e.Id+"&clientId="+e.ClientId,"EDIT:"+e.Id,"height=850,width=1000,left=0,top=0")}function u(e){var a=new i.Booking(e);swal({title:"Are you sure?",text:"Booking will be handed back.",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm"},function(){"WORKSHARE"==a.BookingSource?(e.$loading=!0,o.dispatchObj.bookings.reload++,n.put(t.API_ENDPOINT+"api/partners/booking/reject?bookingId="+e.Id).success(function(){e.$loading=!1,o.dispatchObj.bookings.reload++,f("Booking Rejected","SUCCESS"),p()}).error(function(){e.$loading=!1,o.dispatchObj.bookings.reload++,f("Booking Reject Failed","FAIL"),p()})):a.OneTransportReference?n.post(t.API_ENDPOINT+"api/OneTransport/Reject?BookingId="+e.Id).success(function(){f("Booking Rejected","SUCCESS"),p()}).error(function(){f("Booking Reject Failed","FAIL"),p()}):a.CityFleetReference&&n.post(t.API_ENDPOINT+"api/CityFleet/Reject?BookingId="+e.Id).success(function(){f("Booking Rejected","SUCCESS"),p()}).error(function(){f("Booking Reject Failed","FAIL"),p()})})}function f(e,n){o.dispatchObj.history.unshift({status:n||"info",text:e,time:(new moment).format("HH:mm:ss")}),o.dispatchObj.history.length=Math.min(o.dispatchObj.history.length,30)}function p(){o.fetching=!0,i.Booking.query().include("BookingStops,FlightInfo,Client,ClientStaff,LeadPassenger,Driver,Vehicle,VehicleType,Currency").select("Id,LocalId,DriverId,ClientId,ClientStaffId,Reference,BookingStatus,DriverNotes,PassengerNotificationPhone,EstimatedDistance,PassengerNotes,HasEdits,OfficeNotes,BookingSource,CreationTime,VehicleId,LeadPassengerId,Currency,CurrencyRate,Tax,ActualCost,BookedDateTime,ImageUrl,Pax,Bax,BookingExpense,Driver/Firstname,Driver/Surname,Driver/Callsign,Driver/ImageUrl,Driver/Mobile,Client/Name,Client/AccountNo,Client/ImageUrl,Client/Phone,ClientStaff/Firstname,ClientStaff/Surname,ClientStaff/ImageUrl,ClientStaff/Phone,Vehicle/Class,Vehicle/Registration,Vehicle/Colour,Vehicle/Make,Vehicle/Model,VehicleType/Name,FlightInfo/FlightNumber,FlightInfo/OriginCode,FlightInfo/Origin,FlightInfo/ArrivalTime,FlightInfo/LastUpdate,FlightInfo/ScheduledArrivalTime,BookingStops/StopSummary,BookingStops/Postcode,BookingStops/WaitTimeChargable,BookingStops/Address1,BookingStops/Latitude,BookingStops/Longitude,LeadPassenger/Firstname,LeadPassenger/Surname,LeadPassenger/Mobile,LeadPassenger/ImageUrl,OneTransportReference,OneTransportReceived,OneTransportStatus").orderBy("BookedDateTime").where("BookingStatus eq 'Unconfirmed'").where("BookedDateTime ge datetimeoffset'"+moment().subtract(1,"day").format()+"'").execute().then(function(e){e.map(function(e){e.FlightInfo&&(moment().diff(moment(e.FlightInfo.LastUpdate),"hours")>10?e.FlightInfo.$Status="No updates yet.":e.FlightInfo.$Status="Last Updated "+moment(e.FlightInfo.LastUpdate).fromNow())}),o.dispatchObj.unconfirmed.items.length=0,a(function(){o.dispatchObj.unconfirmed.formatBookings(e),o.fetching=!1,a(function(){k()},0)},0)},function(){f("OT Fetch Failed","FAIL")})}function m(e){}function h(e,n){"13"==e.keyCode?(o.dispatchObj.selectedBooking=n,o.dispatchObj.map.drawRoute(n)):"27"==e.keyCode&&m(null)}function k(){$("#unconfirmed .booking").bind("keydown",function(e){if(e.preventDefault(),"40"==e.keyCode){var o=$(this).attr("tabindex");o++,$("[tabindex="+o+"]").focus()}else if("38"==e.keyCode){var o=$(this).attr("tabindex");o--,$("[tabindex="+o+"]").focus()}})}o.dispatchObj.unconfirmed={items:[],formatBookings:d,selectBooking:m,refetchBookings:p,showHistory:l,acceptBooking:g,rejectBooking:u},o.fetching=!0,o.manageKeyPress=h,o.today=(new moment).format("DD/MM/YYYY"),o.acceptBooking=g,o.rejectBooking=u,a(function(){p()},0),o.$on("SIGNALR_bookingResponded",function(n,t){var i=t[0],a=null;e.forEach(o.dispatchObj.unconfirmed.items,function(e,o){if(e.Id==i)return a=o,!0}),null!=a&&o.dispatchObj.unconfirmed.items.splice(a,1),o.$apply()}),o.$watch("SIGNALR.status",function(e,o){})}var n=e.module("cab9.dispatch");n.controller("DispatchUnconfirmedBookingController",o),o.$inject=["$scope","$http","$config","Model","$timeout","$filter","$interval","$modal"]}(angular);;;;
!function(e){function t(t,n,o,s,a,r,c,d,l,p,h,u,g){function b(){l.get(p.API_ENDPOINT+"api/bookings/workshare-bookings").then(function(e){var i=e.data.map(function(e){return new n.Booking(e)});t.dispatchObj.workshare.bookings=i},function(){})}function f(){for(i=0;i<U.length;i++)U[i].$notification.then(function(e){e.kill(!0)});h.location.href="/webapp/management/index.html"}function m(e,i){var o=t.$new();return o.callData={label:"Calling...",value:e,status:"RINGING"},o.chooseBookingFromCall=function(e){t.dispatchObj.bookingSearch.$=e},o.removeNotification=function(){this.kill(!0)},o.handleNewBooking=function(o){t.dispatchObj.phoneCall=new n.TelephonyCall,t.dispatchObj.phoneCall.Caller=e,t.dispatchObj.phoneCall.CallIdentifier=i,l({method:"GET",url:p.API_ENDPOINT+"/api/telephony/callers-for-number",params:{number:t.dispatchObj.phoneCall.Caller.replaceAll(" ","")},paramSerializer:"$httpParamSerializerJQLike"}).then(function(e){e.data&&(e.data.Passengers.map(function(e){e.$Description=e.Name,e.Client&&e.Client.Name&&(e.$Description+=" - "+e.Client.Name)}),t.dispatchObj.listOfCallers=e.data)},function(e){}),c.go("dispatch.newbooking",{},{reload:!1}),t.$broadcast("CALLNEWBOOKINGREQUESTED",null)},l({method:"GET",url:p.API_ENDPOINT+"/api/telephony/caller-name",params:{number:e},paramSerializer:"$httpParamSerializerJQLike"}).then(function(e){e.data.length>0&&(console.log(e.data),o.callData.value=e.data)},function(e){}),l({method:"GET",url:p.API_ENDPOINT+"/api/telephony/existing-booking",params:{number:e},paramSerializer:"$httpParamSerializerJQLike"}).then(function(e){e.data&&(o.callData.existingBooking=e.data)},function(e){}),o}function O(){c.is("dispatch.bookings")?r.open({templateUrl:"/webapp/management/dispatch/modals/filter/booking-modal.html",controller:"DispatchBookingFilterModalController",backdrop:"static",resolve:{rFilters:function(){return t.dispatchObj.filters}}}).result.then(function(e){t.dispatchObj.bookings.refetchBookings(),sessionStorage.setItem("CAB9_DISPATCH_FILTERS",JSON.stringify(t.dispatchObj.filters))}):c.is("dispatch.workshare")?r.open({templateUrl:"/webapp/management/dispatch/modals/filter/booking-modal.html",controller:"DispatchBookingFilterModalController",backdrop:"static",resolve:{rFilters:function(){return t.dispatchObj.filters}}}).result.then(function(e){t.dispatchObj.bookings.refetchBookings(),sessionStorage.setItem("CAB9_DISPATCH_FILTERS",JSON.stringify(t.dispatchObj.filters))}):c.is("dispatch.drivers")&&r.open({templateUrl:"/webapp/management/dispatch/modals/filter/driver-modal.html",controller:"DispatchDriverFilterModalController",backdrop:"static",resolve:{rFilters:function(){return t.dispatchObj.filters}}}).result.then(function(e){t.dispatchObj.bookings.refetchBookings(),sessionStorage.setItem("CAB9_DISPATCH_FILTERS",JSON.stringify(t.dispatchObj.filters)),t.dispatchObj.drivers.reload=t.dispatchObj.drivers.reload+1})}function k(){if(t.dispatchObj.unconfirmed&&t.dispatchObj.unconfirmed.items){var i=[];e.forEach(t.dispatchObj.unconfirmed.items,function(e,t){if("Accepted"!=e.OneTransportStatus&&"AutoAccepted"!=e.OneTransportStatus){var n=moment(e.OneTransportReceived).add(75,"seconds").diff(moment(),"seconds");e.$countup=n+" secs",n<0&&i.unshift(t)}}),e.forEach(i,function(e){t.dispatchObj.unconfirmed.items.splice(e,1)}),t.dispatchObj.unconfirmed.items.length>0&&(t.dispatchObj.bookings.reload=t.dispatchObj.bookings.reload+1)}if(t.dispatchObj.bookings.items){var i=[];e.forEach(t.dispatchObj.bookings.items,function(e,t){if(e.OneTransportReceived&&"Unconfirmed"==e.BookingStatus&&"Accepted"!=e.OneTransportStatus&&"AutoAccepted"!=e.OneTransportStatus){var n=moment(e.OneTransportReceived).add(90,"seconds").diff(moment(),"seconds");e.$countup=n+" secs",n<0&&i.unshift(t)}else null!=e.$countup&&delete e.$countup}),e.forEach(i,function(e){t.dispatchObj.bookings.items.splice(e,1)})}}function v(e){var i=null,n=t.dispatchObj.live.status;i=null===e||void 0===e?!n:e,n&&!i?s.server.stopLocations():i&&!n&&s.server.startLocations(),t.dispatchObj.live.status=i,i?sessionStorage.setItem("CAB9:DISPATCH:UPDATES","live"):sessionStorage.removeItem("CAB9:DISPATCH:UPDATES")}function j(e){var i=null,n=t.dispatchObj.sound.status;i=null===e||void 0===e?!n:e,t.dispatchObj.sound.status=i,i?sessionStorage.setItem("CAB9:DISPATCH:SOUND","ON"):sessionStorage.removeItem("CAB9:DISPATCH:SOUND")}function S(e){var i=null,n=t.dispatchObj.dispatch.status;i=null===e||void 0===e?!n:e,t.dispatchObj.dispatch.status=i,l.patch(p.API_ENDPOINT+"api/DispatchSettings",{Id:t.dispatchObj.dispatch.settings.Id,Active:i},{params:{Id:t.dispatchObj.dispatch.settings.Id}})}function I(){t.dispatchObj.workshare.driverStatus=!t.dispatchObj.workshare.driverStatus,t.dispatchObj.workshare.driverStatus?(x(),R.partnerDrivers=t.$on("SIGNALR_updatePartnerDriverLocations",y)):(R.partnerDrivers&&R.partnerDrivers(),t.dispatchObj.partnerDrivers.items.length=0,t.dispatchObj.map.updatePartnerDriverMarkers())}function C(i,n){var o=n[0],s=t.dispatchObj.drivers.items.filter(function(e){return e.DriverId==o.Id})[0];s?(s.DriverStatus=o.DriverStatus,s.WeeksEarnings=o.Earnings):o.Shift&&t.dispatchObj.drivers.items.push(o.Shift);var a={Available:[],Clearing:[],OnJob:[],OnBreak:[]};e.forEach(t.dispatchObj.drivers.items,function(e){"Offline"!=e.DriverStatus&&a[e.DriverStatus].push(e)}),t.dispatchObj.drivers.byStatus.length=0,a.Available.length>0&&t.dispatchObj.drivers.byStatus.push({status:"Available",display:"Available",drivers:a.Available}),a.Clearing.length>0&&t.dispatchObj.drivers.byStatus.push({status:"Clearing",display:"Clearing",drivers:a.Clearing}),a.OnJob.length>0&&t.dispatchObj.drivers.byStatus.push({status:"OnJob",display:"On Job",drivers:a.OnJob}),a.OnBreak.length>0&&t.dispatchObj.drivers.byStatus.push({status:"OnBreak",display:"On Break",drivers:a.OnBreak}),t.dispatchObj.drivers.reload=t.dispatchObj.drivers.reload+1,t.$apply()}function B(i,n){var o=n[0];e.forEach(t.dispatchObj.bookings.items,function(e){var t=o.filter(function(t){return t.BookingId==e.Id})[0];t?e.$recommendation=t:e.$recommendation=null}),t.dispatchObj.bookings.reload=t.dispatchObj.bookings.reload+1}function D(i,n){var o=n[0];e.forEach(t.dispatchObj.bookings.items,function(e){var t=o.filter(function(t){return t.BookingId==e.Id})[0];t?e.$warning=t:e.$warning=null}),t.dispatchObj.bookings.reload=t.dispatchObj.bookings.reload+1}function A(e){c.go("dispatch.workshare"),t.dispatchObj.workshare.badgeCount=0,a(function(){t.dispatchObj.bookings.reload++},1e3)}function w(i,o){var s=o[0];if("WORKSHARE"==s.BookingSource)b();else if("Unconfirmed"==s.BookingStatus){if(t.dispatchObj.sound.status)try{var a=new SpeechSynthesisUtterance("New One Transport booking requires attention!");a.voice=speechSynthesis.getVoices().filter(function(e){return"Google UK English Female"==e.name})[0],speechSynthesis.speak(a)}catch(r){}var c=t.dispatchObj.unconfirmed.items.find(function(e){return e.Id==s.Id});if(c){var d=t.dispatchObj.unconfirmed.items.indexOf(c),l=t.dispatchObj.unconfirmed.items.slice();l.splice(d,1,s),t.dispatchObj.unconfirmed.items.length=0,t.dispatchObj.unconfirmed.formatBookings(l)}else{var l=t.dispatchObj.unconfirmed.items.slice();l.push(s),t.dispatchObj.unconfirmed.items.length=0,t.dispatchObj.unconfirmed.formatBookings(l)}}s.DriverBids&&s.DriverBids.length>0&&(s.Bids="active bids");var c=t.dispatchObj.bookings.items.filter(function(e){return e.Id==s.Id})[0],p=c&&c.$selected,h=!0,u=s.BookingStatus;"Arrived"==u&&(u="InProgress");var g=(new moment).add(t.dispatchObj.filters.fromSpan,"seconds"),f=(new moment).add(t.dispatchObj.filters.toSpan,"seconds"),m=new moment(s.BookedDateTime),O=t.dispatchObj.filters.bookingStatuses;if((m.isBefore(g)||m.isAfter(f))&&(h=!1),c&&h&&O[u]){var k=new n.Booking(e.extend({},c,s));k.$selected=p;var d=t.dispatchObj.bookings.items.indexOf(c);k.$pre=N(k),"OnRoute"==k.BookingStatus&&(k.$eta="ETA: Calculating...",k.$etaDesc="Calculating ETA to Pickup"),"InProgress"==k.BookingStatus&&(k.$eta="ETA: Calculating...",k.$etaDesc="Calculating ETA to DropOff"),t.dispatchObj.bookings.items.splice(d,1,k),t.dispatchObj.bookings.formatBookings(t.dispatchObj.bookings.items)}else if(c&&h&&"Completed"==u&&"Completed"!=c.BookingStatus){var k=new n.Booking(e.extend({},c,s));k.$selected=p;var d=t.dispatchObj.bookings.items.indexOf(c);k.$pre=N(k),k.$recentlyCompleted=!0,t.dispatchObj.bookings.items.splice(d,1,k),t.dispatchObj.bookings.formatBookings(t.dispatchObj.bookings.items)}else if(c&&h&&"COA"==u&&"COA"!=c.BookingStatus){var k=new n.Booking(e.extend({},c,s));k.$selected=p;var d=t.dispatchObj.bookings.items.indexOf(c);k.$pre=N(k),k.$recentlyCancelled=!0,t.dispatchObj.bookings.items.splice(d,1,k),t.dispatchObj.bookings.formatBookings(t.dispatchObj.bookings.items)}else if(c&&h&&"Cancelled"==u&&"Cancelled"!=c.BookingStatus){var k=new n.Booking(e.extend({},c,s));k.$selected=p;var d=t.dispatchObj.bookings.items.indexOf(c);k.$pre=N(k),k.$recentlyCancelled=!0,t.dispatchObj.bookings.items.splice(d,1,k),t.dispatchObj.bookings.formatBookings(t.dispatchObj.bookings.items)}else if(!c||h&&O[u]){if(h&&O[u]&&"Incoming"==u&&moment(s.CreationTime).isAfter((new moment).subtract(2,"minute"))){var v=new n.Booking(s);v.$new=!0,v.$pre=N(v),t.dispatchObj.bookings.items.push(v),t.dispatchObj.bookings.formatBookings(t.dispatchObj.bookings.items)}else if(h&&O[u]){var v=new n.Booking(s);v.$pre=N(v),t.dispatchObj.bookings.items.push(v),t.dispatchObj.bookings.formatBookings(t.dispatchObj.bookings.items)}}else{var d=t.dispatchObj.bookings.items.indexOf(c);t.dispatchObj.bookings.items.splice(d,1),t.dispatchObj.bookings.formatBookings(t.dispatchObj.bookings.items)}t.dispatchObj.bookings.formatBookings(t.dispatchObj.bookings.items),t.dispatchObj.map.updateBookingMarkers(),t.dispatchObj.map.updateFocus(),console.log("onUpdateBooking - $scope.$apply"),t.dispatchObj.bookings.reload=t.dispatchObj.bookings.reload+1,t.$apply()}function T(i,o){var s=o[0],a=t.dispatchObj.bookings.items.find(function(e){return e.Id==s.Id}),r=a&&a.$selected,c=!0,d=s.BookingStatus,l=(new moment).add(t.dispatchObj.filters.fromSpan,"seconds"),p=(new moment).add(t.dispatchObj.filters.toSpan,"seconds"),h=new moment(a.BookedDateTime),u=t.dispatchObj.filters.bookingStatuses;if((h.isBefore(l)||h.isAfter(p))&&(c=!1),a&&c&&u[d]){var g=new n.Booking(e.extend({},a,s));g.$selected=r;var b=t.dispatchObj.bookings.items.indexOf(a);g.$pre=N(g),"OnRoute"==g.BookingStatus&&(g.$eta="ETA: Calculating...",g.$etaDesc="Calculating ETA to Pickup"),"InProgress"==g.BookingStatus&&(g.$eta="ETA: Calculating...",g.$etaDesc="Calculating ETA to DropOff"),t.dispatchObj.bookings.items.splice(b,1,g),t.dispatchObj.bookings.formatBookings(t.dispatchObj.bookings.items)}else if(a&&c&&"Completed"==d&&"Completed"!=a.BookingStatus){var g=new n.Booking(e.extend({},a,s));g.$selected=r;var b=t.dispatchObj.bookings.items.indexOf(a);g.$pre=N(g),g.$recentlyCompleted=!0,t.dispatchObj.bookings.items.splice(b,1,g),t.dispatchObj.bookings.formatBookings(t.dispatchObj.bookings.items)}else if(a&&c&&"COA"==d&&"COA"!=a.BookingStatus){var g=new n.Booking(e.extend({},a,s));g.$selected=r;var b=t.dispatchObj.bookings.items.indexOf(a);g.$pre=N(g),g.$recentlyCancelled=!0,t.dispatchObj.bookings.items.splice(b,1,g),t.dispatchObj.bookings.formatBookings(t.dispatchObj.bookings.items)}else if(a&&c&&"Cancelled"==d&&"Cancelled"!=a.BookingStatus){var g=new n.Booking(e.extend({},a,s));g.$selected=r;var b=t.dispatchObj.bookings.items.indexOf(a);g.$pre=N(g),g.$recentlyCancelled=!0,t.dispatchObj.bookings.items.splice(b,1,g),t.dispatchObj.bookings.formatBookings(t.dispatchObj.bookings.items)}else if(!a||c&&u[d]){if(c&&u[d]&&"Incoming"==d&&moment(s.CreationTime).isAfter((new moment).subtract(2,"minute"))){var f=new n.Booking(s);f.$new=!0,f.$pre=N(f),t.dispatchObj.bookings.items.push(f),t.dispatchObj.bookings.formatBookings(t.dispatchObj.bookings.items)}else if(c&&u[d]){var f=new n.Booking(s);f.$pre=N(f),t.dispatchObj.bookings.items.push(f),t.dispatchObj.bookings.formatBookings(t.dispatchObj.bookings.items)}}else{var b=t.dispatchObj.bookings.items.indexOf(a);t.dispatchObj.bookings.items.splice(b,1),t.dispatchObj.bookings.formatBookings(t.dispatchObj.bookings.items)}t.dispatchObj.bookings.formatBookings(t.dispatchObj.bookings.items),t.dispatchObj.map.updateBookingMarkers(),t.dispatchObj.map.updateFocus(),console.log("onUpdateBookingStatus - $scope.$apply"),t.dispatchObj.bookings.reload=t.dispatchObj.bookings.reload+1,t.$apply()}function E(e,i){var n=i[0],o=t.dispatchObj.bookings.items.filter(function(e){return e.Id==n.BookingId})[0];o&&(o.$offer=n,console.log("onUpdateBookingOffer - $scope.$apply"),t.dispatchObj.bookings.reload=t.dispatchObj.bookings.reload+1,t.$apply())}function N(e){var t=new moment(e.BookedDateTime),i=new moment(e.CreationTime),n=moment.duration(t.diff(i)).asMinutes();return n>30}function P(e,i){var n=i[0],o=t.dispatchObj.drivers.items.filter(function(e){return e.DriverId==n.DriverId})[0];o&&(o.LastKnownLatitude=n.Latitude,o.LastKnownLongitude=n.Longitude,t.dispatchObj.selectedDriver==o&&t.map.panTo(new google.maps.LatLng(n.Latitude,n.Longitude)),t.dispatchObj.map.driverMarkers[n.DriverId]?t.dispatchObj.map.driverMarkers[n.DriverId].setPosition(new google.maps.LatLng(n.Latitude,n.Longitude)):t.dispatchObj.map.driverMarkers[n.DriverId]=t.dispatchObj.map.getMarkerForDriver(o),t.dispatchObj.drivers.reload=t.dispatchObj.drivers.reload+1)}function x(){l.get(p.API_ENDPOINT+"api/partners/drivers").success(function(e){t.dispatchObj.partnerDrivers.items.length=0,a(function(){t.dispatchObj.partnerDrivers.items=e,t.dispatchObj.map.updatePartnerDriverMarkers(),t.dispatchObj.map.updateFocus()},0)})}function y(e,i){var n=i[0];t.dispatchObj.partnerDrivers.items.length=0,a(function(){t.dispatchObj.partnerDrivers.items=n,t.dispatchObj.map.updatePartnerDriverMarkers(),t.dispatchObj.map.updateFocus()},0)}function L(){var e={fromSpan:-3600,toSpan:7200,bookingStatuses:{Unconfirmed:!0,Cancelled:!1,Incoming:!0,PreAllocated:!0,Allocated:!0,OnRoute:!0,InProgress:!0,Arrived:!0,Clearing:!0,Completed:!1,OpenToBid:!0},driverStatuses:{Offline:!1,OnBreak:!0,OnJob:!0,Clearing:!0,Available:!0}},t=null,i=sessionStorage.getItem("CAB9_DISPATCH_FILTERS");if(i)try{t=JSON.parse(i),t.bookingStatuses.Unconfirmed=!0}catch(n){sessionStorage.removeItem("CAB9_DISPATCH_FILTERS"),t=null}return t||e}t.exit=f,t.dispatchObj={live:{status:!1,toggleLive:v},workshare:{driverStatus:!1,items:[],badgeCount:0,bookings:[],toggleDrivers:I},dispatch:{status:!1,toggleDispatch:S,settings:{}},sound:{status:!1,toggleSound:j},history:[],map:{mapObject:null,displayOptions:{bookings:1,drivers:1,traffic:!0,heatmap:!1},plotMarkers:e.noop,plotDriverMarkers:e.noop,drawRoute:e.noop,toggleTraffic:e.noop},newBooking:{},phoneCall:null,listOfCallers:null,bookings:{items:[],selectBooking:e.noop,refetchBookings:e.noop},partnerDrivers:{items:[]},drivers:{items:[],selectDriver:e.noop,reload:0},bookingSearch:{},driverSearch:{},selectedBooking:null,selectedDriver:null,filters:L()},t.bookingGroups=[],t.showFilterModal=O;var _=d(k,1e3);t.openWorkshareTab=A,l.get(p.API_ENDPOINT+"api/DispatchSettings").then(function(e){e.data[0]&&(t.dispatchObj.dispatch.settings=e.data[0],t.dispatchObj.dispatch.status=t.dispatchObj.dispatch.settings.Active,t.dispatchObj.dispatch.mode=t.dispatchObj.dispatch.settings.Mode)});var R={partnerDrivers:null};b(),I(),$(".options-mobile-toggle").on("click",function(){$(".options.right").toggleClass("show-options")});var U=[];t.$on("SIGNALR_bookingDriverAck",function(e,i){var n=t.dispatchObj.bookings.items.find(function(e){return e.Id==i[0]});n&&(n.DriverAck=!0,t.dispatchObj.bookings.reload=t.dispatchObj.bookings.reload+1)});var G=[];t.$on("SIGNALR_ringing",function(e,t){var i=G.filter(function(e){return e.$id==t[0].CallIdentifier});if(!i||0==i.length){var n=m(t[0].Caller.replaceAll(" ",""),t[0].CallIdentifier),o=u.success({message:"Incoming Call",closeOnClick:!1,templateUrl:"phone_notification_template.html",scope:n});G.push({$id:t[0].CallIdentifier,$caller:t[0].Caller,$notification:o,$scope:n})}}),t.$on("SIGNALR_answered",function(e,t){var i=G.filter(function(e){return e.$id==t[0].CallIdentifier});if(!i||0==i.length){var n=m(t[0].Caller.replaceAll(" ",""),t[0].CallIdentifier),o=u.success({message:"Answered Call",closeOnClick:!1,templateUrl:"phone_notification_template.html",scope:n});G.push({$id:t[0].CallIdentifier,$caller:t[0].Caller,$notification:o,$scope:n}),i=G}if(t[0].StaffId==g.STAFF_ID){console.log(i[0].$scope.callData.value);var s=i[0].$scope.callData.value,a=i[0].$scope.callData.existingBooking;i[0].$scope.callData={label:"Talking to "+s,value:"00:00",seconds:0,status:"ANSWERED",existingBooking:a},i[0].$scope.timer=d(function(){i[0].$scope.callData.seconds+=1,i[0].$scope.callData.value=window.$utilities.secondsToHms(i[0].$scope.callData.seconds)},1e3)}else i[0].$notification.then(function(e){e.kill(!0)})}),t.$on("SIGNALR_hungUp",function(e,t){var i=G.filter(function(e){return e.$id==t[0].CallIdentifier});i.length>0&&(i[0].$notification.then(function(e){e.kill(!0)}),G.splice(G.indexOf(i[0]),1),d.cancel(i[0].$scope.timer))}),t.$on("SIGNALR_newExpenseNotification",function(e,i){function n(e,t){window.open("/webapp/common/modals/bookings/edit-booking/window.html#?id="+t.BookingId+"&clientId="+t.ClientId,"EDIT:"+t.BookingId,"height=850,width=1000,left=0,top=0"),e.stopPropagation()}function o(e){swal({title:"Confirm Decline",text:"Are you sure you want to decline this expense?",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm Decline"},function(){l.patch(p.API_ENDPOINT+"api/Expense/bookingexpense?BookingExpenseId="+e.ExpenseId+"&Status=false").then(function(e){r.then(function(e){e.kill(!0)})},function(e){swal("Error","Something didn't work, please try again","error")})})}function s(e){l.patch(p.API_ENDPOINT+"api/Expense/bookingexpense?BookingExpenseId="+e.ExpenseId+"&Status=true").then(function(e){r.then(function(e){e.kill(!0)})},function(e){swal("Error","Something didn't work, please try again","error")})}var a=t.$new();a.expense=i[0],a.acceptExpense=s,a.declineExpense=o,a.openEditModal=n,a.formatUrl=window.$utilities.formatUrl;var r=u.success({message:"Just message",closeOnClick:!1,templateUrl:"expense_notification_template.html",scope:a});U.push({$expenseId:i[0].ExpenseId,$notification:r})}),t.$on("SIGNALR_declinedExpenseNotification",function(e,t){var i=U.filter(function(e){return e.$expenseId==t[0].ExpenseId});i.length>0&&i[0].$notification.then(function(e){e.kill(!0)})}),t.$on("SIGNALR_approvedExpenseNotification",function(e,t){var i=U.filter(function(e){return e.$expenseId==t[0].ExpenseId});i.length>0&&i[0].$notification.then(function(e){e.kill(!0)})}),t.$on("SIGNALR_updateDriverStatus",C),t.$on("SIGNALR_updateBooking",w),t.$on("SIGNALR_updateBookingStatus",T),t.$on("SIGNALR_updateBookingOffer",E),t.$on("SIGNALR_updateDriverLocation",P),t.$on("SIGNALR_dispatchRecommendations",B),t.$on("SIGNALR_dispatchWarnings",D),window.dispatchCleanup.push(function(){t.$destroy(),_&&d.cancel(_)}),a(function(){sessionStorage.getItem("CAB9:DISPATCH:UPDATES")&&sessionStorage.removeItem("CAB9:DISPATCH:UPDATES"),sessionStorage.getItem("CAB9:DISPATCH:SOUND")&&j(!0),s.server.startShifts(),s.server.startTelephonyEvents()},1e3),t.$on("$destroy",function(){s.server.stopShifts(),s.server.stopTelephonyEvents(),v(!1)}),$(".content-area").resizable({handles:"e"}),$(".content-area").resize(function(){$(".map-area").css({left:$(".content-area").width()})})}var n=e.module("cab9.dispatch");n.controller("DispatchController",t),t.$inject=["$scope","Model","$filter","SignalR","$timeout","$modal","$state","$interval","$http","$config","$window","Notification","$rootScope"]}(angular);;;;
!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="/webapp/management/dispatch/react/",t(0)}(function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))switch(typeof e[t]){case"function":break;case"object":e[t]=function(t){var n=t.slice(1),o=e[t[0]];return function(e,t,r){o.apply(this,[e,t,r].concat(n))}}(e[t]);break;default:e[t]=e[e[t]]}return e}([function(e,t,n){n(205),n(204),n(125),e.exports=n(206)},function(e,t,n){"use strict";e.exports=n(48)},function(e,t){"use strict";t.__esModule=!0,t["default"]=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(209),a=o(r),i=n(208),l=o(i),u=n(83),s=o(u);t["default"]=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":(0,s["default"])(t)));e.prototype=(0,l["default"])(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(a["default"]?(0,a["default"])(e,t):e.__proto__=t)}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(83),a=o(r);t["default"]=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":(0,a["default"])(t))&&"function"!=typeof t?e:t}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(126),a=o(r);t["default"]=a["default"]||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}},function(e,t){"use strict";t.__esModule=!0,t["default"]=function(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}},function(e,t,n){var o,r;!function(){"use strict";function n(){for(var e=[],t=0;t<arguments.length;t++){var o=arguments[t];if(o){var r=typeof o;if("string"===r||"number"===r)e.push(o);else if(Array.isArray(o)&&o.length){var i=n.apply(null,o);i&&e.push(i)}else if("object"===r)for(var l in o)a.call(o,l)&&o[l]&&e.push(l)}}return e.join(" ")}var a={}.hasOwnProperty;"undefined"!=typeof e&&e.exports?(n["default"]=n,e.exports=n):(o=[],r=function(){return n}.apply(t,o),!(void 0!==r&&(e.exports=r)))}()},function(e,t,n){e.exports=n(285)()},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e){return function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];var r=n[n.length-1];return"function"==typeof r?e.apply(void 0,n):function(t){return e.apply(void 0,n.concat([t]))}}}function a(e,t){return null==e.bsClass?(0,y["default"])(!1):void 0,e.bsClass+(t?"-"+t:"")}function i(e){var t,n=(t={},t[a(e)]=!0,t);if(e.bsSize){var o=_.SIZE_MAP[e.bsSize]||e.bsSize;n[a(e,o)]=!0}return e.bsStyle&&(n[a(e,e.bsStyle)]=!0),n}function l(e){return{bsClass:e.bsClass,bsSize:e.bsSize,bsStyle:e.bsStyle,bsRole:e.bsRole}}function u(e){return"bsClass"===e||"bsSize"===e||"bsStyle"===e||"bsRole"===e}function s(e){var t={};return(0,p["default"])(e).forEach(function(e){var n=e[0],o=e[1];u(n)||(t[n]=o)}),[l(e),t]}function c(e,t){var n={};t.forEach(function(e){n[e]=!0});var o={};return(0,p["default"])(e).forEach(function(e){var t=e[0],r=e[1];u(t)||n[t]||(o[t]=r)}),[l(e),o]}function d(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];C(n,e)}t.__esModule=!0,t._curry=t.bsSizes=t.bsStyles=t.bsClass=void 0;var f=n(127),p=o(f),h=n(5),m=o(h);t.prefix=a,t.getClassSet=i,t.splitBsProps=s,t.splitBsPropsAndOmit=c,t.addStyle=d;var v=n(68),y=o(v),g=n(8),b=o(g),_=n(18),C=(t.bsClass=r(function(e,t){var n=t.propTypes||(t.propTypes={}),o=t.defaultProps||(t.defaultProps={});return n.bsClass=b["default"].string,o.bsClass=e,t}),t.bsStyles=r(function(e,t,n){"string"!=typeof t&&(n=t,t=void 0);var o=n.STYLES||[],r=n.propTypes||{};e.forEach(function(e){o.indexOf(e)===-1&&o.push(e)});var a=b["default"].oneOf(o);if(n.STYLES=o,a._values=o,n.propTypes=(0,m["default"])({},r,{bsStyle:a}),void 0!==t){var i=n.defaultProps||(n.defaultProps={});i.bsStyle=t}return n}));t.bsSizes=r(function(e,t,n){"string"!=typeof t&&(n=t,t=void 0);var o=n.SIZES||[],r=n.propTypes||{};e.forEach(function(e){o.indexOf(e)===-1&&o.push(e)});var a=[];o.forEach(function(e){var t=_.SIZE_MAP[e];t&&t!==e&&a.push(t),a.push(e)});var i=b["default"].oneOf(a);return i._values=a,n.SIZES=o,n.propTypes=(0,m["default"])({},r,{bsSize:i}),void 0!==t&&(n.defaultProps||(n.defaultProps={}),n.defaultProps.bsSize=t),n}),t._curry=r},function(e,t,n){"use strict";function o(e,t,n,o,a,i,l,u){if(r(t),!e){var s;if(void 0===t)s=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,o,a,i,l,u],d=0;s=new Error(t.replace(/%s/g,function(){return c[d++]})),s.name="Invariant Violation"}throw s.framesToPop=1,s}}var r=function(e){};e.exports=o},function(e,t){"use strict";function n(e){for(var t=arguments.length-1,n="Minified React error #"+e+"; visit http://facebook.github.io/react/docs/error-decoder.html?invariant="+e,o=0;o<t;o++)n+="&args[]="+encodeURIComponent(arguments[o+1]);n+=" for the full message or use the non-minified dev environment for full errors and additional helpful warnings.";var r=new Error(n);throw r.name="Invariant Violation",r.framesToPop=1,r}e.exports=n},function(e,t,n){"use strict";var o=n(26),r=o;e.exports=r},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,n,o,r){var a=e[t];return i["default"].isValidElement(a)?new Error("Invalid "+o+" `"+r+"` of type ReactElement "+("supplied to `"+n+"`,expected an element type (a string ")+", component class, or function component)."):(0,l.isValidElementType)(a)?null:new Error("Invalid "+o+" `"+r+"` of value `"+a+"` "+("supplied to `"+n+"`, expected an element type (a string ")+", component class, or function component).")}Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),i=o(a),l=n(415),u=n(72),s=o(u);t["default"]=(0,s["default"])(r),e.exports=t["default"]},function(e,t){"use strict";function n(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function o(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;var o=Object.getOwnPropertyNames(t).map(function(e){return t[e]});if("0123456789"!==o.join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}var r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;e.exports=o()?Object.assign:function(e,t){for(var o,l,u=n(e),s=1;s<arguments.length;s++){o=Object(arguments[s]);for(var c in o)a.call(o,c)&&(u[c]=o[c]);if(r){l=r(o);for(var d=0;d<l.length;d++)i.call(o,l[d])&&(u[l[d]]=o[l[d]])}}return u}},function(e,t,n){"use strict";function o(e,t){return 1===e.nodeType&&e.getAttribute(h)===String(t)||8===e.nodeType&&e.nodeValue===" react-text: "+t+" "||8===e.nodeType&&e.nodeValue===" react-empty: "+t+" "}function r(e){for(var t;t=e._renderedComponent;)e=t;return e}function a(e,t){var n=r(e);n._hostNode=t,t[v]=n}function i(e){var t=e._hostNode;t&&(delete t[v],e._hostNode=null)}function l(e,t){if(!(e._flags&m.hasCachedChildNodes)){var n=e._renderedChildren,i=t.firstChild;e:for(var l in n)if(n.hasOwnProperty(l)){var u=n[l],s=r(u)._domID;if(0!==s){for(;null!==i;i=i.nextSibling)if(o(i,s)){a(u,i);continue e}d("32",s)}}e._flags|=m.hasCachedChildNodes}}function u(e){if(e[v])return e[v];for(var t=[];!e[v];){if(t.push(e),!e.parentNode)return null;e=e.parentNode}for(var n,o;e&&(o=e[v]);e=t.pop())n=o,t.length&&l(o,e);return n}function s(e){var t=u(e);return null!=t&&t._hostNode===e?t:null}function c(e){if(void 0===e._hostNode?d("33"):void 0,e._hostNode)return e._hostNode;for(var t=[];!e._hostNode;)t.push(e),e._hostParent?void 0:d("34"),e=e._hostParent;for(;t.length;e=t.pop())l(e,e._hostNode);return e._hostNode}var d=n(11),f=n(45),p=n(174),h=(n(10),f.ID_ATTRIBUTE_NAME),m=p,v="__reactInternalInstance$"+Math.random().toString(36).slice(2),y={getClosestInstanceFromNode:u,getInstanceFromNode:s,getNodeFromInstance:c,precacheChildNodes:l,precacheNode:a,uncacheNode:i};e.exports=y},function(e,t){function n(e){return e&&e.__esModule?e:{"default":e}}e.exports=n},function(e,t){"use strict";function n(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(function(e){return null!=e}).reduce(function(e,t){if("function"!=typeof t)throw new Error("Invalid Argument Type, must only provide functions, undefined, or null.");return null===e?t:function(){for(var n=arguments.length,o=Array(n),r=0;r<n;r++)o[r]=arguments[r];e.apply(this,o),t.apply(this,o)}},null)}t.__esModule=!0,t["default"]=n,e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0,t.Size={LARGE:"large",SMALL:"small",XSMALL:"xsmall"},t.SIZE_MAP={large:"lg",medium:"md",small:"sm",xsmall:"xs",lg:"lg",md:"md",sm:"sm",xs:"xs"},t.DEVICE_SIZES=["lg","md","sm","xs"],t.State={SUCCESS:"success",WARNING:"warning",DANGER:"danger",INFO:"info"},t.Style={DEFAULT:"default",PRIMARY:"primary",LINK:"link",INVERSE:"inverse"}},function(e,t,n){"use strict";e.exports=n(364)},function(e,t){"use strict";var n=!("undefined"==typeof window||!window.document||!window.document.createElement),o={canUseDOM:n,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:n&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:n&&!!window.screen,isInWorker:!n};e.exports=o},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,n){var o=0;return p["default"].Children.map(e,function(e){return p["default"].isValidElement(e)?t.call(n,e,o++):e})}function a(e,t,n){var o=0;p["default"].Children.forEach(e,function(e){p["default"].isValidElement(e)&&t.call(n,e,o++)})}function i(e){var t=0;return p["default"].Children.forEach(e,function(e){p["default"].isValidElement(e)&&++t}),t}function l(e,t,n){var o=0,r=[];return p["default"].Children.forEach(e,function(e){p["default"].isValidElement(e)&&t.call(n,e,o++)&&r.push(e)}),r}function u(e,t,n){var o=0,r=void 0;return p["default"].Children.forEach(e,function(e){r||p["default"].isValidElement(e)&&t.call(n,e,o++)&&(r=e)}),r}function s(e,t,n){var o=0,r=!0;return p["default"].Children.forEach(e,function(e){r&&p["default"].isValidElement(e)&&(t.call(n,e,o++)||(r=!1))}),r}function c(e,t,n){var o=0,r=!1;return p["default"].Children.forEach(e,function(e){r||p["default"].isValidElement(e)&&t.call(n,e,o++)&&(r=!0)}),r}function d(e){var t=[];return p["default"].Children.forEach(e,function(e){p["default"].isValidElement(e)&&t.push(e)}),t}t.__esModule=!0;var f=n(1),p=o(f);t["default"]={map:r,forEach:a,count:i,find:u,filter:l,every:s,some:c,toArray:d},e.exports=t["default"]},function(e,t,n){"use strict";var o=function(){};e.exports=o},function(e,t,n){"use strict";var o=null;e.exports={debugTool:o}},function(e,t){var n=e.exports={version:"2.5.1"};"number"==typeof __e&&(__e=n)},function(e,t,n){var o=n(93)("wks"),r=n(63),a=n(32).Symbol,i="function"==typeof a,l=e.exports=function(e){return o[e]||(o[e]=i&&a[e]||(i?a:r)("Symbol."+e))};l.store=o},function(e,t){"use strict";function n(e){return function(){return e}}var o=function(){};o.thatReturns=n,o.thatReturnsFalse=n(!1),o.thatReturnsTrue=n(!0),o.thatReturnsNull=n(null),o.thatReturnsThis=function(){return this},o.thatReturnsArgument=function(e){return e},e.exports=o},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e){return!e||"#"===e.trim()}t.__esModule=!0;var a=n(5),i=o(a),l=n(6),u=o(l),s=n(2),c=o(s),d=n(4),f=o(d),p=n(3),h=o(p),m=n(1),v=o(m),y=n(8),g=o(y),b=n(13),_=o(b),C=n(17),E=o(C),x={href:g["default"].string,onClick:g["default"].func,onKeyDown:g["default"].func,disabled:g["default"].bool,role:g["default"].string,tabIndex:g["default"].oneOfType([g["default"].number,g["default"].string]),componentClass:_["default"]},N={componentClass:"a"},k=function(e){function t(n,o){(0,c["default"])(this,t);var r=(0,f["default"])(this,e.call(this,n,o));return r.handleClick=r.handleClick.bind(r),r.handleKeyDown=r.handleKeyDown.bind(r),r}return(0,h["default"])(t,e),t.prototype.handleClick=function(e){var t=this.props,n=t.disabled,o=t.href,a=t.onClick;return(n||r(o))&&e.preventDefault(),n?void e.stopPropagation():void(a&&a(e))},t.prototype.handleKeyDown=function(e){" "===e.key&&(e.preventDefault(),this.handleClick(e))},t.prototype.render=function(){var e=this.props,t=e.componentClass,n=e.disabled,o=e.onKeyDown,a=(0,u["default"])(e,["componentClass","disabled","onKeyDown"]);return r(a.href)&&(a.role=a.role||"button",a.href=a.href||"#"),n&&(a.tabIndex=-1,a.style=(0,i["default"])({pointerEvents:"none"},a.style)),v["default"].createElement(t,(0,i["default"])({},a,{onClick:this.handleClick,onKeyDown:(0,E["default"])(this.handleKeyDown,o)}))},t}(v["default"].Component);k.propTypes=x,k.defaultProps=N,t["default"]=k,e.exports=t["default"]},function(e,t,n){"use strict";function o(){T.ReactReconcileTransaction&&E?void 0:c("123")}function r(){this.reinitializeTransaction(),this.dirtyComponentsLength=null,this.callbackQueue=f.getPooled(),this.reconcileTransaction=T.ReactReconcileTransaction.getPooled(!0)}function a(e,t,n,r,a,i){return o(),E.batchedUpdates(e,t,n,r,a,i)}function i(e,t){return e._mountOrder-t._mountOrder}function l(e){var t=e.dirtyComponentsLength;t!==g.length?c("124",t,g.length):void 0,g.sort(i),b++;for(var n=0;n<t;n++){var o=g[n],r=o._pendingCallbacks;o._pendingCallbacks=null;var a;if(h.logTopLevelRenders){var l=o;o._currentElement.type.isReactTopLevelWrapper&&(l=o._renderedComponent),a="React update: "+l.getName(),console.time(a)}if(m.performUpdateIfNecessary(o,e.reconcileTransaction,b),a&&console.timeEnd(a),r)for(var u=0;u<r.length;u++)e.callbackQueue.enqueue(r[u],o.getPublicInstance())}}function u(e){return o(),E.isBatchingUpdates?(g.push(e),void(null==e._updateBatchNumber&&(e._updateBatchNumber=b+1))):void E.batchedUpdates(u,e)}function s(e,t){y(E.isBatchingUpdates,"ReactUpdates.asap: Can't enqueue an asap callback in a context whereupdates are not being batched."),_.enqueue(e,t),C=!0}var c=n(11),d=n(14),f=n(172),p=n(37),h=n(177),m=n(46),v=n(79),y=n(10),g=[],b=0,_=f.getPooled(),C=!1,E=null,x={initialize:function(){this.dirtyComponentsLength=g.length},close:function(){this.dirtyComponentsLength!==g.length?(g.splice(0,this.dirtyComponentsLength),w()):g.length=0}},N={initialize:function(){this.callbackQueue.reset()},close:function(){this.callbackQueue.notifyAll()}},k=[x,N];d(r.prototype,v,{getTransactionWrappers:function(){return k},destructor:function(){this.dirtyComponentsLength=null,f.release(this.callbackQueue),this.callbackQueue=null,T.ReactReconcileTransaction.release(this.reconcileTransaction),this.reconcileTransaction=null},perform:function(e,t,n){return v.perform.call(this,this.reconcileTransaction.perform,this.reconcileTransaction,e,t,n)}}),p.addPoolingTo(r);var w=function(){for(;g.length||C;){if(g.length){var e=r.getPooled();e.perform(l,null,e),r.release(e)}if(C){C=!1;var t=_;_=f.getPooled(),t.notifyAll(),f.release(t)}}},S={injectReconcileTransaction:function(e){e?void 0:c("126"),T.ReactReconcileTransaction=e},injectBatchingStrategy:function(e){e?void 0:c("127"),"function"!=typeof e.batchedUpdates?c("128"):void 0,"boolean"!=typeof e.isBatchingUpdates?c("129"):void 0,E=e}},T={ReactReconcileTransaction:null,batchedUpdates:a,enqueueUpdate:u,flushBatchedUpdates:w,injection:S,asap:s};e.exports=T},function(e,t,n){"use strict";function o(e,t,n,o){this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n;var r=this.constructor.Interface;for(var a in r)if(r.hasOwnProperty(a)){var l=r[a];l?this[a]=l(n):"target"===a?this.target=o:this[a]=n[a]}var u=null!=n.defaultPrevented?n.defaultPrevented:n.returnValue===!1;return u?this.isDefaultPrevented=i.thatReturnsTrue:this.isDefaultPrevented=i.thatReturnsFalse,this.isPropagationStopped=i.thatReturnsFalse,this}var r=n(14),a=n(37),i=n(26),l=(n(12),"function"==typeof Proxy,["dispatchConfig","_targetInst","nativeEvent","isDefaultPrevented","isPropagationStopped","_dispatchListeners","_dispatchInstances"]),u={type:null,target:null,currentTarget:i.thatReturnsNull,eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null};r(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=i.thatReturnsTrue)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=i.thatReturnsTrue)},persist:function(){this.isPersistent=i.thatReturnsTrue},isPersistent:i.thatReturnsFalse,destructor:function(){var e=this.constructor.Interface;for(var t in e)this[t]=null;for(var n=0;n<l.length;n++)this[l[n]]=null}}),o.Interface=u,o.augmentClass=function(e,t){var n=this,o=function(){};o.prototype=n.prototype;var i=new o;r(i,e.prototype),e.prototype=i,e.prototype.constructor=e,e.Interface=r({},n.Interface,t),e.augmentClass=n.augmentClass,a.addPoolingTo(e,a.fourArgumentPooler)},a.addPoolingTo(o,a.fourArgumentPooler),e.exports=o},function(e,t){"use strict";var n={current:null};e.exports=n},function(e,t,n){var o=n(32),r=n(24),a=n(85),i=n(41),l="prototype",u=function(e,t,n){var s,c,d,f=e&u.F,p=e&u.G,h=e&u.S,m=e&u.P,v=e&u.B,y=e&u.W,g=p?r:r[t]||(r[t]={}),b=g[l],_=p?o:h?o[t]:(o[t]||{})[l];p&&(n=t);for(s in n)c=!f&&_&&void 0!==_[s],c&&s in g||(d=c?_[s]:n[s],g[s]=p&&"function"!=typeof _[s]?n[s]:v&&c?a(d,o):y&&_[s]==d?function(e){var t=function(t,n,o){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,o)}return e.apply(this,arguments)};return t[l]=e[l],t}(d):m&&"function"==typeof d?a(Function.call,d):d,m&&((g.virtual||(g.virtual={}))[s]=d,e&u.R&&b&&!b[s]&&i(b,s,d)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){"use strict";t.__esModule=!0,t["default"]=void 0;var n=!("undefined"==typeof window||!window.document||!window.document.createElement);t["default"]=n,e.exports=t["default"]},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var o=n(39),r=n(129),a=n(96),i=Object.defineProperty;t.f=n(40)?Object.defineProperty:function(e,t,n){if(o(e),t=a(t,!0),o(n),r)try{return i(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var o=n(130),r=n(86);e.exports=function(e){return o(r(e))}},[439,11],function(e,t,n){e.exports={"default":n(217),__esModule:!0}},function(e,t,n){var o=n(51);e.exports=function(e){if(!o(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){e.exports=!n(50)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){var o=n(35),r=n(55);e.exports=n(40)?function(e,t,n){return o.f(e,t,r(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t){"use strict";function n(e){return e&&e.ownerDocument||document}t.__esModule=!0,t["default"]=n,e.exports=t["default"]},function(e,t,n){"use strict";function o(e,t){if(t)do if(t===e)return!0;while(t=t.parentNode);return!1}var r=n(16);t.__esModule=!0,t["default"]=void 0;var a=r(n(33)),i=function(){return a["default"]?function(e,t){return e.contains?e.contains(t):e.compareDocumentPosition?e===t||!!(16&e.compareDocumentPosition(t)):o(e,t)}:o}();t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){if(v){var t=e.node,n=e.children;if(n.length)for(var o=0;o<n.length;o++)y(t,n[o],null);else null!=e.html?d(t,e.html):null!=e.text&&p(t,e.text)}}function r(e,t){e.parentNode.replaceChild(t.node,e),o(t)}function a(e,t){v?e.children.push(t):e.node.appendChild(t.node)}function i(e,t){v?e.html=t:d(e.node,t)}function l(e,t){v?e.text=t:p(e.node,t)}function u(){return this.node.nodeName}function s(e){return{node:e,children:[],html:null,text:null,toString:u}}var c=n(110),d=n(81),f=n(118),p=n(190),h=1,m=11,v="undefined"!=typeof document&&"number"==typeof document.documentMode||"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent&&/\bEdge\/\d/.test(navigator.userAgent),y=f(function(e,t,n){t.node.nodeType===m||t.node.nodeType===h&&"object"===t.node.nodeName.toLowerCase()&&(null==t.node.namespaceURI||t.node.namespaceURI===c.html)?(o(t),e.insertBefore(t.node,n)):(e.insertBefore(t.node,n),o(t))});s.insertTreeBefore=y,s.replaceChildWithTree=r,s.queueChild=a,s.queueHTML=i,s.queueText=l,e.exports=s},function(e,t,n){"use strict";function o(e,t){return(e&t)===t}var r=n(11),a=(n(10),{MUST_USE_PROPERTY:1,HAS_BOOLEAN_VALUE:4,HAS_NUMERIC_VALUE:8,HAS_POSITIVE_NUMERIC_VALUE:24,HAS_OVERLOADED_BOOLEAN_VALUE:32,injectDOMPropertyConfig:function(e){var t=a,n=e.Properties||{},i=e.DOMAttributeNamespaces||{},u=e.DOMAttributeNames||{},s=e.DOMPropertyNames||{},c=e.DOMMutationMethods||{};e.isCustomAttribute&&l._isCustomAttributeFunctions.push(e.isCustomAttribute);for(var d in n){l.properties.hasOwnProperty(d)?r("48",d):void 0;var f=d.toLowerCase(),p=n[d],h={attributeName:f,attributeNamespace:null,propertyName:d,mutationMethod:null,mustUseProperty:o(p,t.MUST_USE_PROPERTY),hasBooleanValue:o(p,t.HAS_BOOLEAN_VALUE),hasNumericValue:o(p,t.HAS_NUMERIC_VALUE),hasPositiveNumericValue:o(p,t.HAS_POSITIVE_NUMERIC_VALUE),hasOverloadedBooleanValue:o(p,t.HAS_OVERLOADED_BOOLEAN_VALUE)};if(h.hasBooleanValue+h.hasNumericValue+h.hasOverloadedBooleanValue<=1?void 0:r("50",d),u.hasOwnProperty(d)){var m=u[d];h.attributeName=m}i.hasOwnProperty(d)&&(h.attributeNamespace=i[d]),s.hasOwnProperty(d)&&(h.propertyName=s[d]),c.hasOwnProperty(d)&&(h.mutationMethod=c[d]),l.properties[d]=h}}}),i=":A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",l={ID_ATTRIBUTE_NAME:"data-reactid",ROOT_ATTRIBUTE_NAME:"data-reactroot",ATTRIBUTE_NAME_START_CHAR:i,ATTRIBUTE_NAME_CHAR:i+"\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",properties:{},getPossibleStandardName:null,_isCustomAttributeFunctions:[],isCustomAttribute:function(e){for(var t=0;t<l._isCustomAttributeFunctions.length;t++){var n=l._isCustomAttributeFunctions[t];if(n(e))return!0}return!1},injection:a};e.exports=l},function(e,t,n){"use strict";function o(){r.attachRefs(this,this._currentElement)}var r=n(387),a=(n(23),n(12),{mountComponent:function(e,t,n,r,a,i){var l=e.mountComponent(t,n,r,a,i);return e._currentElement&&null!=e._currentElement.ref&&t.getReactMountReady().enqueue(o,e),l},getHostNode:function(e){return e.getHostNode()},unmountComponent:function(e,t){r.detachRefs(e,e._currentElement),e.unmountComponent(t)},receiveComponent:function(e,t,n,a){var i=e._currentElement;if(t!==i||a!==e._context){var l=r.shouldUpdateRefs(i,t);l&&r.detachRefs(e,i),e.receiveComponent(t,n,a),l&&e._currentElement&&null!=e._currentElement.ref&&n.getReactMountReady().enqueue(o,e)}},performUpdateIfNecessary:function(e,t,n){e._updateBatchNumber===n&&e.performUpdateIfNecessary(t)}});e.exports=a},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0,t["default"]=function(e){return(0,l["default"])(a["default"].findDOMNode(e))};var r=n(19),a=o(r),i=n(42),l=o(i);e.exports=t["default"]},function(e,t,n){"use strict";var o=n(14),r=n(197),a=n(427),i=n(428),l=n(49),u=n(429),s=n(430),c=n(431),d=n(435),f=l.createElement,p=l.createFactory,h=l.cloneElement,m=o,v=function(e){return e},y={Children:{map:a.map,forEach:a.forEach,count:a.count,toArray:a.toArray,only:d},Component:r.Component,PureComponent:r.PureComponent,createElement:f,cloneElement:h,isValidElement:l.isValidElement,PropTypes:u,createClass:c,createFactory:p,createMixin:v,DOM:i,version:s,__spread:m};e.exports=y},function(e,t,n){"use strict";function o(e){return void 0!==e.ref}function r(e){return void 0!==e.key}var a=n(14),i=n(30),l=(n(12),n(201),Object.prototype.hasOwnProperty),u=n(199),s={key:!0,ref:!0,__self:!0,__source:!0},c=function(e,t,n,o,r,a,i){var l={$$typeof:u,type:e,key:t,ref:n,props:i,_owner:a};return l};c.createElement=function(e,t,n){var a,u={},d=null,f=null,p=null,h=null;if(null!=t){o(t)&&(f=t.ref),r(t)&&(d=""+t.key),p=void 0===t.__self?null:t.__self,h=void 0===t.__source?null:t.__source;for(a in t)l.call(t,a)&&!s.hasOwnProperty(a)&&(u[a]=t[a])}var m=arguments.length-2;if(1===m)u.children=n;else if(m>1){for(var v=Array(m),y=0;y<m;y++)v[y]=arguments[y+2];u.children=v}if(e&&e.defaultProps){var g=e.defaultProps;for(a in g)void 0===u[a]&&(u[a]=g[a])}return c(e,d,f,p,h,i.current,u)},c.createFactory=function(e){var t=c.createElement.bind(null,e);return t.type=e,t},c.cloneAndReplaceKey=function(e,t){var n=c(e.type,t,e.ref,e._self,e._source,e._owner,e.props);return n},c.cloneElement=function(e,t,n){var u,d=a({},e.props),f=e.key,p=e.ref,h=e._self,m=e._source,v=e._owner;if(null!=t){o(t)&&(p=t.ref,v=i.current),r(t)&&(f=""+t.key);var y;e.type&&e.type.defaultProps&&(y=e.type.defaultProps);for(u in t)l.call(t,u)&&!s.hasOwnProperty(u)&&(void 0===t[u]&&void 0!==y?d[u]=y[u]:d[u]=t[u])}var g=arguments.length-2;if(1===g)d.children=n;else if(g>1){for(var b=Array(g),_=0;_<g;_++)b[_]=arguments[_+2];d.children=b}return c(e.type,f,p,h,m,v,d)},c.isValidElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===u},e.exports=c},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){e.exports={}},function(e,t,n){var o=n(134),r=n(87);e.exports=Object.keys||function(e){return o(e,r)}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(38),a=o(r),i=n(6),l=o(i),u=n(5),s=o(u),c=n(2),d=o(c),f=n(4),p=o(f),h=n(3),m=o(h),v=n(7),y=o(v),g=n(1),b=o(g),_=n(8),C=o(_),E=n(13),x=o(E),N=n(9),k=n(18),w=n(27),S=o(w),T={active:C["default"].bool,disabled:C["default"].bool,block:C["default"].bool,onClick:C["default"].func,componentClass:x["default"],href:C["default"].string,type:C["default"].oneOf(["button","reset","submit"])},O={active:!1,block:!1,disabled:!1},M=function(e){function t(){return(0,d["default"])(this,t),(0,p["default"])(this,e.apply(this,arguments))}return(0,m["default"])(t,e),t.prototype.renderAnchor=function(e,t){return b["default"].createElement(S["default"],(0,s["default"])({},e,{className:(0,y["default"])(t,e.disabled&&"disabled")}))},t.prototype.renderButton=function(e,t){var n=e.componentClass,o=(0,l["default"])(e,["componentClass"]),r=n||"button";return b["default"].createElement(r,(0,s["default"])({},o,{type:o.type||"button",className:t}))},t.prototype.render=function(){var e,t=this.props,n=t.active,o=t.block,r=t.className,a=(0,l["default"])(t,["active","block","className"]),i=(0,N.splitBsProps)(a),u=i[0],c=i[1],d=(0,s["default"])({},(0,N.getClassSet)(u),(e={active:n},e[(0,N.prefix)(u,"block")]=o,e)),f=(0,y["default"])(r,d);return c.href?this.renderAnchor(c,f):this.renderButton(c,f)},t}(b["default"].Component);M.propTypes=T,M.defaultProps=O,t["default"]=(0,N.bsClass)("btn",(0,N.bsSizes)([k.Size.LARGE,k.Size.SMALL,k.Size.XSMALL],(0,N.bsStyles)([].concat((0,a["default"])(k.State),[k.Style.DEFAULT,k.Style.PRIMARY,k.Style.LINK]),k.Style.DEFAULT,M))),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return"button"===e||"input"===e||"select"===e||"textarea"===e}function r(e,t,n){switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":return!(!n.disabled||!o(t));default:return!1}}var a=n(11),i=n(111),l=n(112),u=n(116),s=n(183),c=n(184),d=(n(10),{}),f=null,p=function(e,t){e&&(l.executeDispatchesInOrder(e,t),e.isPersistent()||e.constructor.release(e))},h=function(e){return p(e,!0)},m=function(e){return p(e,!1)},v=function(e){return"."+e._rootNodeID},y={injection:{injectEventPluginOrder:i.injectEventPluginOrder,injectEventPluginsByName:i.injectEventPluginsByName},putListener:function(e,t,n){"function"!=typeof n?a("94",t,typeof n):void 0;var o=v(e),r=d[t]||(d[t]={});r[o]=n;var l=i.registrationNameModules[t];l&&l.didPutListener&&l.didPutListener(e,t,n)},getListener:function(e,t){var n=d[t];if(r(t,e._currentElement.type,e._currentElement.props))return null;var o=v(e);return n&&n[o]},deleteListener:function(e,t){var n=i.registrationNameModules[t];n&&n.willDeleteListener&&n.willDeleteListener(e,t);var o=d[t];if(o){var r=v(e);delete o[r]}},deleteAllListeners:function(e){var t=v(e);for(var n in d)if(d.hasOwnProperty(n)&&d[n][t]){var o=i.registrationNameModules[n];o&&o.willDeleteListener&&o.willDeleteListener(e,n),delete d[n][t]}},extractEvents:function(e,t,n,o){for(var r,a=i.plugins,l=0;l<a.length;l++){var u=a[l];if(u){var c=u.extractEvents(e,t,n,o);c&&(r=s(r,c))}}return r},enqueueEvents:function(e){e&&(f=s(f,e))},processEventQueue:function(e){var t=f;f=null,e?c(t,h):c(t,m),f?a("95"):void 0,u.rethrowCaughtError()},__purge:function(){d={}},__getListenerBank:function(){return d}};e.exports=y},function(e,t,n){"use strict";function o(e,t,n){var o=t.dispatchConfig.phasedRegistrationNames[n];return y(e,o)}function r(e,t,n){var r=o(e,n,t);r&&(n._dispatchListeners=m(n._dispatchListeners,r),n._dispatchInstances=m(n._dispatchInstances,e))}function a(e){e&&e.dispatchConfig.phasedRegistrationNames&&h.traverseTwoPhase(e._targetInst,r,e)}function i(e){if(e&&e.dispatchConfig.phasedRegistrationNames){var t=e._targetInst,n=t?h.getParentInstance(t):null;h.traverseTwoPhase(n,r,e)}}function l(e,t,n){if(n&&n.dispatchConfig.registrationName){var o=n.dispatchConfig.registrationName,r=y(e,o);r&&(n._dispatchListeners=m(n._dispatchListeners,r),n._dispatchInstances=m(n._dispatchInstances,e))}}function u(e){e&&e.dispatchConfig.registrationName&&l(e._targetInst,null,e)}function s(e){v(e,a)}function c(e){v(e,i)}function d(e,t,n,o){h.traverseEnterLeave(n,o,l,e,t)}function f(e){v(e,u)}var p=n(57),h=n(112),m=n(183),v=n(184),y=(n(12),p.getListener),g={accumulateTwoPhaseDispatches:s,accumulateTwoPhaseDispatchesSkipTarget:c,accumulateDirectDispatches:f,accumulateEnterLeaveDispatches:d};e.exports=g},function(e,t){"use strict";var n={remove:function(e){e._reactInternalInstance=void 0},get:function(e){return e._reactInternalInstance},has:function(e){return void 0!==e._reactInternalInstance},set:function(e,t){e._reactInternalInstance=t}};e.exports=n},function(e,t,n){"use strict";function o(e,t,n,o){return r.call(this,e,t,n,o)}var r=n(29),a=n(121),i={view:function(e){if(e.view)return e.view;var t=a(e);if(t.window===t)return t;var n=t.ownerDocument;return n?n.defaultView||n.parentWindow:window},detail:function(e){return e.detail||0}};r.augmentClass(o,i),e.exports=o},11,function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,n,o,r){n&&(e._notifying=!0,n.call.apply(n,[e,o].concat(r)),e._notifying=!1),e._values[t]=o,e.unmounted||e.forceUpdate()}t.__esModule=!0;
var a=n(437),i=o(a),l={shouldComponentUpdate:function(){return!this._notifying}};t["default"]=(0,i["default"])(l,r),e.exports=t["default"]},function(e,t){var n=0,o=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+o).toString(36))}},function(e,t,n){"use strict";var o=n(16);t.__esModule=!0,t["default"]=void 0;var r=o(n(33)),a=function(){};r["default"]&&(a=function(){return document.addEventListener?function(e,t,n,o){return e.addEventListener(t,n,o||!1)}:document.attachEvent?function(e,t,n){return e.attachEvent("on"+t,function(t){t=t||window.event,t.target=t.target||t.srcElement,t.currentTarget=e,n.call(e,t)})}:void 0}());var i=a;t["default"]=i,e.exports=t["default"]},function(e,t){"use strict";function n(e){return e===e.window?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}t.__esModule=!0,t["default"]=n,e.exports=t["default"]},function(e,t,n){"use strict";function o(e,t,n){var o="",r="",d=t;if("string"==typeof t){if(void 0===n)return e.style[(0,a["default"])(t)]||(0,l["default"])(e).getPropertyValue((0,i["default"])(t));(d={})[t]=n}Object.keys(d).forEach(function(t){var n=d[t];n||0===n?(0,c["default"])(t)?r+=t+"("+n+") ":o+=(0,i["default"])(t)+": "+n+";":(0,u["default"])(e,(0,i["default"])(t))}),r&&(o+=s.transform+": "+r+";"),e.style.cssText+=";"+o}var r=n(16);t.__esModule=!0,t["default"]=o;var a=r(n(144)),i=r(n(270)),l=r(n(265)),u=r(n(266)),s=n(143),c=r(n(267));e.exports=t["default"]},function(e,t,n){"use strict";var o={};e.exports=o},function(e,t,n){"use strict";var o=function(e,t,n,o,r,a,i,l){if(!e){var u;if(void 0===t)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var s=[n,o,r,a,i,l],c=0;u=new Error(t.replace(/%s/g,function(){return s[c++]})),u.name="Invariant Violation"}throw u.framesToPop=1,u}};e.exports=o},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(){function e(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];var r=null;return n.forEach(function(e){if(null==r){var n=e.apply(void 0,t);null!=n&&(r=n)}}),r}for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];return(0,i["default"])(e)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=r;var a=n(72),i=o(a);e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,n,o,r){var i=e[t],u="undefined"==typeof i?"undefined":a(i);return l["default"].isValidElement(i)?new Error("Invalid "+o+" `"+r+"` of type ReactElement "+("supplied to `"+n+"`, expected a ReactComponent or a ")+"DOMElement. You can usually obtain a ReactComponent or DOMElement from a ReactElement by attaching a ref to it."):"object"===u&&"function"==typeof i.render||1===i.nodeType?null:new Error("Invalid "+o+" `"+r+"` of value `"+i+"` "+("supplied to `"+n+"`, expected a ReactComponent or a ")+"DOMElement.")}Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(1),l=o(i),u=n(72),s=o(u);t["default"]=(0,s["default"])(r),e.exports=t["default"]},function(e,t){"use strict";function n(e){return function(t,n,o,r,a){var i=o||"<<anonymous>>",l=a||n;if(null==t[n])return new Error("The "+r+" `"+l+"` is required to make "+("`"+i+"` accessible for users of assistive ")+"technologies such as screen readers.");for(var u=arguments.length,s=Array(u>5?u-5:0),c=5;c<u;c++)s[c-5]=arguments[c];return e.apply(void 0,[t,n,o,r,a].concat(s))}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=n,e.exports=t["default"]},function(e,t){"use strict";function n(e){function t(t,n,o,r,a,i){var l=r||"<<anonymous>>",u=i||o;if(null==n[o])return t?new Error("Required "+a+" `"+u+"` was not specified "+("in `"+l+"`.")):null;for(var s=arguments.length,c=Array(s>6?s-6:0),d=6;d<s;d++)c[d-6]=arguments[d];return e.apply(void 0,[n,o,l,a,u].concat(c))}var n=t.bind(null,!1);return n.isRequired=t.bind(null,!0),n}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=n,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(139),y=o(v),g=n(43),b=o(g),_=n(101),C=o(_),E=n(1),x=o(E),N=n(8),k=o(N),w=n(19),S=o(w),T=n(69),O=o(T),M=n(13),P=o(M),D=n(71),I=o(D),A=n(62),R=o(A),L=n(22),j=(o(L),n(102)),B=o(j),U=n(299),F=o(U),H=n(154),V=o(H),K=n(9),W=n(17),$=o(W),q=n(347),z=n(21),G=o(z),Y=V["default"].defaultProps.bsRole,X=F["default"].defaultProps.bsRole,Q={dropup:k["default"].bool,id:(0,I["default"])(k["default"].oneOfType([k["default"].string,k["default"].number])),componentClass:P["default"],children:(0,O["default"])((0,q.requiredRoles)(Y,X),(0,q.exclusiveRoles)(X)),disabled:k["default"].bool,pullRight:k["default"].bool,open:k["default"].bool,defaultOpen:k["default"].bool,onToggle:k["default"].func,onSelect:k["default"].func,role:k["default"].string,rootCloseEvent:k["default"].oneOf(["click","mousedown"]),onMouseEnter:k["default"].func,onMouseLeave:k["default"].func},Z={componentClass:B["default"]},J=function(e){function t(n,o){(0,s["default"])(this,t);var r=(0,d["default"])(this,e.call(this,n,o));return r.handleClick=r.handleClick.bind(r),r.handleKeyDown=r.handleKeyDown.bind(r),r.handleClose=r.handleClose.bind(r),r._focusInDropdown=!1,r.lastOpenEventType=null,r}return(0,p["default"])(t,e),t.prototype.componentDidMount=function(){this.focusNextOnOpen()},t.prototype.componentWillUpdate=function(e){!e.open&&this.props.open&&(this._focusInDropdown=(0,b["default"])(S["default"].findDOMNode(this.menu),(0,y["default"])(document)))},t.prototype.componentDidUpdate=function(e){var t=this.props.open,n=e.open;t&&!n&&this.focusNextOnOpen(),!t&&n&&this._focusInDropdown&&(this._focusInDropdown=!1,this.focus())},t.prototype.focus=function(){var e=S["default"].findDOMNode(this.toggle);e&&e.focus&&e.focus()},t.prototype.focusNextOnOpen=function(){var e=this.menu;e.focusNext&&("keydown"!==this.lastOpenEventType&&"menuitem"!==this.props.role||e.focusNext())},t.prototype.handleClick=function(e){this.props.disabled||this.toggleOpen(e,{source:"click"})},t.prototype.handleClose=function(e,t){this.props.open&&this.toggleOpen(e,t)},t.prototype.handleKeyDown=function(e){if(!this.props.disabled)switch(e.keyCode){case C["default"].codes.down:this.props.open?this.menu.focusNext&&this.menu.focusNext():this.toggleOpen(e,{source:"keydown"}),e.preventDefault();break;case C["default"].codes.esc:case C["default"].codes.tab:this.handleClose(e,{source:"keydown"})}},t.prototype.toggleOpen=function(e,t){var n=!this.props.open;n&&(this.lastOpenEventType=t.source),this.props.onToggle&&this.props.onToggle(n,e,t)},t.prototype.renderMenu=function(e,t){var n=this,o=t.id,r=t.onSelect,i=t.rootCloseEvent,u=(0,l["default"])(t,["id","onSelect","rootCloseEvent"]),s=function(e){n.menu=e};return"string"==typeof e.ref||(s=(0,$["default"])(e.ref,s)),(0,E.cloneElement)(e,(0,a["default"])({},u,{ref:s,labelledBy:o,bsClass:(0,K.prefix)(u,"menu"),onClose:(0,$["default"])(e.props.onClose,this.handleClose),onSelect:(0,$["default"])(e.props.onSelect,r,function(e,t){return n.handleClose(t,{source:"select"})}),rootCloseEvent:i}))},t.prototype.renderToggle=function(e,t){var n=this,o=function(e){n.toggle=e};return"string"==typeof e.ref||(o=(0,$["default"])(e.ref,o)),(0,E.cloneElement)(e,(0,a["default"])({},t,{ref:o,bsClass:(0,K.prefix)(t,"toggle"),onClick:(0,$["default"])(e.props.onClick,this.handleClick),onKeyDown:(0,$["default"])(e.props.onKeyDown,this.handleKeyDown)}))},t.prototype.render=function(){var e,t=this,n=this.props,o=n.componentClass,r=n.id,i=n.dropup,u=n.disabled,s=n.pullRight,c=n.open,d=n.onSelect,f=n.role,p=n.bsClass,h=n.className,v=n.rootCloseEvent,y=n.children,g=(0,l["default"])(n,["componentClass","id","dropup","disabled","pullRight","open","onSelect","role","bsClass","className","rootCloseEvent","children"]);delete g.onToggle;var b=(e={},e[p]=!0,e.open=c,e.disabled=u,e);return i&&(b[p]=!1,b.dropup=!0),x["default"].createElement(o,(0,a["default"])({},g,{className:(0,m["default"])(h,b)}),G["default"].map(y,function(e){switch(e.props.bsRole){case Y:return t.renderToggle(e,{id:r,disabled:u,open:c,role:f,bsClass:p});case X:return t.renderMenu(e,{id:r,open:c,pullRight:s,bsClass:p,onSelect:d,rootCloseEvent:v});default:return e}}))},t}(x["default"].Component);J.propTypes=Q,J.defaultProps=Z,(0,K.bsClass)("dropdown",J);var ee=(0,R["default"])(J,{open:"onToggle"});ee.Toggle=V["default"],ee.Menu=F["default"],t["default"]=ee,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(2),l=o(i),u=n(4),s=o(u),c=n(3),d=o(c),f=n(7),p=o(f),h=n(1),m=o(h),v=n(8),y=o(v),g=n(194),b=o(g),_={"in":y["default"].bool,mountOnEnter:y["default"].bool,unmountOnExit:y["default"].bool,transitionAppear:y["default"].bool,timeout:y["default"].number,onEnter:y["default"].func,onEntering:y["default"].func,onEntered:y["default"].func,onExit:y["default"].func,onExiting:y["default"].func,onExited:y["default"].func},C={"in":!1,timeout:300,mountOnEnter:!1,unmountOnExit:!1,transitionAppear:!1},E=function(e){function t(){return(0,l["default"])(this,t),(0,s["default"])(this,e.apply(this,arguments))}return(0,d["default"])(t,e),t.prototype.render=function(){return m["default"].createElement(b["default"],(0,a["default"])({},this.props,{className:(0,p["default"])(this.props.className,"fade"),enteredClassName:"in",enteringClassName:"in"}))},t}(m["default"].Component);E.propTypes=_,E.defaultProps=C,t["default"]=E,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(13),b=o(g),_=n(313),C=o(_),E=n(314),x=o(E),N=n(315),k=o(N),w=n(316),S=o(w),T=n(317),O=o(T),M=n(318),P=o(M),D=n(9),I={componentClass:b["default"]},A={componentClass:"div"},R=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.componentClass,n=e.className,o=(0,l["default"])(e,["componentClass","className"]),r=(0,D.splitBsProps)(o),i=r[0],u=r[1],s=(0,D.getClassSet)(i);return y["default"].createElement(t,(0,a["default"])({},u,{className:(0,m["default"])(n,s)}))},t}(y["default"].Component);R.propTypes=I,R.defaultProps=A,R.Heading=x["default"],R.Body=C["default"],R.Left=k["default"],R.Right=P["default"],R.List=S["default"],R.ListItem=O["default"],t["default"]=(0,D.bsClass)("media",R),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){var n=t.propTypes,o={},r={};return(0,i["default"])(e).forEach(function(e){var t=e[0],a=e[1];n[t]?o[t]=a:r[t]=a}),[o,r]}t.__esModule=!0;var a=n(127),i=o(a);t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return Object.prototype.hasOwnProperty.call(e,m)||(e[m]=p++,d[e[m]]={}),d[e[m]]}var r,a=n(14),i=n(111),l=n(379),u=n(182),s=n(411),c=n(122),d={},f=!1,p=0,h={topAbort:"abort",topAnimationEnd:s("animationend")||"animationend",topAnimationIteration:s("animationiteration")||"animationiteration",topAnimationStart:s("animationstart")||"animationstart",topBlur:"blur",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topChange:"change",topClick:"click",topCompositionEnd:"compositionend",topCompositionStart:"compositionstart",topCompositionUpdate:"compositionupdate",topContextMenu:"contextmenu",topCopy:"copy",topCut:"cut",topDoubleClick:"dblclick",topDrag:"drag",topDragEnd:"dragend",topDragEnter:"dragenter",topDragExit:"dragexit",topDragLeave:"dragleave",topDragOver:"dragover",topDragStart:"dragstart",topDrop:"drop",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topFocus:"focus",topInput:"input",topKeyDown:"keydown",topKeyPress:"keypress",topKeyUp:"keyup",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topMouseDown:"mousedown",topMouseMove:"mousemove",topMouseOut:"mouseout",topMouseOver:"mouseover",topMouseUp:"mouseup",topPaste:"paste",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topScroll:"scroll",topSeeked:"seeked",topSeeking:"seeking",topSelectionChange:"selectionchange",topStalled:"stalled",topSuspend:"suspend",topTextInput:"textInput",topTimeUpdate:"timeupdate",topTouchCancel:"touchcancel",topTouchEnd:"touchend",topTouchMove:"touchmove",topTouchStart:"touchstart",topTransitionEnd:s("transitionend")||"transitionend",topVolumeChange:"volumechange",topWaiting:"waiting",topWheel:"wheel"},m="_reactListenersID"+String(Math.random()).slice(2),v=a({},l,{ReactEventListener:null,injection:{injectReactEventListener:function(e){e.setHandleTopLevel(v.handleTopLevel),v.ReactEventListener=e}},setEnabled:function(e){v.ReactEventListener&&v.ReactEventListener.setEnabled(e)},isEnabled:function(){return!(!v.ReactEventListener||!v.ReactEventListener.isEnabled())},listenTo:function(e,t){for(var n=t,r=o(n),a=i.registrationNameDependencies[e],l=0;l<a.length;l++){var u=a[l];r.hasOwnProperty(u)&&r[u]||("topWheel"===u?c("wheel")?v.ReactEventListener.trapBubbledEvent("topWheel","wheel",n):c("mousewheel")?v.ReactEventListener.trapBubbledEvent("topWheel","mousewheel",n):v.ReactEventListener.trapBubbledEvent("topWheel","DOMMouseScroll",n):"topScroll"===u?c("scroll",!0)?v.ReactEventListener.trapCapturedEvent("topScroll","scroll",n):v.ReactEventListener.trapBubbledEvent("topScroll","scroll",v.ReactEventListener.WINDOW_HANDLE):"topFocus"===u||"topBlur"===u?(c("focus",!0)?(v.ReactEventListener.trapCapturedEvent("topFocus","focus",n),v.ReactEventListener.trapCapturedEvent("topBlur","blur",n)):c("focusin")&&(v.ReactEventListener.trapBubbledEvent("topFocus","focusin",n),v.ReactEventListener.trapBubbledEvent("topBlur","focusout",n)),r.topBlur=!0,r.topFocus=!0):h.hasOwnProperty(u)&&v.ReactEventListener.trapBubbledEvent(u,h[u],n),r[u]=!0)}},trapBubbledEvent:function(e,t,n){return v.ReactEventListener.trapBubbledEvent(e,t,n)},trapCapturedEvent:function(e,t,n){return v.ReactEventListener.trapCapturedEvent(e,t,n)},supportsEventPageXY:function(){if(!document.createEvent)return!1;var e=document.createEvent("MouseEvent");return null!=e&&"pageX"in e},ensureScrollValueMonitoring:function(){if(void 0===r&&(r=v.supportsEventPageXY()),!r&&!f){var e=u.refreshScrollValues;v.ReactEventListener.monitorScrollValue(e),f=!0}}});e.exports=v},function(e,t,n){"use strict";function o(e,t,n,o){return r.call(this,e,t,n,o)}var r=n(60),a=n(182),i=n(120),l={screenX:null,screenY:null,clientX:null,clientY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:i,button:function(e){var t=e.button;return"which"in e?t:2===t?2:4===t?1:0},buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},pageX:function(e){return"pageX"in e?e.pageX:e.clientX+a.currentScrollLeft},pageY:function(e){return"pageY"in e?e.pageY:e.clientY+a.currentScrollTop}};r.augmentClass(o,l),e.exports=o},function(e,t,n){"use strict";var o=n(11),r=(n(10),{}),a={reinitializeTransaction:function(){this.transactionWrappers=this.getTransactionWrappers(),this.wrapperInitData?this.wrapperInitData.length=0:this.wrapperInitData=[],this._isInTransaction=!1},_isInTransaction:!1,getTransactionWrappers:null,isInTransaction:function(){return!!this._isInTransaction},perform:function(e,t,n,r,a,i,l,u){this.isInTransaction()?o("27"):void 0;var s,c;try{this._isInTransaction=!0,s=!0,this.initializeAll(0),c=e.call(t,n,r,a,i,l,u),s=!1}finally{try{if(s)try{this.closeAll(0)}catch(e){}else this.closeAll(0)}finally{this._isInTransaction=!1}}return c},initializeAll:function(e){for(var t=this.transactionWrappers,n=e;n<t.length;n++){var o=t[n];try{this.wrapperInitData[n]=r,this.wrapperInitData[n]=o.initialize?o.initialize.call(this):null}finally{if(this.wrapperInitData[n]===r)try{this.initializeAll(n+1)}catch(e){}}}},closeAll:function(e){this.isInTransaction()?void 0:o("28");for(var t=this.transactionWrappers,n=e;n<t.length;n++){var a,i=t[n],l=this.wrapperInitData[n];try{a=!0,l!==r&&i.close&&i.close.call(this,l),a=!1}finally{if(a)try{this.closeAll(n+1)}catch(e){}}}this.wrapperInitData.length=0}};e.exports=a},function(e,t){"use strict";function n(e){var t=""+e,n=r.exec(t);if(!n)return t;var o,a="",i=0,l=0;for(i=n.index;i<t.length;i++){switch(t.charCodeAt(i)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 39:o="&#x27;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}l!==i&&(a+=t.substring(l,i)),l=i+1,a+=o}return l!==i?a+t.substring(l,i):a}function o(e){return"boolean"==typeof e||"number"==typeof e?""+e:n(e)}var r=/["'&<>]/;e.exports=o},function(e,t,n){"use strict";var o,r=n(20),a=n(110),i=/^[ \r\n\t\f]/,l=/<(!--|link|noscript|meta|script|style)[ \r\n\t\f\/>]/,u=n(118),s=u(function(e,t){if(e.namespaceURI!==a.svg||"innerHTML"in e)e.innerHTML=t;else{o=o||document.createElement("div"),o.innerHTML="<svg>"+t+"</svg>";for(var n=o.firstChild;n.firstChild;)e.appendChild(n.firstChild)}});if(r.canUseDOM){var c=document.createElement("div");c.innerHTML=" ",""===c.innerHTML&&(s=function(e,t){if(e.parentNode&&e.parentNode.replaceChild(e,e),i.test(t)||"<"===t[0]&&l.test(t)){e.innerHTML=String.fromCharCode(65279)+t;var n=e.firstChild;1===n.data.length?e.removeChild(n):n.deleteData(0,1)}else e.innerHTML=t}),c=null}e.exports=s},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){return e="function"==typeof e?e():e,i["default"].findDOMNode(e)||t}t.__esModule=!0,t["default"]=r;var a=n(19),i=o(a);e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(211),a=o(r),i=n(210),l=o(i),u="function"==typeof l["default"]&&"symbol"==typeof a["default"]?function(e){return typeof e}:function(e){return e&&"function"==typeof l["default"]&&e.constructor===l["default"]&&e!==l["default"].prototype?"symbol":typeof e};t["default"]="function"==typeof l["default"]&&"symbol"===u(a["default"])?function(e){return"undefined"==typeof e?"undefined":u(e)}:function(e){return e&&"function"==typeof l["default"]&&e.constructor===l["default"]&&e!==l["default"].prototype?"symbol":"undefined"==typeof e?"undefined":u(e)}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var o=n(220);e.exports=function(e,t,n){if(o(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,o){return e.call(t,n,o)};case 3:return function(n,o,r){return e.call(t,n,o,r)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t){e.exports=!0},function(e,t,n){var o=n(39),r=n(235),a=n(87),i=n(92)("IE_PROTO"),l=function(){},u="prototype",s=function(){var e,t=n(128)("iframe"),o=a.length,r="<",i=">";for(t.style.display="none",n(226).appendChild(t),t.src="javascript:",e=t.contentWindow.document,e.open(),e.write(r+"script"+i+"document.F=Object"+r+"/script"+i),e.close(),s=e.F;o--;)delete s[u][a[o]];return s()};e.exports=Object.create||function(e,t){var n;return null!==e?(l[u]=o(e),n=new l,l[u]=null,n[i]=e):n=s(),void 0===t?n:r(n,t)}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var o=n(35).f,r=n(34),a=n(25)("toStringTag");e.exports=function(e,t,n){e&&!r(e=n?e:e.prototype,a)&&o(e,a,{configurable:!0,value:t})}},function(e,t,n){var o=n(93)("keys"),r=n(63);e.exports=function(e){return o[e]||(o[e]=r(e))}},function(e,t,n){var o=n(32),r="__core-js_shared__",a=o[r]||(o[r]={});e.exports=function(e){return a[e]||(a[e]={})}},function(e,t){var n=Math.ceil,o=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?o:n)(e)}},function(e,t,n){var o=n(86);e.exports=function(e){return Object(o(e))}},function(e,t,n){var o=n(51);e.exports=function(e,t){if(!o(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!o(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!o(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!o(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var o=n(32),r=n(24),a=n(88),i=n(98),l=n(35).f;e.exports=function(e){var t=r.Symbol||(r.Symbol=a?{}:o.Symbol||{});"_"==e.charAt(0)||e in t||l(t,e,{value:i.f(e)})}},function(e,t,n){t.f=n(25)},function(e,t,n){"use strict";var o=n(16);t.__esModule=!0,t["default"]=void 0;var r=o(n(33)),a=function(){};r["default"]&&(a=function(){return document.addEventListener?function(e,t,n,o){return e.removeEventListener(t,n,o||!1)}:document.attachEvent?function(e,t,n){return e.detachEvent("on"+t,n)}:void 0}());var i=a;t["default"]=i,e.exports=t["default"]},function(e,t){"use strict";function n(e,t){return e===t?0!==e||0!==t||1/e===1/t:e!==e&&t!==t}function o(e,t){if(n(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var o=Object.keys(e),a=Object.keys(t);if(o.length!==a.length)return!1;for(var i=0;i<o.length;i++)if(!r.call(t,o[i])||!n(e[o[i]],t[o[i]]))return!1;return!0}var r=Object.prototype.hasOwnProperty;e.exports=o},function(e,t){function n(e){if(e&&"object"==typeof e){var t=e.which||e.keyCode||e.charCode;t&&(e=t)}if("number"==typeof e)return i[e];var n=String(e),a=o[n.toLowerCase()];if(a)return a;var a=r[n.toLowerCase()];return a?a:1===n.length?n.charCodeAt(0):void 0}n.isEventKey=function(e,t){if(e&&"object"==typeof e){var n=e.which||e.keyCode||e.charCode;if(null===n||void 0===n)return!1;if("string"==typeof t){var a=o[t.toLowerCase()];if(a)return a===n;var a=r[t.toLowerCase()];if(a)return a===n}else if("number"==typeof t)return t===n;return!1}},t=e.exports=n;var o=t.code=t.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},r=t.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,"break":19,caps:20,"return":13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(a=97;a<123;a++)o[String.fromCharCode(a)]=a-32;for(var a=48;a<58;a++)o[a-48]=a;for(a=1;a<13;a++)o["f"+a]=a+111;for(a=0;a<10;a++)o["numpad "+a]=a+96;var i=t.names=t.title={};for(a in o)i[o[a]]=a;for(var l in r)o[l]=r[l]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(69),C=o(_),E=n(56),x=o(E),N=n(9),k={vertical:b["default"].bool,justified:b["default"].bool,block:(0,C["default"])(b["default"].bool,function(e){var t=e.block,n=e.vertical;return t&&!n?new Error("`block` requires `vertical` to be set to have any effect"):null})},w={block:!1,justified:!1,vertical:!1},S=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e,t=this.props,n=t.block,o=t.justified,r=t.vertical,i=t.className,u=(0,l["default"])(t,["block","justified","vertical","className"]),s=(0,N.splitBsProps)(u),c=s[0],d=s[1],f=(0,a["default"])({},(0,N.getClassSet)(c),(e={},e[(0,N.prefix)(c)]=!r,e[(0,N.prefix)(c,"vertical")]=r,e[(0,N.prefix)(c,"justified")]=o,e[(0,N.prefix)(x["default"].defaultProps,"block")]=n,e));return y["default"].createElement("div",(0,a["default"])({},d,{className:(0,m["default"])(i,f)}))},t}(y["default"].Component);S.propTypes=k,S.defaultProps=w,t["default"]=(0,N.bsClass)("btn-group",S),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(2),a=o(r),i=n(4),l=o(i),u=n(3),s=o(u),c=n(8),d=o(c),f=n(1),p=o(f),h={label:d["default"].string.isRequired,onClick:d["default"].func},m={label:"Close"},v=function(e){function t(){return(0,a["default"])(this,t),(0,l["default"])(this,e.apply(this,arguments))}return(0,s["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.label,n=e.onClick;return p["default"].createElement("button",{type:"button",className:"close",onClick:n},p["default"].createElement("span",{"aria-hidden":"true"},"×"),p["default"].createElement("span",{className:"sr-only"},t))},t}(p["default"].Component);v.propTypes=h,v.defaultProps=m,t["default"]=v,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e){e.offsetHeight}function a(e,t){var n=t["offset"+(0,S["default"])(e)],o=M[e];return n+parseInt((0,b["default"])(t,o[0]),10)+parseInt((0,b["default"])(t,o[1]),10)}t.__esModule=!0;var i=n(5),l=o(i),u=n(6),s=o(u),c=n(2),d=o(c),f=n(4),p=o(f),h=n(3),m=o(h),v=n(7),y=o(v),g=n(66),b=o(g),_=n(1),C=o(_),E=n(8),x=o(E),N=n(194),k=o(N),w=n(170),S=o(w),T=n(17),O=o(T),M={height:["marginTop","marginBottom"],width:["marginLeft","marginRight"]},P={"in":x["default"].bool,mountOnEnter:x["default"].bool,unmountOnExit:x["default"].bool,transitionAppear:x["default"].bool,timeout:x["default"].number,onEnter:x["default"].func,onEntering:x["default"].func,onEntered:x["default"].func,onExit:x["default"].func,onExiting:x["default"].func,onExited:x["default"].func,dimension:x["default"].oneOfType([x["default"].oneOf(["height","width"]),x["default"].func]),getDimensionValue:x["default"].func,role:x["default"].string},D={"in":!1,timeout:300,mountOnEnter:!1,unmountOnExit:!1,transitionAppear:!1,dimension:"height",getDimensionValue:a},I=function(e){function t(n,o){(0,d["default"])(this,t);var r=(0,p["default"])(this,e.call(this,n,o));return r.handleEnter=r.handleEnter.bind(r),r.handleEntering=r.handleEntering.bind(r),r.handleEntered=r.handleEntered.bind(r),r.handleExit=r.handleExit.bind(r),r.handleExiting=r.handleExiting.bind(r),r}return(0,m["default"])(t,e),t.prototype._dimension=function(){return"function"==typeof this.props.dimension?this.props.dimension():this.props.dimension},t.prototype._getScrollDimensionValue=function(e,t){return e["scroll"+(0,S["default"])(t)]+"px"},t.prototype.handleEnter=function(e){var t=this._dimension();e.style[t]="0"},t.prototype.handleEntered=function(e){var t=this._dimension();e.style[t]=null},t.prototype.handleEntering=function(e){var t=this._dimension();e.style[t]=this._getScrollDimensionValue(e,t)},t.prototype.handleExit=function(e){var t=this._dimension();e.style[t]=this.props.getDimensionValue(t,e)+"px",r(e)},t.prototype.handleExiting=function(e){var t=this._dimension();e.style[t]="0"},t.prototype.render=function(){var e=this.props,t=e.onEnter,n=e.onEntering,o=e.onEntered,r=e.onExit,a=e.onExiting,i=e.className,u=(0,s["default"])(e,["onEnter","onEntering","onEntered","onExit","onExiting","className"]);delete u.dimension,delete u.getDimensionValue;var c=(0,O["default"])(this.handleEnter,t),d=(0,O["default"])(this.handleEntering,n),f=(0,O["default"])(this.handleEntered,o),p=(0,O["default"])(this.handleExit,r),h=(0,O["default"])(this.handleExiting,a),m={width:"width"===this._dimension()};return C["default"].createElement(k["default"],(0,l["default"])({},u,{"aria-expanded":u.role?u["in"]:null,className:(0,y["default"])(i,m),exitedClassName:"collapse",exitingClassName:"collapsing",enteredClassName:"collapse in",enteringClassName:"collapsing",onEnter:c,onEntering:d,onEntered:f,onExit:p,onExiting:h}))},t}(C["default"].Component);I.propTypes=P,I.defaultProps=D,t["default"]=I,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(9),C={glyph:b["default"].string.isRequired},E=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e,t=this.props,n=t.glyph,o=t.className,r=(0,l["default"])(t,["glyph","className"]),i=(0,_.splitBsProps)(r),u=i[0],s=i[1],c=(0,a["default"])({},(0,_.getClassSet)(u),(e={},e[(0,_.prefix)(u,n)]=!0,e));return y["default"].createElement("span",(0,a["default"])({},s,{className:(0,m["default"])(o,c)}))},t}(y["default"].Component);E.propTypes=C,t["default"]=(0,_.bsClass)("glyphicon",E),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(6),a=o(r),i=n(2),l=o(i),u=n(4),s=o(u),c=n(3),d=o(c),f=n(1),p=o(f),h=n(8),m=o(h),v=n(62),y=o(v),g="tab",b="pane",_=m["default"].oneOfType([m["default"].string,m["default"].number]),C={id:function(e){var t=null;if(!e.generateChildId){for(var n=arguments.length,o=Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];t=_.apply(void 0,[e].concat(o)),t||e.id||(t=new Error("In order to properly initialize Tabs in a way that is accessible to assistive technologies (such as screen readers) an `id` or a `generateChildId` prop to TabContainer is required"))}return t},generateChildId:m["default"].func,onSelect:m["default"].func,activeKey:m["default"].any},E={$bs_tabContainer:m["default"].shape({activeKey:m["default"].any,onSelect:m["default"].func.isRequired,getTabId:m["default"].func.isRequired,getPaneId:m["default"].func.isRequired})},x=function(e){function t(){return(0,l["default"])(this,t),(0,s["default"])(this,e.apply(this,arguments))}return(0,d["default"])(t,e),t.prototype.getChildContext=function(){var e=this.props,t=e.activeKey,n=e.onSelect,o=e.generateChildId,r=e.id,a=o||function(e,t){return r?r+"-"+t+"-"+e:null};return{$bs_tabContainer:{activeKey:t,onSelect:n,getTabId:function(e){return a(e,g)},getPaneId:function(e){return a(e,b)}}}},t.prototype.render=function(){var e=this.props,t=e.children,n=(0,a["default"])(e,["children"]);return delete n.generateChildId,delete n.onSelect,delete n.activeKey,p["default"].cloneElement(p["default"].Children.only(t),n)},t}(p["default"].Component);x.propTypes=C,x.childContextTypes=E,t["default"]=(0,y["default"])(x,{activeKey:"onSelect"}),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(13),C=o(_),E=n(9),x={componentClass:C["default"],animation:b["default"].oneOfType([b["default"].bool,C["default"]]),mountOnEnter:b["default"].bool,unmountOnExit:b["default"].bool},N={componentClass:"div",animation:!0,mountOnEnter:!1,unmountOnExit:!1},k={$bs_tabContainer:b["default"].shape({activeKey:b["default"].any})},w={$bs_tabContent:b["default"].shape({bsClass:b["default"].string,animation:b["default"].oneOfType([b["default"].bool,C["default"]]),activeKey:b["default"].any,mountOnEnter:b["default"].bool,unmountOnExit:b["default"].bool,onPaneEnter:b["default"].func.isRequired,onPaneExited:b["default"].func.isRequired,exiting:b["default"].bool.isRequired})},S=function(e){function t(n,o){(0,s["default"])(this,t);var r=(0,d["default"])(this,e.call(this,n,o));return r.handlePaneEnter=r.handlePaneEnter.bind(r),r.handlePaneExited=r.handlePaneExited.bind(r),r.state={activeKey:null,activeChild:null},r}return(0,p["default"])(t,e),t.prototype.getChildContext=function(){var e=this.props,t=e.bsClass,n=e.animation,o=e.mountOnEnter,r=e.unmountOnExit,a=this.state.activeKey,i=this.getContainerActiveKey(),l=null!=a?a:i,u=null!=a&&a!==i;
return{$bs_tabContent:{bsClass:t,animation:n,activeKey:l,mountOnEnter:o,unmountOnExit:r,onPaneEnter:this.handlePaneEnter,onPaneExited:this.handlePaneExited,exiting:u}}},t.prototype.componentWillReceiveProps=function(e){!e.animation&&this.state.activeChild&&this.setState({activeKey:null,activeChild:null})},t.prototype.componentWillUnmount=function(){this.isUnmounted=!0},t.prototype.getContainerActiveKey=function(){var e=this.context.$bs_tabContainer;return e&&e.activeKey},t.prototype.handlePaneEnter=function(e,t){return!!this.props.animation&&t===this.getContainerActiveKey()&&(this.setState({activeKey:t,activeChild:e}),!0)},t.prototype.handlePaneExited=function(e){this.isUnmounted||this.setState(function(t){var n=t.activeChild;return n!==e?null:{activeKey:null,activeChild:null}})},t.prototype.render=function(){var e=this.props,t=e.componentClass,n=e.className,o=(0,l["default"])(e,["componentClass","className"]),r=(0,E.splitBsPropsAndOmit)(o,["animation","mountOnEnter","unmountOnExit"]),i=r[0],u=r[1];return y["default"].createElement(t,(0,a["default"])({},u,{className:(0,m["default"])(n,(0,E.prefix)(i,"content"))}))},t}(y["default"].Component);S.propTypes=x,S.defaultProps=N,S.contextTypes=k,S.childContextTypes=w,t["default"]=(0,E.bsClass)("tab",S),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function r(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0,t.utils=t.Well=t.Tooltip=t.ToggleButtonGroup=t.ToggleButton=t.Thumbnail=t.Tabs=t.TabPane=t.Table=t.TabContent=t.TabContainer=t.Tab=t.SplitButton=t.SafeAnchor=t.Row=t.ResponsiveEmbed=t.Radio=t.ProgressBar=t.Popover=t.PanelGroup=t.Panel=t.PaginationButton=t.Pagination=t.Pager=t.PageItem=t.PageHeader=t.OverlayTrigger=t.Overlay=t.NavItem=t.NavDropdown=t.NavbarBrand=t.Navbar=t.Nav=t.ModalTitle=t.ModalHeader=t.ModalFooter=t.ModalBody=t.Modal=t.MenuItem=t.Media=t.ListGroupItem=t.ListGroup=t.Label=t.Jumbotron=t.InputGroup=t.Image=t.HelpBlock=t.Grid=t.Glyphicon=t.FormGroup=t.FormControl=t.Form=t.Fade=t.DropdownButton=t.Dropdown=t.Collapse=t.Col=t.ControlLabel=t.CloseButton=t.Clearfix=t.Checkbox=t.CarouselItem=t.Carousel=t.ButtonToolbar=t.ButtonGroup=t.Button=t.BreadcrumbItem=t.Breadcrumb=t.Badge=t.Alert=t.Accordion=void 0;var a=n(287),i=r(a),l=n(288),u=r(l),s=n(289),c=r(s),d=n(290),f=r(d),p=n(152),h=r(p),m=n(56),v=r(m),y=n(102),g=r(y),b=n(291),_=r(b),C=n(292),E=r(C),x=n(153),N=r(x),k=n(294),w=r(k),S=n(295),T=r(S),O=n(103),M=r(O),P=n(297),D=r(P),I=n(296),A=r(I),R=n(104),L=r(R),j=n(73),B=r(j),U=n(298),F=r(U),H=n(74),V=r(H),K=n(300),W=r(K),$=n(301),q=r($),z=n(304),G=r(z),Y=n(105),X=r(Y),Q=n(155),Z=r(Q),J=n(305),ee=r(J),te=n(306),ne=r(te),oe=n(307),re=r(oe),ae=n(310),ie=r(ae),le=n(311),ue=r(le),se=n(312),ce=r(se),de=n(156),fe=r(de),pe=n(75),he=r(pe),me=n(319),ve=r(me),ye=n(320),ge=r(ye),be=n(157),_e=r(be),Ce=n(158),Ee=r(Ce),xe=n(159),Ne=r(xe),ke=n(160),we=r(ke),Se=n(161),Te=r(Se),Oe=n(323),Me=r(Oe),Pe=n(163),De=r(Pe),Ie=n(322),Ae=r(Ie),Re=n(162),Le=r(Re),je=n(164),Be=r(je),Ue=n(327),Fe=r(Ue),He=n(328),Ve=r(He),Ke=n(329),We=r(Ke),$e=n(330),qe=r($e),ze=n(331),Ge=r(ze),Ye=n(166),Xe=r(Ye),Qe=n(332),Ze=r(Qe),Je=n(167),et=r(Je),tt=n(333),nt=r(tt),ot=n(334),rt=r(ot),at=n(335),it=r(at),lt=n(336),ut=r(lt),st=n(337),ct=r(st),dt=n(27),ft=r(dt),pt=n(338),ht=r(pt),mt=n(340),vt=r(mt),yt=n(106),gt=r(yt),bt=n(107),_t=r(bt),Ct=n(341),Et=r(Ct),xt=n(168),Nt=r(xt),kt=n(342),wt=r(kt),St=n(343),Tt=r(St),Ot=n(169),Mt=r(Ot),Pt=n(344),Dt=r(Pt),It=n(345),At=r(It),Rt=n(346),Lt=r(Rt),jt=n(350),Bt=o(jt);t.Accordion=i["default"],t.Alert=u["default"],t.Badge=c["default"],t.Breadcrumb=f["default"],t.BreadcrumbItem=h["default"],t.Button=v["default"],t.ButtonGroup=g["default"],t.ButtonToolbar=_["default"],t.Carousel=E["default"],t.CarouselItem=N["default"],t.Checkbox=w["default"],t.Clearfix=T["default"],t.CloseButton=M["default"],t.ControlLabel=D["default"],t.Col=A["default"],t.Collapse=L["default"],t.Dropdown=B["default"],t.DropdownButton=F["default"],t.Fade=V["default"],t.Form=W["default"],t.FormControl=q["default"],t.FormGroup=G["default"],t.Glyphicon=X["default"],t.Grid=Z["default"],t.HelpBlock=ee["default"],t.Image=ne["default"],t.InputGroup=re["default"],t.Jumbotron=ie["default"],t.Label=ue["default"],t.ListGroup=ce["default"],t.ListGroupItem=fe["default"],t.Media=he["default"],t.MenuItem=ve["default"],t.Modal=ge["default"],t.ModalBody=_e["default"],t.ModalFooter=Ee["default"],t.ModalHeader=Ne["default"],t.ModalTitle=we["default"],t.Nav=Te["default"],t.Navbar=Me["default"],t.NavbarBrand=De["default"],t.NavDropdown=Ae["default"],t.NavItem=Le["default"],t.Overlay=Be["default"],t.OverlayTrigger=Fe["default"],t.PageHeader=Ve["default"],t.PageItem=We["default"],t.Pager=qe["default"],t.Pagination=Ge["default"],t.PaginationButton=Xe["default"],t.Panel=Ze["default"],t.PanelGroup=et["default"],t.Popover=nt["default"],t.ProgressBar=rt["default"],t.Radio=it["default"],t.ResponsiveEmbed=ut["default"],t.Row=ct["default"],t.SafeAnchor=ft["default"],t.SplitButton=ht["default"],t.Tab=vt["default"],t.TabContainer=gt["default"],t.TabContent=_t["default"],t.Table=Et["default"],t.TabPane=Nt["default"],t.Tabs=wt["default"],t.Thumbnail=Tt["default"],t.ToggleButton=Mt["default"],t.ToggleButtonGroup=Dt["default"],t.Tooltip=At["default"],t.Well=Lt["default"],t.utils=Bt},function(e,t,n){"use strict";function o(e,t){return Array.isArray(t)&&(t=t[1]),t?t.nextSibling:e.firstChild}function r(e,t,n){c.insertTreeBefore(e,t,n)}function a(e,t,n){Array.isArray(t)?l(e,t[0],t[1],n):m(e,t,n)}function i(e,t){if(Array.isArray(t)){var n=t[1];t=t[0],u(e,t,n),e.removeChild(n)}e.removeChild(t)}function l(e,t,n,o){for(var r=t;;){var a=r.nextSibling;if(m(e,r,o),r===n)break;r=a}}function u(e,t,n){for(;;){var o=t.nextSibling;if(o===n)break;e.removeChild(o)}}function s(e,t,n){var o=e.parentNode,r=e.nextSibling;r===t?n&&m(o,document.createTextNode(n),r):n?(h(r,n),u(o,r,t)):u(o,e,t)}var c=n(44),d=n(356),f=(n(15),n(23),n(118)),p=n(81),h=n(190),m=f(function(e,t,n){e.insertBefore(t,n)}),v=d.dangerouslyReplaceNodeWithMarkup,y={dangerouslyReplaceNodeWithMarkup:v,replaceDelimitedText:s,processUpdates:function(e,t){for(var n=0;n<t.length;n++){var l=t[n];switch(l.type){case"INSERT_MARKUP":r(e,l.content,o(e,l.afterNode));break;case"MOVE_EXISTING":a(e,l.fromNode,o(e,l.afterNode));break;case"SET_MARKUP":p(e,l.content);break;case"TEXT_CONTENT":h(e,l.content);break;case"REMOVE_NODE":i(e,l.fromNode)}}}};e.exports=y},function(e,t){"use strict";var n={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};e.exports=n},function(e,t,n){"use strict";function o(){if(l)for(var e in u){var t=u[e],n=l.indexOf(e);if(n>-1?void 0:i("96",e),!s.plugins[n]){t.extractEvents?void 0:i("97",e),s.plugins[n]=t;var o=t.eventTypes;for(var a in o)r(o[a],t,a)?void 0:i("98",a,e)}}}function r(e,t,n){s.eventNameDispatchConfigs.hasOwnProperty(n)?i("99",n):void 0,s.eventNameDispatchConfigs[n]=e;var o=e.phasedRegistrationNames;if(o){for(var r in o)if(o.hasOwnProperty(r)){var l=o[r];a(l,t,n)}return!0}return!!e.registrationName&&(a(e.registrationName,t,n),!0)}function a(e,t,n){s.registrationNameModules[e]?i("100",e):void 0,s.registrationNameModules[e]=t,s.registrationNameDependencies[e]=t.eventTypes[n].dependencies}var i=n(11),l=(n(10),null),u={},s={plugins:[],eventNameDispatchConfigs:{},registrationNameModules:{},registrationNameDependencies:{},possibleRegistrationNames:null,injectEventPluginOrder:function(e){l?i("101"):void 0,l=Array.prototype.slice.call(e),o()},injectEventPluginsByName:function(e){var t=!1;for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];u.hasOwnProperty(n)&&u[n]===r||(u[n]?i("102",n):void 0,u[n]=r,t=!0)}t&&o()},getPluginModuleForEvent:function(e){var t=e.dispatchConfig;if(t.registrationName)return s.registrationNameModules[t.registrationName]||null;if(void 0!==t.phasedRegistrationNames){var n=t.phasedRegistrationNames;for(var o in n)if(n.hasOwnProperty(o)){var r=s.registrationNameModules[n[o]];if(r)return r}}return null},_resetEventPlugins:function(){l=null;for(var e in u)u.hasOwnProperty(e)&&delete u[e];s.plugins.length=0;var t=s.eventNameDispatchConfigs;for(var n in t)t.hasOwnProperty(n)&&delete t[n];var o=s.registrationNameModules;for(var r in o)o.hasOwnProperty(r)&&delete o[r]}};e.exports=s},function(e,t,n){"use strict";function o(e){return"topMouseUp"===e||"topTouchEnd"===e||"topTouchCancel"===e}function r(e){return"topMouseMove"===e||"topTouchMove"===e}function a(e){return"topMouseDown"===e||"topTouchStart"===e}function i(e,t,n,o){var r=e.type||"unknown-event";e.currentTarget=y.getNodeFromInstance(o),t?m.invokeGuardedCallbackWithCatch(r,n,e):m.invokeGuardedCallback(r,n,e),e.currentTarget=null}function l(e,t){var n=e._dispatchListeners,o=e._dispatchInstances;if(Array.isArray(n))for(var r=0;r<n.length&&!e.isPropagationStopped();r++)i(e,t,n[r],o[r]);else n&&i(e,t,n,o);e._dispatchListeners=null,e._dispatchInstances=null}function u(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t)){for(var o=0;o<t.length&&!e.isPropagationStopped();o++)if(t[o](e,n[o]))return n[o]}else if(t&&t(e,n))return n;return null}function s(e){var t=u(e);return e._dispatchInstances=null,e._dispatchListeners=null,t}function c(e){var t=e._dispatchListeners,n=e._dispatchInstances;Array.isArray(t)?h("103"):void 0,e.currentTarget=t?y.getNodeFromInstance(n):null;var o=t?t(e):null;return e.currentTarget=null,e._dispatchListeners=null,e._dispatchInstances=null,o}function d(e){return!!e._dispatchListeners}var f,p,h=n(11),m=n(116),v=(n(10),n(12),{injectComponentTree:function(e){f=e},injectTreeTraversal:function(e){p=e}}),y={isEndish:o,isMoveish:r,isStartish:a,executeDirectDispatch:c,executeDispatchesInOrder:l,executeDispatchesInOrderStopAtTrue:s,hasDispatches:d,getInstanceFromNode:function(e){return f.getInstanceFromNode(e)},getNodeFromInstance:function(e){return f.getNodeFromInstance(e)},isAncestor:function(e,t){return p.isAncestor(e,t)},getLowestCommonAncestor:function(e,t){return p.getLowestCommonAncestor(e,t)},getParentInstance:function(e){return p.getParentInstance(e)},traverseTwoPhase:function(e,t,n){return p.traverseTwoPhase(e,t,n)},traverseEnterLeave:function(e,t,n,o,r){return p.traverseEnterLeave(e,t,n,o,r)},injection:v};e.exports=y},function(e,t){"use strict";function n(e){var t=/[=:]/g,n={"=":"=0",":":"=2"},o=(""+e).replace(t,function(e){return n[e]});return"$"+o}function o(e){var t=/(=0|=2)/g,n={"=0":"=","=2":":"},o="."===e[0]&&"$"===e[1]?e.substring(2):e.substring(1);return(""+o).replace(t,function(e){return n[e]})}var r={escape:n,unescape:o};e.exports=r},function(e,t,n){"use strict";function o(e){null!=e.checkedLink&&null!=e.valueLink?l("87"):void 0}function r(e){o(e),null!=e.value||null!=e.onChange?l("88"):void 0}function a(e){o(e),null!=e.checked||null!=e.onChange?l("89"):void 0}function i(e){if(e){var t=e.getName();if(t)return" Check the render method of `"+t+"`."}return""}var l=n(11),u=n(385),s=n(150),c=n(48),d=s(c.isValidElement),f=(n(10),n(12),{button:!0,checkbox:!0,image:!0,hidden:!0,radio:!0,reset:!0,submit:!0}),p={value:function(e,t,n){return!e[t]||f[e.type]||e.onChange||e.readOnly||e.disabled?null:new Error("You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set either `onChange` or `readOnly`.")},checked:function(e,t,n){return!e[t]||e.onChange||e.readOnly||e.disabled?null:new Error("You provided a `checked` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultChecked`. Otherwise, set either `onChange` or `readOnly`.")},onChange:d.func},h={},m={checkPropTypes:function(e,t,n){for(var o in p){if(p.hasOwnProperty(o))var r=p[o](t,o,e,"prop",null,u);r instanceof Error&&!(r.message in h)&&(h[r.message]=!0,i(n))}},getValue:function(e){return e.valueLink?(r(e),e.valueLink.value):e.value},getChecked:function(e){return e.checkedLink?(a(e),e.checkedLink.value):e.checked},executeOnChange:function(e,t){return e.valueLink?(r(e),e.valueLink.requestChange(t.target.value)):e.checkedLink?(a(e),e.checkedLink.requestChange(t.target.checked)):e.onChange?e.onChange.call(void 0,t):void 0}};e.exports=m},function(e,t,n){"use strict";var o=n(11),r=(n(10),!1),a={replaceNodeWithMarkup:null,processChildrenUpdates:null,injection:{injectEnvironment:function(e){r?o("104"):void 0,a.replaceNodeWithMarkup=e.replaceNodeWithMarkup,a.processChildrenUpdates=e.processChildrenUpdates,r=!0}}};e.exports=a},function(e,t,n){"use strict";function o(e,t,n){try{t(n)}catch(e){null===r&&(r=e)}}var r=null,a={invokeGuardedCallback:o,invokeGuardedCallbackWithCatch:o,rethrowCaughtError:function(){if(r){var e=r;throw r=null,e}}};e.exports=a},function(e,t,n){"use strict";function o(e){u.enqueueUpdate(e)}function r(e){var t=typeof e;if("object"!==t)return t;var n=e.constructor&&e.constructor.name||t,o=Object.keys(e);return o.length>0&&o.length<20?n+" (keys: "+o.join(", ")+")":n}function a(e,t){var n=l.get(e);return n?n:null}var i=n(11),l=(n(30),n(59)),u=(n(23),n(28)),s=(n(10),n(12),{isMounted:function(e){var t=l.get(e);return!!t&&!!t._renderedComponent},enqueueCallback:function(e,t,n){s.validateCallback(t,n);var r=a(e);return r?(r._pendingCallbacks?r._pendingCallbacks.push(t):r._pendingCallbacks=[t],void o(r)):null},enqueueCallbackInternal:function(e,t){e._pendingCallbacks?e._pendingCallbacks.push(t):e._pendingCallbacks=[t],o(e)},enqueueForceUpdate:function(e){var t=a(e,"forceUpdate");t&&(t._pendingForceUpdate=!0,o(t))},enqueueReplaceState:function(e,t,n){var r=a(e,"replaceState");r&&(r._pendingStateQueue=[t],r._pendingReplaceState=!0,void 0!==n&&null!==n&&(s.validateCallback(n,"replaceState"),r._pendingCallbacks?r._pendingCallbacks.push(n):r._pendingCallbacks=[n]),o(r))},enqueueSetState:function(e,t){var n=a(e,"setState");if(n){var r=n._pendingStateQueue||(n._pendingStateQueue=[]);r.push(t),o(n)}},enqueueElementInternal:function(e,t,n){e._pendingElement=t,e._context=n,o(e)},validateCallback:function(e,t){e&&"function"!=typeof e?i("122",t,r(e)):void 0}});e.exports=s},function(e,t){"use strict";var n=function(e){return"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,n,o,r){MSApp.execUnsafeLocalFunction(function(){return e(t,n,o,r)})}:e};e.exports=n},function(e,t){"use strict";function n(e){var t,n=e.keyCode;return"charCode"in e?(t=e.charCode,0===t&&13===n&&(t=13)):t=n,t>=32||13===t?t:0}e.exports=n},function(e,t){"use strict";function n(e){var t=this,n=t.nativeEvent;if(n.getModifierState)return n.getModifierState(e);var o=r[e];return!!o&&!!n[o]}function o(e){return n}var r={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};e.exports=o},function(e,t){"use strict";function n(e){var t=e.target||e.srcElement||window;return t.correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}e.exports=n},function(e,t,n){"use strict";function o(e,t){if(!a.canUseDOM||t&&!("addEventListener"in document))return!1;var n="on"+e,o=n in document;if(!o){var i=document.createElement("div");i.setAttribute(n,"return;"),o="function"==typeof i[n]}return!o&&r&&"wheel"===e&&(o=document.implementation.hasFeature("Events.wheel","3.0")),o}var r,a=n(20);a.canUseDOM&&(r=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0),e.exports=o},function(e,t){"use strict";function n(e,t){var n=null===e||e===!1,o=null===t||t===!1;if(n||o)return n===o;var r=typeof e,a=typeof t;return"string"===r||"number"===r?"string"===a||"number"===a:"object"===a&&e.type===t.type&&e.key===t.key}e.exports=n},function(e,t,n){"use strict";var o=(n(14),n(26)),r=(n(12),o);e.exports=r},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=n(1),s=o(u),c=n(108),d=function(e){function t(e){r(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.selectDriver=function(e){n.props.selectDriver({driver:e})},n}return i(t,e),l(t,[{key:"componentWillMount",value:function(){console.log("Component mounting")}},{key:"componentWillUnmount",value:function(){console.log("Component unmounting")}},{key:"render",value:function(){var e=this;return s["default"].createElement("div",null,this.props.dispatchObj.drivers.byStatus.map(function(t){return s["default"].createElement("div",{key:t.status},e.props.dispatchObj.filters.driverStatuses[t.status]&&s["default"].createElement("div",{className:"shift-section "+t.status},s["default"].createElement("div",{className:"header"},t.display+" ("+t.drivers.length+") Drivers"),e.props.order(e.props.filter(t.drivers,e.props.dispatchObj.driverSearch),function(e){return new moment("2017-01-01T"+e.EmptyTime).valueOf()},!0).map(function(t){return s["default"].createElement("div",{key:t.DriverId,className:"driver-strip-wrapper"},s["default"].createElement("div",{className:"driver-strip "+t.DriverStatus},s["default"].createElement("div",{className:"driver"},s["default"].createElement("div",{className:"info"},s["default"].createElement("strong",{onClick:function(n){n.preventDefault(),e.props.dispatchObj.drivers.selectDriver(t)}},t.Notes&&s["default"].createElement("span",{className:"material-icons notes"},"note"),t.GoingHome&&s["default"].createElement("span",{className:"material-icons notes"},"home"),t.DriverCallsign+" "+t.DriverFirstname+" "+t.DriverSurname),t.DriverId&&s["default"].createElement("div",null,t.LastKnownShortLocation&&s["default"].createElement("span",null,t.LastKnownShortLocation," (",e.props.countdown(t.LastUpdateTime),")"),!t.LastKnownShortLocation&&s["default"].createElement("span",{className:"text-muted"},s["default"].createElement("i",{className:"fa fa-refresh fa-spin","aria-hidden":"true"}),"Fetching Location...")),!t.DriverId&&s["default"].createElement("div",null,s["default"].createElement("span",{className:"text-muted"},"Driver Offline")))),t.DriverId&&s["default"].createElement("div",{className:"bookings"},s["default"].createElement("div",{className:"stat"},s["default"].createElement("span",{className:"number"},e.props.currencyFilter(t.WeeksEarnings,"£",0)),s["default"].createElement("span",{className:"lbl"},"Earnings"))),t.DriverId&&s["default"].createElement("div",{className:"time"},s["default"].createElement("div",{className:"stat",style:{textAlign:"left",paddingTop:"0",whiteSpace:"nowrap",overflow:"hidden",MsTextOverflow:"ellipsis",OTextOverflow:"ellipsis",textOverflow:"ellipsis"}},s["default"].createElement("b",{style:{color:"black"}},e.props.timeFilter(t.ShiftLengthTime,"HH:mm"))," ",s["default"].createElement("b",null,"Shift"),s["default"].createElement("br",null),s["default"].createElement("b",{style:{color:"black"}},e.props.timeFilter(t.EmptyTime,"HH:mm"))," ",s["default"].createElement("b",null,"Empty"))),t.VehicleId&&s["default"].createElement("div",{className:"vehicle"},s["default"].createElement("div",{className:"number-plate"},t.VehicleReg),s["default"].createElement("div",{className:"description"},t.VehicleDescription)),!t.VehicleId&&s["default"].createElement("div",{className:"vehicle"},s["default"].createElement("div",{className:"number-plate"},"N/A"),s["default"].createElement("div",{className:"description"},"Vehicle Not Found")),s["default"].createElement("div",{className:"option"},s["default"].createElement(c.DropdownButton,{className:moment().diff(t.LastUpdateTime,"minutes")<7.5?t.AutoDispatch?"btn btn-xs btn-success":"btn btn-xs btn-primary ":"btn btn-xs btn-primary late",noCaret:!0,title:s["default"].createElement("i",{className:t.$activity?"fa fa-circle-o-notch fa-spin":moment().diff(t.LastUpdateTime,"minutes")<7.5?t.AutoDispatch?"fa fa-check":"fa fa-caret-down":"fa fa-exclamation-circle late"}," "),id:"dropdown-basic"},("Available"==t.DriverStatus||"OnJob"==t.DriverStatus||"Clearing"==t.DriverStatus||"OnBreak"==t.DriverStatus)&&s["default"].createElement(c.MenuItem,{href:"javascript:;",onClick:function(n){n.preventDefault(),e.props.dispatchObj.drivers.nudgeDriverOnShift(t)}},s["default"].createElement("i",{className:"material-icons"},"settings_remote"),"Nudge Driver"),("Available"==t.DriverStatus||"OnBreak"==t.DriverStatus)&&s["default"].createElement(c.MenuItem,{href:"javascript:;",onClick:function(n){n.preventDefault(),e.props.dispatchObj.drivers.endShift(t)}},s["default"].createElement("i",{className:"material-icons"},"highlight_off"),"End Shift"),"                                                       ",s["default"].createElement(c.MenuItem,{href:"javascript:;",onClick:function(n){n.preventDefault(),e.props.dispatchObj.drivers.openNotesModal(t)}},s["default"].createElement("i",{className:"material-icons"},"note"),"Notes"),t.AutoDispatch&&s["default"].createElement(c.MenuItem,{href:"javascript:;",onClick:function(n){n.preventDefault(),e.props.dispatchObj.drivers.toggleAutoDispatch(t,!1)}},s["default"].createElement("i",{className:"material-icons"},"close"),"AutoDispatch Off"),!t.AutoDispatch&&s["default"].createElement(c.MenuItem,{href:"javascript:;",onClick:function(n){n.preventDefault(),e.props.dispatchObj.drivers.toggleAutoDispatch(t,!0)}},s["default"].createElement("i",{className:"material-icons"},"check"),"AutoDispatch On"),t.GoingHome&&s["default"].createElement(c.MenuItem,{href:"javascript:;",onClick:function(n){n.preventDefault(),e.props.dispatchObj.drivers.toggleGoingHome(t,!1)}},s["default"].createElement("i",{className:"material-icons"},"close"),"Going Home Off"),!t.GoingHome&&s["default"].createElement(c.MenuItem,{href:"javascript:;",onClick:function(n){n.preventDefault(),e.props.dispatchObj.drivers.toggleGoingHome(t,!0)}},s["default"].createElement("i",{className:"material-icons"},"check"),"Going Home On"),s["default"].createElement(c.MenuItem,{href:"javascript:;",onClick:function(n){n.preventDefault(),e.props.dispatchObj.drivers.setLocation(t)}},s["default"].createElement("i",{className:"material-icons"},"check"),"DEBUG: Set Location")))))})),s["default"].createElement("br",{className:"clearfix"}))}))}}]),t}(s["default"].Component);t["default"]=d},function(e,t,n){e.exports={"default":n(213),__esModule:!0}},function(e,t,n){e.exports={"default":n(215),__esModule:!0}},function(e,t,n){var o=n(51),r=n(32).document,a=o(r)&&o(r.createElement);e.exports=function(e){return a?r.createElement(e):{}}},function(e,t,n){e.exports=!n(40)&&!n(50)(function(){return 7!=Object.defineProperty(n(128)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var o=n(84);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==o(e)?e.split(""):Object(e)}},function(e,t,n){"use strict";var o=n(88),r=n(31),a=n(136),i=n(41),l=n(34),u=n(52),s=n(230),c=n(91),d=n(237),f=n(25)("iterator"),p=!([].keys&&"next"in[].keys()),h="@@iterator",m="keys",v="values",y=function(){return this};e.exports=function(e,t,n,g,b,_,C){s(n,t,g);var E,x,N,k=function(e){if(!p&&e in O)return O[e];switch(e){case m:return function(){return new n(this,e)};case v:return function(){return new n(this,e)}}return function(){return new n(this,e)}},w=t+" Iterator",S=b==v,T=!1,O=e.prototype,M=O[f]||O[h]||b&&O[b],P=M||k(b),D=b?S?k("entries"):P:void 0,I="Array"==t?O.entries||M:M;if(I&&(N=d(I.call(new e)),N!==Object.prototype&&N.next&&(c(N,w,!0),o||l(N,f)||i(N,f,y))),S&&M&&M.name!==v&&(T=!0,P=function(){return M.call(this)}),o&&!C||!p&&!T&&O[f]||i(O,f,P),u[t]=P,u[w]=y,b)if(E={values:S?P:k(v),keys:_?P:k(m),entries:D},C)for(x in E)x in O||a(O,x,E[x]);else r(r.P+r.F*(p||T),t,E);return E}},function(e,t,n){var o=n(54),r=n(55),a=n(36),i=n(96),l=n(34),u=n(129),s=Object.getOwnPropertyDescriptor;t.f=n(40)?s:function(e,t){if(e=a(e),t=i(t,!0),u)try{return s(e,t)}catch(e){}if(l(e,t))return r(!o.f.call(e,t),e[t])}},function(e,t,n){var o=n(134),r=n(87).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return o(e,r)}},function(e,t,n){var o=n(34),r=n(36),a=n(222)(!1),i=n(92)("IE_PROTO");e.exports=function(e,t){var n,l=r(e),u=0,s=[];for(n in l)n!=i&&o(l,n)&&s.push(n);for(;t.length>u;)o(l,n=t[u++])&&(~a(s,n)||s.push(n));return s}},function(e,t,n){var o=n(53),r=n(36),a=n(54).f;e.exports=function(e){return function(t){for(var n,i=r(t),l=o(i),u=l.length,s=0,c=[];u>s;)a.call(i,n=l[s++])&&c.push(e?[n,i[n]]:i[n]);return c}}},function(e,t,n){e.exports=n(41)},function(e,t,n){var o=n(94),r=Math.min;e.exports=function(e){return e>0?r(o(e),9007199254740991):0}},function(e,t,n){"use strict";var o=n(239)(!0);n(131)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=o(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){"use strict";function o(e){void 0===e&&(e=(0,a["default"])());try{return e.activeElement}catch(e){}}var r=n(16);t.__esModule=!0,t["default"]=o;var a=r(n(42));e.exports=t["default"]},function(e,t){"use strict";function n(e,t){return e.classList?!!t&&e.classList.contains(t):(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")!==-1}t.__esModule=!0,t["default"]=n,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){var t=(0,l["default"])(e),n=(0,i["default"])(t),o=t&&t.documentElement,r={top:0,left:0,height:0,width:0};if(t)return(0,a["default"])(o,e)?(void 0!==e.getBoundingClientRect&&(r=e.getBoundingClientRect()),r={top:r.top+(n.pageYOffset||o.scrollTop)-(o.clientTop||0),left:r.left+(n.pageXOffset||o.scrollLeft)-(o.clientLeft||0),width:(null==r.width?e.offsetWidth:r.width)||0,height:(null==r.height?e.offsetHeight:r.height)||0}):r}var r=n(16);t.__esModule=!0,t["default"]=o;var a=r(n(43)),i=r(n(65)),l=r(n(42));e.exports=t["default"]},function(e,t,n){"use strict";function o(e,t){var n=(0,a["default"])(e);return void 0===t?n?"pageYOffset"in n?n.pageYOffset:n.document.documentElement.scrollTop:e.scrollTop:void(n?n.scrollTo("pageXOffset"in n?n.pageXOffset:n.document.documentElement.scrollLeft,t):e.scrollTop=t)}var r=n(16);t.__esModule=!0,t["default"]=o;var a=r(n(65));e.exports=t["default"]},function(e,t,n){"use strict";function o(){for(var e,t,n=document.createElement("div").style,o={O:function(e){return"o"+e.toLowerCase()},Moz:function(e){return e.toLowerCase()},Webkit:function(e){return"webkit"+e},ms:function(e){return"MS"+e}},r=Object.keys(o),a="",i=0;i<r.length;i++){var l=r[i];if(l+"TransitionProperty"in n){a="-"+l.toLowerCase(),e=o[l]("TransitionEnd"),t=o[l]("AnimationEnd");break}}return!e&&"transitionProperty"in n&&(e="transitionend"),!t&&"animationName"in n&&(t="animationend"),n=null,{animationEnd:t,transitionEnd:e,prefix:a}}var r=n(16);t.__esModule=!0,t["default"]=t.animationEnd=t.animationDelay=t.animationTiming=t.animationDuration=t.animationName=t.transitionEnd=t.transitionDuration=t.transitionDelay=t.transitionTiming=t.transitionProperty=t.transform=void 0;var a=r(n(33)),i="transform";t.transform=i;var l,u,s;t.animationEnd=s,t.transitionEnd=u;var c,d,f,p;t.transitionDelay=p,t.transitionTiming=f,t.transitionDuration=d,t.transitionProperty=c;var h,m,v,y;if(t.animationDelay=y,t.animationTiming=v,t.animationDuration=m,t.animationName=h,a["default"]){var g=o();l=g.prefix,t.transitionEnd=u=g.transitionEnd,t.animationEnd=s=g.animationEnd,t.transform=i=l+"-"+i,t.transitionProperty=c=l+"-transition-property",t.transitionDuration=d=l+"-transition-duration",t.transitionDelay=p=l+"-transition-delay",t.transitionTiming=f=l+"-transition-timing-function",t.animationName=h=l+"-animation-name",t.animationDuration=m=l+"-animation-duration",t.animationTiming=v=l+"-animation-delay",t.animationDelay=y=l+"-animation-timing-function"}var b={transform:i,end:u,property:c,timing:f,delay:p,duration:d};t["default"]=b},function(e,t,n){"use strict";function o(e){return(0,a["default"])(e.replace(i,"ms-"))}var r=n(16);t.__esModule=!0,t["default"]=o;var a=r(n(268)),i=/^-ms-/;e.exports=t["default"]},function(e,t,n){"use strict";function o(e){if((!a&&0!==a||e)&&i["default"]){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),a=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return a}var r=n(16);t.__esModule=!0,t["default"]=o;var a,i=r(n(33));e.exports=t["default"]},function(e,t,n){"use strict";var o=n(26),r={listen:function(e,t,n){return e.addEventListener?(e.addEventListener(t,n,!1),{remove:function(){e.removeEventListener(t,n,!1)}}):e.attachEvent?(e.attachEvent("on"+t,n),{remove:function(){e.detachEvent("on"+t,n)}}):void 0},capture:function(e,t,n){return e.addEventListener?(e.addEventListener(t,n,!0),{remove:function(){e.removeEventListener(t,n,!0)}}):{remove:o}},registerDefault:function(){}};e.exports=r},function(e,t){"use strict";function n(e){try{e.focus()}catch(e){}}e.exports=n},function(e,t){"use strict";function n(e){if(e=e||("undefined"!=typeof document?document:void 0),"undefined"==typeof e)return null;try{return e.activeElement||e.body}catch(t){return e.body}}e.exports=n},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function r(e){if(c===setTimeout)return setTimeout(e,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function a(e){if(d===clearTimeout)return clearTimeout(e);if((d===o||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function i(){m&&p&&(m=!1,p.length?h=p.concat(h):v=-1,h.length&&l())}function l(){if(!m){var e=r(i);m=!0;for(var t=h.length;t;){for(p=h,h=[];++v<t;)p&&p[v].run();v=-1,t=h.length}p=null,m=!1,a(e)}}function u(e,t){this.fun=e,this.array=t}function s(){}var c,d,f=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(e){c=n}try{d="function"==typeof clearTimeout?clearTimeout:o}catch(e){d=o}}();var p,h=[],m=!1,v=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new u(e,t)),1!==h.length||m||r(l)},u.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=s,f.addListener=s,f.once=s,f.off=s,f.removeListener=s,f.removeAllListeners=s,f.emit=s,f.prependListener=s,f.prependOnceListener=s,f.listeners=function(e){return[]},f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(e,t,n){"use strict";var o=n(286);e.exports=function(e){var t=!1;return o(e,t)}},function(e,t){"use strict";var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";e.exports=n},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(27),C=o(_),E={active:b["default"].bool,
href:b["default"].string,title:b["default"].node,target:b["default"].string},x={active:!1},N=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.active,n=e.href,o=e.title,r=e.target,i=e.className,u=(0,l["default"])(e,["active","href","title","target","className"]),s={href:n,title:o,target:r};return y["default"].createElement("li",{className:(0,m["default"])(i,{active:t})},t?y["default"].createElement("span",u):y["default"].createElement(C["default"],(0,a["default"])({},u,s)))},t}(y["default"].Component);N.propTypes=E,N.defaultProps=x,t["default"]=N,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(19),C=o(_),E=n(348),x=o(E),N={direction:b["default"].oneOf(["prev","next"]),onAnimateOutEnd:b["default"].func,active:b["default"].bool,animateIn:b["default"].bool,animateOut:b["default"].bool,index:b["default"].number},k={active:!1,animateIn:!1,animateOut:!1},w=function(e){function t(n,o){(0,s["default"])(this,t);var r=(0,d["default"])(this,e.call(this,n,o));return r.handleAnimateOutEnd=r.handleAnimateOutEnd.bind(r),r.state={direction:null},r.isUnmounted=!1,r}return(0,p["default"])(t,e),t.prototype.componentWillReceiveProps=function(e){this.props.active!==e.active&&this.setState({direction:null})},t.prototype.componentDidUpdate=function(e){var t=this,n=this.props.active,o=e.active;!n&&o&&x["default"].addEndEventListener(C["default"].findDOMNode(this),this.handleAnimateOutEnd),n!==o&&setTimeout(function(){return t.startAnimation()},20)},t.prototype.componentWillUnmount=function(){this.isUnmounted=!0},t.prototype.handleAnimateOutEnd=function(){this.isUnmounted||this.props.onAnimateOutEnd&&this.props.onAnimateOutEnd(this.props.index)},t.prototype.startAnimation=function(){this.isUnmounted||this.setState({direction:"prev"===this.props.direction?"right":"left"})},t.prototype.render=function(){var e=this.props,t=e.direction,n=e.active,o=e.animateIn,r=e.animateOut,i=e.className,u=(0,l["default"])(e,["direction","active","animateIn","animateOut","className"]);delete u.onAnimateOutEnd,delete u.index;var s={item:!0,active:n&&!o||r};return t&&n&&o&&(s[t]=!0),this.state.direction&&(o||r)&&(s[this.state.direction]=!0),y["default"].createElement("div",(0,a["default"])({},u,{className:(0,m["default"])(i,s)}))},t}(y["default"].Component);w.propTypes=N,w.defaultProps=k,t["default"]=w,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(1),m=o(h),v=n(8),y=o(v),g=n(7),b=o(g),_=n(56),C=o(_),E=n(27),x=o(E),N=n(9),k={noCaret:y["default"].bool,open:y["default"].bool,title:y["default"].string,useAnchor:y["default"].bool},w={open:!1,useAnchor:!1,bsRole:"toggle"},S=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.noCaret,n=e.open,o=e.useAnchor,r=e.bsClass,i=e.className,u=e.children,s=(0,l["default"])(e,["noCaret","open","useAnchor","bsClass","className","children"]);delete s.bsRole;var c=o?x["default"]:C["default"],d=!t;return m["default"].createElement(c,(0,a["default"])({},s,{role:"button",className:(0,b["default"])(i,r),"aria-haspopup":!0,"aria-expanded":n}),u||s.title,d&&" ",d&&m["default"].createElement("span",{className:"caret"}))},t}(m["default"].Component);S.propTypes=k,S.defaultProps=w,t["default"]=(0,N.bsClass)("dropdown-toggle",S),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(13),C=o(_),E=n(9),x={fluid:b["default"].bool,componentClass:C["default"]},N={componentClass:"div",fluid:!1},k=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.fluid,n=e.componentClass,o=e.className,r=(0,l["default"])(e,["fluid","componentClass","className"]),i=(0,E.splitBsProps)(r),u=i[0],s=i[1],c=(0,E.prefix)(u,t&&"fluid");return y["default"].createElement(n,(0,a["default"])({},s,{className:(0,m["default"])(o,c)}))},t}(y["default"].Component);k.propTypes=x,k.defaultProps=N,t["default"]=(0,E.bsClass)("container",k),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(38),a=o(r),i=n(5),l=o(i),u=n(6),s=o(u),c=n(2),d=o(c),f=n(4),p=o(f),h=n(3),m=o(h),v=n(7),y=o(v),g=n(1),b=o(g),_=n(8),C=o(_),E=n(9),x=n(18),N={active:C["default"].any,disabled:C["default"].any,header:C["default"].node,listItem:C["default"].bool,onClick:C["default"].func,href:C["default"].string,type:C["default"].string},k={listItem:!1},w=function(e){function t(){return(0,d["default"])(this,t),(0,p["default"])(this,e.apply(this,arguments))}return(0,m["default"])(t,e),t.prototype.renderHeader=function(e,t){return b["default"].isValidElement(e)?(0,g.cloneElement)(e,{className:(0,y["default"])(e.props.className,t)}):b["default"].createElement("h4",{className:t},e)},t.prototype.render=function(){var e=this.props,t=e.active,n=e.disabled,o=e.className,r=e.header,a=e.listItem,i=e.children,u=(0,s["default"])(e,["active","disabled","className","header","listItem","children"]),c=(0,E.splitBsProps)(u),d=c[0],f=c[1],p=(0,l["default"])({},(0,E.getClassSet)(d),{active:t,disabled:n}),h=void 0;return f.href?h="a":f.onClick?(h="button",f.type=f.type||"button"):h=a?"li":"span",f.className=(0,y["default"])(o,p),r?b["default"].createElement(h,f,this.renderHeader(r,(0,E.prefix)(d,"heading")),b["default"].createElement("p",{className:(0,E.prefix)(d,"text")},i)):b["default"].createElement(h,f,i)},t}(b["default"].Component);w.propTypes=N,w.defaultProps=k,t["default"]=(0,E.bsClass)("list-group-item",(0,E.bsStyles)((0,a["default"])(x.State),w)),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(13),b=o(g),_=n(9),C={componentClass:b["default"]},E={componentClass:"div"},x=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.componentClass,n=e.className,o=(0,l["default"])(e,["componentClass","className"]),r=(0,_.splitBsProps)(o),i=r[0],u=r[1],s=(0,_.getClassSet)(i);return y["default"].createElement(t,(0,a["default"])({},u,{className:(0,m["default"])(n,s)}))},t}(y["default"].Component);x.propTypes=C,x.defaultProps=E,t["default"]=(0,_.bsClass)("modal-body",x),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(13),b=o(g),_=n(9),C={componentClass:b["default"]},E={componentClass:"div"},x=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.componentClass,n=e.className,o=(0,l["default"])(e,["componentClass","className"]),r=(0,_.splitBsProps)(o),i=r[0],u=r[1],s=(0,_.getClassSet)(i);return y["default"].createElement(t,(0,a["default"])({},u,{className:(0,m["default"])(n,s)}))},t}(y["default"].Component);x.propTypes=C,x.defaultProps=E,t["default"]=(0,_.bsClass)("modal-footer",x),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(9),C=n(17),E=o(C),x=n(103),N=o(x),k={closeLabel:b["default"].string,closeButton:b["default"].bool,onHide:b["default"].func},w={closeLabel:"Close",closeButton:!1},S={$bs_modal:b["default"].shape({onHide:b["default"].func})},T=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.closeLabel,n=e.closeButton,o=e.onHide,r=e.className,i=e.children,u=(0,l["default"])(e,["closeLabel","closeButton","onHide","className","children"]),s=this.context.$bs_modal,c=(0,_.splitBsProps)(u),d=c[0],f=c[1],p=(0,_.getClassSet)(d);return y["default"].createElement("div",(0,a["default"])({},f,{className:(0,m["default"])(r,p)}),n&&y["default"].createElement(N["default"],{label:t,onClick:(0,E["default"])(s&&s.onHide,o)}),i)},t}(y["default"].Component);T.propTypes=k,T.defaultProps=w,T.contextTypes=S,t["default"]=(0,_.bsClass)("modal-header",T),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(13),b=o(g),_=n(9),C={componentClass:b["default"]},E={componentClass:"h4"},x=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.componentClass,n=e.className,o=(0,l["default"])(e,["componentClass","className"]),r=(0,_.splitBsProps)(o),i=r[0],u=r[1],s=(0,_.getClassSet)(i);return y["default"].createElement(t,(0,a["default"])({},u,{className:(0,m["default"])(n,s)}))},t}(y["default"].Component);x.propTypes=C,x.defaultProps=E,t["default"]=(0,_.bsClass)("modal-title",x),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(101),y=o(v),g=n(1),b=o(g),_=n(8),C=o(_),E=n(19),x=o(E),N=n(69),k=o(N),w=n(22),S=(o(w),n(9)),T=n(17),O=o(T),M=n(21),P=o(M),D={activeKey:C["default"].any,activeHref:C["default"].string,stacked:C["default"].bool,justified:(0,k["default"])(C["default"].bool,function(e){var t=e.justified,n=e.navbar;return t&&n?Error("justified navbar `Nav`s are not supported"):null}),onSelect:C["default"].func,role:C["default"].string,navbar:C["default"].bool,pullRight:C["default"].bool,pullLeft:C["default"].bool},I={justified:!1,pullRight:!1,pullLeft:!1,stacked:!1},A={$bs_navbar:C["default"].shape({bsClass:C["default"].string,onSelect:C["default"].func}),$bs_tabContainer:C["default"].shape({activeKey:C["default"].any,onSelect:C["default"].func.isRequired,getTabId:C["default"].func.isRequired,getPaneId:C["default"].func.isRequired})},R=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.componentDidUpdate=function(){var e=this;if(this._needsRefocus){this._needsRefocus=!1;var t=this.props.children,n=this.getActiveProps(),o=n.activeKey,r=n.activeHref,a=P["default"].find(t,function(t){return e.isActive(t,o,r)}),i=P["default"].toArray(t),l=i.indexOf(a),u=x["default"].findDOMNode(this).children,s=u&&u[l];s&&s.firstChild&&s.firstChild.focus()}},t.prototype.getActiveProps=function(){var e=this.context.$bs_tabContainer;return e?e:this.props},t.prototype.getNextActiveChild=function(e){var t=this,n=this.props.children,o=n.filter(function(e){return null!=e.props.eventKey&&!e.props.disabled}),r=this.getActiveProps(),a=r.activeKey,i=r.activeHref,l=P["default"].find(n,function(e){return t.isActive(e,a,i)}),u=o.indexOf(l);if(u===-1)return o[0];var s=u+e,c=o.length;return s>=c?s=0:s<0&&(s=c-1),o[s]},t.prototype.getTabProps=function(e,t,n,o,r){var a=this;if(!t&&"tablist"!==n)return null;var i=e.props,l=i.id,u=i["aria-controls"],s=i.eventKey,c=i.role,d=i.onKeyDown,f=i.tabIndex;return t&&(l=t.getTabId(s),u=t.getPaneId(s)),"tablist"===n&&(c=c||"tab",d=(0,O["default"])(function(e){return a.handleTabKeyDown(r,e)},d),f=o?f:-1),{id:l,role:c,onKeyDown:d,"aria-controls":u,tabIndex:f}},t.prototype.handleTabKeyDown=function(e,t){var n=void 0;switch(t.keyCode){case y["default"].codes.left:case y["default"].codes.up:n=this.getNextActiveChild(-1);break;case y["default"].codes.right:case y["default"].codes.down:n=this.getNextActiveChild(1);break;default:return}t.preventDefault(),e&&n&&null!=n.props.eventKey&&e(n.props.eventKey),this._needsRefocus=!0},t.prototype.isActive=function(e,t,n){var o=e.props;return!!(o.active||null!=t&&o.eventKey===t||n&&o.href===n)||o.active},t.prototype.render=function(){var e,t=this,n=this.props,o=n.stacked,r=n.justified,i=n.onSelect,u=n.role,s=n.navbar,c=n.pullRight,d=n.pullLeft,f=n.className,p=n.children,h=(0,l["default"])(n,["stacked","justified","onSelect","role","navbar","pullRight","pullLeft","className","children"]),v=this.context.$bs_tabContainer,y=u||(v?"tablist":null),_=this.getActiveProps(),C=_.activeKey,E=_.activeHref;delete h.activeKey,delete h.activeHref;var x=(0,S.splitBsProps)(h),N=x[0],k=x[1],w=(0,a["default"])({},(0,S.getClassSet)(N),(e={},e[(0,S.prefix)(N,"stacked")]=o,e[(0,S.prefix)(N,"justified")]=r,e)),T=null!=s?s:this.context.$bs_navbar,M=void 0,D=void 0;if(T){var I=this.context.$bs_navbar||{bsClass:"navbar"};w[(0,S.prefix)(I,"nav")]=!0,D=(0,S.prefix)(I,"right"),M=(0,S.prefix)(I,"left")}else D="pull-right",M="pull-left";return w[D]=c,w[M]=d,b["default"].createElement("ul",(0,a["default"])({},k,{role:y,className:(0,m["default"])(f,w)}),P["default"].map(p,function(e){var n=t.isActive(e,C,E),o=(0,O["default"])(e.props.onSelect,i,T&&T.onSelect,v&&v.onSelect);return(0,g.cloneElement)(e,(0,a["default"])({},t.getTabProps(e,v,y,n,o),{active:n,activeKey:C,activeHref:E,onSelect:o}))}))},t}(b["default"].Component);R.propTypes=D,R.defaultProps=I,R.contextTypes=A,t["default"]=(0,S.bsClass)("nav",(0,S.bsStyles)(["tabs","pills"],R)),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(27),C=o(_),E=n(17),x=o(E),N={active:b["default"].bool,disabled:b["default"].bool,role:b["default"].string,href:b["default"].string,onClick:b["default"].func,onSelect:b["default"].func,eventKey:b["default"].any},k={active:!1,disabled:!1},w=function(e){function t(n,o){(0,s["default"])(this,t);var r=(0,d["default"])(this,e.call(this,n,o));return r.handleClick=r.handleClick.bind(r),r}return(0,p["default"])(t,e),t.prototype.handleClick=function(e){this.props.onSelect&&(e.preventDefault(),this.props.disabled||this.props.onSelect(this.props.eventKey,e))},t.prototype.render=function(){var e=this.props,t=e.active,n=e.disabled,o=e.onClick,r=e.className,i=e.style,u=(0,l["default"])(e,["active","disabled","onClick","className","style"]);return delete u.onSelect,delete u.eventKey,delete u.activeKey,delete u.activeHref,u.role?"tab"===u.role&&(u["aria-selected"]=t):"#"===u.href&&(u.role="button"),y["default"].createElement("li",{role:"presentation",className:(0,m["default"])(r,{active:t,disabled:n}),style:i},y["default"].createElement(C["default"],(0,a["default"])({},u,{disabled:n,onClick:(0,x["default"])(o,this.handleClick)})))},t}(y["default"].Component);w.propTypes=N,w.defaultProps=k,t["default"]=w,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(9),C={$bs_navbar:b["default"].shape({bsClass:b["default"].string})},E=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=e.children,o=(0,l["default"])(e,["className","children"]),r=this.context.$bs_navbar||{bsClass:"navbar"},i=(0,_.prefix)(r,"brand");return y["default"].isValidElement(n)?y["default"].cloneElement(n,{className:(0,m["default"])(n.props.className,t,i)}):y["default"].createElement("span",(0,a["default"])({},o,{className:(0,m["default"])(t,i)}),n)},t}(y["default"].Component);E.contextTypes=C,t["default"]=E,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(6),a=o(r),i=n(2),l=o(i),u=n(4),s=o(u),c=n(3),d=o(c),f=n(5),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(419),C=o(_),E=n(13),x=o(E),N=n(74),k=o(N),w=(0,p["default"])({},C["default"].propTypes,{show:b["default"].bool,rootClose:b["default"].bool,onHide:b["default"].func,animation:b["default"].oneOfType([b["default"].bool,x["default"]]),onEnter:b["default"].func,onEntering:b["default"].func,onEntered:b["default"].func,onExit:b["default"].func,onExiting:b["default"].func,onExited:b["default"].func,placement:b["default"].oneOf(["top","right","bottom","left"])}),S={animation:k["default"],rootClose:!1,show:!1,placement:"right"},T=function(e){function t(){return(0,l["default"])(this,t),(0,s["default"])(this,e.apply(this,arguments))}return(0,d["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.animation,n=e.children,o=(0,a["default"])(e,["animation","children"]),r=t===!0?k["default"]:t||null,i=void 0;return i=r?n:(0,v.cloneElement)(n,{className:(0,m["default"])(n.props.className,"in")}),y["default"].createElement(C["default"],(0,p["default"])({},o,{transition:r}),i)},t}(y["default"].Component);T.propTypes=w,T.defaultProps=S,t["default"]=T,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(27),C=o(_),E=n(17),x=o(E),N={disabled:b["default"].bool,previous:b["default"].bool,next:b["default"].bool,onClick:b["default"].func,onSelect:b["default"].func,eventKey:b["default"].any},k={disabled:!1,previous:!1,next:!1},w=function(e){function t(n,o){(0,s["default"])(this,t);var r=(0,d["default"])(this,e.call(this,n,o));return r.handleSelect=r.handleSelect.bind(r),r}return(0,p["default"])(t,e),t.prototype.handleSelect=function(e){var t=this.props,n=t.disabled,o=t.onSelect,r=t.eventKey;(o||n)&&e.preventDefault(),n||o&&o(r,e)},t.prototype.render=function(){var e=this.props,t=e.disabled,n=e.previous,o=e.next,r=e.onClick,i=e.className,u=e.style,s=(0,l["default"])(e,["disabled","previous","next","onClick","className","style"]);return delete s.onSelect,delete s.eventKey,y["default"].createElement("li",{className:(0,m["default"])(i,{disabled:t,previous:n,next:o}),style:u},y["default"].createElement(C["default"],(0,a["default"])({},s,{disabled:t,onClick:(0,x["default"])(r,this.handleSelect)})))},t}(y["default"].Component);w.propTypes=N,w.defaultProps=k,t["default"]=w,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(13),C=o(_),E=n(27),x=o(E),N=n(17),k=o(N),w={componentClass:C["default"],className:b["default"].string,eventKey:b["default"].any,onSelect:b["default"].func,disabled:b["default"].bool,active:b["default"].bool,onClick:b["default"].func},S={componentClass:x["default"],active:!1,disabled:!1},T=function(e){function t(n,o){(0,s["default"])(this,t);var r=(0,d["default"])(this,e.call(this,n,o));return r.handleClick=r.handleClick.bind(r),r}return(0,p["default"])(t,e),t.prototype.handleClick=function(e){var t=this.props,n=t.disabled,o=t.onSelect,r=t.eventKey;n||o&&o(r,e)},t.prototype.render=function(){var e=this.props,t=e.componentClass,n=e.active,o=e.disabled,r=e.onClick,i=e.className,u=e.style,s=(0,l["default"])(e,["componentClass","active","disabled","onClick","className","style"]);return t===x["default"]&&delete s.eventKey,delete s.onSelect,y["default"].createElement("li",{className:(0,m["default"])(i,{active:n,disabled:o}),style:u},y["default"].createElement(t,(0,a["default"])({},s,{disabled:o,onClick:(0,k["default"])(r,this.handleClick)})))},t}(y["default"].Component);T.propTypes=w,T.defaultProps=S,t["default"]=T,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(126),l=o(i),u=n(6),s=o(u),c=n(2),d=o(c),f=n(4),p=o(f),h=n(3),m=o(h),v=n(7),y=o(v),g=n(1),b=o(g),_=n(8),C=o(_),E=n(9),x=n(17),N=o(x),k=n(21),w=o(k),S={accordion:C["default"].bool,activeKey:C["default"].any,defaultActiveKey:C["default"].any,onSelect:C["default"].func,role:C["default"].string},T={accordion:!1},O=function(e){function t(n,o){(0,d["default"])(this,t);var r=(0,p["default"])(this,e.call(this,n,o));return r.handleSelect=r.handleSelect.bind(r),r.state={activeKey:n.defaultActiveKey},r}return(0,m["default"])(t,e),t.prototype.handleSelect=function(e,t){t.preventDefault(),this.props.onSelect&&this.props.onSelect(e,t),this.state.activeKey===e&&(e=null),this.setState({activeKey:e})},t.prototype.render=function(){var e=this,t=this.props,n=t.accordion,o=t.activeKey,r=t.className,i=t.children,u=(0,s["default"])(t,["accordion","activeKey","className","children"]),c=(0,E.splitBsPropsAndOmit)(u,["defaultActiveKey","onSelect"]),d=c[0],f=c[1],p=void 0;n&&(p=null!=o?o:this.state.activeKey,f.role=f.role||"tablist");var h=(0,E.getClassSet)(d);return b["default"].createElement("div",(0,a["default"])({},f,{className:(0,y["default"])(r,h)}),w["default"].map(i,function(t){var o={bsStyle:t.props.bsStyle||d.bsStyle};return n&&(0,l["default"])(o,{headerRole:"tab",panelRole:"tabpanel",collapsible:!0,expanded:t.props.eventKey===p,onSelect:(0,N["default"])(e.handleSelect,t.props.onSelect)}),(0,g.cloneElement)(t,o)}))},t}(b["default"].Component);O.propTypes=S,O.defaultProps=T,t["default"]=(0,E.bsClass)("panel-group",O),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(13),C=o(_),E=n(22),x=(o(E),n(9)),N=n(17),k=o(N),w=n(74),S=o(w),T={eventKey:b["default"].any,animation:b["default"].oneOfType([b["default"].bool,C["default"]]),id:b["default"].string,"aria-labelledby":b["default"].string,bsClass:b["default"].string,onEnter:b["default"].func,onEntering:b["default"].func,onEntered:b["default"].func,onExit:b["default"].func,onExiting:b["default"].func,onExited:b["default"].func,mountOnEnter:b["default"].bool,unmountOnExit:b["default"].bool},O={$bs_tabContainer:b["default"].shape({getTabId:b["default"].func,getPaneId:b["default"].func}),$bs_tabContent:b["default"].shape({bsClass:b["default"].string,animation:b["default"].oneOfType([b["default"].bool,C["default"]]),activeKey:b["default"].any,mountOnEnter:b["default"].bool,unmountOnExit:b["default"].bool,onPaneEnter:b["default"].func.isRequired,onPaneExited:b["default"].func.isRequired,exiting:b["default"].bool.isRequired})},M={$bs_tabContainer:b["default"].oneOf([null])},P=function(e){function t(n,o){(0,s["default"])(this,t);var r=(0,d["default"])(this,e.call(this,n,o));return r.handleEnter=r.handleEnter.bind(r),r.handleExited=r.handleExited.bind(r),r["in"]=!1,r}return(0,p["default"])(t,e),t.prototype.getChildContext=function(){return{$bs_tabContainer:null}},t.prototype.componentDidMount=function(){this.shouldBeIn()&&this.handleEnter()},t.prototype.componentDidUpdate=function(){this["in"]?this.shouldBeIn()||this.handleExited():this.shouldBeIn()&&this.handleEnter()},t.prototype.componentWillUnmount=function(){this["in"]&&this.handleExited()},t.prototype.getAnimation=function(){if(null!=this.props.animation)return this.props.animation;var e=this.context.$bs_tabContent;return e&&e.animation},t.prototype.handleEnter=function(){var e=this.context.$bs_tabContent;e&&(this["in"]=e.onPaneEnter(this,this.props.eventKey))},t.prototype.handleExited=function(){var e=this.context.$bs_tabContent;e&&(e.onPaneExited(this),this["in"]=!1)},t.prototype.isActive=function(){var e=this.context.$bs_tabContent,t=e&&e.activeKey;return this.props.eventKey===t},t.prototype.shouldBeIn=function(){return this.getAnimation()&&this.isActive()},t.prototype.render=function(){var e=this.props,t=e.eventKey,n=e.className,o=e.onEnter,r=e.onEntering,i=e.onEntered,u=e.onExit,s=e.onExiting,c=e.onExited,d=e.mountOnEnter,f=e.unmountOnExit,p=(0,l["default"])(e,["eventKey","className","onEnter","onEntering","onEntered","onExit","onExiting","onExited","mountOnEnter","unmountOnExit"]),h=this.context,v=h.$bs_tabContent,g=h.$bs_tabContainer,b=(0,x.splitBsPropsAndOmit)(p,["animation"]),_=b[0],C=b[1],E=this.isActive(),N=this.getAnimation(),w=null!=d?d:v&&v.mountOnEnter,T=null!=f?f:v&&v.unmountOnExit;if(!E&&!N&&T)return null;var O=N===!0?S["default"]:N||null;v&&(_.bsClass=(0,x.prefix)(v,"pane"));var M=(0,a["default"])({},(0,x.getClassSet)(_),{active:E});g&&(C.id=g.getPaneId(t),C["aria-labelledby"]=g.getTabId(t));var P=y["default"].createElement("div",(0,a["default"])({},C,{role:"tabpanel","aria-hidden":!E,className:(0,m["default"])(n,M)}));if(O){var D=v&&v.exiting;return y["default"].createElement(O,{"in":E&&!D,onEnter:(0,k["default"])(this.handleEnter,o),onEntering:r,onEntered:i,onExit:u,onExiting:s,onExited:(0,k["default"])(this.handleExited,c),mountOnEnter:w,unmountOnExit:T},P)}return P},t}(y["default"].Component);P.propTypes=T,P.contextTypes=O,P.childContextTypes=M,t["default"]=(0,x.bsClass)("tab-pane",P),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(8),m=o(h),v=n(1),y=o(v),g=n(56),b=o(g),_={type:m["default"].oneOf(["checkbox","radio"]),name:m["default"].string,checked:m["default"].bool,disabled:m["default"].bool,onChange:m["default"].func,value:m["default"].any.isRequired},C=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.children,n=e.name,o=e.checked,r=e.type,i=e.onChange,u=e.value,s=(0,l["default"])(e,["children","name","checked","type","onChange","value"]),c=s.disabled;return y["default"].createElement(b["default"],(0,a["default"])({},s,{active:!!o,componentClass:"label"}),y["default"].createElement("input",{name:n,type:r,autoComplete:"off",value:u,checked:!!o,disabled:!!c,onChange:i}),t)},t}(y["default"].Component);C.propTypes=_,t["default"]=C,e.exports=t["default"]},function(e,t){"use strict";function n(e){return""+e.charAt(0).toUpperCase()+e.slice(1)}t.__esModule=!0,t["default"]=n,e.exports=t["default"]},function(e,t){"use strict";function n(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}var o={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},r=["Webkit","ms","Moz","O"];Object.keys(o).forEach(function(e){r.forEach(function(t){o[n(t,e)]=o[e]})});var a={background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}},i={isUnitlessNumber:o,shorthandPropertyExpansions:a};e.exports=i},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=n(11),a=n(37),i=(n(10),function(){function e(t){o(this,e),this._callbacks=null,this._contexts=null,this._arg=t}return e.prototype.enqueue=function(e,t){this._callbacks=this._callbacks||[],this._callbacks.push(e),this._contexts=this._contexts||[],this._contexts.push(t)},e.prototype.notifyAll=function(){var e=this._callbacks,t=this._contexts,n=this._arg;if(e&&t){e.length!==t.length?r("24"):void 0,this._callbacks=null,this._contexts=null;for(var o=0;o<e.length;o++)e[o].call(t[o],n);e.length=0,t.length=0}},e.prototype.checkpoint=function(){return this._callbacks?this._callbacks.length:0},e.prototype.rollback=function(e){this._callbacks&&this._contexts&&(this._callbacks.length=e,this._contexts.length=e)},e.prototype.reset=function(){this._callbacks=null,this._contexts=null},e.prototype.destructor=function(){this.reset()},e}());e.exports=a.addPoolingTo(i)},function(e,t,n){"use strict";function o(e){return!!s.hasOwnProperty(e)||!u.hasOwnProperty(e)&&(l.test(e)?(s[e]=!0,!0):(u[e]=!0,!1))}function r(e,t){return null==t||e.hasBooleanValue&&!t||e.hasNumericValue&&isNaN(t)||e.hasPositiveNumericValue&&t<1||e.hasOverloadedBooleanValue&&t===!1}var a=n(45),i=(n(15),n(23),n(412)),l=(n(12),new RegExp("^["+a.ATTRIBUTE_NAME_START_CHAR+"]["+a.ATTRIBUTE_NAME_CHAR+"]*$")),u={},s={},c={createMarkupForID:function(e){return a.ID_ATTRIBUTE_NAME+"="+i(e)},setAttributeForID:function(e,t){e.setAttribute(a.ID_ATTRIBUTE_NAME,t)},createMarkupForRoot:function(){return a.ROOT_ATTRIBUTE_NAME+'=""'},setAttributeForRoot:function(e){e.setAttribute(a.ROOT_ATTRIBUTE_NAME,"")},createMarkupForProperty:function(e,t){var n=a.properties.hasOwnProperty(e)?a.properties[e]:null;if(n){if(r(n,t))return"";var o=n.attributeName;return n.hasBooleanValue||n.hasOverloadedBooleanValue&&t===!0?o+'=""':o+"="+i(t)}return a.isCustomAttribute(e)?null==t?"":e+"="+i(t):null},createMarkupForCustomAttribute:function(e,t){return o(e)&&null!=t?e+"="+i(t):""},setValueForProperty:function(e,t,n){var o=a.properties.hasOwnProperty(t)?a.properties[t]:null;if(o){var i=o.mutationMethod;if(i)i(e,n);else{if(r(o,n))return void this.deleteValueForProperty(e,t);if(o.mustUseProperty)e[o.propertyName]=n;else{var l=o.attributeName,u=o.attributeNamespace;u?e.setAttributeNS(u,l,""+n):o.hasBooleanValue||o.hasOverloadedBooleanValue&&n===!0?e.setAttribute(l,""):e.setAttribute(l,""+n)}}}else if(a.isCustomAttribute(t))return void c.setValueForAttribute(e,t,n)},setValueForAttribute:function(e,t,n){o(t)&&(null==n?e.removeAttribute(t):e.setAttribute(t,""+n))},deleteValueForAttribute:function(e,t){e.removeAttribute(t)},deleteValueForProperty:function(e,t){var n=a.properties.hasOwnProperty(t)?a.properties[t]:null;if(n){var o=n.mutationMethod;if(o)o(e,void 0);else if(n.mustUseProperty){var r=n.propertyName;n.hasBooleanValue?e[r]=!1:e[r]=""}else e.removeAttribute(n.attributeName)}else a.isCustomAttribute(t)&&e.removeAttribute(t)}};e.exports=c},function(e,t){"use strict";var n={hasCachedChildNodes:1};e.exports=n},function(e,t,n){"use strict";function o(){if(this._rootNodeID&&this._wrapperState.pendingUpdate){this._wrapperState.pendingUpdate=!1;var e=this._currentElement.props,t=l.getValue(e);null!=t&&r(this,Boolean(e.multiple),t)}}function r(e,t,n){var o,r,a=u.getNodeFromInstance(e).options;if(t){for(o={},r=0;r<n.length;r++)o[""+n[r]]=!0;for(r=0;r<a.length;r++){
var i=o.hasOwnProperty(a[r].value);a[r].selected!==i&&(a[r].selected=i)}}else{for(o=""+n,r=0;r<a.length;r++)if(a[r].value===o)return void(a[r].selected=!0);a.length&&(a[0].selected=!0)}}function a(e){var t=this._currentElement.props,n=l.executeOnChange(t,e);return this._rootNodeID&&(this._wrapperState.pendingUpdate=!0),s.asap(o,this),n}var i=n(14),l=n(114),u=n(15),s=n(28),c=(n(12),!1),d={getHostProps:function(e,t){return i({},t,{onChange:e._wrapperState.onChange,value:void 0})},mountWrapper:function(e,t){var n=l.getValue(t);e._wrapperState={pendingUpdate:!1,initialValue:null!=n?n:t.defaultValue,listeners:null,onChange:a.bind(e),wasMultiple:Boolean(t.multiple)},void 0===t.value||void 0===t.defaultValue||c||(c=!0)},getSelectValueContext:function(e){return e._wrapperState.initialValue},postUpdateWrapper:function(e){var t=e._currentElement.props;e._wrapperState.initialValue=void 0;var n=e._wrapperState.wasMultiple;e._wrapperState.wasMultiple=Boolean(t.multiple);var o=l.getValue(t);null!=o?(e._wrapperState.pendingUpdate=!1,r(e,Boolean(t.multiple),o)):n!==Boolean(t.multiple)&&(null!=t.defaultValue?r(e,Boolean(t.multiple),t.defaultValue):r(e,Boolean(t.multiple),t.multiple?[]:""))}};e.exports=d},function(e,t){"use strict";var n,o={injectEmptyComponentFactory:function(e){n=e}},r={create:function(e){return n(e)}};r.injection=o,e.exports=r},function(e,t){"use strict";var n={logTopLevelRenders:!1};e.exports=n},function(e,t,n){"use strict";function o(e){return l?void 0:i("111",e.type),new l(e)}function r(e){return new u(e)}function a(e){return e instanceof u}var i=n(11),l=(n(10),null),u=null,s={injectGenericComponentClass:function(e){l=e},injectTextComponentClass:function(e){u=e}},c={createInternalComponent:o,createInstanceForText:r,isTextComponent:a,injection:s};e.exports=c},function(e,t,n){"use strict";function o(e){return a(document.documentElement,e)}var r=n(372),a=n(273),i=n(147),l=n(148),u={hasSelectionCapabilities:function(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&"text"===e.type||"textarea"===t||"true"===e.contentEditable)},getSelectionInformation:function(){var e=l();return{focusedElem:e,selectionRange:u.hasSelectionCapabilities(e)?u.getSelection(e):null}},restoreSelection:function(e){var t=l(),n=e.focusedElem,r=e.selectionRange;t!==n&&o(n)&&(u.hasSelectionCapabilities(n)&&u.setSelection(n,r),i(n))},getSelection:function(e){var t;if("selectionStart"in e)t={start:e.selectionStart,end:e.selectionEnd};else if(document.selection&&e.nodeName&&"input"===e.nodeName.toLowerCase()){var n=document.selection.createRange();n.parentElement()===e&&(t={start:-n.moveStart("character",-e.value.length),end:-n.moveEnd("character",-e.value.length)})}else t=r.getOffsets(e);return t||{start:0,end:0}},setSelection:function(e,t){var n=t.start,o=t.end;if(void 0===o&&(o=n),"selectionStart"in e)e.selectionStart=n,e.selectionEnd=Math.min(o,e.value.length);else if(document.selection&&e.nodeName&&"input"===e.nodeName.toLowerCase()){var a=e.createTextRange();a.collapse(!0),a.moveStart("character",n),a.moveEnd("character",o-n),a.select()}else r.setOffsets(e,t)}};e.exports=u},function(e,t,n){"use strict";function o(e,t){for(var n=Math.min(e.length,t.length),o=0;o<n;o++)if(e.charAt(o)!==t.charAt(o))return o;return e.length===t.length?-1:n}function r(e){return e?e.nodeType===A?e.documentElement:e.firstChild:null}function a(e){return e.getAttribute&&e.getAttribute(P)||""}function i(e,t,n,o,r){var a;if(C.logTopLevelRenders){var i=e._currentElement.props.child,l=i.type;a="React mount: "+("string"==typeof l?l:l.displayName||l.name),console.time(a)}var u=N.mountComponent(e,n,null,b(e,t),r,0);a&&console.timeEnd(a),e._renderedComponent._topLevelWrapper=e,U._mountImageIntoNode(u,t,e,o,n)}function l(e,t,n,o){var r=w.ReactReconcileTransaction.getPooled(!n&&_.useCreateElement);r.perform(i,null,e,t,r,n,o),w.ReactReconcileTransaction.release(r)}function u(e,t,n){for(N.unmountComponent(e,n),t.nodeType===A&&(t=t.documentElement);t.lastChild;)t.removeChild(t.lastChild)}function s(e){var t=r(e);if(t){var n=g.getInstanceFromNode(t);return!(!n||!n._hostParent)}}function c(e){return!(!e||e.nodeType!==I&&e.nodeType!==A&&e.nodeType!==R)}function d(e){var t=r(e),n=t&&g.getInstanceFromNode(t);return n&&!n._hostParent?n:null}function f(e){var t=d(e);return t?t._hostContainerInfo._topLevelWrapper:null}var p=n(11),h=n(44),m=n(45),v=n(48),y=n(77),g=(n(30),n(15)),b=n(366),_=n(368),C=n(177),E=n(59),x=(n(23),n(382)),N=n(46),k=n(117),w=n(28),S=n(67),T=n(188),O=(n(10),n(81)),M=n(123),P=(n(12),m.ID_ATTRIBUTE_NAME),D=m.ROOT_ATTRIBUTE_NAME,I=1,A=9,R=11,L={},j=1,B=function(){this.rootID=j++};B.prototype.isReactComponent={},B.prototype.render=function(){return this.props.child},B.isReactTopLevelWrapper=!0;var U={TopLevelWrapper:B,_instancesByReactRootID:L,scrollMonitor:function(e,t){t()},_updateRootComponent:function(e,t,n,o,r){return U.scrollMonitor(o,function(){k.enqueueElementInternal(e,t,n),r&&k.enqueueCallbackInternal(e,r)}),e},_renderNewRootComponent:function(e,t,n,o){c(t)?void 0:p("37"),y.ensureScrollValueMonitoring();var r=T(e,!1);w.batchedUpdates(l,r,t,n,o);var a=r._instance.rootID;return L[a]=r,r},renderSubtreeIntoContainer:function(e,t,n,o){return null!=e&&E.has(e)?void 0:p("38"),U._renderSubtreeIntoContainer(e,t,n,o)},_renderSubtreeIntoContainer:function(e,t,n,o){k.validateCallback(o,"ReactDOM.render"),v.isValidElement(t)?void 0:p("39","string"==typeof t?" Instead of passing a string like 'div', pass React.createElement('div') or <div />.":"function"==typeof t?" Instead of passing a class like Foo, pass React.createElement(Foo) or <Foo />.":null!=t&&void 0!==t.props?" This may be caused by unintentionally loading two independent copies of React.":"");var i,l=v.createElement(B,{child:t});if(e){var u=E.get(e);i=u._processChildContext(u._context)}else i=S;var c=f(n);if(c){var d=c._currentElement,h=d.props.child;if(M(h,t)){var m=c._renderedComponent.getPublicInstance(),y=o&&function(){o.call(m)};return U._updateRootComponent(c,l,i,n,y),m}U.unmountComponentAtNode(n)}var g=r(n),b=g&&!!a(g),_=s(n),C=b&&!c&&!_,x=U._renderNewRootComponent(l,n,C,i)._renderedComponent.getPublicInstance();return o&&o.call(x),x},render:function(e,t,n){return U._renderSubtreeIntoContainer(null,e,t,n)},unmountComponentAtNode:function(e){c(e)?void 0:p("40");var t=f(e);return t?(delete L[t._instance.rootID],w.batchedUpdates(u,t,e,!1),!0):(s(e),1===e.nodeType&&e.hasAttribute(D),!1)},_mountImageIntoNode:function(e,t,n,a,i){if(c(t)?void 0:p("41"),a){var l=r(t);if(x.canReuseMarkup(e,l))return void g.precacheNode(n,l);var u=l.getAttribute(x.CHECKSUM_ATTR_NAME);l.removeAttribute(x.CHECKSUM_ATTR_NAME);var s=l.outerHTML;l.setAttribute(x.CHECKSUM_ATTR_NAME,u);var d=e,f=o(d,s),m=" (client) "+d.substring(f-20,f+20)+"\n (server) "+s.substring(f-20,f+20);t.nodeType===A?p("42",m):void 0}if(t.nodeType===A?p("43"):void 0,i.useCreateElement){for(;t.lastChild;)t.removeChild(t.lastChild);h.insertTreeBefore(t,e,null)}else O(t,e),g.precacheNode(n,t.firstChild)}};e.exports=U},function(e,t,n){"use strict";var o=n(11),r=n(48),a=(n(10),{HOST:0,COMPOSITE:1,EMPTY:2,getType:function(e){return null===e||e===!1?a.EMPTY:r.isValidElement(e)?"function"==typeof e.type?a.COMPOSITE:a.HOST:void o("26",e)}});e.exports=a},function(e,t){"use strict";var n={currentScrollLeft:0,currentScrollTop:0,refreshScrollValues:function(e){n.currentScrollLeft=e.x,n.currentScrollTop=e.y}};e.exports=n},function(e,t,n){"use strict";function o(e,t){return null==t?r("30"):void 0,null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}var r=n(11);n(10),e.exports=o},function(e,t){"use strict";function n(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}e.exports=n},function(e,t,n){"use strict";function o(e){for(var t;(t=e._renderedNodeType)===r.COMPOSITE;)e=e._renderedComponent;return t===r.HOST?e._renderedComponent:t===r.EMPTY?null:void 0}var r=n(181);e.exports=o},function(e,t,n){"use strict";function o(){return!a&&r.canUseDOM&&(a="textContent"in document.documentElement?"textContent":"innerText"),a}var r=n(20),a=null;e.exports=o},function(e,t,n){"use strict";function o(e){var t=e.type,n=e.nodeName;return n&&"input"===n.toLowerCase()&&("checkbox"===t||"radio"===t)}function r(e){return e._wrapperState.valueTracker}function a(e,t){e._wrapperState.valueTracker=t}function i(e){e._wrapperState.valueTracker=null}function l(e){var t;return e&&(t=o(e)?""+e.checked:e.value),t}var u=n(15),s={_getTrackerFromNode:function(e){return r(u.getInstanceFromNode(e))},track:function(e){if(!r(e)){var t=u.getNodeFromInstance(e),n=o(t)?"checked":"value",l=Object.getOwnPropertyDescriptor(t.constructor.prototype,n),s=""+t[n];t.hasOwnProperty(n)||"function"!=typeof l.get||"function"!=typeof l.set||(Object.defineProperty(t,n,{enumerable:l.enumerable,configurable:!0,get:function(){return l.get.call(this)},set:function(e){s=""+e,l.set.call(this,e)}}),a(e,{getValue:function(){return s},setValue:function(e){s=""+e},stopTracking:function(){i(e),delete t[n]}}))}},updateValueIfChanged:function(e){if(!e)return!1;var t=r(e);if(!t)return s.track(e),!0;var n=t.getValue(),o=l(u.getNodeFromInstance(e));return o!==n&&(t.setValue(o),!0)},stopTracking:function(e){var t=r(e);t&&t.stopTracking()}};e.exports=s},function(e,t,n){"use strict";function o(e){if(e){var t=e.getName();if(t)return" Check the render method of `"+t+"`."}return""}function r(e){return"function"==typeof e&&"undefined"!=typeof e.prototype&&"function"==typeof e.prototype.mountComponent&&"function"==typeof e.prototype.receiveComponent}function a(e,t){var n;if(null===e||e===!1)n=s.create(a);else if("object"==typeof e){var l=e,u=l.type;if("function"!=typeof u&&"string"!=typeof u){var f="";f+=o(l._owner),i("130",null==u?u:typeof u,f)}"string"==typeof l.type?n=c.createInternalComponent(l):r(l.type)?(n=new l.type(l),n.getHostNode||(n.getHostNode=n.getNativeNode)):n=new d(l)}else"string"==typeof e||"number"==typeof e?n=c.createInstanceForText(e):i("131",typeof e);return n._mountIndex=0,n._mountImage=null,n}var i=n(11),l=n(14),u=n(363),s=n(176),c=n(178),d=(n(433),n(10),n(12),function(e){this.construct(e)});l(d.prototype,u,{_instantiateReactComponent:a}),e.exports=a},function(e,t){"use strict";function n(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!o[e.type]:"textarea"===t}var o={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};e.exports=n},function(e,t,n){"use strict";var o=n(20),r=n(80),a=n(81),i=function(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t};o.canUseDOM&&("textContent"in document.documentElement||(i=function(e,t){return 3===e.nodeType?void(e.nodeValue=t):void a(e,r(t))})),e.exports=i},function(e,t,n){"use strict";function o(e,t){return e&&"object"==typeof e&&null!=e.key?s.escape(e.key):t.toString(36)}function r(e,t,n,a){var f=typeof e;if("undefined"!==f&&"boolean"!==f||(e=null),null===e||"string"===f||"number"===f||"object"===f&&e.$$typeof===l)return n(a,e,""===t?c+o(e,0):t),1;var p,h,m=0,v=""===t?c:t+d;if(Array.isArray(e))for(var y=0;y<e.length;y++)p=e[y],h=v+o(p,y),m+=r(p,h,n,a);else{var g=u(e);if(g){var b,_=g.call(e);if(g!==e.entries)for(var C=0;!(b=_.next()).done;)p=b.value,h=v+o(p,C++),m+=r(p,h,n,a);else for(;!(b=_.next()).done;){var E=b.value;E&&(p=E[1],h=v+s.escape(E[0])+d+o(p,0),m+=r(p,h,n,a))}}else if("object"===f){var x="",N=String(e);i("31","[object Object]"===N?"object with keys {"+Object.keys(e).join(", ")+"}":N,x)}}return m}function a(e,t,n){return null==e?0:r(e,"",t,n)}var i=n(11),l=(n(30),n(378)),u=n(409),s=(n(10),n(113)),c=(n(12),"."),d=":";e.exports=a},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var l=n(8),u=o(l),s=n(70),c=o(s),d=n(1),f=o(d),p=n(19),h=o(p),m=n(82),v=o(m),y=n(47),g=o(y),b=n(416),_=o(b),C=function(e){function t(){var n,o,i;r(this,t);for(var l=arguments.length,u=Array(l),s=0;s<l;s++)u[s]=arguments[s];return n=o=a(this,e.call.apply(e,[this].concat(u))),o.setContainer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.props;o._portalContainerNode=(0,v["default"])(e.container,(0,g["default"])(o).body)},o.getMountNode=function(){return o._portalContainerNode},i=n,a(o,i)}return i(t,e),t.prototype.componentDidMount=function(){this.setContainer(),this.forceUpdate(this.props.onRendered)},t.prototype.componentWillReceiveProps=function(e){e.container!==this.props.container&&this.setContainer(e)},t.prototype.componentWillUnmount=function(){this._portalContainerNode=null},t.prototype.render=function(){return this.props.children&&this._portalContainerNode?h["default"].createPortal(this.props.children,this._portalContainerNode):null},t}(f["default"].Component);C.displayName="Portal",C.propTypes={container:u["default"].oneOfType([c["default"],u["default"].func]),onRendered:u["default"].func},t["default"]=h["default"].createPortal?C:_["default"],e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){return 0===e.button}function u(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}t.__esModule=!0;var s=n(43),c=o(s),d=n(8),f=o(d),p=n(1),h=o(p),m=n(19),v=o(m),y=n(195),g=o(y),b=n(47),_=o(b),C=27,E=function(e){function t(n,o){r(this,t);var i=a(this,e.call(this,n,o));return i.addEventListeners=function(){var e=i.props.event,t=(0,_["default"])(i);i.documentMouseCaptureListener=(0,g["default"])(t,e,i.handleMouseCapture,!0),i.documentMouseListener=(0,g["default"])(t,e,i.handleMouse),i.documentKeyupListener=(0,g["default"])(t,"keyup",i.handleKeyUp)},i.removeEventListeners=function(){i.documentMouseCaptureListener&&i.documentMouseCaptureListener.remove(),i.documentMouseListener&&i.documentMouseListener.remove(),i.documentKeyupListener&&i.documentKeyupListener.remove()},i.handleMouseCapture=function(e){i.preventMouseRootClose=u(e)||!l(e)||(0,c["default"])(v["default"].findDOMNode(i),e.target)},i.handleMouse=function(e){!i.preventMouseRootClose&&i.props.onRootClose&&i.props.onRootClose(e)},i.handleKeyUp=function(e){e.keyCode===C&&i.props.onRootClose&&i.props.onRootClose(e)},i.preventMouseRootClose=!1,i}return i(t,e),t.prototype.componentDidMount=function(){this.props.disabled||this.addEventListeners()},t.prototype.componentDidUpdate=function(e){!this.props.disabled&&e.disabled?this.addEventListeners():this.props.disabled&&!e.disabled&&this.removeEventListeners()},t.prototype.componentWillUnmount=function(){this.props.disabled||this.removeEventListeners()},t.prototype.render=function(){return this.props.children},t}(h["default"].Component);E.displayName="RootCloseWrapper",E.propTypes={onRootClose:f["default"].func,children:f["default"].element,disabled:f["default"].bool,event:f["default"].oneOf(["click","mousedown"])},E.defaultProps={event:"click"},t["default"]=E,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(){}t.__esModule=!0,t.EXITING=t.ENTERED=t.ENTERING=t.EXITED=t.UNMOUNTED=void 0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},c=n(7),d=o(c),f=n(64),p=o(f),h=n(143),m=o(h),v=n(8),y=o(v),g=n(1),b=o(g),_=n(19),C=o(_),E=m["default"].end,x=t.UNMOUNTED=0,N=t.EXITED=1,k=t.ENTERING=2,w=t.ENTERED=3,S=t.EXITING=4,T=function(e){function t(n,o){a(this,t);var r=i(this,e.call(this,n,o));r.updateStatus=function(){if(null!==r.nextStatus){r.cancelNextCallback();var e=C["default"].findDOMNode(r);r.nextStatus===k?(r.props.onEnter(e),r.safeSetState({status:k},function(){r.props.onEntering(e),r.onTransitionEnd(e,function(){r.safeSetState({status:w},function(){r.props.onEntered(e)})})})):(r.props.onExit(e),r.safeSetState({status:S},function(){r.props.onExiting(e),r.onTransitionEnd(e,function(){r.safeSetState({status:N},function(){r.props.onExited(e)})})})),r.nextStatus=null}else r.props.unmountOnExit&&r.state.status===N&&r.setState({status:x})},r.cancelNextCallback=function(){null!==r.nextCallback&&(r.nextCallback.cancel(),r.nextCallback=null)},r.safeSetState=function(e,t){r.setState(e,r.setNextCallback(t))},r.setNextCallback=function(e){var t=!0;return r.nextCallback=function(n){t&&(t=!1,r.nextCallback=null,e(n))},r.nextCallback.cancel=function(){t=!1},r.nextCallback},r.onTransitionEnd=function(e,t){r.setNextCallback(t),e?((0,p["default"])(e,E,r.nextCallback),setTimeout(r.nextCallback,r.props.timeout)):setTimeout(r.nextCallback,0)};var l=void 0;return r.nextStatus=null,n["in"]?n.transitionAppear?(l=N,r.nextStatus=k):l=w:l=n.unmountOnExit||n.mountOnEnter?x:N,r.state={status:l},r.nextCallback=null,r}return l(t,e),t.prototype.componentDidMount=function(){this.updateStatus()},t.prototype.componentWillReceiveProps=function(e){var t=this.state.status;e["in"]?(t===x&&this.setState({status:N}),t!==k&&t!==w&&(this.nextStatus=k)):t!==k&&t!==w||(this.nextStatus=S)},t.prototype.componentDidUpdate=function(){this.updateStatus()},t.prototype.componentWillUnmount=function(){this.cancelNextCallback()},t.prototype.render=function(){var e=this.state.status;if(e===x)return null;var n=this.props,o=n.children,a=n.className,i=r(n,["children","className"]);Object.keys(t.propTypes).forEach(function(e){return delete i[e]});var l=void 0;e===N?l=this.props.exitedClassName:e===k?l=this.props.enteringClassName:e===w?l=this.props.enteredClassName:e===S&&(l=this.props.exitingClassName);var u=b["default"].Children.only(o);return b["default"].cloneElement(u,s({},i,{className:(0,d["default"])(u.props.className,a,l)}))},t}(b["default"].Component);T.propTypes={"in":y["default"].bool,mountOnEnter:y["default"].bool,unmountOnExit:y["default"].bool,transitionAppear:y["default"].bool,timeout:y["default"].number,exitedClassName:y["default"].string,exitingClassName:y["default"].string,enteredClassName:y["default"].string,enteringClassName:y["default"].string,onEnter:y["default"].func,onEntering:y["default"].func,onEntered:y["default"].func,onExit:y["default"].func,onExiting:y["default"].func,onExited:y["default"].func},T.displayName="Transition",T.defaultProps={"in":!1,unmountOnExit:!1,transitionAppear:!1,timeout:5e3,onEnter:u,onEntering:u,onEntered:u,onExit:u,onExiting:u,onExited:u},t["default"]=T},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0,t["default"]=function(e,t,n,o){return(0,a["default"])(e,t,n,o),{remove:function(){(0,l["default"])(e,t,n,o)}}};var r=n(64),a=o(r),i=n(99),l=o(i);e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e){return e&&"body"===e.tagName.toLowerCase()}function a(e){var t=(0,c["default"])(e),n=(0,u["default"])(t),o=n.innerWidth;if(!o){var r=t.documentElement.getBoundingClientRect();o=r.right-Math.abs(r.left)}return t.body.clientWidth<o}function i(e){var t=(0,u["default"])(e);return t||r(e)?a(e):e.scrollHeight>e.clientHeight}t.__esModule=!0,t["default"]=i;var l=n(65),u=o(l),s=n(42),c=o(s);e.exports=t["default"]},function(e,t,n){"use strict";function o(e,t,n){this.props=e,this.context=t,this.refs=s,this.updater=n||u}function r(e,t,n){this.props=e,this.context=t,this.refs=s,this.updater=n||u}function a(){}var i=n(61),l=n(14),u=n(200),s=(n(201),n(67));n(10),n(434),o.prototype.isReactComponent={},o.prototype.setState=function(e,t){"object"!=typeof e&&"function"!=typeof e&&null!=e?i("85"):void 0,this.updater.enqueueSetState(this,e),t&&this.updater.enqueueCallback(this,t,"setState")},o.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this),e&&this.updater.enqueueCallback(this,e,"forceUpdate")},a.prototype=o.prototype,r.prototype=new a,r.prototype.constructor=r,l(r.prototype,o.prototype),r.prototype.isPureReactComponent=!0,e.exports={Component:o,PureComponent:r}},function(e,t,n){"use strict";function o(e){var t=Function.prototype.toString,n=Object.prototype.hasOwnProperty,o=RegExp("^"+t.call(n).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");try{var r=t.call(e);return o.test(r)}catch(e){return!1}}function r(e){var t=s(e);if(t){var n=t.childIDs;c(e),n.forEach(r)}}function a(e,t,n){return"\n    in "+(e||"Unknown")+(t?" (at "+t.fileName.replace(/^.*[\\\/]/,"")+":"+t.lineNumber+")":n?" (created by "+n+")":"")}function i(e){return null==e?"#empty":"string"==typeof e||"number"==typeof e?"#text":"string"==typeof e.type?e.type:e.type.displayName||e.type.name||"Unknown"}function l(e){var t,n=k.getDisplayName(e),o=k.getElement(e),r=k.getOwnerID(e);return r&&(t=k.getDisplayName(r)),a(n,o&&o._source,t)}var u,s,c,d,f,p,h,m=n(61),v=n(30),y=(n(10),n(12),"function"==typeof Array.from&&"function"==typeof Map&&o(Map)&&null!=Map.prototype&&"function"==typeof Map.prototype.keys&&o(Map.prototype.keys)&&"function"==typeof Set&&o(Set)&&null!=Set.prototype&&"function"==typeof Set.prototype.keys&&o(Set.prototype.keys));if(y){var g=new Map,b=new Set;u=function(e,t){g.set(e,t)},s=function(e){return g.get(e)},c=function(e){g["delete"](e)},d=function(){return Array.from(g.keys())},f=function(e){b.add(e)},p=function(e){b["delete"](e)},h=function(){return Array.from(b.keys())}}else{var _={},C={},E=function(e){return"."+e},x=function(e){return parseInt(e.substr(1),10)};u=function(e,t){var n=E(e);_[n]=t},s=function(e){var t=E(e);return _[t]},c=function(e){var t=E(e);delete _[t]},d=function(){return Object.keys(_).map(x)},f=function(e){var t=E(e);C[t]=!0},p=function(e){var t=E(e);delete C[t]},h=function(){return Object.keys(C).map(x)}}var N=[],k={onSetChildren:function(e,t){var n=s(e);n?void 0:m("144"),n.childIDs=t;for(var o=0;o<t.length;o++){var r=t[o],a=s(r);a?void 0:m("140"),null==a.childIDs&&"object"==typeof a.element&&null!=a.element?m("141"):void 0,a.isMounted?void 0:m("71"),null==a.parentID&&(a.parentID=e),a.parentID!==e?m("142",r,a.parentID,e):void 0}},onBeforeMountComponent:function(e,t,n){var o={element:t,parentID:n,text:null,childIDs:[],isMounted:!1,updateCount:0};u(e,o)},onBeforeUpdateComponent:function(e,t){var n=s(e);n&&n.isMounted&&(n.element=t)},onMountComponent:function(e){var t=s(e);t?void 0:m("144"),t.isMounted=!0;var n=0===t.parentID;n&&f(e)},onUpdateComponent:function(e){var t=s(e);t&&t.isMounted&&t.updateCount++},onUnmountComponent:function(e){var t=s(e);if(t){t.isMounted=!1;var n=0===t.parentID;n&&p(e)}N.push(e)},purgeUnmountedComponents:function(){if(!k._preventPurging){for(var e=0;e<N.length;e++){var t=N[e];r(t)}N.length=0}},isMounted:function(e){var t=s(e);return!!t&&t.isMounted},getCurrentStackAddendum:function(e){var t="";if(e){var n=i(e),o=e._owner;t+=a(n,e._source,o&&o.getName())}var r=v.current,l=r&&r._debugID;return t+=k.getStackAddendumByID(l)},getStackAddendumByID:function(e){for(var t="";e;)t+=l(e),e=k.getParentID(e);return t},getChildIDs:function(e){var t=s(e);return t?t.childIDs:[]},getDisplayName:function(e){var t=k.getElement(e);return t?i(t):null},getElement:function(e){var t=s(e);return t?t.element:null},getOwnerID:function(e){var t=k.getElement(e);return t&&t._owner?t._owner._debugID:null},getParentID:function(e){var t=s(e);return t?t.parentID:null},getSource:function(e){var t=s(e),n=t?t.element:null,o=null!=n?n._source:null;return o},getText:function(e){var t=k.getElement(e);return"string"==typeof t?t:"number"==typeof t?""+t:null},getUpdateCount:function(e){var t=s(e);return t?t.updateCount:0},getRootIDs:h,getRegisteredIDs:d,pushNonStandardWarningStack:function(e,t){if("function"==typeof console.reactStack){var n=[],o=v.current,r=o&&o._debugID;try{for(e&&n.push({name:r?k.getDisplayName(r):null,fileName:t?t.fileName:null,lineNumber:t?t.lineNumber:null});r;){var a=k.getElement(r),i=k.getParentID(r),l=k.getOwnerID(r),u=l?k.getDisplayName(l):null,s=a&&a._source;n.push({name:u,fileName:s?s.fileName:null,lineNumber:s?s.lineNumber:null}),r=i}}catch(e){}console.reactStack(n)}},popNonStandardWarningStack:function(){"function"==typeof console.reactStackEnd&&console.reactStackEnd()}};e.exports=k},function(e,t){"use strict";var n="function"==typeof Symbol&&Symbol["for"]&&Symbol["for"]("react.element")||60103;e.exports=n},function(e,t,n){"use strict";function o(e,t){}var r=(n(12),{isMounted:function(e){return!1},enqueueCallback:function(e,t){},enqueueForceUpdate:function(e){o(e,"forceUpdate")},enqueueReplaceState:function(e,t){o(e,"replaceState")},enqueueSetState:function(e,t){o(e,"setState")}});e.exports=r},function(e,t,n){"use strict";var o=!1;e.exports=o},function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},n.apply(this,arguments)}e.exports=n},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=n(1),s=o(u),c=n(108),d=function(e){return s["default"].createElement("div",{className:"journey"},s["default"].createElement("div",{className:"indicators"},e.booking.$pre&&s["default"].createElement("div",{className:"tag pre"},"PRE"),"OnAccount"==e.booking.PaymentMethod&&s["default"].createElement("div",{className:"tag icon"},s["default"].createElement("i",{className:"material-icons"},"account_balance")),"Card"==e.booking.PaymentMethod&&s["default"].createElement("div",{className:"tag icon"},s["default"].createElement("i",{className:"material-icons"},"credit_card")),"Cash"==e.booking.PaymentMethod&&s["default"].createElement("div",{className:"tag icon"},s["default"].createElement("i",{className:"material-icons"},"account_balance_wallet")),s["default"].createElement("div",{className:"tag booking-source "+e.booking.BookingSource},e.booking.BookingSource.substring(0,3)),s["default"].createElement("div",{className:"tag vehicle "+e.booking.VehicleType.Name,style:{backgroundColor:e.booking.VehicleType.Colour}},e.booking.VehicleType.Name),(e.booking.OfficeNotes||e.booking.DriverNotes||e.booking.PassengerNotes)&&s["default"].createElement("div",{className:"tag icon notes"},s["default"].createElement("i",{className:"material-icons"},"speaker_notes")),e.booking.BookingTags.length>0&&s["default"].createElement("div",{className:"tag icon tags",style:{backgroundColor:"#3b4752"}},s["default"].createElement("i",{className:"material-icons"},"label_important")),e.booking.FlightInfo&&s["default"].createElement("div",{className:"tag icon flight"},s["default"].createElement("i",{className:"material-icons"},"airplanemode_active"),e.booking.FlightInfo.FlightNumber),e.booking["new"]&&s["default"].createElement("div",{"class":"tag new"},"NEW")),s["default"].createElement("div",{className:"text"},s["default"].createElement("strong",{className:"pickup"},e.booking.Summary)))},f=function(e){return s["default"].createElement("div",{className:"passenger"},s["default"].createElement("div",{className:"text"},1==e.booking.LeadPassenger.VIP&&s["default"].createElement("strong",null,"(VIP) "),s["default"].createElement("span",null,e.booking.LeadPassenger.Firstname+" "+e.booking.LeadPassenger.Surname)),!!e.booking.Client&&s["default"].createElement("div",{className:"text"},s["default"].createElement("span",{className:"label client-priority "+(e.booking.Priority?"P"+e.booking.Priority:e.booking.Client.Priority)},e.booking.Priority?"P"+e.booking.Priority:e.booking.Client.Priority),s["default"].createElement("strong",null,(e.booking.Client.AccountNo?"("+e.booking.Client.AccountNo+") ":"")+e.booking.Client.Name)))},p=function(e){var t=function(){return s["default"].createElement("div",{className:"driver"},s["default"].createElement("div",null,s["default"].createElement("div",{className:"text"},e.booking.Partner.PartnerName&&e.booking.Partner.PartnerName.indexOf(" ")!=-1&&s["default"].createElement("strong",null," ","(WS:"+e.booking.Partner.PartnerName.split(" ")[0]+")"),e.booking.Partner.PartnerName&&e.booking.Partner.PartnerName.indexOf(" ")==-1&&s["default"].createElement("strong",null," ","(WS:"+e.booking.Partner.PartnerName+")"),s["default"].createElement("span",null,e.booking.PartnerDriver&&e.booking.PartnerDriver.Name)),["UpdatePending","Pending","UpdateRequested","Requested"].indexOf(e.booking.PartnerBookingStatus)!=-1?s["default"].createElement("div",{className:"text"},s["default"].createElement("span",{className:"vehicle"},e.booking.PartnerBookingStatus)):s["default"].createElement("div",{className:"text"},s["default"].createElement("span",{className:"vehicle"},e.booking.PartnerVehicle?e.booking.PartnerVehicle._Description:"Not Assigned"))))},n=function(){return s["default"].createElement("div",{className:"driver"},e.booking.Driver&&"PreAllocated"!=e.booking.BookingStatus&&s["default"].createElement("div",null,s["default"].createElement("div",{className:"text"},!e.booking.DriverAck&&s["default"].createElement("i",{className:"material-icons red"},"warning"),s["default"].createElement("strong",null,"("+e.booking.Driver.Callsign+")")," ",s["default"].createElement("span",null,e.booking.Driver.Firstname)," ",s["default"].createElement("span",null,e.booking.Driver.Surname)),s["default"].createElement("div",{className:"text"},s["default"].createElement("span",{className:"vehicle"},e.booking.Vehicle?e.booking.Vehicle._Description+" "+e.booking.Vehicle.Registration:""))),e.booking.Partner&&s["default"].createElement("div",null,s["default"].createElement("div",{
className:"text"},s["default"].createElement("strong",null,"("+e.booking.Partner.PartnerType+")")," ",s["default"].createElement("span",null,e.booking.PartnerDriver&&e.booking.PartnerDriver.Name)),s["default"].createElement("div",{className:"text"},s["default"].createElement("span",{className:"vehicle"},e.booking.PartnerVehicle?e.booking.PartnerVehicle._Description:"Not Assigned"))),e.booking.Driver&&"PreAllocated"==e.booking.BookingStatus&&s["default"].createElement("div",null,s["default"].createElement("div",{className:"text"},s["default"].createElement("strong",null,"("+e.booking.Driver.Callsign+")")," ",s["default"].createElement("span",null,e.booking.Driver.Firstname)," ",s["default"].createElement("span",null,e.booking.Driver.Surname)),e.booking.$offer&&s["default"].createElement("div",{className:"text"},"Sent"==e.booking.$offer.Status&&1==e.booking.$offer.Attempts&&s["default"].createElement("span",null,"Sending.."),"Sent"==e.booking.$offer.Status&&e.booking.$offer.Attempts>1&&s["default"].createElement("span",null,"Retrying "+e.booking.$offer.Attempts-1+".."),"Read"==e.booking.$offer.Status&&!e.booking.$offer.ResponseTime&&s["default"].createElement("span",null,"Read"),"Rejected"==e.booking.$offer.Status&&e.booking.$offer.ResponseTime&&0==e.booking.$offer.Accepted&&s["default"].createElement("span",null,"Driver Rejected!"),"Rejected"==e.booking.$offer.Status&&!e.booking.$offer.ResponseTime&&s["default"].createElement("span",null,"Exceeded!")),!e.booking.$offer&&s["default"].createElement("div",{className:"text"},s["default"].createElement("button",{className:"btn btn-xs btn-success",onClick:function(t){t.preventDefault(),e.allocateDriver(e.booking,e.booking.DriverId)},style:{paddingLeft:"12px",lineHeight:"20px",height:"20px"}},"Confirm Allocation"))),!e.booking.Partner&&!e.booking.Driver&&!e.booking.$offer&&!e.booking.$recommendation&&s["default"].createElement("div",{onClick:function(t){t.preventDefault(),e.allocateDriver(e.booking)}},s["default"].createElement("i",{className:"material-icons add",style:{lineHeight:e.booking.$ad?"27px":""}},"add_circle"),s["default"].createElement("p",{style:{lineHeight:e.booking.$ad?"27px":""}},"Add Driver"),e.booking.$ad&&s["default"].createElement("div",{style:{height:"20px",fontSize:"85%",overflow:"hidden"}},e.booking.$ad)),!e.booking.Partner&&!e.booking.Driver&&e.booking.$offer&&s["default"].createElement("div",{onClick:function(t){t.preventDefault(),e.allocateDriver(e.booking)}},s["default"].createElement("div",null,s["default"].createElement("div",{className:"text"},s["default"].createElement("strong",null,"("+e.booking.$offer.Driver.Callsign+")")," ",s["default"].createElement("span",null,e.booking.$offer.Driver.Firstname)," ",s["default"].createElement("span",null,e.booking.$offer.Driver.Surname)),s["default"].createElement("div",{className:"text"},e.booking.$offer&&s["default"].createElement("div",null,"Sent"==e.booking.$offer.Status&&1==e.booking.$offer.Attempts&&s["default"].createElement("span",null,"Sending.."),"Sent"==e.booking.$offer.Status&&e.booking.$offer.Attempts>1&&s["default"].createElement("span",null,"Retrying "+(e.booking.$offer.Attempts-1)+".."),"Read"==e.booking.$offer.Status&&!e.booking.$offer.ResponseTime&&s["default"].createElement("span",null,"Read"),"Rejected"==e.booking.$offer.Status&&e.booking.$offer.ResponseTime&&0==e.booking.$offer.Accepted&&s["default"].createElement("span",null,"Driver Rejected!"),"Rejected"==e.booking.$offer.Status&&!e.booking.$offer.ResponseTime&&s["default"].createElement("span",null,"Retries Exceeded!"))))),!e.booking.Partner&&!e.booking.Driver&&!e.booking.$offer&&e.booking.$recommendation&&s["default"].createElement("div",null,s["default"].createElement("div",null,s["default"].createElement("div",{className:"text",style:{opacity:"0.5"}},s["default"].createElement("strong",null,"("+e.booking.$recommendation.Callsign+")")," ",s["default"].createElement("span",null,e.booking.$recommendation.Firstname)," ",s["default"].createElement("span",null,e.booking.$recommendation.Surname)),s["default"].createElement("button",{className:"btn btn-xs btn-success",onClick:function(t){t.preventDefault(),e.allocateDriver(e.booking,e.booking.$recommendation.DriverId)},style:{paddingLeft:"12px",lineHeight:"20px",height:"20px"}},"Confirm Allocation"))))},o=function(){return s["default"].createElement("div",{className:"accept-reject"},"Awaiting Confirmation")},r=function(){return s["default"].createElement("div",{className:"accept-reject"},s["default"].createElement("button",{disabled:e.booking.$loading,className:"btn btn-xs btn-success",onClick:function(t){t.preventDefault(),e.acceptBooking(e.booking)}},s["default"].createElement("i",{className:"material-icons"},"thumb_up"),"Accept")," ",s["default"].createElement("button",{disabled:e.booking.$loading,className:"btn btn-xs btn-danger",onClick:function(t){t.preventDefault(),e.rejectBooking(e.booking)}},s["default"].createElement("i",{className:"material-icons"},"thumb_down"),"Reject"))};return"Unconfirmed"==e.booking.BookingStatus?"Accepted"==e.booking.OneTransportStatus||"AutoAccepted"==e.booking.OneTransportStatus?s["default"].createElement(o,null):s["default"].createElement(r,null):e.booking.PartnerId&&e.booking.PartnerBookingStatus&&"WORKSHARE"!=e.booking.BookingSource?s["default"].createElement(t,null):s["default"].createElement(n,null)},h=function(e){return s["default"].createElement("div",{className:"time",onClick:function(t){t.preventDefault(),e.editBooking(e.booking)}},s["default"].createElement("strong",{className:"badge"},e.companyDateFilter(e.booking.BookedDateTime,"HH:mm")),s["default"].createElement("div",{className:"text"},s["default"].createElement("span",null,e.booking.$countdown)))},m=function(e){return s["default"].createElement("div",{className:"status"},s["default"].createElement("strong",{className:"badge"},e.booking.BookingStatus),s["default"].createElement("div",{className:"text"},s["default"].createElement("span",null,e.booking.$eta),"Accepted"!=e.booking.OneTransportStatus&&"AutoAccepted"!=e.booking.OneTransportStatus&&s["default"].createElement("span",null,e.booking.$countup)))},v=function(e){return s["default"].createElement("div",{className:"action"},s["default"].createElement("button",{className:"expand select",onClick:function(t){t.preventDefault(),e.selectBooking(e.booking)}},s["default"].createElement("i",{className:"material-icons"},"place")),s["default"].createElement("button",{className:"expand",onClick:function(t){t.preventDefault(),e.openBooking(e.booking)}},s["default"].createElement("i",{className:"material-icons"},"visibility")),e.booking.$warning&&s["default"].createElement(c.OverlayTrigger,{placement:"left",overlay:s["default"].createElement(c.Tooltip,null,e.booking.$warning.Message)},s["default"].createElement("button",{className:"expand warning "+e.booking.$warning.Severity,style:{animation:"blink-animation 1s steps(2, start) infinite;"},onClick:function(t){t.preventDefault(),e.openBooking(e.booking)}},"Low"==e.booking.$warning.Severity&&s["default"].createElement("i",{className:"material-icons"},"info"),"Medium"==e.booking.$warning.Severity&&s["default"].createElement("i",{className:"material-icons"},"warning"),"High"==e.booking.$warning.Severity&&s["default"].createElement("i",{className:"material-icons"},"error"))),("OpenToBid"==e.booking.BookingStatus||"Incoming"==e.booking.BookingStatus)&&e.enableBidding&&s["default"].createElement("button",{className:"expand",onClick:function(t){t.preventDefault(),e.addToBidQueue(e.booking)}},function(){return e.booking.DriverBids&&0!=e.booking.DriverBids.length?e.booking.DriverBids.length>9?s["default"].createElement("i",{className:"material-icons grey"},"filter_9_plus"):s["default"].createElement("i",{className:"material-icons grey"},"filter_"+e.booking.DriverBids.length):s["default"].createElement("i",{className:"material-icons"},"supervisor_account")}()),e.booking.$recentlyCompleted&&s["default"].createElement("button",{className:"expand",onClick:function(t){t.preventDefault(),e.removeCompleted(e.booking)}},s["default"].createElement("i",{className:"material-icons"},"check_circle")),e.booking.$recentlyCancelled&&s["default"].createElement("button",{className:"expand",onClick:function(t){t.preventDefault(),e.removeCancelled(e.booking)}},s["default"].createElement("i",{className:"material-icons"},"check_circle")),e.booking.HasEdits&&s["default"].createElement("button",{className:"expand",onClick:function(t){t.preventDefault(),e.approveChanges(e.booking)}},s["default"].createElement("i",{className:"material-icons ",style:{transform:"rotate(180deg)"}},"info")))},y=function(e){function t(e){r(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.openBooking=function(e){n.props.openBooking({booking:e})},n.editBooking=function(e){n.props.editBooking({booking:e})},n.openBidding=function(e){n.props.openBidding({booking:e})},n.selectBooking=function(e){n.props.selectBooking({booking:e})},n.removeCompleted=function(e){n.props.removeCompleted({booking:e})},n.removeCancelled=function(e){n.props.removeCancelled({booking:e})},n.approveChanges=function(e){n.props.approveChanges({booking:e})},n.allocateDriver=function(e,t,o){n.props.allocateDriver({booking:e,driverId:t,misc:o})},n.confirm=function(e,t,o,r){n.props.confirm({type:e,notify:t,booking:o,driverId:r})},n.acceptBooking=function(e){n.props.acceptBooking({booking:e})},n.rejectBooking=function(e){n.props.rejectBooking({booking:e})},n.companyDate=function(e){n.props.companyDate({date:e,format:"HH:mm"})},n.addToBidQueue=function(e){e.$selected=!e.$selected,n.setState({bookings:n.props.bookings})},n}return i(t,e),l(t,[{key:"componentWillMount",value:function(){console.log("Component mounting")}},{key:"componentWillUnmount",value:function(){console.log("Component unmounting")}},{key:"render",value:function(){var e=this;return this.state={bookings:this.props.bookings},s["default"].createElement("div",null,this.props.bookings.map(function(t){return s["default"].createElement("div",{key:t.Id},s["default"].createElement("div",{className:"booking "+t.BookingStatus+" "+(t.$selected?"selected":"")},s["default"].createElement("div",{className:"content-wrapper"},s["default"].createElement(d,{booking:t}),s["default"].createElement(f,{booking:t}),s["default"].createElement(p,{booking:t,allocateDriver:e.allocateDriver,confirm:e.confirm,acceptBooking:e.acceptBooking,rejectBooking:e.rejectBooking,dispatchObj:e.props.dispatchObj}),s["default"].createElement(h,{booking:t,companyDateFilter:e.props.companyDateFilter,editBooking:e.editBooking}),s["default"].createElement(m,{booking:t}),s["default"].createElement(v,{enableBidding:e.props.enableBidding,booking:t,selectBooking:e.selectBooking,openBooking:e.openBooking,addToBidQueue:e.addToBidQueue,removeCompleted:e.removeCompleted,removeCancelled:e.removeCancelled,approveChanges:e.approveChanges}))))}))}}]),t}(s["default"].Component);t["default"]=y},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var r=n(1),a=o(r),i=n(19),l=o(i),u=n(203),s=o(u);!function(e){function t(t,n,o,r){return{template:'<div class="react-part"></div>',scope:{dispatchObj:"=",bookings:"=",reload:"=",openBooking:"&",editBooking:"&",bidQueue:"&",selectBooking:"&",enableBidding:"=",removeCompleted:"&",removeCancelled:"&",approveChanges:"&",allocateDriver:"&",acceptBooking:"&",confirm:"&",rejectBooking:"&"},link:function(t,n,o){function i(){l["default"].unmountComponentAtNode(c)}var u=r("companyDate"),c=n.find(".react-part")[0];t.$watch("reload",function(n,o){e.isDefined(t.bookings)&&l["default"].render(a["default"].createElement(s["default"],{dispatchObj:t.dispatchObj,bookings:t.bookings,enableBidding:t.enableBidding,openBooking:t.openBooking,editBooking:t.editBooking,addToBidQueue:t.bidQueue,selectBooking:t.selectBooking,removeCompleted:t.removeCompleted,removeCancelled:t.removeCancelled,approveChanges:t.approveChanges,allocateDriver:t.allocateDriver,acceptBooking:t.acceptBooking,loading:t.loading,confirm:t.confirm,rejectBooking:t.rejectBooking,companyDateFilter:u}),c)}),t.$on("$destroy",i)}}}var n=e.module("cab9.dispatch");n.directive("reactBooking",t),t.$inject=["$state","$interval","$parse","$filter"]}(angular)},203,function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var r=n(1),a=o(r),i=n(19),l=o(i),u=n(125),s=o(u);!function(e){function t(t,n,o,r){return{template:'<div id="reactdriverapp" class="react-part"></div>',scope:{dispatchObj:"=",reload:"=",formatImage:"&",selectDriver:"&"},link:function(t,n,o){function i(){l["default"].unmountComponentAtNode(u)}var u=document.getElementById("reactdriverapp"),c=e.injector(["ng"]).get("$filter")("filter"),d=e.injector(["ng"]).get("$filter")("orderBy"),f=e.injector(["ng"]).get("$filter")("currency"),p=e.injector(["ng","framework.filters.utility"]).get("$filter")("time"),h=r("Countdown");t.$watchGroup(["reload","dispatchObj.driverSearch.$"],function(n,o){e.isDefined(t.dispatchObj)&&l["default"].render(a["default"].createElement(s["default"],{dispatchObj:t.dispatchObj,formatImage:t.formatImage,selectDriver:t.selectDriver,filter:c,order:d,currencyFilter:f,countdown:h,timeFilter:p}),u)}),t.$on("$destroy",i)}}}var n=e.module("cab9.dispatch");n.directive("reactDriver",t),t.$inject=["$state","$interval","$parse","$filter"]}(angular)},function(e,t,n){e.exports={"default":n(212),__esModule:!0}},function(e,t,n){e.exports={"default":n(214),__esModule:!0}},function(e,t,n){e.exports={"default":n(216),__esModule:!0}},function(e,t,n){e.exports={"default":n(218),__esModule:!0}},function(e,t,n){e.exports={"default":n(219),__esModule:!0}},function(e,t,n){n(138),n(242),e.exports=n(24).Array.from},function(e,t,n){n(244),e.exports=n(24).Object.assign},function(e,t,n){n(245);var o=n(24).Object;e.exports=function(e,t){return o.create(e,t)}},function(e,t,n){n(249),e.exports=n(24).Object.entries},function(e,t,n){n(246),e.exports=n(24).Object.setPrototypeOf},function(e,t,n){n(250),e.exports=n(24).Object.values},function(e,t,n){n(248),n(247),n(251),n(252),e.exports=n(24).Symbol},function(e,t,n){n(138),n(253),e.exports=n(98).f("iterator")},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(){}},function(e,t,n){var o=n(36),r=n(137),a=n(240);e.exports=function(e){return function(t,n,i){var l,u=o(t),s=r(u.length),c=a(i,s);if(e&&n!=n){for(;s>c;)if(l=u[c++],l!=l)return!0}else for(;s>c;c++)if((e||c in u)&&u[c]===n)return e||c||0;return!e&&-1}}},function(e,t,n){var o=n(84),r=n(25)("toStringTag"),a="Arguments"==o(function(){return arguments}()),i=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,n,l;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=i(t=Object(e),r))?n:a?o(t):"Object"==(l=o(t))&&"function"==typeof t.callee?"Arguments":l}},function(e,t,n){"use strict";var o=n(35),r=n(55);e.exports=function(e,t,n){t in e?o.f(e,t,r(0,n)):e[t]=n}},function(e,t,n){var o=n(53),r=n(90),a=n(54);e.exports=function(e){var t=o(e),n=r.f;if(n)for(var i,l=n(e),u=a.f,s=0;l.length>s;)u.call(e,i=l[s++])&&t.push(i);return t}},function(e,t,n){var o=n(32).document;e.exports=o&&o.documentElement},function(e,t,n){var o=n(52),r=n(25)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(o.Array===e||a[r]===e)}},function(e,t,n){var o=n(84);e.exports=Array.isArray||function(e){return"Array"==o(e)}},function(e,t,n){var o=n(39);e.exports=function(e,t,n,r){try{return r?t(o(n)[0],n[1]):t(n)}catch(t){var a=e["return"];throw void 0!==a&&o(a.call(e)),t}}},function(e,t,n){"use strict";var o=n(89),r=n(55),a=n(91),i={};n(41)(i,n(25)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=o(i,{next:r(1,n)}),a(e,t+" Iterator")}},function(e,t,n){var o=n(25)("iterator"),r=!1;try{var a=[7][o]();a["return"]=function(){r=!0},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!r)return!1;var n=!1;try{var a=[7],i=a[o]();i.next=function(){return{done:n=!0}},a[o]=function(){return i},e(a)}catch(e){}return n}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){var o=n(63)("meta"),r=n(51),a=n(34),i=n(35).f,l=0,u=Object.isExtensible||function(){return!0},s=!n(50)(function(){return u(Object.preventExtensions({}))}),c=function(e){i(e,o,{value:{i:"O"+ ++l,w:{}}})},d=function(e,t){if(!r(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,o)){if(!u(e))return"F";if(!t)return"E";c(e)}return e[o].i},f=function(e,t){if(!a(e,o)){if(!u(e))return!0;if(!t)return!1;c(e)}return e[o].w},p=function(e){return s&&h.NEED&&u(e)&&!a(e,o)&&c(e),e},h=e.exports={KEY:o,NEED:!1,fastKey:d,getWeak:f,onFreeze:p}},function(e,t,n){"use strict";var o=n(53),r=n(90),a=n(54),i=n(95),l=n(130),u=Object.assign;e.exports=!u||n(50)(function(){var e={},t={},n=Symbol(),o="abcdefghijklmnopqrst";return e[n]=7,o.split("").forEach(function(e){t[e]=e}),7!=u({},e)[n]||Object.keys(u({},t)).join("")!=o})?function(e,t){for(var n=i(e),u=arguments.length,s=1,c=r.f,d=a.f;u>s;)for(var f,p=l(arguments[s++]),h=c?o(p).concat(c(p)):o(p),m=h.length,v=0;m>v;)d.call(p,f=h[v++])&&(n[f]=p[f]);return n}:u},function(e,t,n){var o=n(35),r=n(39),a=n(53);e.exports=n(40)?Object.defineProperties:function(e,t){r(e);for(var n,i=a(t),l=i.length,u=0;l>u;)o.f(e,n=i[u++],t[n]);return e}},function(e,t,n){var o=n(36),r=n(133).f,a={}.toString,i="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],l=function(e){try{return r(e)}catch(e){return i.slice()}};e.exports.f=function(e){return i&&"[object Window]"==a.call(e)?l(e):r(o(e))}},function(e,t,n){var o=n(34),r=n(95),a=n(92)("IE_PROTO"),i=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=r(e),o(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?i:null}},function(e,t,n){var o=n(51),r=n(39),a=function(e,t){if(r(e),!o(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,o){try{o=n(85)(Function.call,n(132).f(Object.prototype,"__proto__").set,2),o(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return a(e,n),t?e.__proto__=n:o(e,n),e}}({},!1):void 0),check:a}},function(e,t,n){var o=n(94),r=n(86);e.exports=function(e){return function(t,n){var a,i,l=String(r(t)),u=o(n),s=l.length;return u<0||u>=s?e?"":void 0:(a=l.charCodeAt(u),a<55296||a>56319||u+1===s||(i=l.charCodeAt(u+1))<56320||i>57343?e?l.charAt(u):a:e?l.slice(u,u+2):(a-55296<<10)+(i-56320)+65536)}}},function(e,t,n){var o=n(94),r=Math.max,a=Math.min;e.exports=function(e,t){return e=o(e),e<0?r(e+t,0):a(e,t)}},function(e,t,n){var o=n(223),r=n(25)("iterator"),a=n(52);e.exports=n(24).getIteratorMethod=function(e){if(void 0!=e)return e[r]||e["@@iterator"]||a[o(e)]}},function(e,t,n){"use strict";var o=n(85),r=n(31),a=n(95),i=n(229),l=n(227),u=n(137),s=n(224),c=n(241);r(r.S+r.F*!n(231)(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,r,d,f=a(e),p="function"==typeof this?this:Array,h=arguments.length,m=h>1?arguments[1]:void 0,v=void 0!==m,y=0,g=c(f);if(v&&(m=o(m,h>2?arguments[2]:void 0,2)),void 0==g||p==Array&&l(g))for(t=u(f.length),n=new p(t);t>y;y++)s(n,y,v?m(f[y],y):f[y]);else for(d=g.call(f),n=new p;!(r=d.next()).done;y++)s(n,y,v?i(d,m,[r.value,y],!0):r.value);return n.length=y,n}})},function(e,t,n){"use strict";var o=n(221),r=n(232),a=n(52),i=n(36);e.exports=n(131)(Array,"Array",function(e,t){this._t=i(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,r(1)):"keys"==t?r(0,n):"values"==t?r(0,e[n]):r(0,[n,e[n]])},"values"),a.Arguments=a.Array,o("keys"),o("values"),o("entries")},function(e,t,n){var o=n(31);o(o.S+o.F,"Object",{assign:n(234)})},function(e,t,n){var o=n(31);o(o.S,"Object",{create:n(89)})},function(e,t,n){var o=n(31);o(o.S,"Object",{setPrototypeOf:n(238).set})},function(e,t){},function(e,t,n){"use strict";var o=n(32),r=n(34),a=n(40),i=n(31),l=n(136),u=n(233).KEY,s=n(50),c=n(93),d=n(91),f=n(63),p=n(25),h=n(98),m=n(97),v=n(225),y=n(228),g=n(39),b=n(36),_=n(96),C=n(55),E=n(89),x=n(236),N=n(132),k=n(35),w=n(53),S=N.f,T=k.f,O=x.f,M=o.Symbol,P=o.JSON,D=P&&P.stringify,I="prototype",A=p("_hidden"),R=p("toPrimitive"),L={}.propertyIsEnumerable,j=c("symbol-registry"),B=c("symbols"),U=c("op-symbols"),F=Object[I],H="function"==typeof M,V=o.QObject,K=!V||!V[I]||!V[I].findChild,W=a&&s(function(){return 7!=E(T({},"a",{get:function(){return T(this,"a",{value:7}).a}})).a})?function(e,t,n){var o=S(F,t);o&&delete F[t],T(e,t,n),o&&e!==F&&T(F,t,o)}:T,$=function(e){var t=B[e]=E(M[I]);return t._k=e,t},q=H&&"symbol"==typeof M.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof M},z=function(e,t,n){return e===F&&z(U,t,n),g(e),t=_(t,!0),g(n),r(B,t)?(n.enumerable?(r(e,A)&&e[A][t]&&(e[A][t]=!1),n=E(n,{enumerable:C(0,!1)})):(r(e,A)||T(e,A,C(1,{})),e[A][t]=!0),W(e,t,n)):T(e,t,n)},G=function(e,t){g(e);for(var n,o=v(t=b(t)),r=0,a=o.length;a>r;)z(e,n=o[r++],t[n]);return e},Y=function(e,t){return void 0===t?E(e):G(E(e),t)},X=function(e){var t=L.call(this,e=_(e,!0));return!(this===F&&r(B,e)&&!r(U,e))&&(!(t||!r(this,e)||!r(B,e)||r(this,A)&&this[A][e])||t)},Q=function(e,t){if(e=b(e),t=_(t,!0),e!==F||!r(B,t)||r(U,t)){var n=S(e,t);return!n||!r(B,t)||r(e,A)&&e[A][t]||(n.enumerable=!0),n}},Z=function(e){for(var t,n=O(b(e)),o=[],a=0;n.length>a;)r(B,t=n[a++])||t==A||t==u||o.push(t);return o},J=function(e){for(var t,n=e===F,o=O(n?U:b(e)),a=[],i=0;o.length>i;)!r(B,t=o[i++])||n&&!r(F,t)||a.push(B[t]);return a};H||(M=function(){if(this instanceof M)throw TypeError("Symbol is not a constructor!");var e=f(arguments.length>0?arguments[0]:void 0),t=function(n){this===F&&t.call(U,n),r(this,A)&&r(this[A],e)&&(this[A][e]=!1),W(this,e,C(1,n))};return a&&K&&W(F,e,{configurable:!0,set:t}),$(e)},l(M[I],"toString",function(){return this._k}),N.f=Q,k.f=z,n(133).f=x.f=Z,n(54).f=X,n(90).f=J,a&&!n(88)&&l(F,"propertyIsEnumerable",X,!0),h.f=function(e){return $(p(e))}),i(i.G+i.W+i.F*!H,{Symbol:M});for(var ee="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),te=0;ee.length>te;)p(ee[te++]);for(var ne=w(p.store),oe=0;ne.length>oe;)m(ne[oe++]);i(i.S+i.F*!H,"Symbol",{"for":function(e){return r(j,e+="")?j[e]:j[e]=M(e)},keyFor:function(e){if(!q(e))throw TypeError(e+" is not a symbol!");for(var t in j)if(j[t]===e)return t},useSetter:function(){K=!0},useSimple:function(){K=!1}}),i(i.S+i.F*!H,"Object",{create:Y,defineProperty:z,defineProperties:G,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:J}),P&&i(i.S+i.F*(!H||s(function(){var e=M();return"[null]"!=D([e])||"{}"!=D({a:e})||"{}"!=D(Object(e))})),"JSON",{stringify:function(e){if(void 0!==e&&!q(e)){for(var t,n,o=[e],r=1;arguments.length>r;)o.push(arguments[r++]);return t=o[1],"function"==typeof t&&(n=t),!n&&y(t)||(t=function(e,t){if(n&&(t=n.call(this,e,t)),!q(t))return t}),o[1]=t,D.apply(P,o)}}}),M[I][R]||n(41)(M[I],R,M[I].valueOf),d(M,"Symbol"),d(Math,"Math",!0),d(o.JSON,"JSON",!0)},function(e,t,n){var o=n(31),r=n(135)(!0);o(o.S,"Object",{entries:function(e){return r(e)}})},function(e,t,n){var o=n(31),r=n(135)(!1);o(o.S,"Object",{values:function(e){return r(e)}})},function(e,t,n){n(97)("asyncIterator")},function(e,t,n){n(97)("observable")},function(e,t,n){n(243);for(var o=n(32),r=n(41),a=n(52),i=n(25)("toStringTag"),l="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<l.length;u++){var s=l[u],c=o[s],d=c&&c.prototype;d&&!d[i]&&r(d,i,s),a[s]=a.Array}},function(e,t,n){"use strict";function o(e){return e}function r(e,t,n){function r(e,t){var n=g.hasOwnProperty(t)?g[t]:null;x.hasOwnProperty(t)&&u("OVERRIDE_BASE"===n,"ReactClassInterface: You are attempting to override `%s` from your class specification. Ensure that your method names do not overlap with React methods.",t),e&&u("DEFINE_MANY"===n||"DEFINE_MANY_MERGED"===n,"ReactClassInterface: You are attempting to define `%s` on your component more than once. This conflict may be due to a mixin.",t)}function a(e,n){if(n){u("function"!=typeof n,"ReactClass: You're attempting to use a component class or function as a mixin. Instead, just use a regular object."),u(!t(n),"ReactClass: You're attempting to use a component as a mixin. Instead, just use a regular object.");var o=e.prototype,a=o.__reactAutoBindPairs;n.hasOwnProperty(s)&&_.mixins(e,n.mixins);for(var i in n)if(n.hasOwnProperty(i)&&i!==s){var l=n[i],c=o.hasOwnProperty(i);if(r(c,i),_.hasOwnProperty(i))_[i](e,l);else{var d=g.hasOwnProperty(i),h="function"==typeof l,m=h&&!d&&!c&&n.autobind!==!1;if(m)a.push(i,l),o[i]=l;else if(c){var v=g[i];u(d&&("DEFINE_MANY_MERGED"===v||"DEFINE_MANY"===v),"ReactClass: Unexpected spec policy %s for key %s when mixing in component specs.",v,i),"DEFINE_MANY_MERGED"===v?o[i]=f(o[i],l):"DEFINE_MANY"===v&&(o[i]=p(o[i],l))}else o[i]=l}}}}function c(e,t){if(t)for(var n in t){var o=t[n];if(t.hasOwnProperty(n)){var r=n in _;u(!r,'ReactClass: You are attempting to define a reserved property, `%s`, that shouldn\'t be on the "statics" key. Define it as an instance property instead; it will still be accessible on the constructor.',n);var a=n in e;if(a){var i=b.hasOwnProperty(n)?b[n]:null;return u("DEFINE_MANY_MERGED"===i,"ReactClass: You are attempting to define `%s` on your component more than once. This conflict may be due to a mixin.",n),void(e[n]=f(e[n],o))}e[n]=o}}}function d(e,t){u(e&&t&&"object"==typeof e&&"object"==typeof t,"mergeIntoWithNoDuplicateKeys(): Cannot merge non-objects.");for(var n in t)t.hasOwnProperty(n)&&(u(void 0===e[n],"mergeIntoWithNoDuplicateKeys(): Tried to merge two objects with the same key: `%s`. This conflict may be due to a mixin; in particular, this may be caused by two getInitialState() or getDefaultProps() methods returning objects with clashing keys.",n),e[n]=t[n]);return e}function f(e,t){return function(){var n=e.apply(this,arguments),o=t.apply(this,arguments);if(null==n)return o;if(null==o)return n;var r={};return d(r,n),d(r,o),r}}function p(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function h(e,t){var n=t.bind(e);return n}function m(e){for(var t=e.__reactAutoBindPairs,n=0;n<t.length;n+=2){var o=t[n],r=t[n+1];e[o]=h(e,r)}}function v(e){var t=o(function(e,o,r){this.__reactAutoBindPairs.length&&m(this),this.props=e,this.context=o,this.refs=l,this.updater=r||n,this.state=null;var a=this.getInitialState?this.getInitialState():null;u("object"==typeof a&&!Array.isArray(a),"%s.getInitialState(): must return an object or null",t.displayName||"ReactCompositeComponent"),this.state=a});t.prototype=new N,t.prototype.constructor=t,t.prototype.__reactAutoBindPairs=[],y.forEach(a.bind(null,t)),a(t,C),a(t,e),a(t,E),t.getDefaultProps&&(t.defaultProps=t.getDefaultProps()),u(t.prototype.render,"createClass(...): Class specification must implement a `render` method.");for(var r in g)t.prototype[r]||(t.prototype[r]=null);return t}var y=[],g={mixins:"DEFINE_MANY",statics:"DEFINE_MANY",propTypes:"DEFINE_MANY",contextTypes:"DEFINE_MANY",childContextTypes:"DEFINE_MANY",getDefaultProps:"DEFINE_MANY_MERGED",getInitialState:"DEFINE_MANY_MERGED",getChildContext:"DEFINE_MANY_MERGED",render:"DEFINE_ONCE",componentWillMount:"DEFINE_MANY",componentDidMount:"DEFINE_MANY",componentWillReceiveProps:"DEFINE_MANY",shouldComponentUpdate:"DEFINE_ONCE",componentWillUpdate:"DEFINE_MANY",componentDidUpdate:"DEFINE_MANY",componentWillUnmount:"DEFINE_MANY",UNSAFE_componentWillMount:"DEFINE_MANY",UNSAFE_componentWillReceiveProps:"DEFINE_MANY",UNSAFE_componentWillUpdate:"DEFINE_MANY",updateComponent:"OVERRIDE_BASE"},b={getDerivedStateFromProps:"DEFINE_MANY_MERGED"},_={displayName:function(e,t){e.displayName=t},mixins:function(e,t){if(t)for(var n=0;n<t.length;n++)a(e,t[n])},childContextTypes:function(e,t){e.childContextTypes=i({},e.childContextTypes,t)},contextTypes:function(e,t){e.contextTypes=i({},e.contextTypes,t)},getDefaultProps:function(e,t){e.getDefaultProps?e.getDefaultProps=f(e.getDefaultProps,t):e.getDefaultProps=t},propTypes:function(e,t){e.propTypes=i({},e.propTypes,t)},statics:function(e,t){c(e,t)},autobind:function(){}},C={componentDidMount:function(){this.__isMounted=!0}},E={componentWillUnmount:function(){this.__isMounted=!1}},x={replaceState:function(e,t){this.updater.enqueueReplaceState(this,e,t)},isMounted:function(){return!!this.__isMounted}},N=function(){};return i(N.prototype,e.prototype,x),v}var a,i=n(14),l=n(67),u=n(10),s="mixins";a={},e.exports=r},function(e,t,n){"use strict";function o(e,t){e.classList?e.classList.add(t):(0,a["default"])(e,t)||("string"==typeof e.className?e.className=e.className+" "+t:e.setAttribute("class",(e.className&&e.className.baseVal||"")+" "+t))}var r=n(16);t.__esModule=!0,t["default"]=o;var a=r(n(140));e.exports=t["default"]},function(e,t,n){"use strict";var o=n(16);t.__esModule=!0,t["default"]=void 0;var r=o(n(255));t.addClass=r["default"];var a=o(n(257));t.removeClass=a["default"];var i=o(n(140));t.hasClass=i["default"];var l={addClass:r["default"],removeClass:a["default"],hasClass:i["default"]};t["default"]=l},function(e,t){"use strict";function n(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}e.exports=function(e,t){e.classList?e.classList.remove(t):"string"==typeof e.className?e.className=n(e.className,t):e.setAttribute("class",n(e.className&&e.className.baseVal||"",t))}},function(e,t,n){"use strict";function o(e,t){return function(n){var o=n.currentTarget,r=n.target,l=(0,i["default"])(o,e);l.some(function(e){return(0,a["default"])(e,r)})&&t.call(this,n)}}var r=n(16);t.__esModule=!0,t["default"]=o;var a=r(n(43)),i=r(n(263));e.exports=t["default"]},function(e,t,n){"use strict";var o=n(16);t.__esModule=!0,t["default"]=void 0;var r=o(n(64));t.on=r["default"];var a=o(n(99));t.off=a["default"];var i=o(n(258));t.filter=i["default"];var l=o(n(260));t.listen=l["default"];var u={on:r["default"],off:a["default"],filter:i["default"],listen:l["default"]};t["default"]=u},function(e,t,n){"use strict";var o=n(16);t.__esModule=!0,t["default"]=void 0;var r=o(n(33)),a=o(n(64)),i=o(n(99)),l=function(){};r["default"]&&(l=function(e,t,n,o){return(0,a["default"])(e,t,n,o),function(){(0,i["default"])(e,t,n,o)}});var u=l;t["default"]=u,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e.nodeName&&e.nodeName.toLowerCase()}function r(e){for(var t=(0,i["default"])(e),n=e&&e.offsetParent;n&&"html"!==o(e)&&"static"===(0,l["default"])(n,"position");)n=n.offsetParent;return n||t.documentElement}var a=n(16);t.__esModule=!0,t["default"]=r;var i=a(n(42)),l=a(n(66));e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e.nodeName&&e.nodeName.toLowerCase()}function r(e,t){var n,r={top:0,left:0};return"fixed"===(0,d["default"])(e,"position")?n=e.getBoundingClientRect():(t=t||(0,u["default"])(e),n=(0,l["default"])(e),"html"!==o(t)&&(r=(0,l["default"])(t)),r.top+=parseInt((0,d["default"])(t,"borderTopWidth"),10)-(0,s["default"])(t)||0,r.left+=parseInt((0,d["default"])(t,"borderLeftWidth"),10)-(0,c["default"])(t)||0),(0,i["default"])({},n,{top:n.top-r.top-(parseInt((0,d["default"])(e,"marginTop"),10)||0),left:n.left-r.left-(parseInt((0,d["default"])(e,"marginLeft"),10)||0)})}var a=n(16);t.__esModule=!0,t["default"]=r;var i=a(n(202)),l=a(n(141)),u=a(n(261)),s=a(n(142)),c=a(n(264)),d=a(n(66));e.exports=t["default"]},function(e,t){"use strict";function n(e,t){var n,a="#"===t[0],i="."===t[0],l=a||i?t.slice(1):t,u=o.test(l);
return u?a?(e=e.getElementById?e:document,(n=e.getElementById(l))?[n]:[]):r(e.getElementsByClassName&&i?e.getElementsByClassName(l):e.getElementsByTagName(t)):r(e.querySelectorAll(t))}t.__esModule=!0,t["default"]=n;var o=/^[\w-]*$/,r=Function.prototype.bind.call(Function.prototype.call,[].slice);e.exports=t["default"]},function(e,t,n){"use strict";function o(e,t){var n=(0,a["default"])(e);return void 0===t?n?"pageXOffset"in n?n.pageXOffset:n.document.documentElement.scrollLeft:e.scrollLeft:void(n?n.scrollTo(t,"pageYOffset"in n?n.pageYOffset:n.document.documentElement.scrollTop):e.scrollLeft=t)}var r=n(16);t.__esModule=!0,t["default"]=o;var a=r(n(65));e.exports=t["default"]},function(e,t,n){"use strict";function o(e){if(!e)throw new TypeError("No Element passed to `getComputedStyle()`");var t=e.ownerDocument;return"defaultView"in t?t.defaultView.opener?e.ownerDocument.defaultView.getComputedStyle(e,null):window.getComputedStyle(e,null):{getPropertyValue:function(t){var n=e.style;t=(0,a["default"])(t),"float"==t&&(t="styleFloat");var o=e.currentStyle[t]||null;if(null==o&&n&&n[t]&&(o=n[t]),l.test(o)&&!i.test(t)){var r=n.left,u=e.runtimeStyle,s=u&&u.left;s&&(u.left=e.currentStyle.left),n.left="fontSize"===t?"1em":o,o=n.pixelLeft+"px",n.left=r,s&&(u.left=s)}return o}}}var r=n(16);t.__esModule=!0,t["default"]=o;var a=r(n(144)),i=/^(top|right|bottom|left)$/,l=/^([+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|))(?!px)[a-z%]+$/i;e.exports=t["default"]},function(e,t){"use strict";function n(e,t){return"removeProperty"in e.style?e.style.removeProperty(t):e.style.removeAttribute(t)}t.__esModule=!0,t["default"]=n,e.exports=t["default"]},function(e,t){"use strict";function n(e){return!(!e||!o.test(e))}t.__esModule=!0,t["default"]=n;var o=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;e.exports=t["default"]},function(e,t){"use strict";function n(e){return e.replace(o,function(e,t){return t.toUpperCase()})}t.__esModule=!0,t["default"]=n;var o=/-(.)/g;e.exports=t["default"]},function(e,t){"use strict";function n(e){return e.replace(o,"-$1").toLowerCase()}t.__esModule=!0,t["default"]=n;var o=/([A-Z])/g;e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return(0,a["default"])(e).replace(i,"-ms-")}var r=n(16);t.__esModule=!0,t["default"]=o;var a=r(n(269)),i=/^ms-/;e.exports=t["default"]},function(e,t){"use strict";function n(e){return e.replace(o,function(e,t){return t.toUpperCase()})}var o=/-(.)/g;e.exports=n},function(e,t,n){"use strict";function o(e){return r(e.replace(a,"ms-"))}var r=n(271),a=/^-ms-/;e.exports=o},function(e,t,n){"use strict";function o(e,t){return!(!e||!t)&&(e===t||!r(e)&&(r(t)?o(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}var r=n(281);e.exports=o},function(e,t,n){"use strict";function o(e){var t=e.length;if(Array.isArray(e)||"object"!=typeof e&&"function"!=typeof e?i(!1):void 0,"number"!=typeof t?i(!1):void 0,0===t||t-1 in e?void 0:i(!1),"function"==typeof e.callee?i(!1):void 0,e.hasOwnProperty)try{return Array.prototype.slice.call(e)}catch(e){}for(var n=Array(t),o=0;o<t;o++)n[o]=e[o];return n}function r(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"length"in e&&!("setInterval"in e)&&"number"!=typeof e.nodeType&&(Array.isArray(e)||"callee"in e||"item"in e)}function a(e){return r(e)?Array.isArray(e)?e.slice():o(e):[e]}var i=n(10);e.exports=a},function(e,t,n){"use strict";function o(e){var t=e.match(c);return t&&t[1].toLowerCase()}function r(e,t){var n=s;s?void 0:u(!1);var r=o(e),a=r&&l(r);if(a){n.innerHTML=a[1]+e+a[2];for(var c=a[0];c--;)n=n.lastChild}else n.innerHTML=e;var d=n.getElementsByTagName("script");d.length&&(t?void 0:u(!1),i(d).forEach(t));for(var f=Array.from(n.childNodes);n.lastChild;)n.removeChild(n.lastChild);return f}var a=n(20),i=n(274),l=n(276),u=n(10),s=a.canUseDOM?document.createElement("div"):null,c=/^\s*<(\w+)/;e.exports=r},function(e,t,n){"use strict";function o(e){return i?void 0:a(!1),f.hasOwnProperty(e)||(e="*"),l.hasOwnProperty(e)||("*"===e?i.innerHTML="<link />":i.innerHTML="<"+e+"></"+e+">",l[e]=!i.firstChild),l[e]?f[e]:null}var r=n(20),a=n(10),i=r.canUseDOM?document.createElement("div"):null,l={},u=[1,'<select multiple="true">',"</select>"],s=[1,"<table>","</table>"],c=[3,"<table><tbody><tr>","</tr></tbody></table>"],d=[1,'<svg xmlns="http://www.w3.org/2000/svg">',"</svg>"],f={"*":[1,"?<div>","</div>"],area:[1,"<map>","</map>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],legend:[1,"<fieldset>","</fieldset>"],param:[1,"<object>","</object>"],tr:[2,"<table><tbody>","</tbody></table>"],optgroup:u,option:u,caption:s,colgroup:s,tbody:s,tfoot:s,thead:s,td:c,th:c},p=["circle","clipPath","defs","ellipse","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","text","tspan"];p.forEach(function(e){f[e]=d,l[e]=!0}),e.exports=o},function(e,t){"use strict";function n(e){return e.Window&&e instanceof e.Window?{x:e.pageXOffset||e.document.documentElement.scrollLeft,y:e.pageYOffset||e.document.documentElement.scrollTop}:{x:e.scrollLeft,y:e.scrollTop}}e.exports=n},function(e,t){"use strict";function n(e){return e.replace(o,"-$1").toLowerCase()}var o=/([A-Z])/g;e.exports=n},function(e,t,n){"use strict";function o(e){return r(e).replace(a,"-ms-")}var r=n(278),a=/^ms-/;e.exports=o},function(e,t){"use strict";function n(e){var t=e?e.ownerDocument||e:document,n=t.defaultView||window;return!(!e||!("function"==typeof n.Node?e instanceof n.Node:"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName))}e.exports=n},function(e,t,n){"use strict";function o(e){return r(e)&&3==e.nodeType}var r=n(280);e.exports=o},function(e,t){"use strict";function n(e){var t={};return function(n){return t.hasOwnProperty(n)||(t[n]=e.call(this,n)),t[n]}}e.exports=n},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){return function(n,o,r,a,i){var s=r||"<<anonymous>>",c=i||o;if(null!=n[o]){var d=r+"."+o;(0,l["default"])(u[d],"The "+a+" `"+c+"` of "+("`"+s+"` is deprecated. "+t+".")),u[d]=!0}for(var f=arguments.length,p=Array(f>5?f-5:0),h=5;h<f;h++)p[h-5]=arguments[h];return e.apply(void 0,[n,o,r,a,i].concat(p))}}function a(){u={}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=r;var i=n(22),l=o(i),u={};r._resetWarned=a,e.exports=t["default"]},function(e,t,n){"use strict";function o(e,t,n,o,r){}e.exports=o},function(e,t,n){"use strict";function o(){}var r=n(151);e.exports=function(){function e(e,t,n,o,a,i){if(i!==r){var l=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return n.checkPropTypes=o,n.PropTypes=n,n}},function(e,t,n){"use strict";function o(){return null}var r=n(14),a=n(151),i=n(284),l=function(){};e.exports=function(e,t){function n(e){var t=e&&(T&&e[T]||e[O]);if("function"==typeof t)return t}function u(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}function s(e){this.message=e,this.stack=""}function c(e){function n(n,o,r,i,l,u,c){if(i=i||M,u=u||r,c!==a&&t){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}return null==o[r]?n?new s(null===o[r]?"The "+l+" `"+u+"` is marked as required "+("in `"+i+"`, but its value is `null`."):"The "+l+" `"+u+"` is marked as required in "+("`"+i+"`, but its value is `undefined`.")):null:e(o,r,i,l,u)}var o=n.bind(null,!1);return o.isRequired=n.bind(null,!0),o}function d(e){function t(t,n,o,r,a,i){var l=t[n],u=N(l);if(u!==e){var c=k(l);return new s("Invalid "+r+" `"+a+"` of type "+("`"+c+"` supplied to `"+o+"`, expected ")+("`"+e+"`."))}return null}return c(t)}function f(){return c(o)}function p(e){function t(t,n,o,r,i){if("function"!=typeof e)return new s("Property `"+i+"` of component `"+o+"` has invalid PropType notation inside arrayOf.");var l=t[n];if(!Array.isArray(l)){var u=N(l);return new s("Invalid "+r+" `"+i+"` of type "+("`"+u+"` supplied to `"+o+"`, expected an array."))}for(var c=0;c<l.length;c++){var d=e(l,c,o,r,i+"["+c+"]",a);if(d instanceof Error)return d}return null}return c(t)}function h(){function t(t,n,o,r,a){var i=t[n];if(!e(i)){var l=N(i);return new s("Invalid "+r+" `"+a+"` of type "+("`"+l+"` supplied to `"+o+"`, expected a single ReactElement."))}return null}return c(t)}function m(e){function t(t,n,o,r,a){if(!(t[n]instanceof e)){var i=e.name||M,l=S(t[n]);return new s("Invalid "+r+" `"+a+"` of type "+("`"+l+"` supplied to `"+o+"`, expected ")+("instance of `"+i+"`."))}return null}return c(t)}function v(e){function t(t,n,o,r,a){for(var i=t[n],l=0;l<e.length;l++)if(u(i,e[l]))return null;var c=JSON.stringify(e);return new s("Invalid "+r+" `"+a+"` of value `"+i+"` "+("supplied to `"+o+"`, expected one of "+c+"."))}return Array.isArray(e)?c(t):o}function y(e){function t(t,n,o,r,i){if("function"!=typeof e)return new s("Property `"+i+"` of component `"+o+"` has invalid PropType notation inside objectOf.");var l=t[n],u=N(l);if("object"!==u)return new s("Invalid "+r+" `"+i+"` of type "+("`"+u+"` supplied to `"+o+"`, expected an object."));for(var c in l)if(l.hasOwnProperty(c)){var d=e(l,c,o,r,i+"."+c,a);if(d instanceof Error)return d}return null}return c(t)}function g(e){function t(t,n,o,r,i){for(var l=0;l<e.length;l++){var u=e[l];if(null==u(t,n,o,r,i,a))return null}return new s("Invalid "+r+" `"+i+"` supplied to "+("`"+o+"`."))}if(!Array.isArray(e))return o;for(var n=0;n<e.length;n++){var r=e[n];if("function"!=typeof r)return l("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+w(r)+" at index "+n+"."),o}return c(t)}function b(){function e(e,t,n,o,r){return E(e[t])?null:new s("Invalid "+o+" `"+r+"` supplied to "+("`"+n+"`, expected a ReactNode."))}return c(e)}function _(e){function t(t,n,o,r,i){var l=t[n],u=N(l);if("object"!==u)return new s("Invalid "+r+" `"+i+"` of type `"+u+"` "+("supplied to `"+o+"`, expected `object`."));for(var c in e){var d=e[c];if(d){var f=d(l,c,o,r,i+"."+c,a);if(f)return f}}return null}return c(t)}function C(e){function t(t,n,o,i,l){var u=t[n],c=N(u);if("object"!==c)return new s("Invalid "+i+" `"+l+"` of type `"+c+"` "+("supplied to `"+o+"`, expected `object`."));var d=r({},t[n],e);for(var f in d){var p=e[f];if(!p)return new s("Invalid "+i+" `"+l+"` key `"+f+"` supplied to `"+o+"`.\nBad object: "+JSON.stringify(t[n],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(e),null,"  "));var h=p(u,f,o,i,l+"."+f,a);if(h)return h}return null}return c(t)}function E(t){switch(typeof t){case"number":case"string":case"undefined":return!0;case"boolean":return!t;case"object":if(Array.isArray(t))return t.every(E);if(null===t||e(t))return!0;var o=n(t);if(!o)return!1;var r,a=o.call(t);if(o!==t.entries){for(;!(r=a.next()).done;)if(!E(r.value))return!1}else for(;!(r=a.next()).done;){var i=r.value;if(i&&!E(i[1]))return!1}return!0;default:return!1}}function x(e,t){return"symbol"===e||"Symbol"===t["@@toStringTag"]||"function"==typeof Symbol&&t instanceof Symbol}function N(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":x(t,e)?"symbol":t}function k(e){if("undefined"==typeof e||null===e)return""+e;var t=N(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function w(e){var t=k(e);switch(t){case"array":case"object":return"an "+t;case"boolean":case"date":case"regexp":return"a "+t;default:return t}}function S(e){return e.constructor&&e.constructor.name?e.constructor.name:M}var T="function"==typeof Symbol&&Symbol.iterator,O="@@iterator",M="<<anonymous>>",P={array:d("array"),bool:d("boolean"),func:d("function"),number:d("number"),object:d("object"),string:d("string"),symbol:d("symbol"),any:f(),arrayOf:p,element:h(),instanceOf:m,node:b(),objectOf:y,oneOf:v,oneOfType:g,shape:_,exact:C};return s.prototype=Error.prototype,P.checkPropTypes=i,P.PropTypes=P,P}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(2),l=o(i),u=n(4),s=o(u),c=n(3),d=o(c),f=n(1),p=o(f),h=n(167),m=o(h),v=function(e){function t(){return(0,l["default"])(this,t),(0,s["default"])(this,e.apply(this,arguments))}return(0,d["default"])(t,e),t.prototype.render=function(){return p["default"].createElement(m["default"],(0,a["default"])({},this.props,{accordion:!0}),this.props.children)},t}(p["default"].Component);t["default"]=v,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(38),a=o(r),i=n(5),l=o(i),u=n(6),s=o(u),c=n(2),d=o(c),f=n(4),p=o(f),h=n(3),m=o(h),v=n(7),y=o(v),g=n(1),b=o(g),_=n(8),C=o(_),E=n(9),x=n(18),N=n(103),k=o(N),w={onDismiss:C["default"].func,closeLabel:C["default"].string},S={closeLabel:"Close alert"},T=function(e){function t(){return(0,d["default"])(this,t),(0,p["default"])(this,e.apply(this,arguments))}return(0,m["default"])(t,e),t.prototype.render=function(){var e,t=this.props,n=t.onDismiss,o=t.closeLabel,r=t.className,a=t.children,i=(0,s["default"])(t,["onDismiss","closeLabel","className","children"]),u=(0,E.splitBsProps)(i),c=u[0],d=u[1],f=!!n,p=(0,l["default"])({},(0,E.getClassSet)(c),(e={},e[(0,E.prefix)(c,"dismissable")]=f,e));return b["default"].createElement("div",(0,l["default"])({},d,{role:"alert",className:(0,y["default"])(r,p)}),f&&b["default"].createElement(k["default"],{onClick:n,label:o}),a)},t}(b["default"].Component);T.propTypes=w,T.defaultProps=S,t["default"]=(0,E.bsStyles)((0,a["default"])(x.State),x.State.INFO,(0,E.bsClass)("alert",T)),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(9),C={pullRight:b["default"].bool},E={pullRight:!1},x=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.hasContent=function(e){var t=!1;return y["default"].Children.forEach(e,function(e){t||(e||0===e)&&(t=!0)}),t},t.prototype.render=function(){var e=this.props,t=e.pullRight,n=e.className,o=e.children,r=(0,l["default"])(e,["pullRight","className","children"]),i=(0,_.splitBsProps)(r),u=i[0],s=i[1],c=(0,a["default"])({},(0,_.getClassSet)(u),{"pull-right":t,hidden:!this.hasContent(o)});return y["default"].createElement("span",(0,a["default"])({},s,{className:(0,m["default"])(n,c)}),o)},t}(y["default"].Component);x.propTypes=C,x.defaultProps=E,t["default"]=(0,_.bsClass)("badge",x),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(152),b=o(g),_=n(9),C=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=(0,l["default"])(e,["className"]),o=(0,_.splitBsProps)(n),r=o[0],i=o[1],u=(0,_.getClassSet)(r);return y["default"].createElement("ol",(0,a["default"])({},i,{role:"navigation","aria-label":"breadcrumbs",className:(0,m["default"])(t,u)}))},t}(y["default"].Component);C.Item=b["default"],t["default"]=(0,_.bsClass)("breadcrumb",C),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(9),b=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=(0,l["default"])(e,["className"]),o=(0,g.splitBsProps)(n),r=o[0],i=o[1],u=(0,g.getClassSet)(r);return y["default"].createElement("div",(0,a["default"])({},i,{role:"toolbar",className:(0,m["default"])(t,u)}))},t}(y["default"].Component);t["default"]=(0,g.bsClass)("btn-toolbar",b),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(293),C=o(_),E=n(153),x=o(E),N=n(105),k=o(N),w=n(27),S=o(w),T=n(9),O=n(21),M=o(O),P={slide:b["default"].bool,indicators:b["default"].bool,interval:b["default"].number,controls:b["default"].bool,pauseOnHover:b["default"].bool,wrap:b["default"].bool,onSelect:b["default"].func,onSlideEnd:b["default"].func,activeIndex:b["default"].number,defaultActiveIndex:b["default"].number,direction:b["default"].oneOf(["prev","next"]),prevIcon:b["default"].node,prevLabel:b["default"].string,nextIcon:b["default"].node,nextLabel:b["default"].string},D={slide:!0,interval:5e3,pauseOnHover:!0,wrap:!0,indicators:!0,controls:!0,prevIcon:y["default"].createElement(k["default"],{glyph:"chevron-left"}),prevLabel:"Previous",nextIcon:y["default"].createElement(k["default"],{glyph:"chevron-right"}),nextLabel:"Next"},I=function(e){function t(n,o){(0,s["default"])(this,t);var r=(0,d["default"])(this,e.call(this,n,o));r.handleMouseOver=r.handleMouseOver.bind(r),r.handleMouseOut=r.handleMouseOut.bind(r),r.handlePrev=r.handlePrev.bind(r),r.handleNext=r.handleNext.bind(r),r.handleItemAnimateOutEnd=r.handleItemAnimateOutEnd.bind(r);var a=n.defaultActiveIndex;return r.state={activeIndex:null!=a?a:0,previousActiveIndex:null,direction:null},r.isUnmounted=!1,r}return(0,p["default"])(t,e),t.prototype.componentDidMount=function(){this.waitForNext()},t.prototype.componentWillReceiveProps=function(e){var t=this.getActiveIndex();null!=e.activeIndex&&e.activeIndex!==t&&(clearTimeout(this.timeout),this.setState({previousActiveIndex:t,direction:null!=e.direction?e.direction:this.getDirection(t,e.activeIndex)})),null==e.activeIndex&&this.state.activeIndex>=e.children.length&&this.setState({activeIndex:0,previousActiveIndex:null,direction:null})},t.prototype.componentWillUnmount=function(){clearTimeout(this.timeout),this.isUnmounted=!0},t.prototype.getActiveIndex=function(){var e=this.props.activeIndex;return null!=e?e:this.state.activeIndex},t.prototype.getDirection=function(e,t){return e===t?null:e>t?"prev":"next"},t.prototype.handleItemAnimateOutEnd=function(){var e=this;this.setState({previousActiveIndex:null,direction:null},function(){e.waitForNext(),e.props.onSlideEnd&&e.props.onSlideEnd()})},t.prototype.handleMouseOut=function(){this.isPaused&&this.play()},t.prototype.handleMouseOver=function(){this.props.pauseOnHover&&this.pause()},t.prototype.handleNext=function(e){var t=this.getActiveIndex()+1,n=M["default"].count(this.props.children);if(t>n-1){if(!this.props.wrap)return;t=0}this.select(t,e,"next")},t.prototype.handlePrev=function(e){var t=this.getActiveIndex()-1;if(t<0){if(!this.props.wrap)return;t=M["default"].count(this.props.children)-1}this.select(t,e,"prev")},t.prototype.pause=function(){this.isPaused=!0,clearTimeout(this.timeout)},t.prototype.play=function(){this.isPaused=!1,this.waitForNext()},t.prototype.select=function(e,t,n){if(clearTimeout(this.timeout),!this.isUnmounted){var o=this.props.slide?this.getActiveIndex():null;n=n||this.getDirection(o,e);var r=this.props.onSelect;if(r&&(r.length>1?(t?(t.persist(),t.direction=n):t={direction:n},r(e,t)):r(e)),null==this.props.activeIndex&&e!==o){if(null!=this.state.previousActiveIndex)return;this.setState({activeIndex:e,previousActiveIndex:o,direction:n})}}},t.prototype.waitForNext=function(){var e=this.props,t=e.slide,n=e.interval,o=e.activeIndex;!this.isPaused&&t&&n&&null==o&&(this.timeout=setTimeout(this.handleNext,n))},t.prototype.renderControls=function(e){var t=e.wrap,n=e.children,o=e.activeIndex,r=e.prevIcon,a=e.nextIcon,i=e.bsProps,l=e.prevLabel,u=e.nextLabel,s=(0,T.prefix)(i,"control"),c=M["default"].count(n);return[(t||0!==o)&&y["default"].createElement(S["default"],{key:"prev",className:(0,m["default"])(s,"left"),onClick:this.handlePrev},r,l&&y["default"].createElement("span",{className:"sr-only"},l)),(t||o!==c-1)&&y["default"].createElement(S["default"],{key:"next",className:(0,m["default"])(s,"right"),onClick:this.handleNext},a,u&&y["default"].createElement("span",{className:"sr-only"},u))]},t.prototype.renderIndicators=function(e,t,n){var o=this,r=[];return M["default"].forEach(e,function(e,n){r.push(y["default"].createElement("li",{key:n,className:n===t?"active":null,onClick:function(e){return o.select(n,e)}})," ")}),y["default"].createElement("ol",{className:(0,T.prefix)(n,"indicators")},r)},t.prototype.render=function(){var e=this,t=this.props,n=t.slide,o=t.indicators,r=t.controls,i=t.wrap,u=t.prevIcon,s=t.prevLabel,c=t.nextIcon,d=t.nextLabel,f=t.className,p=t.children,h=(0,l["default"])(t,["slide","indicators","controls","wrap","prevIcon","prevLabel","nextIcon","nextLabel","className","children"]),g=this.state,b=g.previousActiveIndex,_=g.direction,C=(0,T.splitBsPropsAndOmit)(h,["interval","pauseOnHover","onSelect","onSlideEnd","activeIndex","defaultActiveIndex","direction"]),E=C[0],x=C[1],N=this.getActiveIndex(),k=(0,a["default"])({},(0,T.getClassSet)(E),{slide:n});return y["default"].createElement("div",(0,a["default"])({},x,{className:(0,m["default"])(f,k),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut}),o&&this.renderIndicators(p,N,E),y["default"].createElement("div",{className:(0,T.prefix)(E,"inner")},M["default"].map(p,function(t,o){var r=o===N,a=n&&o===b;return(0,v.cloneElement)(t,{active:r,index:o,animateOut:a,animateIn:r&&null!=b&&n,direction:_,onAnimateOutEnd:a?e.handleItemAnimateOutEnd:null})})),r&&this.renderControls({wrap:i,children:p,activeIndex:N,prevIcon:u,prevLabel:s,nextIcon:c,nextLabel:d,bsProps:E}))},t}(y["default"].Component);I.propTypes=P,I.defaultProps=D,I.Caption=C["default"],I.Item=x["default"],t["default"]=(0,T.bsClass)("carousel",I),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(13),b=o(g),_=n(9),C={componentClass:b["default"]},E={componentClass:"div"},x=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.componentClass,n=e.className,o=(0,l["default"])(e,["componentClass","className"]),r=(0,_.splitBsProps)(o),i=r[0],u=r[1],s=(0,_.getClassSet)(i);return y["default"].createElement(t,(0,a["default"])({},u,{className:(0,m["default"])(n,s)}))},t}(y["default"].Component);x.propTypes=C,x.defaultProps=E,t["default"]=(0,_.bsClass)("carousel-caption",x),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(22),C=(o(_),n(9)),E={inline:b["default"].bool,disabled:b["default"].bool,title:b["default"].string,validationState:b["default"].oneOf(["success","warning","error",null]),inputRef:b["default"].func},x={inline:!1,disabled:!1,title:""},N=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.inline,n=e.disabled,o=e.validationState,r=e.inputRef,i=e.className,u=e.style,s=e.title,c=e.children,d=(0,l["default"])(e,["inline","disabled","validationState","inputRef","className","style","title","children"]),f=(0,C.splitBsProps)(d),p=f[0],h=f[1],v=y["default"].createElement("input",(0,a["default"])({},h,{ref:r,type:"checkbox",disabled:n}));if(t){var g,b=(g={},g[(0,C.prefix)(p,"inline")]=!0,g.disabled=n,g);return y["default"].createElement("label",{className:(0,m["default"])(i,b),style:u,title:s},v,c)}var _=(0,a["default"])({},(0,C.getClassSet)(p),{disabled:n});return o&&(_["has-"+o]=!0),y["default"].createElement("div",{className:(0,m["default"])(i,_),style:u},y["default"].createElement("label",{title:s},v,c))},t}(y["default"].Component);N.propTypes=E,N.defaultProps=x,t["default"]=(0,C.bsClass)("checkbox",N),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(13),C=o(_),E=n(9),x=n(170),N=o(x),k=n(18),w={componentClass:C["default"],visibleXsBlock:b["default"].bool,visibleSmBlock:b["default"].bool,visibleMdBlock:b["default"].bool,visibleLgBlock:b["default"].bool},S={componentClass:"div"},T=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.componentClass,n=e.className,o=(0,l["default"])(e,["componentClass","className"]),r=(0,E.splitBsProps)(o),i=r[0],u=r[1],s=(0,E.getClassSet)(i);return k.DEVICE_SIZES.forEach(function(e){var t="visible"+(0,N["default"])(e)+"Block";u[t]&&(s["visible-"+e+"-block"]=!0),delete u[t]}),y["default"].createElement(t,(0,a["default"])({},u,{className:(0,m["default"])(n,s)}))},t}(y["default"].Component);T.propTypes=w,T.defaultProps=S,t["default"]=(0,E.bsClass)("clearfix",T),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(13),C=o(_),E=n(9),x=n(18),N={componentClass:C["default"],xs:b["default"].number,sm:b["default"].number,md:b["default"].number,lg:b["default"].number,xsHidden:b["default"].bool,smHidden:b["default"].bool,mdHidden:b["default"].bool,lgHidden:b["default"].bool,xsOffset:b["default"].number,smOffset:b["default"].number,mdOffset:b["default"].number,lgOffset:b["default"].number,xsPush:b["default"].number,smPush:b["default"].number,mdPush:b["default"].number,lgPush:b["default"].number,xsPull:b["default"].number,smPull:b["default"].number,mdPull:b["default"].number,lgPull:b["default"].number},k={componentClass:"div"},w=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.componentClass,n=e.className,o=(0,l["default"])(e,["componentClass","className"]),r=(0,E.splitBsProps)(o),i=r[0],u=r[1],s=[];return x.DEVICE_SIZES.forEach(function(e){function t(t,n){var o=""+e+t,r=u[o];null!=r&&s.push((0,E.prefix)(i,""+e+n+"-"+r)),delete u[o]}t("",""),t("Offset","-offset"),t("Push","-push"),t("Pull","-pull");var n=e+"Hidden";u[n]&&s.push("hidden-"+e),delete u[n]}),y["default"].createElement(t,(0,a["default"])({},u,{className:(0,m["default"])(n,s)}))},t}(y["default"].Component);w.propTypes=N,w.defaultProps=k,t["default"]=(0,E.bsClass)("col",w),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(22),C=(o(_),n(9)),E={htmlFor:b["default"].string,srOnly:b["default"].bool},x={srOnly:!1},N={$bs_formGroup:b["default"].object},k=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.context.$bs_formGroup,t=e&&e.controlId,n=this.props,o=n.htmlFor,r=void 0===o?t:o,i=n.srOnly,u=n.className,s=(0,l["default"])(n,["htmlFor","srOnly","className"]),c=(0,C.splitBsProps)(s),d=c[0],f=c[1],p=(0,a["default"])({},(0,C.getClassSet)(d),{"sr-only":i});return y["default"].createElement("label",(0,a["default"])({},f,{htmlFor:r,className:(0,m["default"])(u,p)}))},t}(y["default"].Component);k.propTypes=E,k.defaultProps=x,k.contextTypes=N,t["default"]=(0,C.bsClass)("control-label",k),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(6),a=o(r),i=n(2),l=o(i),u=n(4),s=o(u),c=n(3),d=o(c),f=n(5),p=o(f),h=n(1),m=o(h),v=n(8),y=o(v),g=n(73),b=o(g),_=n(76),C=o(_),E=(0,p["default"])({},b["default"].propTypes,{bsStyle:y["default"].string,bsSize:y["default"].string,title:y["default"].node.isRequired,noCaret:y["default"].bool,children:y["default"].node}),x=function(e){function t(){return(0,l["default"])(this,t),(0,s["default"])(this,e.apply(this,arguments))}return(0,d["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.bsSize,n=e.bsStyle,o=e.title,r=e.children,i=(0,a["default"])(e,["bsSize","bsStyle","title","children"]),l=(0,C["default"])(i,b["default"].ControlledComponent),u=l[0],s=l[1];return m["default"].createElement(b["default"],(0,p["default"])({},u,{bsSize:t,bsStyle:n}),m["default"].createElement(b["default"].Toggle,(0,p["default"])({},s,{bsSize:t,bsStyle:n}),o),m["default"].createElement(b["default"].Menu,null,r))},t}(m["default"].Component);x.propTypes=E,t["default"]=x,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(207),s=o(u),c=n(2),d=o(c),f=n(4),p=o(f),h=n(3),m=o(h),v=n(7),y=o(v),g=n(101),b=o(g),_=n(1),C=o(_),E=n(8),x=o(E),N=n(19),k=o(N),w=n(193),S=o(w),T=n(9),O=n(17),M=o(O),P=n(21),D=o(P),I={open:x["default"].bool,pullRight:x["default"].bool,onClose:x["default"].func,labelledBy:x["default"].oneOfType([x["default"].string,x["default"].number]),onSelect:x["default"].func,rootCloseEvent:x["default"].oneOf(["click","mousedown"])},A={bsRole:"menu",pullRight:!1},R=function(e){function t(n){(0,d["default"])(this,t);var o=(0,p["default"])(this,e.call(this,n));return o.handleRootClose=o.handleRootClose.bind(o),o.handleKeyDown=o.handleKeyDown.bind(o),o}return(0,m["default"])(t,e),t.prototype.getFocusableMenuItems=function(){var e=k["default"].findDOMNode(this);return e?(0,s["default"])(e.querySelectorAll('[tabIndex="-1"]')):[]},t.prototype.getItemsAndActiveIndex=function(){var e=this.getFocusableMenuItems(),t=e.indexOf(document.activeElement);return{items:e,activeIndex:t}},t.prototype.focusNext=function(){var e=this.getItemsAndActiveIndex(),t=e.items,n=e.activeIndex;if(0!==t.length){var o=n===t.length-1?0:n+1;t[o].focus()}},t.prototype.focusPrevious=function(){var e=this.getItemsAndActiveIndex(),t=e.items,n=e.activeIndex;if(0!==t.length){var o=0===n?t.length-1:n-1;t[o].focus()}},t.prototype.handleKeyDown=function(e){switch(e.keyCode){case b["default"].codes.down:this.focusNext(),e.preventDefault();break;case b["default"].codes.up:this.focusPrevious(),e.preventDefault();break;case b["default"].codes.esc:case b["default"].codes.tab:this.props.onClose(e,{source:"keydown"})}},t.prototype.handleRootClose=function(e){this.props.onClose(e,{source:"rootClose"})},t.prototype.render=function(){var e,t=this,n=this.props,o=n.open,r=n.pullRight,i=n.labelledBy,u=n.onSelect,s=n.className,c=n.rootCloseEvent,d=n.children,f=(0,l["default"])(n,["open","pullRight","labelledBy","onSelect","className","rootCloseEvent","children"]),p=(0,T.splitBsPropsAndOmit)(f,["onClose"]),h=p[0],m=p[1],v=(0,a["default"])({},(0,T.getClassSet)(h),(e={},e[(0,T.prefix)(h,"right")]=r,e));return C["default"].createElement(S["default"],{disabled:!o,onRootClose:this.handleRootClose,event:c},C["default"].createElement("ul",(0,a["default"])({},m,{role:"menu",className:(0,y["default"])(s,v),"aria-labelledby":i}),D["default"].map(d,function(e){
return C["default"].cloneElement(e,{onKeyDown:(0,M["default"])(e.props.onKeyDown,t.handleKeyDown),onSelect:(0,M["default"])(e.props.onSelect,u)})})))},t}(C["default"].Component);R.propTypes=I,R.defaultProps=A,t["default"]=(0,T.bsClass)("dropdown-menu",R),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(13),C=o(_),E=n(9),x={horizontal:b["default"].bool,inline:b["default"].bool,componentClass:C["default"]},N={horizontal:!1,inline:!1,componentClass:"form"},k=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.horizontal,n=e.inline,o=e.componentClass,r=e.className,i=(0,l["default"])(e,["horizontal","inline","componentClass","className"]),u=(0,E.splitBsProps)(i),s=u[0],c=u[1],d=[];return t&&d.push((0,E.prefix)(s,"horizontal")),n&&d.push((0,E.prefix)(s,"inline")),y["default"].createElement(o,(0,a["default"])({},c,{className:(0,m["default"])(r,d)}))},t}(y["default"].Component);k.propTypes=x,k.defaultProps=N,t["default"]=(0,E.bsClass)("form",k),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(13),C=o(_),E=n(22),x=(o(E),n(302)),N=o(x),k=n(303),w=o(k),S=n(9),T=n(18),O={componentClass:C["default"],type:b["default"].string,id:b["default"].string,inputRef:b["default"].func},M={componentClass:"input"},P={$bs_formGroup:b["default"].object},D=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.context.$bs_formGroup,t=e&&e.controlId,n=this.props,o=n.componentClass,r=n.type,i=n.id,u=void 0===i?t:i,s=n.inputRef,c=n.className,d=n.bsSize,f=(0,l["default"])(n,["componentClass","type","id","inputRef","className","bsSize"]),p=(0,S.splitBsProps)(f),h=p[0],v=p[1],g=void 0;if("file"!==r&&(g=(0,S.getClassSet)(h)),d){var b=T.SIZE_MAP[d]||d;g[(0,S.prefix)({bsClass:"input"},b)]=!0}return y["default"].createElement(o,(0,a["default"])({},v,{type:r,id:u,ref:s,className:(0,m["default"])(c,g)}))},t}(y["default"].Component);D.propTypes=O,D.defaultProps=M,D.contextTypes=P,D.Feedback=N["default"],D.Static=w["default"],t["default"]=(0,S.bsClass)("form-control",(0,S.bsSizes)([T.Size.SMALL,T.Size.LARGE],D)),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(6),a=o(r),i=n(5),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(105),C=o(_),E=n(9),x={bsRole:"feedback"},N={$bs_formGroup:b["default"].object},k=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.getGlyph=function(e){switch(e){case"success":return"ok";case"warning":return"warning-sign";case"error":return"remove";default:return null}},t.prototype.renderDefaultFeedback=function(e,t,n,o){var r=this.getGlyph(e&&e.validationState);return r?y["default"].createElement(C["default"],(0,l["default"])({},o,{glyph:r,className:(0,m["default"])(t,n)})):null},t.prototype.render=function(){var e=this.props,t=e.className,n=e.children,o=(0,a["default"])(e,["className","children"]),r=(0,E.splitBsProps)(o),i=r[0],u=r[1],s=(0,E.getClassSet)(i);if(!n)return this.renderDefaultFeedback(this.context.$bs_formGroup,t,s,u);var c=y["default"].Children.only(n);return y["default"].cloneElement(c,(0,l["default"])({},u,{className:(0,m["default"])(c.props.className,t,s)}))},t}(y["default"].Component);k.defaultProps=x,k.contextTypes=N,t["default"]=(0,E.bsClass)("form-control-feedback",k),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(13),b=o(g),_=n(9),C={componentClass:b["default"]},E={componentClass:"p"},x=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.componentClass,n=e.className,o=(0,l["default"])(e,["componentClass","className"]),r=(0,_.splitBsProps)(o),i=r[0],u=r[1],s=(0,_.getClassSet)(i);return y["default"].createElement(t,(0,a["default"])({},u,{className:(0,m["default"])(n,s)}))},t}(y["default"].Component);x.propTypes=C,x.defaultProps=E,t["default"]=(0,_.bsClass)("form-control-static",x),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(9),C=n(18),E=n(21),x=o(E),N={controlId:b["default"].string,validationState:b["default"].oneOf(["success","warning","error",null])},k={$bs_formGroup:b["default"].object.isRequired},w=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.getChildContext=function(){var e=this.props,t=e.controlId,n=e.validationState;return{$bs_formGroup:{controlId:t,validationState:n}}},t.prototype.hasFeedback=function(e){var t=this;return x["default"].some(e,function(e){return"feedback"===e.props.bsRole||e.props.children&&t.hasFeedback(e.props.children)})},t.prototype.render=function(){var e=this.props,t=e.validationState,n=e.className,o=e.children,r=(0,l["default"])(e,["validationState","className","children"]),i=(0,_.splitBsPropsAndOmit)(r,["controlId"]),u=i[0],s=i[1],c=(0,a["default"])({},(0,_.getClassSet)(u),{"has-feedback":this.hasFeedback(o)});return t&&(c["has-"+t]=!0),y["default"].createElement("div",(0,a["default"])({},s,{className:(0,m["default"])(n,c)}),o)},t}(y["default"].Component);w.propTypes=N,w.childContextTypes=k,t["default"]=(0,_.bsClass)("form-group",(0,_.bsSizes)([C.Size.LARGE,C.Size.SMALL],w)),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(9),b=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=(0,l["default"])(e,["className"]),o=(0,g.splitBsProps)(n),r=o[0],i=o[1],u=(0,g.getClassSet)(r);return y["default"].createElement("span",(0,a["default"])({},i,{className:(0,m["default"])(t,u)}))},t}(y["default"].Component);t["default"]=(0,g.bsClass)("help-block",b),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(9),C={responsive:b["default"].bool,rounded:b["default"].bool,circle:b["default"].bool,thumbnail:b["default"].bool},E={responsive:!1,rounded:!1,circle:!1,thumbnail:!1},x=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e,t=this.props,n=t.responsive,o=t.rounded,r=t.circle,i=t.thumbnail,u=t.className,s=(0,l["default"])(t,["responsive","rounded","circle","thumbnail","className"]),c=(0,_.splitBsProps)(s),d=c[0],f=c[1],p=(e={},e[(0,_.prefix)(d,"responsive")]=n,e[(0,_.prefix)(d,"rounded")]=o,e[(0,_.prefix)(d,"circle")]=r,e[(0,_.prefix)(d,"thumbnail")]=i,e);return y["default"].createElement("img",(0,a["default"])({},f,{className:(0,m["default"])(u,p)}))},t}(y["default"].Component);x.propTypes=C,x.defaultProps=E,t["default"]=(0,_.bsClass)("img",x),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(308),b=o(g),_=n(309),C=o(_),E=n(9),x=n(18),N=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=(0,l["default"])(e,["className"]),o=(0,E.splitBsProps)(n),r=o[0],i=o[1],u=(0,E.getClassSet)(r);return y["default"].createElement("span",(0,a["default"])({},i,{className:(0,m["default"])(t,u)}))},t}(y["default"].Component);N.Addon=b["default"],N.Button=C["default"],t["default"]=(0,E.bsClass)("input-group",(0,E.bsSizes)([x.Size.LARGE,x.Size.SMALL],N)),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(9),b=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=(0,l["default"])(e,["className"]),o=(0,g.splitBsProps)(n),r=o[0],i=o[1],u=(0,g.getClassSet)(r);return y["default"].createElement("span",(0,a["default"])({},i,{className:(0,m["default"])(t,u)}))},t}(y["default"].Component);t["default"]=(0,g.bsClass)("input-group-addon",b),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(9),b=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=(0,l["default"])(e,["className"]),o=(0,g.splitBsProps)(n),r=o[0],i=o[1],u=(0,g.getClassSet)(r);return y["default"].createElement("span",(0,a["default"])({},i,{className:(0,m["default"])(t,u)}))},t}(y["default"].Component);t["default"]=(0,g.bsClass)("input-group-btn",b),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(1),m=o(h),v=n(7),y=o(v),g=n(13),b=o(g),_=n(9),C={componentClass:b["default"]},E={componentClass:"div"},x=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.componentClass,n=e.className,o=(0,l["default"])(e,["componentClass","className"]),r=(0,_.splitBsProps)(o),i=r[0],u=r[1],s=(0,_.getClassSet)(i);return m["default"].createElement(t,(0,a["default"])({},u,{className:(0,y["default"])(n,s)}))},t}(m["default"].Component);x.propTypes=C,x.defaultProps=E,t["default"]=(0,_.bsClass)("jumbotron",x),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(38),a=o(r),i=n(5),l=o(i),u=n(6),s=o(u),c=n(2),d=o(c),f=n(4),p=o(f),h=n(3),m=o(h),v=n(7),y=o(v),g=n(1),b=o(g),_=n(9),C=n(18),E=function(e){function t(){return(0,d["default"])(this,t),(0,p["default"])(this,e.apply(this,arguments))}return(0,m["default"])(t,e),t.prototype.hasContent=function(e){var t=!1;return b["default"].Children.forEach(e,function(e){t||(e||0===e)&&(t=!0)}),t},t.prototype.render=function(){var e=this.props,t=e.className,n=e.children,o=(0,s["default"])(e,["className","children"]),r=(0,_.splitBsProps)(o),a=r[0],i=r[1],u=(0,l["default"])({},(0,_.getClassSet)(a),{hidden:!this.hasContent(n)});return b["default"].createElement("span",(0,l["default"])({},i,{className:(0,y["default"])(t,u)}),n)},t}(b["default"].Component);t["default"]=(0,_.bsClass)("label",(0,_.bsStyles)([].concat((0,a["default"])(C.State),[C.Style.DEFAULT,C.Style.PRIMARY]),C.Style.DEFAULT,E)),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e){return e?k["default"].some(e,function(e){return e.type!==E["default"]||e.props.href||e.props.onClick})?"div":"ul":"div"}t.__esModule=!0;var a=n(5),i=o(a),l=n(6),u=o(l),s=n(2),c=o(s),d=n(4),f=o(d),p=n(3),h=o(p),m=n(7),v=o(m),y=n(1),g=o(y),b=n(13),_=o(b),C=n(156),E=o(C),x=n(9),N=n(21),k=o(N),w={componentClass:_["default"]},S=function(e){function t(){return(0,c["default"])(this,t),(0,f["default"])(this,e.apply(this,arguments))}return(0,h["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.children,n=e.componentClass,o=void 0===n?r(t):n,a=e.className,l=(0,u["default"])(e,["children","componentClass","className"]),s=(0,x.splitBsProps)(l),c=s[0],d=s[1],f=(0,x.getClassSet)(c),p="ul"===o&&k["default"].every(t,function(e){return e.type===E["default"]});return g["default"].createElement(o,(0,i["default"])({},d,{className:(0,v["default"])(a,f)}),p?k["default"].map(t,function(e){return(0,y.cloneElement)(e,{listItem:!0})}):t)},t}(g["default"].Component);S.propTypes=w,t["default"]=(0,x.bsClass)("list-group",S),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(13),C=o(_),E=n(75),x=o(E),N=n(9),k={align:b["default"].oneOf(["top","middle","bottom"]),componentClass:C["default"]},w={componentClass:"div"},S=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.componentClass,n=e.align,o=e.className,r=(0,l["default"])(e,["componentClass","align","className"]),i=(0,N.splitBsProps)(r),u=i[0],s=i[1],c=(0,N.getClassSet)(u);return n&&(c[(0,N.prefix)(x["default"].defaultProps,n)]=!0),y["default"].createElement(t,(0,a["default"])({},s,{className:(0,m["default"])(o,c)}))},t}(y["default"].Component);S.propTypes=k,S.defaultProps=w,t["default"]=(0,N.bsClass)("media-body",S),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(13),b=o(g),_=n(9),C={componentClass:b["default"]},E={componentClass:"h4"},x=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.componentClass,n=e.className,o=(0,l["default"])(e,["componentClass","className"]),r=(0,_.splitBsProps)(o),i=r[0],u=r[1],s=(0,_.getClassSet)(i);return y["default"].createElement(t,(0,a["default"])({},u,{className:(0,m["default"])(n,s)}))},t}(y["default"].Component);x.propTypes=C,x.defaultProps=E,t["default"]=(0,_.bsClass)("media-heading",x),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(75),C=o(_),E=n(9),x={align:b["default"].oneOf(["top","middle","bottom"])},N=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.align,n=e.className,o=(0,l["default"])(e,["align","className"]),r=(0,E.splitBsProps)(o),i=r[0],u=r[1],s=(0,E.getClassSet)(i);return t&&(s[(0,E.prefix)(C["default"].defaultProps,t)]=!0),y["default"].createElement("div",(0,a["default"])({},u,{className:(0,m["default"])(n,s)}))},t}(y["default"].Component);N.propTypes=x,t["default"]=(0,E.bsClass)("media-left",N),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(9),b=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=(0,l["default"])(e,["className"]),o=(0,g.splitBsProps)(n),r=o[0],i=o[1],u=(0,g.getClassSet)(r);return y["default"].createElement("ul",(0,a["default"])({},i,{className:(0,m["default"])(t,u)}))},t}(y["default"].Component);t["default"]=(0,g.bsClass)("media-list",b),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(9),b=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=(0,l["default"])(e,["className"]),o=(0,g.splitBsProps)(n),r=o[0],i=o[1],u=(0,g.getClassSet)(r);return y["default"].createElement("li",(0,a["default"])({},i,{className:(0,m["default"])(t,u)}))},t}(y["default"].Component);t["default"]=(0,g.bsClass)("media",b),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(75),C=o(_),E=n(9),x={align:b["default"].oneOf(["top","middle","bottom"])},N=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.align,n=e.className,o=(0,l["default"])(e,["align","className"]),r=(0,E.splitBsProps)(o),i=r[0],u=r[1],s=(0,E.getClassSet)(i);return t&&(s[(0,E.prefix)(C["default"].defaultProps,t)]=!0),y["default"].createElement("div",(0,a["default"])({},u,{className:(0,m["default"])(n,s)}))},t}(y["default"].Component);N.propTypes=x,t["default"]=(0,E.bsClass)("media-right",N),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(69),C=o(_),E=n(27),x=o(E),N=n(9),k=n(17),w=o(k),S={active:b["default"].bool,disabled:b["default"].bool,divider:(0,C["default"])(b["default"].bool,function(e){var t=e.divider,n=e.children;return t&&n?new Error("Children will not be rendered for dividers"):null}),eventKey:b["default"].any,header:b["default"].bool,href:b["default"].string,onClick:b["default"].func,onSelect:b["default"].func},T={divider:!1,disabled:!1,header:!1},O=function(e){function t(n,o){(0,s["default"])(this,t);var r=(0,d["default"])(this,e.call(this,n,o));return r.handleClick=r.handleClick.bind(r),r}return(0,p["default"])(t,e),t.prototype.handleClick=function(e){var t=this.props,n=t.href,o=t.disabled,r=t.onSelect,a=t.eventKey;n&&!o||e.preventDefault(),o||r&&r(a,e)},t.prototype.render=function(){var e=this.props,t=e.active,n=e.disabled,o=e.divider,r=e.header,i=e.onClick,u=e.className,s=e.style,c=(0,l["default"])(e,["active","disabled","divider","header","onClick","className","style"]),d=(0,N.splitBsPropsAndOmit)(c,["eventKey","onSelect"]),f=d[0],p=d[1];return o?(p.children=void 0,y["default"].createElement("li",(0,a["default"])({},p,{role:"separator",className:(0,m["default"])(u,"divider"),style:s}))):r?y["default"].createElement("li",(0,a["default"])({},p,{role:"heading",className:(0,m["default"])(u,(0,N.prefix)(f,"header")),style:s})):y["default"].createElement("li",{role:"presentation",className:(0,m["default"])(u,{active:t,disabled:n}),style:s},y["default"].createElement(x["default"],(0,a["default"])({},p,{role:"menuitem",tabIndex:"-1",onClick:(0,w["default"])(i,this.handleClick)})))},t}(y["default"].Component);O.propTypes=S,O.defaultProps=T,t["default"]=(0,N.bsClass)("dropdown",O),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(6),a=o(r),i=n(2),l=o(i),u=n(4),s=o(u),c=n(3),d=o(c),f=n(5),p=o(f),h=n(7),m=o(h),v=n(259),y=o(v),g=n(42),b=o(g),_=n(33),C=o(_),E=n(145),x=o(E),N=n(1),k=o(N),w=n(8),S=o(w),T=n(19),O=o(T),M=n(417),P=o(M),D=n(196),I=o(D),A=n(13),R=o(A),L=n(74),j=o(L),B=n(157),U=o(B),F=n(321),H=o(F),V=n(158),K=o(V),W=n(159),$=o(W),q=n(160),z=o(q),G=n(9),Y=n(17),X=o(Y),Q=n(76),Z=o(Q),J=n(18),ee=(0,p["default"])({},P["default"].propTypes,H["default"].propTypes,{backdrop:S["default"].oneOf(["static",!0,!1]),backdropClassName:S["default"].string,keyboard:S["default"].bool,animation:S["default"].bool,dialogComponentClass:R["default"],autoFocus:S["default"].bool,enforceFocus:S["default"].bool,restoreFocus:S["default"].bool,show:S["default"].bool,onHide:S["default"].func,onEnter:S["default"].func,onEntering:S["default"].func,onEntered:S["default"].func,onExit:S["default"].func,onExiting:S["default"].func,onExited:S["default"].func,container:P["default"].propTypes.container}),te=(0,p["default"])({},P["default"].defaultProps,{animation:!0,dialogComponentClass:H["default"]}),ne={$bs_modal:S["default"].shape({onHide:S["default"].func})},oe=function(e){function t(n,o){(0,l["default"])(this,t);var r=(0,s["default"])(this,e.call(this,n,o));return r.handleEntering=r.handleEntering.bind(r),r.handleExited=r.handleExited.bind(r),r.handleWindowResize=r.handleWindowResize.bind(r),r.handleDialogClick=r.handleDialogClick.bind(r),r.setModalRef=r.setModalRef.bind(r),r.state={style:{}},r}return(0,d["default"])(t,e),t.prototype.getChildContext=function(){return{$bs_modal:{onHide:this.props.onHide}}},t.prototype.componentWillUnmount=function(){this.handleExited()},t.prototype.setModalRef=function(e){this._modal=e},t.prototype.handleDialogClick=function(e){e.target===e.currentTarget&&this.props.onHide()},t.prototype.handleEntering=function(){y["default"].on(window,"resize",this.handleWindowResize),this.updateStyle()},t.prototype.handleExited=function(){y["default"].off(window,"resize",this.handleWindowResize)},t.prototype.handleWindowResize=function(){this.updateStyle()},t.prototype.updateStyle=function(){if(C["default"]){var e=this._modal.getDialogElement(),t=e.scrollHeight,n=(0,b["default"])(e),o=(0,I["default"])(O["default"].findDOMNode(this.props.container||n.body)),r=t>n.documentElement.clientHeight;this.setState({style:{paddingRight:o&&!r?(0,x["default"])():void 0,paddingLeft:!o&&r?(0,x["default"])():void 0}})}},t.prototype.render=function(){var e=this.props,n=e.backdrop,o=e.backdropClassName,r=e.animation,i=e.show,l=e.dialogComponentClass,u=e.className,s=e.style,c=e.children,d=e.onEntering,f=e.onExited,h=(0,a["default"])(e,["backdrop","backdropClassName","animation","show","dialogComponentClass","className","style","children","onEntering","onExited"]),v=(0,Z["default"])(h,P["default"]),y=v[0],g=v[1],b=i&&!r&&"in";return k["default"].createElement(P["default"],(0,p["default"])({},y,{ref:this.setModalRef,show:i,onEntering:(0,X["default"])(d,this.handleEntering),onExited:(0,X["default"])(f,this.handleExited),backdrop:n,backdropClassName:(0,m["default"])((0,G.prefix)(h,"backdrop"),o,b),containerClassName:(0,G.prefix)(h,"open"),transition:r?j["default"]:void 0,dialogTransitionTimeout:t.TRANSITION_DURATION,backdropTransitionTimeout:t.BACKDROP_TRANSITION_DURATION}),k["default"].createElement(l,(0,p["default"])({},g,{style:(0,p["default"])({},this.state.style,s),className:(0,m["default"])(u,b),onClick:n===!0?this.handleDialogClick:null}),c))},t}(k["default"].Component);oe.propTypes=ee,oe.defaultProps=te,oe.childContextTypes=ne,oe.Body=U["default"],oe.Header=$["default"],oe.Title=z["default"],oe.Footer=K["default"],oe.Dialog=H["default"],oe.TRANSITION_DURATION=300,oe.BACKDROP_TRANSITION_DURATION=150,t["default"]=(0,G.bsClass)("modal",(0,G.bsSizes)([J.Size.LARGE,J.Size.SMALL],oe)),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(9),C=n(18),E={dialogClassName:b["default"].string},x=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e,t=this.props,n=t.dialogClassName,o=t.className,r=t.style,i=t.children,u=(0,l["default"])(t,["dialogClassName","className","style","children"]),s=(0,_.splitBsProps)(u),c=s[0],d=s[1],f=(0,_.prefix)(c),p=(0,a["default"])({display:"block"},r),h=(0,a["default"])({},(0,_.getClassSet)(c),(e={},e[f]=!1,e[(0,_.prefix)(c,"dialog")]=!0,e));return y["default"].createElement("div",(0,a["default"])({},d,{tabIndex:"-1",role:"dialog",style:p,className:(0,m["default"])(o,f)}),y["default"].createElement("div",{className:(0,m["default"])(n,h)},y["default"].createElement("div",{className:(0,_.prefix)(c,"content"),role:"document"},i)))},t}(y["default"].Component);x.propTypes=E,t["default"]=(0,_.bsClass)("modal",(0,_.bsSizes)([C.Size.LARGE,C.Size.SMALL],x)),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(6),a=o(r),i=n(2),l=o(i),u=n(4),s=o(u),c=n(3),d=o(c),f=n(5),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(73),C=o(_),E=n(76),x=o(E),N=n(21),k=o(N),w=(0,p["default"])({},C["default"].propTypes,{title:b["default"].node.isRequired,noCaret:b["default"].bool,active:b["default"].bool,children:b["default"].node}),S=function(e){function t(){return(0,l["default"])(this,t),(0,s["default"])(this,e.apply(this,arguments))}return(0,d["default"])(t,e),t.prototype.isActive=function(e,t,n){var o=e.props,r=this;return!!(o.active||null!=t&&o.eventKey===t||n&&o.href===n)||!!k["default"].some(o.children,function(e){return r.isActive(e,t,n)})||o.active},t.prototype.render=function(){var e=this,t=this.props,n=t.title,o=t.activeKey,r=t.activeHref,i=t.className,l=t.style,u=t.children,s=(0,a["default"])(t,["title","activeKey","activeHref","className","style","children"]),c=this.isActive(this,o,r);delete s.active,delete s.eventKey;var d=(0,x["default"])(s,C["default"].ControlledComponent),f=d[0],h=d[1];return y["default"].createElement(C["default"],(0,p["default"])({},f,{componentClass:"li",className:(0,m["default"])(i,{active:c}),style:l}),y["default"].createElement(C["default"].Toggle,(0,p["default"])({},h,{useAnchor:!0}),n),y["default"].createElement(C["default"].Menu,null,k["default"].map(u,function(t){return y["default"].cloneElement(t,{active:e.isActive(t,o,r)})})))},t}(y["default"].Component);S.propTypes=w,t["default"]=S,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,n){var o=function(e,n){var o=n.$bs_navbar,r=void 0===o?{bsClass:"navbar"}:o,a=e.componentClass,l=e.className,s=e.pullRight,c=e.pullLeft,d=(0,u["default"])(e,["componentClass","className","pullRight","pullLeft"]);return g["default"].createElement(a,(0,i["default"])({},d,{className:(0,v["default"])(l,(0,R.prefix)(r,t),s&&(0,R.prefix)(r,"right"),c&&(0,R.prefix)(r,"left"))}))};return o.displayName=n,o.propTypes={componentClass:E["default"],pullRight:_["default"].bool,pullLeft:_["default"].bool},o.defaultProps={componentClass:e,pullRight:!1,pullLeft:!1},o.contextTypes={$bs_navbar:_["default"].shape({bsClass:_["default"].string})},o}t.__esModule=!0;var a=n(5),i=o(a),l=n(6),u=o(l),s=n(2),c=o(s),d=n(4),f=o(d),p=n(3),h=o(p),m=n(7),v=o(m),y=n(1),g=o(y),b=n(8),_=o(b),C=n(13),E=o(C),x=n(62),N=o(x),k=n(155),w=o(k),S=n(163),T=o(S),O=n(324),M=o(O),P=n(325),D=o(P),I=n(326),A=o(I),R=n(9),L=n(18),j=n(17),B=o(j),U={fixedTop:_["default"].bool,fixedBottom:_["default"].bool,staticTop:_["default"].bool,inverse:_["default"].bool,fluid:_["default"].bool,componentClass:E["default"],onToggle:_["default"].func,onSelect:_["default"].func,collapseOnSelect:_["default"].bool,expanded:_["default"].bool,role:_["default"].string},F={componentClass:"nav",fixedTop:!1,fixedBottom:!1,staticTop:!1,inverse:!1,fluid:!1,collapseOnSelect:!1},H={$bs_navbar:_["default"].shape({bsClass:_["default"].string,expanded:_["default"].bool,onToggle:_["default"].func.isRequired,onSelect:_["default"].func})},V=function(e){function t(n,o){(0,c["default"])(this,t);var r=(0,f["default"])(this,e.call(this,n,o));return r.handleToggle=r.handleToggle.bind(r),r.handleCollapse=r.handleCollapse.bind(r),r}return(0,h["default"])(t,e),t.prototype.getChildContext=function(){var e=this.props,t=e.bsClass,n=e.expanded,o=e.onSelect,r=e.collapseOnSelect;return{$bs_navbar:{bsClass:t,expanded:n,onToggle:this.handleToggle,onSelect:(0,B["default"])(o,r?this.handleCollapse:null)}}},t.prototype.handleCollapse=function(){var e=this.props,t=e.onToggle,n=e.expanded;n&&t(!1)},t.prototype.handleToggle=function(){var e=this.props,t=e.onToggle,n=e.expanded;t(!n)},t.prototype.render=function(){var e,t=this.props,n=t.componentClass,o=t.fixedTop,r=t.fixedBottom,a=t.staticTop,l=t.inverse,s=t.fluid,c=t.className,d=t.children,f=(0,u["default"])(t,["componentClass","fixedTop","fixedBottom","staticTop","inverse","fluid","className","children"]),p=(0,R.splitBsPropsAndOmit)(f,["expanded","onToggle","onSelect","collapseOnSelect"]),h=p[0],m=p[1];void 0===m.role&&"nav"!==n&&(m.role="navigation"),l&&(h.bsStyle=L.Style.INVERSE);var y=(0,i["default"])({},(0,R.getClassSet)(h),(e={},e[(0,R.prefix)(h,"fixed-top")]=o,e[(0,R.prefix)(h,"fixed-bottom")]=r,e[(0,R.prefix)(h,"static-top")]=a,e));return g["default"].createElement(n,(0,i["default"])({},m,{className:(0,v["default"])(c,y)}),g["default"].createElement(w["default"],{fluid:s},d))},t}(g["default"].Component);V.propTypes=U,V.defaultProps=F,V.childContextTypes=H,(0,R.bsClass)("navbar",V);var K=(0,N["default"])(V,{expanded:"onToggle"});K.Brand=T["default"],K.Header=D["default"],K.Toggle=A["default"],K.Collapse=M["default"],K.Form=r("div","form","NavbarForm"),K.Text=r("p","text","NavbarText"),K.Link=r("a","link","NavbarLink"),t["default"]=(0,R.bsStyles)([L.Style.DEFAULT,L.Style.INVERSE],L.Style.DEFAULT,K),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(1),m=o(h),v=n(8),y=o(v),g=n(104),b=o(g),_=n(9),C={$bs_navbar:y["default"].shape({bsClass:y["default"].string,expanded:y["default"].bool})},E=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.children,n=(0,l["default"])(e,["children"]),o=this.context.$bs_navbar||{bsClass:"navbar"},r=(0,_.prefix)(o,"collapse");return m["default"].createElement(b["default"],(0,a["default"])({"in":o.expanded},n),m["default"].createElement("div",{className:r},t))},t}(m["default"].Component);E.contextTypes=C,t["default"]=E,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(9),C={$bs_navbar:b["default"].shape({bsClass:b["default"].string})},E=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=(0,l["default"])(e,["className"]),o=this.context.$bs_navbar||{bsClass:"navbar"},r=(0,_.prefix)(o,"header");return y["default"].createElement("div",(0,a["default"])({},n,{className:(0,m["default"])(t,r)}))},t}(y["default"].Component);E.contextTypes=C,t["default"]=E,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(9),C=n(17),E=o(C),x={
onClick:b["default"].func,children:b["default"].node},N={$bs_navbar:b["default"].shape({bsClass:b["default"].string,expanded:b["default"].bool,onToggle:b["default"].func.isRequired})},k=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.onClick,n=e.className,o=e.children,r=(0,l["default"])(e,["onClick","className","children"]),i=this.context.$bs_navbar||{bsClass:"navbar"},u=(0,a["default"])({type:"button"},r,{onClick:(0,E["default"])(t,i.onToggle),className:(0,m["default"])(n,(0,_.prefix)(i,"toggle"),!i.expanded&&"collapsed")});return o?y["default"].createElement("button",u,o):y["default"].createElement("button",u,y["default"].createElement("span",{className:"sr-only"},"Toggle navigation"),y["default"].createElement("span",{className:"icon-bar"}),y["default"].createElement("span",{className:"icon-bar"}),y["default"].createElement("span",{className:"icon-bar"}))},t}(y["default"].Component);k.propTypes=x,k.contextTypes=N,t["default"]=k,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){return Array.isArray(t)?t.indexOf(e)>=0:e===t}t.__esModule=!0;var a=n(6),i=o(a),l=n(2),u=o(l),s=n(4),c=o(s),d=n(3),f=o(d),p=n(5),h=o(p),m=n(43),v=o(m),y=n(1),g=o(y),b=n(8),_=o(b),C=n(19),E=o(C),x=n(22),N=(o(x),n(164)),k=o(N),w=n(17),S=o(w),T=_["default"].oneOf(["click","hover","focus"]),O=(0,h["default"])({},k["default"].propTypes,{trigger:_["default"].oneOfType([T,_["default"].arrayOf(T)]),delay:_["default"].number,delayShow:_["default"].number,delayHide:_["default"].number,defaultOverlayShown:_["default"].bool,overlay:_["default"].node.isRequired,onBlur:_["default"].func,onClick:_["default"].func,onFocus:_["default"].func,onMouseOut:_["default"].func,onMouseOver:_["default"].func,target:_["default"].oneOf([null]),onHide:_["default"].oneOf([null]),show:_["default"].oneOf([null])}),M={defaultOverlayShown:!1,trigger:["hover","focus"]},P=function(e){function t(n,o){(0,u["default"])(this,t);var r=(0,c["default"])(this,e.call(this,n,o));return r.handleToggle=r.handleToggle.bind(r),r.handleDelayedShow=r.handleDelayedShow.bind(r),r.handleDelayedHide=r.handleDelayedHide.bind(r),r.handleHide=r.handleHide.bind(r),r.handleMouseOver=function(e){return r.handleMouseOverOut(r.handleDelayedShow,e)},r.handleMouseOut=function(e){return r.handleMouseOverOut(r.handleDelayedHide,e)},r._mountNode=null,r.state={show:n.defaultOverlayShown},r}return(0,f["default"])(t,e),t.prototype.componentDidMount=function(){this._mountNode=document.createElement("div"),this.renderOverlay()},t.prototype.componentDidUpdate=function(){this.renderOverlay()},t.prototype.componentWillUnmount=function(){E["default"].unmountComponentAtNode(this._mountNode),this._mountNode=null,clearTimeout(this._hoverShowDelay),clearTimeout(this._hoverHideDelay)},t.prototype.handleDelayedHide=function(){var e=this;if(null!=this._hoverShowDelay)return clearTimeout(this._hoverShowDelay),void(this._hoverShowDelay=null);if(this.state.show&&null==this._hoverHideDelay){var t=null!=this.props.delayHide?this.props.delayHide:this.props.delay;return t?void(this._hoverHideDelay=setTimeout(function(){e._hoverHideDelay=null,e.hide()},t)):void this.hide()}},t.prototype.handleDelayedShow=function(){var e=this;if(null!=this._hoverHideDelay)return clearTimeout(this._hoverHideDelay),void(this._hoverHideDelay=null);if(!this.state.show&&null==this._hoverShowDelay){var t=null!=this.props.delayShow?this.props.delayShow:this.props.delay;return t?void(this._hoverShowDelay=setTimeout(function(){e._hoverShowDelay=null,e.show()},t)):void this.show()}},t.prototype.handleHide=function(){this.hide()},t.prototype.handleMouseOverOut=function(e,t){var n=t.currentTarget,o=t.relatedTarget||t.nativeEvent.toElement;o&&o===n||(0,v["default"])(n,o)||e(t)},t.prototype.handleToggle=function(){this.state.show?this.hide():this.show()},t.prototype.hide=function(){this.setState({show:!1})},t.prototype.makeOverlay=function(e,t){return g["default"].createElement(k["default"],(0,h["default"])({},t,{show:this.state.show,onHide:this.handleHide,target:this}),e)},t.prototype.show=function(){this.setState({show:!0})},t.prototype.renderOverlay=function(){E["default"].unstable_renderSubtreeIntoContainer(this,this._overlay,this._mountNode)},t.prototype.render=function(){var e=this.props,t=e.trigger,n=e.overlay,o=e.children,a=e.onBlur,l=e.onClick,u=e.onFocus,s=e.onMouseOut,c=e.onMouseOver,d=(0,i["default"])(e,["trigger","overlay","children","onBlur","onClick","onFocus","onMouseOut","onMouseOver"]);delete d.delay,delete d.delayShow,delete d.delayHide,delete d.defaultOverlayShown;var f=g["default"].Children.only(o),p=f.props,h={};return this.state.show&&(h["aria-describedby"]=n.props.id),h.onClick=(0,S["default"])(p.onClick,l),r("click",t)&&(h.onClick=(0,S["default"])(h.onClick,this.handleToggle)),r("hover",t)&&(h.onMouseOver=(0,S["default"])(p.onMouseOver,c,this.handleMouseOver),h.onMouseOut=(0,S["default"])(p.onMouseOut,s,this.handleMouseOut)),r("focus",t)&&(h.onFocus=(0,S["default"])(p.onFocus,u,this.handleDelayedShow),h.onBlur=(0,S["default"])(p.onBlur,a,this.handleDelayedHide)),this._overlay=this.makeOverlay(n,d),(0,y.cloneElement)(f,h)},t}(g["default"].Component);P.propTypes=O,P.defaultProps=M,t["default"]=P,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(9),b=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=e.children,o=(0,l["default"])(e,["className","children"]),r=(0,g.splitBsProps)(o),i=r[0],u=r[1],s=(0,g.getClassSet)(i);return y["default"].createElement("div",(0,a["default"])({},u,{className:(0,m["default"])(t,s)}),y["default"].createElement("h1",null,n))},t}(y["default"].Component);t["default"]=(0,g.bsClass)("page-header",b),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(165),a=o(r),i=n(349),l=o(i);t["default"]=l["default"].wrapper(a["default"],"`<PageItem>`","`<Pager.Item>`"),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(165),C=o(_),E=n(9),x=n(17),N=o(x),k=n(21),w=o(k),S={onSelect:b["default"].func},T=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.onSelect,n=e.className,o=e.children,r=(0,l["default"])(e,["onSelect","className","children"]),i=(0,E.splitBsProps)(r),u=i[0],s=i[1],c=(0,E.getClassSet)(u);return y["default"].createElement("ul",(0,a["default"])({},s,{className:(0,m["default"])(n,c)}),w["default"].map(o,function(e){return(0,v.cloneElement)(e,{onSelect:(0,N["default"])(e.props.onSelect,t)})}))},t}(y["default"].Component);T.propTypes=S,T.Item=C["default"],t["default"]=(0,E.bsClass)("pager",T),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(6),a=o(r),i=n(5),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(13),C=o(_),E=n(166),x=o(E),N=n(9),k={activePage:b["default"].number,items:b["default"].number,maxButtons:b["default"].number,boundaryLinks:b["default"].bool,ellipsis:b["default"].oneOfType([b["default"].bool,b["default"].node]),first:b["default"].oneOfType([b["default"].bool,b["default"].node]),last:b["default"].oneOfType([b["default"].bool,b["default"].node]),prev:b["default"].oneOfType([b["default"].bool,b["default"].node]),next:b["default"].oneOfType([b["default"].bool,b["default"].node]),onSelect:b["default"].func,buttonComponentClass:C["default"]},w={activePage:1,items:1,maxButtons:0,first:!1,last:!1,prev:!1,next:!1,ellipsis:!0,boundaryLinks:!1},S=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.renderPageButtons=function(e,t,n,o,r,a){var i=[],u=void 0,s=void 0;n&&n<t?(u=Math.max(Math.min(e-Math.floor(n/2,10),t-n+1),1),s=u+n-1):(u=1,s=t);for(var c=u;c<=s;++c)i.push(y["default"].createElement(x["default"],(0,l["default"])({},a,{key:c,eventKey:c,active:c===e}),c));return r&&o&&u>1&&(u>2&&i.unshift(y["default"].createElement(x["default"],{key:"ellipsisFirst",disabled:!0,componentClass:a.componentClass},y["default"].createElement("span",{"aria-label":"More"},r===!0?"…":r))),i.unshift(y["default"].createElement(x["default"],(0,l["default"])({},a,{key:1,eventKey:1,active:!1}),"1"))),r&&s<t&&((!o||s<t-1)&&i.push(y["default"].createElement(x["default"],{key:"ellipsis",disabled:!0,componentClass:a.componentClass},y["default"].createElement("span",{"aria-label":"More"},r===!0?"…":r))),o&&i.push(y["default"].createElement(x["default"],(0,l["default"])({},a,{key:t,eventKey:t,active:!1}),t))),i},t.prototype.render=function(){var e=this.props,t=e.activePage,n=e.items,o=e.maxButtons,r=e.boundaryLinks,i=e.ellipsis,u=e.first,s=e.last,c=e.prev,d=e.next,f=e.onSelect,p=e.buttonComponentClass,h=e.className,v=(0,a["default"])(e,["activePage","items","maxButtons","boundaryLinks","ellipsis","first","last","prev","next","onSelect","buttonComponentClass","className"]),g=(0,N.splitBsProps)(v),b=g[0],_=g[1],C=(0,N.getClassSet)(b),E={onSelect:f,componentClass:p};return y["default"].createElement("ul",(0,l["default"])({},_,{className:(0,m["default"])(h,C)}),u&&y["default"].createElement(x["default"],(0,l["default"])({},E,{eventKey:1,disabled:1===t}),y["default"].createElement("span",{"aria-label":"First"},u===!0?"«":u)),c&&y["default"].createElement(x["default"],(0,l["default"])({},E,{eventKey:t-1,disabled:1===t}),y["default"].createElement("span",{"aria-label":"Previous"},c===!0?"‹":c)),this.renderPageButtons(t,n,o,r,i,E),d&&y["default"].createElement(x["default"],(0,l["default"])({},E,{eventKey:t+1,disabled:t>=n}),y["default"].createElement("span",{"aria-label":"Next"},d===!0?"›":d)),s&&y["default"].createElement(x["default"],(0,l["default"])({},E,{eventKey:n,disabled:t>=n}),y["default"].createElement("span",{"aria-label":"Last"},s===!0?"»":s)))},t}(y["default"].Component);S.propTypes=k,S.defaultProps=w,t["default"]=(0,N.bsClass)("pagination",S),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(38),a=o(r),i=n(6),l=o(i),u=n(5),s=o(u),c=n(2),d=o(c),f=n(4),p=o(f),h=n(3),m=o(h),v=n(7),y=o(v),g=n(1),b=o(g),_=n(8),C=o(_),E=n(104),x=o(E),N=n(9),k=n(18),w={collapsible:C["default"].bool,onSelect:C["default"].func,header:C["default"].node,id:C["default"].oneOfType([C["default"].string,C["default"].number]),footer:C["default"].node,defaultExpanded:C["default"].bool,expanded:C["default"].bool,eventKey:C["default"].any,headerRole:C["default"].string,panelRole:C["default"].string,onEnter:C["default"].func,onEntering:C["default"].func,onEntered:C["default"].func,onExit:C["default"].func,onExiting:C["default"].func,onExited:C["default"].func},S={defaultExpanded:!1},T=function(e){function t(n,o){(0,d["default"])(this,t);var r=(0,p["default"])(this,e.call(this,n,o));return r.handleClickTitle=r.handleClickTitle.bind(r),r.state={expanded:r.props.defaultExpanded},r}return(0,m["default"])(t,e),t.prototype.handleClickTitle=function(e){e.persist(),e.selected=!0,this.props.onSelect?this.props.onSelect(this.props.eventKey,e):e.preventDefault(),e.selected&&this.setState({expanded:!this.state.expanded})},t.prototype.renderAnchor=function(e,t,n,o){return b["default"].createElement("a",{role:n,href:t&&"#"+t,onClick:this.handleClickTitle,"aria-controls":t,"aria-expanded":o,"aria-selected":o,className:o?null:"collapsed"},e)},t.prototype.renderBody=function(e,t){function n(){r.length&&(o.push(b["default"].createElement("div",{key:o.length,className:a},r)),r=[])}var o=[],r=[],a=(0,N.prefix)(t,"body");return b["default"].Children.toArray(e).forEach(function(e){return b["default"].isValidElement(e)&&e.props.fill?(n(),void o.push((0,g.cloneElement)(e,{fill:void 0}))):void r.push(e)}),n(),o},t.prototype.renderCollapsibleBody=function(e,t,n,o,r,a){return b["default"].createElement(x["default"],(0,s["default"])({"in":t},a),b["default"].createElement("div",{id:e,role:n,className:(0,N.prefix)(r,"collapse"),"aria-hidden":!t},this.renderBody(o,r)))},t.prototype.renderHeader=function(e,t,n,o,r,a){var i=(0,N.prefix)(a,"title");return e?b["default"].isValidElement(t)?(0,g.cloneElement)(t,{className:(0,y["default"])(t.props.className,i),children:this.renderAnchor(t.props.children,n,o,r)}):b["default"].createElement("h4",{role:"presentation",className:i},this.renderAnchor(t,n,o,r)):b["default"].isValidElement(t)?(0,g.cloneElement)(t,{className:(0,y["default"])(t.props.className,i)}):t},t.prototype.render=function(){var e=this.props,t=e.collapsible,n=e.header,o=e.id,r=e.footer,a=e.expanded,i=e.headerRole,u=e.panelRole,c=e.className,d=e.children,f=e.onEnter,p=e.onEntering,h=e.onEntered,m=e.onExit,v=e.onExiting,g=e.onExited,_=(0,l["default"])(e,["collapsible","header","id","footer","expanded","headerRole","panelRole","className","children","onEnter","onEntering","onEntered","onExit","onExiting","onExited"]),C=(0,N.splitBsPropsAndOmit)(_,["defaultExpanded","eventKey","onSelect"]),E=C[0],x=C[1],k=null!=a?a:this.state.expanded,w=(0,N.getClassSet)(E);return b["default"].createElement("div",(0,s["default"])({},x,{className:(0,y["default"])(c,w),id:t?null:o}),n&&b["default"].createElement("div",{className:(0,N.prefix)(E,"heading")},this.renderHeader(t,n,o,i,k,E)),t?this.renderCollapsibleBody(o,k,u,d,E,{onEnter:f,onEntering:p,onEntered:h,onExit:m,onExiting:v,onExited:g}):this.renderBody(d,E),r&&b["default"].createElement("div",{className:(0,N.prefix)(E,"footer")},r))},t}(b["default"].Component);T.propTypes=w,T.defaultProps=S,t["default"]=(0,N.bsClass)("panel",(0,N.bsStyles)([].concat((0,a["default"])(k.State),[k.Style.DEFAULT,k.Style.PRIMARY]),k.Style.DEFAULT,T)),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(71),C=o(_),E=n(9),x={id:(0,C["default"])(b["default"].oneOfType([b["default"].string,b["default"].number])),placement:b["default"].oneOf(["top","right","bottom","left"]),positionTop:b["default"].oneOfType([b["default"].number,b["default"].string]),positionLeft:b["default"].oneOfType([b["default"].number,b["default"].string]),arrowOffsetTop:b["default"].oneOfType([b["default"].number,b["default"].string]),arrowOffsetLeft:b["default"].oneOfType([b["default"].number,b["default"].string]),title:b["default"].node},N={placement:"right"},k=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e,t=this.props,n=t.placement,o=t.positionTop,r=t.positionLeft,i=t.arrowOffsetTop,u=t.arrowOffsetLeft,s=t.title,c=t.className,d=t.style,f=t.children,p=(0,l["default"])(t,["placement","positionTop","positionLeft","arrowOffsetTop","arrowOffsetLeft","title","className","style","children"]),h=(0,E.splitBsProps)(p),v=h[0],g=h[1],b=(0,a["default"])({},(0,E.getClassSet)(v),(e={},e[n]=!0,e)),_=(0,a["default"])({display:"block",top:o,left:r},d),C={top:i,left:u};return y["default"].createElement("div",(0,a["default"])({},g,{role:"tooltip",className:(0,m["default"])(c,b),style:_}),y["default"].createElement("div",{className:"arrow",style:C}),s&&y["default"].createElement("h3",{className:(0,E.prefix)(v,"title")},s),y["default"].createElement("div",{className:(0,E.prefix)(v,"content")},f))},t}(y["default"].Component);k.propTypes=x,k.defaultProps=N,t["default"]=(0,E.bsClass)("popover",k),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,n){var o=e[t];if(!o)return null;var r=null;return C["default"].Children.forEach(o,function(e){if(!r&&e.type!==P){var t=C["default"].isValidElement(e)?e.type.displayName||e.type.name||e.type:e;r=new Error("Children of "+n+" can contain only ProgressBar "+("components. Found "+t+"."))}}),r}function a(e,t,n){var o=(e-t)/(n-t)*100;return Math.round(o*T)/T}t.__esModule=!0;var i=n(38),l=o(i),u=n(5),s=o(u),c=n(6),d=o(c),f=n(2),p=o(f),h=n(4),m=o(h),v=n(3),y=o(v),g=n(7),b=o(g),_=n(1),C=o(_),E=n(8),x=o(E),N=n(9),k=n(18),w=n(21),S=o(w),T=1e3,O={min:x["default"].number,now:x["default"].number,max:x["default"].number,label:x["default"].node,srOnly:x["default"].bool,striped:x["default"].bool,active:x["default"].bool,children:r,isChild:x["default"].bool},M={min:0,max:100,active:!1,isChild:!1,srOnly:!1,striped:!1},P=function(e){function t(){return(0,p["default"])(this,t),(0,m["default"])(this,e.apply(this,arguments))}return(0,y["default"])(t,e),t.prototype.renderProgressBar=function(e){var t,n=e.min,o=e.now,r=e.max,i=e.label,l=e.srOnly,u=e.striped,c=e.active,f=e.className,p=e.style,h=(0,d["default"])(e,["min","now","max","label","srOnly","striped","active","className","style"]),m=(0,N.splitBsProps)(h),v=m[0],y=m[1],g=(0,s["default"])({},(0,N.getClassSet)(v),(t={active:c},t[(0,N.prefix)(v,"striped")]=c||u,t));return C["default"].createElement("div",(0,s["default"])({},y,{role:"progressbar",className:(0,b["default"])(f,g),style:(0,s["default"])({width:a(o,n,r)+"%"},p),"aria-valuenow":o,"aria-valuemin":n,"aria-valuemax":r}),l?C["default"].createElement("span",{className:"sr-only"},i):i)},t.prototype.render=function(){var e=this.props,t=e.isChild,n=(0,d["default"])(e,["isChild"]);if(t)return this.renderProgressBar(n);var o=n.min,r=n.now,a=n.max,i=n.label,l=n.srOnly,u=n.striped,c=n.active,f=n.bsClass,p=n.bsStyle,h=n.className,m=n.children,v=(0,d["default"])(n,["min","now","max","label","srOnly","striped","active","bsClass","bsStyle","className","children"]);return C["default"].createElement("div",(0,s["default"])({},v,{className:(0,b["default"])(h,"progress")}),m?S["default"].map(m,function(e){return(0,_.cloneElement)(e,{isChild:!0})}):this.renderProgressBar({min:o,now:r,max:a,label:i,srOnly:l,striped:u,active:c,bsClass:f,bsStyle:p}))},t}(C["default"].Component);P.propTypes=O,P.defaultProps=M,t["default"]=(0,N.bsClass)("progress-bar",(0,N.bsStyles)((0,l["default"])(k.State),P)),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(22),C=(o(_),n(9)),E={inline:b["default"].bool,disabled:b["default"].bool,title:b["default"].string,validationState:b["default"].oneOf(["success","warning","error",null]),inputRef:b["default"].func},x={inline:!1,disabled:!1,title:""},N=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.inline,n=e.disabled,o=e.validationState,r=e.inputRef,i=e.className,u=e.style,s=e.title,c=e.children,d=(0,l["default"])(e,["inline","disabled","validationState","inputRef","className","style","title","children"]),f=(0,C.splitBsProps)(d),p=f[0],h=f[1],v=y["default"].createElement("input",(0,a["default"])({},h,{ref:r,type:"radio",disabled:n}));if(t){var g,b=(g={},g[(0,C.prefix)(p,"inline")]=!0,g.disabled=n,g);return y["default"].createElement("label",{className:(0,m["default"])(i,b),style:u,title:s},v,c)}var _=(0,a["default"])({},(0,C.getClassSet)(p),{disabled:n});return o&&(_["has-"+o]=!0),y["default"].createElement("div",{className:(0,m["default"])(i,_),style:u},y["default"].createElement("label",{title:s},v,c))},t}(y["default"].Component);N.propTypes=E,N.defaultProps=x,t["default"]=(0,C.bsClass)("radio",N),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(22),C=(o(_),n(9)),E={children:b["default"].element.isRequired,a16by9:b["default"].bool,a4by3:b["default"].bool},x={a16by9:!1,a4by3:!1},N=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e,t=this.props,n=t.a16by9,o=t.a4by3,r=t.className,i=t.children,u=(0,l["default"])(t,["a16by9","a4by3","className","children"]),s=(0,C.splitBsProps)(u),c=s[0],d=s[1],f=(0,a["default"])({},(0,C.getClassSet)(c),(e={},e[(0,C.prefix)(c,"16by9")]=n,e[(0,C.prefix)(c,"4by3")]=o,e));return y["default"].createElement("div",{className:(0,m["default"])(f)},(0,v.cloneElement)(i,(0,a["default"])({},d,{className:(0,m["default"])(r,(0,C.prefix)(c,"item"))})))},t}(y["default"].Component);N.propTypes=E,N.defaultProps=x,t["default"]=(0,C.bsClass)("embed-responsive",N),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(13),b=o(g),_=n(9),C={componentClass:b["default"]},E={componentClass:"div"},x=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.componentClass,n=e.className,o=(0,l["default"])(e,["componentClass","className"]),r=(0,_.splitBsProps)(o),i=r[0],u=r[1],s=(0,_.getClassSet)(i);return y["default"].createElement(t,(0,a["default"])({},u,{className:(0,m["default"])(n,s)}))},t}(y["default"].Component);x.propTypes=C,x.defaultProps=E,t["default"]=(0,_.bsClass)("row",x),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(6),a=o(r),i=n(2),l=o(i),u=n(4),s=o(u),c=n(3),d=o(c),f=n(5),p=o(f),h=n(1),m=o(h),v=n(8),y=o(v),g=n(56),b=o(g),_=n(73),C=o(_),E=n(339),x=o(E),N=n(76),k=o(N),w=(0,p["default"])({},C["default"].propTypes,{bsStyle:y["default"].string,bsSize:y["default"].string,href:y["default"].string,onClick:y["default"].func,title:y["default"].node.isRequired,toggleLabel:y["default"].string,children:y["default"].node}),S=function(e){function t(){return(0,l["default"])(this,t),(0,s["default"])(this,e.apply(this,arguments))}return(0,d["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.bsSize,n=e.bsStyle,o=e.title,r=e.toggleLabel,i=e.children,l=(0,a["default"])(e,["bsSize","bsStyle","title","toggleLabel","children"]),u=(0,k["default"])(l,C["default"].ControlledComponent),s=u[0],c=u[1];return m["default"].createElement(C["default"],(0,p["default"])({},s,{bsSize:t,bsStyle:n}),m["default"].createElement(b["default"],(0,p["default"])({},c,{disabled:l.disabled,bsSize:t,bsStyle:n}),o),m["default"].createElement(x["default"],{"aria-label":r||o,bsSize:t,bsStyle:n}),m["default"].createElement(C["default"].Menu,null,i))},t}(m["default"].Component);S.propTypes=w,S.Toggle=x["default"],t["default"]=S,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(2),l=o(i),u=n(4),s=o(u),c=n(3),d=o(c),f=n(1),p=o(f),h=n(154),m=o(h),v=function(e){function t(){return(0,l["default"])(this,t),(0,s["default"])(this,e.apply(this,arguments))}return(0,d["default"])(t,e),t.prototype.render=function(){return p["default"].createElement(m["default"],(0,a["default"])({},this.props,{useAnchor:!1,noCaret:!1}))},t}(p["default"].Component);v.defaultProps=m["default"].defaultProps,t["default"]=v,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(2),a=o(r),i=n(4),l=o(i),u=n(3),s=o(u),c=n(5),d=o(c),f=n(1),p=o(f),h=n(8),m=o(h),v=n(106),y=o(v),g=n(107),b=o(g),_=n(168),C=o(_),E=(0,d["default"])({},C["default"].propTypes,{disabled:m["default"].bool,title:m["default"].node,tabClassName:m["default"].string}),x=function(e){function t(){return(0,a["default"])(this,t),(0,l["default"])(this,e.apply(this,arguments))}return(0,s["default"])(t,e),t.prototype.render=function(){var e=(0,d["default"])({},this.props);return delete e.title,delete e.disabled,delete e.tabClassName,p["default"].createElement(C["default"],e)},t}(p["default"].Component);x.propTypes=E,x.Container=y["default"],x.Content=b["default"],x.Pane=C["default"],t["default"]=x,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(9),C={striped:b["default"].bool,bordered:b["default"].bool,condensed:b["default"].bool,hover:b["default"].bool,responsive:b["default"].bool},E={bordered:!1,condensed:!1,hover:!1,responsive:!1,striped:!1},x=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e,t=this.props,n=t.striped,o=t.bordered,r=t.condensed,i=t.hover,u=t.responsive,s=t.className,c=(0,l["default"])(t,["striped","bordered","condensed","hover","responsive","className"]),d=(0,_.splitBsProps)(c),f=d[0],p=d[1],h=(0,a["default"])({},(0,_.getClassSet)(f),(e={},e[(0,_.prefix)(f,"striped")]=n,e[(0,_.prefix)(f,"bordered")]=o,e[(0,_.prefix)(f,"condensed")]=r,e[(0,_.prefix)(f,"hover")]=i,e)),v=y["default"].createElement("table",(0,a["default"])({},p,{className:(0,m["default"])(s,h)}));return u?y["default"].createElement("div",{className:(0,_.prefix)(f,"responsive")},v):v},t}(y["default"].Component);x.propTypes=C,x.defaultProps=E,t["default"]=(0,_.bsClass)("table",x),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e){var t=void 0;return I["default"].forEach(e,function(e){null==t&&(t=e.props.eventKey)}),t}t.__esModule=!0;var a=n(5),i=o(a),l=n(6),u=o(l),s=n(2),c=o(s),d=n(4),f=o(d),p=n(3),h=o(p),m=n(1),v=o(m),y=n(8),g=o(y),b=n(71),_=o(b),C=n(62),E=o(C),x=n(161),N=o(x),k=n(162),w=o(k),S=n(106),T=o(S),O=n(107),M=o(O),P=n(9),D=n(21),I=o(D),A=T["default"].ControlledComponent,R={activeKey:g["default"].any,bsStyle:g["default"].oneOf(["tabs","pills"]),animation:g["default"].bool,id:(0,_["default"])(g["default"].oneOfType([g["default"].string,g["default"].number])),onSelect:g["default"].func,mountOnEnter:g["default"].bool,unmountOnExit:g["default"].bool},L={bsStyle:"tabs",animation:!0,mountOnEnter:!1,unmountOnExit:!1},j=function(e){function t(){return(0,c["default"])(this,t),(0,f["default"])(this,e.apply(this,arguments))}return(0,h["default"])(t,e),t.prototype.renderTab=function(e){var t=e.props,n=t.title,o=t.eventKey,r=t.disabled,a=t.tabClassName;return null==n?null:v["default"].createElement(w["default"],{eventKey:o,disabled:r,className:a},n)},t.prototype.render=function(){var e=this.props,t=e.id,n=e.onSelect,o=e.animation,a=e.mountOnEnter,l=e.unmountOnExit,s=e.bsClass,c=e.className,d=e.style,f=e.children,p=e.activeKey,h=void 0===p?r(f):p,m=(0,u["default"])(e,["id","onSelect","animation","mountOnEnter","unmountOnExit","bsClass","className","style","children","activeKey"]);return v["default"].createElement(A,{id:t,activeKey:h,onSelect:n,className:c,style:d},v["default"].createElement("div",null,v["default"].createElement(N["default"],(0,i["default"])({},m,{role:"tablist"}),I["default"].map(f,this.renderTab)),v["default"].createElement(M["default"],{bsClass:s,animation:o,mountOnEnter:a,unmountOnExit:l},f)))},t}(v["default"].Component);j.propTypes=R,j.defaultProps=L,(0,P.bsClass)("tab",j),t["default"]=(0,E["default"])(j,{activeKey:"onSelect"}),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(27),C=o(_),E=n(9),x={src:b["default"].string,alt:b["default"].string,href:b["default"].string,onError:b["default"].func,onLoad:b["default"].func},N=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.src,n=e.alt,o=e.onError,r=e.onLoad,i=e.className,u=e.children,s=(0,l["default"])(e,["src","alt","onError","onLoad","className","children"]),c=(0,E.splitBsProps)(s),d=c[0],f=c[1],p=f.href?C["default"]:"div",h=(0,E.getClassSet)(d);return y["default"].createElement(p,(0,a["default"])({},f,{className:(0,m["default"])(i,h)}),y["default"].createElement("img",{src:t,alt:n,onError:o,onLoad:r}),u&&y["default"].createElement("div",{className:"caption"},u))},t}(y["default"].Component);N.propTypes=x,t["default"]=(0,E.bsClass)("thumbnail",N),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(8),m=o(h),v=n(1),y=o(v),g=n(68),b=o(g),_=n(62),C=o(_),E=n(17),x=o(E),N=n(21),k=o(N),w=n(102),S=o(w),T=n(169),O=o(T),M={name:m["default"].string,value:m["default"].any,onChange:m["default"].func,type:m["default"].oneOf(["checkbox","radio"]).isRequired},P={type:"radio"},D=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.getValues=function(){var e=this.props.value;return null==e?[]:[].concat(e)},t.prototype.handleToggle=function(e){var t=this.props,n=t.type,o=t.onChange,r=this.getValues(),a=r.indexOf(e)!==-1;return"radio"===n?void(a||o(e)):void o(a?r.filter(function(t){return t!==e}):[].concat(r,[e]))},t.prototype.render=function(){var e=this,t=this.props,n=t.children,o=t.type,r=t.name,i=(0,l["default"])(t,["children","type","name"]),u=this.getValues();return"radio"!==o||r?void 0:(0,b["default"])(!1),delete i.onChange,delete i.value,y["default"].createElement(S["default"],(0,a["default"])({},i,{"data-toggle":"buttons"}),k["default"].map(n,function(t){var n=t.props,a=n.value,i=n.onChange,l=function(){return e.handleToggle(a)};return y["default"].cloneElement(t,{type:o,name:t.name||r,checked:u.indexOf(a)!==-1,onChange:(0,x["default"])(i,l)})}))},t}(y["default"].Component);D.propTypes=M,D.defaultProps=P;var I=(0,C["default"])(D,{value:"onChange"});I.Button=O["default"],t["default"]=I,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(8),b=o(g),_=n(71),C=o(_),E=n(9),x={id:(0,C["default"])(b["default"].oneOfType([b["default"].string,b["default"].number])),placement:b["default"].oneOf(["top","right","bottom","left"]),positionTop:b["default"].oneOfType([b["default"].number,b["default"].string]),positionLeft:b["default"].oneOfType([b["default"].number,b["default"].string]),arrowOffsetTop:b["default"].oneOfType([b["default"].number,b["default"].string]),arrowOffsetLeft:b["default"].oneOfType([b["default"].number,b["default"].string])},N={placement:"right"},k=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e,t=this.props,n=t.placement,o=t.positionTop,r=t.positionLeft,i=t.arrowOffsetTop,u=t.arrowOffsetLeft,s=t.className,c=t.style,d=t.children,f=(0,l["default"])(t,["placement","positionTop","positionLeft","arrowOffsetTop","arrowOffsetLeft","className","style","children"]),p=(0,E.splitBsProps)(f),h=p[0],v=p[1],g=(0,
a["default"])({},(0,E.getClassSet)(h),(e={},e[n]=!0,e)),b=(0,a["default"])({top:o,left:r},c),_={top:i,left:u};return y["default"].createElement("div",(0,a["default"])({},v,{role:"tooltip",className:(0,m["default"])(s,g),style:b}),y["default"].createElement("div",{className:(0,E.prefix)(h,"arrow"),style:_}),y["default"].createElement("div",{className:(0,E.prefix)(h,"inner")},d))},t}(y["default"].Component);k.propTypes=x,k.defaultProps=N,t["default"]=(0,E.bsClass)("tooltip",k),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(5),a=o(r),i=n(6),l=o(i),u=n(2),s=o(u),c=n(4),d=o(c),f=n(3),p=o(f),h=n(7),m=o(h),v=n(1),y=o(v),g=n(9),b=n(18),_=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,e.apply(this,arguments))}return(0,p["default"])(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=(0,l["default"])(e,["className"]),o=(0,g.splitBsProps)(n),r=o[0],i=o[1],u=(0,g.getClassSet)(r);return y["default"].createElement("div",(0,a["default"])({},i,{className:(0,m["default"])(t,u)}))},t}(y["default"].Component);t["default"]=(0,g.bsClass)("well",(0,g.bsSizes)([b.Size.LARGE,b.Size.SMALL],_)),e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,l["default"])(function(e,n,o){var r=void 0;return t.every(function(t){return!!s["default"].some(e.children,function(e){return e.props.bsRole===t})||(r=t,!1)}),r?new Error("(children) "+o+" - Missing a required child with bsRole: "+(r+". "+o+" must have at least one child of each of ")+("the following bsRoles: "+t.join(", "))):null})}function a(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,l["default"])(function(e,n,o){var r=void 0;return t.every(function(t){var n=s["default"].filter(e.children,function(e){return e.props.bsRole===t});return!(n.length>1&&(r=t,1))}),r?new Error("(children) "+o+" - Duplicate children detected of bsRole: "+(r+". Only one child each allowed with the following ")+("bsRoles: "+t.join(", "))):null})}t.__esModule=!0,t.requiredRoles=r,t.exclusiveRoles=a;var i=n(72),l=o(i),u=n(21),s=o(u)},function(e,t){"use strict";function n(){var e=document.createElement("div"),t=e.style;"AnimationEvent"in window||delete i.animationend.animation,"TransitionEvent"in window||delete i.transitionend.transition;for(var n in i){var o=i[n];for(var r in o)if(r in t){l.push(o[r]);break}}}function o(e,t,n){e.addEventListener(t,n,!1)}function r(e,t,n){e.removeEventListener(t,n,!1)}t.__esModule=!0;var a=!("undefined"==typeof window||!window.document||!window.document.createElement),i={transitionend:{transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"mozTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd"},animationend:{animation:"animationend",WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd"}},l=[];a&&n();var u={addEndEventListener:function(e,t){return 0===l.length?void window.setTimeout(t,0):void l.forEach(function(n){o(e,n,t)})},removeEndEventListener:function(e,t){0!==l.length&&l.forEach(function(n){r(e,n,t)})}};t["default"]=u,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,n){var o=void 0;"object"===("undefined"==typeof e?"undefined":(0,p["default"])(e))?o=e.message:(o=e+" is deprecated. Use "+t+" instead.",n&&(o+="\nYou can read more about it at "+n)),m[o]||(m[o]=!0)}function a(){m={}}t.__esModule=!0;var i=n(2),l=o(i),u=n(4),s=o(u),c=n(3),d=o(c),f=n(83),p=o(f);t._resetWarned=a;var h=n(22),m=(o(h),{});r.wrapper=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return function(e){function t(){return(0,l["default"])(this,t),(0,s["default"])(this,e.apply(this,arguments))}return(0,d["default"])(t,e),t.prototype.componentWillMount=function(){if(r.apply(void 0,n),e.prototype.componentWillMount){for(var t,o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];(t=e.prototype.componentWillMount).call.apply(t,[this].concat(a))}},t}(e)},t["default"]=r},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}t.__esModule=!0,t.ValidComponentChildren=t.createChainedFunction=t.bootstrapUtils=void 0;var a=n(9),i=r(a),l=n(17),u=o(l),s=n(21),c=o(s);t.bootstrapUtils=i,t.createChainedFunction=u["default"],t.ValidComponentChildren=c["default"]},function(e,t){"use strict";var n={Properties:{"aria-current":0,"aria-details":0,"aria-disabled":0,"aria-hidden":0,"aria-invalid":0,"aria-keyshortcuts":0,"aria-label":0,"aria-roledescription":0,"aria-autocomplete":0,"aria-checked":0,"aria-expanded":0,"aria-haspopup":0,"aria-level":0,"aria-modal":0,"aria-multiline":0,"aria-multiselectable":0,"aria-orientation":0,"aria-placeholder":0,"aria-pressed":0,"aria-readonly":0,"aria-required":0,"aria-selected":0,"aria-sort":0,"aria-valuemax":0,"aria-valuemin":0,"aria-valuenow":0,"aria-valuetext":0,"aria-atomic":0,"aria-busy":0,"aria-live":0,"aria-relevant":0,"aria-dropeffect":0,"aria-grabbed":0,"aria-activedescendant":0,"aria-colcount":0,"aria-colindex":0,"aria-colspan":0,"aria-controls":0,"aria-describedby":0,"aria-errormessage":0,"aria-flowto":0,"aria-labelledby":0,"aria-owns":0,"aria-posinset":0,"aria-rowcount":0,"aria-rowindex":0,"aria-rowspan":0,"aria-setsize":0},DOMAttributeNames:{},DOMPropertyNames:{}};e.exports=n},function(e,t,n){"use strict";var o=n(15),r=n(147),a={focusDOMComponent:function(){r(o.getNodeFromInstance(this))}};e.exports=a},function(e,t,n){"use strict";function o(){var e=window.opera;return"object"==typeof e&&"function"==typeof e.version&&parseInt(e.version(),10)<=12}function r(e){return(e.ctrlKey||e.altKey||e.metaKey)&&!(e.ctrlKey&&e.altKey)}function a(e){switch(e){case"topCompositionStart":return w.compositionStart;case"topCompositionEnd":return w.compositionEnd;case"topCompositionUpdate":return w.compositionUpdate}}function i(e,t){return"topKeyDown"===e&&t.keyCode===b}function l(e,t){switch(e){case"topKeyUp":return g.indexOf(t.keyCode)!==-1;case"topKeyDown":return t.keyCode!==b;case"topKeyPress":case"topMouseDown":case"topBlur":return!0;default:return!1}}function u(e){var t=e.detail;return"object"==typeof t&&"data"in t?t.data:null}function s(e,t,n,o){var r,s;if(_?r=a(e):T?l(e,n)&&(r=w.compositionEnd):i(e,n)&&(r=w.compositionStart),!r)return null;x&&(T||r!==w.compositionStart?r===w.compositionEnd&&T&&(s=T.getData()):T=m.getPooled(o));var c=v.getPooled(r,t,n,o);if(s)c.data=s;else{var d=u(n);null!==d&&(c.data=d)}return p.accumulateTwoPhaseDispatches(c),c}function c(e,t){switch(e){case"topCompositionEnd":return u(t);case"topKeyPress":var n=t.which;return n!==N?null:(S=!0,k);case"topTextInput":var o=t.data;return o===k&&S?null:o;default:return null}}function d(e,t){if(T){if("topCompositionEnd"===e||!_&&l(e,t)){var n=T.getData();return m.release(T),T=null,n}return null}switch(e){case"topPaste":return null;case"topKeyPress":return t.which&&!r(t)?String.fromCharCode(t.which):null;case"topCompositionEnd":return x?null:t.data;default:return null}}function f(e,t,n,o){var r;if(r=E?c(e,n):d(e,n),!r)return null;var a=y.getPooled(w.beforeInput,t,n,o);return a.data=r,p.accumulateTwoPhaseDispatches(a),a}var p=n(58),h=n(20),m=n(359),v=n(396),y=n(399),g=[9,13,27,32],b=229,_=h.canUseDOM&&"CompositionEvent"in window,C=null;h.canUseDOM&&"documentMode"in document&&(C=document.documentMode);var E=h.canUseDOM&&"TextEvent"in window&&!C&&!o(),x=h.canUseDOM&&(!_||C&&C>8&&C<=11),N=32,k=String.fromCharCode(N),w={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["topCompositionEnd","topKeyPress","topTextInput","topPaste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:["topBlur","topCompositionEnd","topKeyDown","topKeyPress","topKeyUp","topMouseDown"]},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:["topBlur","topCompositionStart","topKeyDown","topKeyPress","topKeyUp","topMouseDown"]},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:["topBlur","topCompositionUpdate","topKeyDown","topKeyPress","topKeyUp","topMouseDown"]}},S=!1,T=null,O={eventTypes:w,extractEvents:function(e,t,n,o){return[s(e,t,n,o),f(e,t,n,o)]}};e.exports=O},function(e,t,n){"use strict";var o=n(171),r=n(20),a=(n(23),n(272),n(405)),i=n(279),l=n(282),u=(n(12),l(function(e){return i(e)})),s=!1,c="cssFloat";if(r.canUseDOM){var d=document.createElement("div").style;try{d.font=""}catch(e){s=!0}void 0===document.documentElement.style.cssFloat&&(c="styleFloat")}var f={createMarkupForStyles:function(e,t){var n="";for(var o in e)if(e.hasOwnProperty(o)){var r=0===o.indexOf("--"),i=e[o];null!=i&&(n+=u(o)+":",n+=a(o,i,t,r)+";")}return n||null},setValueForStyles:function(e,t,n){var r=e.style;for(var i in t)if(t.hasOwnProperty(i)){var l=0===i.indexOf("--"),u=a(i,t[i],n,l);if("float"!==i&&"cssFloat"!==i||(i=c),l)r.setProperty(i,u);else if(u)r[i]=u;else{var d=s&&o.shorthandPropertyExpansions[i];if(d)for(var f in d)r[f]="";else r[i]=""}}}};e.exports=f},function(e,t,n){"use strict";function o(e,t,n){var o=w.getPooled(P.change,e,t,n);return o.type="change",E.accumulateTwoPhaseDispatches(o),o}function r(e){var t=e.nodeName&&e.nodeName.toLowerCase();return"select"===t||"input"===t&&"file"===e.type}function a(e){var t=o(I,e,T(e));k.batchedUpdates(i,t)}function i(e){C.enqueueEvents(e),C.processEventQueue(!1)}function l(e,t){D=e,I=t,D.attachEvent("onchange",a)}function u(){D&&(D.detachEvent("onchange",a),D=null,I=null)}function s(e,t){var n=S.updateValueIfChanged(e),o=t.simulated===!0&&L._allowSimulatedPassThrough;if(n||o)return e}function c(e,t){if("topChange"===e)return t}function d(e,t,n){"topFocus"===e?(u(),l(t,n)):"topBlur"===e&&u()}function f(e,t){D=e,I=t,D.attachEvent("onpropertychange",h)}function p(){D&&(D.detachEvent("onpropertychange",h),D=null,I=null)}function h(e){"value"===e.propertyName&&s(I,e)&&a(e)}function m(e,t,n){"topFocus"===e?(p(),f(t,n)):"topBlur"===e&&p()}function v(e,t,n){if("topSelectionChange"===e||"topKeyUp"===e||"topKeyDown"===e)return s(I,n)}function y(e){var t=e.nodeName;return t&&"input"===t.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)}function g(e,t,n){if("topClick"===e)return s(t,n)}function b(e,t,n){if("topInput"===e||"topChange"===e)return s(t,n)}function _(e,t){if(null!=e){var n=e._wrapperState||t._wrapperState;if(n&&n.controlled&&"number"===t.type){var o=""+t.value;t.getAttribute("value")!==o&&t.setAttribute("value",o)}}}var C=n(57),E=n(58),x=n(20),N=n(15),k=n(28),w=n(29),S=n(187),T=n(121),O=n(122),M=n(189),P={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:["topBlur","topChange","topClick","topFocus","topInput","topKeyDown","topKeyUp","topSelectionChange"]}},D=null,I=null,A=!1;x.canUseDOM&&(A=O("change")&&(!document.documentMode||document.documentMode>8));var R=!1;x.canUseDOM&&(R=O("input")&&(!document.documentMode||document.documentMode>9));var L={eventTypes:P,_allowSimulatedPassThrough:!0,_isInputEventSupported:R,extractEvents:function(e,t,n,a){var i,l,u=t?N.getNodeFromInstance(t):window;if(r(u)?A?i=c:l=d:M(u)?R?i=b:(i=v,l=m):y(u)&&(i=g),i){var s=i(e,t,n);if(s){var f=o(s,n,a);return f}}l&&l(e,u,t),"topBlur"===e&&_(t,u)}};e.exports=L},function(e,t,n){"use strict";var o=n(11),r=n(44),a=n(20),i=n(275),l=n(26),u=(n(10),{dangerouslyReplaceNodeWithMarkup:function(e,t){if(a.canUseDOM?void 0:o("56"),t?void 0:o("57"),"HTML"===e.nodeName?o("58"):void 0,"string"==typeof t){var n=i(t,l)[0];e.parentNode.replaceChild(n,e)}else r.replaceChildWithTree(e,t)}});e.exports=u},function(e,t){"use strict";var n=["ResponderEventPlugin","SimpleEventPlugin","TapEventPlugin","EnterLeaveEventPlugin","ChangeEventPlugin","SelectEventPlugin","BeforeInputEventPlugin"];e.exports=n},function(e,t,n){"use strict";var o=n(58),r=n(15),a=n(78),i={mouseEnter:{registrationName:"onMouseEnter",dependencies:["topMouseOut","topMouseOver"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["topMouseOut","topMouseOver"]}},l={eventTypes:i,extractEvents:function(e,t,n,l){if("topMouseOver"===e&&(n.relatedTarget||n.fromElement))return null;if("topMouseOut"!==e&&"topMouseOver"!==e)return null;var u;if(l.window===l)u=l;else{var s=l.ownerDocument;u=s?s.defaultView||s.parentWindow:window}var c,d;if("topMouseOut"===e){c=t;var f=n.relatedTarget||n.toElement;d=f?r.getClosestInstanceFromNode(f):null}else c=null,d=t;if(c===d)return null;var p=null==c?u:r.getNodeFromInstance(c),h=null==d?u:r.getNodeFromInstance(d),m=a.getPooled(i.mouseLeave,c,n,l);m.type="mouseleave",m.target=p,m.relatedTarget=h;var v=a.getPooled(i.mouseEnter,d,n,l);return v.type="mouseenter",v.target=h,v.relatedTarget=p,o.accumulateEnterLeaveDispatches(m,v,c,d),[m,v]}};e.exports=l},function(e,t,n){"use strict";function o(e){this._root=e,this._startText=this.getText(),this._fallbackText=null}var r=n(14),a=n(37),i=n(186);r(o.prototype,{destructor:function(){this._root=null,this._startText=null,this._fallbackText=null},getText:function(){return"value"in this._root?this._root.value:this._root[i()]},getData:function(){if(this._fallbackText)return this._fallbackText;var e,t,n=this._startText,o=n.length,r=this.getText(),a=r.length;for(e=0;e<o&&n[e]===r[e];e++);var i=o-e;for(t=1;t<=i&&n[o-t]===r[a-t];t++);var l=t>1?1-t:void 0;return this._fallbackText=r.slice(e,l),this._fallbackText}}),a.addPoolingTo(o),e.exports=o},function(e,t,n){"use strict";var o=n(45),r=o.injection.MUST_USE_PROPERTY,a=o.injection.HAS_BOOLEAN_VALUE,i=o.injection.HAS_NUMERIC_VALUE,l=o.injection.HAS_POSITIVE_NUMERIC_VALUE,u=o.injection.HAS_OVERLOADED_BOOLEAN_VALUE,s={isCustomAttribute:RegExp.prototype.test.bind(new RegExp("^(data|aria)-["+o.ATTRIBUTE_NAME_CHAR+"]*$")),Properties:{accept:0,acceptCharset:0,accessKey:0,action:0,allowFullScreen:a,allowTransparency:0,alt:0,as:0,async:a,autoComplete:0,autoPlay:a,capture:a,cellPadding:0,cellSpacing:0,charSet:0,challenge:0,checked:r|a,cite:0,classID:0,className:0,cols:l,colSpan:0,content:0,contentEditable:0,contextMenu:0,controls:a,controlsList:0,coords:0,crossOrigin:0,data:0,dateTime:0,"default":a,defer:a,dir:0,disabled:a,download:u,draggable:0,encType:0,form:0,formAction:0,formEncType:0,formMethod:0,formNoValidate:a,formTarget:0,frameBorder:0,headers:0,height:0,hidden:a,high:0,href:0,hrefLang:0,htmlFor:0,httpEquiv:0,icon:0,id:0,inputMode:0,integrity:0,is:0,keyParams:0,keyType:0,kind:0,label:0,lang:0,list:0,loop:a,low:0,manifest:0,marginHeight:0,marginWidth:0,max:0,maxLength:0,media:0,mediaGroup:0,method:0,min:0,minLength:0,multiple:r|a,muted:r|a,name:0,nonce:0,noValidate:a,open:a,optimum:0,pattern:0,placeholder:0,playsInline:a,poster:0,preload:0,profile:0,radioGroup:0,readOnly:a,referrerPolicy:0,rel:0,required:a,reversed:a,role:0,rows:l,rowSpan:i,sandbox:0,scope:0,scoped:a,scrolling:0,seamless:a,selected:r|a,shape:0,size:l,sizes:0,span:l,spellCheck:0,src:0,srcDoc:0,srcLang:0,srcSet:0,start:i,step:0,style:0,summary:0,tabIndex:0,target:0,title:0,type:0,useMap:0,value:0,width:0,wmode:0,wrap:0,about:0,datatype:0,inlist:0,prefix:0,property:0,resource:0,"typeof":0,vocab:0,autoCapitalize:0,autoCorrect:0,autoSave:0,color:0,itemProp:0,itemScope:a,itemType:0,itemID:0,itemRef:0,results:0,security:0,unselectable:0},DOMAttributeNames:{acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv"},DOMPropertyNames:{},DOMMutationMethods:{value:function(e,t){return null==t?e.removeAttribute("value"):void("number"!==e.type||e.hasAttribute("value")===!1?e.setAttribute("value",""+t):e.validity&&!e.validity.badInput&&e.ownerDocument.activeElement!==e&&e.setAttribute("value",""+t))}}};e.exports=s},function(e,t,n){(function(t){"use strict";function o(e,t,n,o){var r=void 0===e[n];null!=t&&r&&(e[n]=a(t,!0))}var r=n(46),a=n(188),i=(n(113),n(123)),l=n(191),u=(n(12),{instantiateChildren:function(e,t,n,r){if(null==e)return null;var a={};return l(e,o,a),a},updateChildren:function(e,t,n,o,l,u,s,c,d){if(t||e){var f,p;for(f in t)if(t.hasOwnProperty(f)){p=e&&e[f];var h=p&&p._currentElement,m=t[f];if(null!=p&&i(h,m))r.receiveComponent(p,m,l,c),t[f]=p;else{p&&(o[f]=r.getHostNode(p),r.unmountComponent(p,!1));var v=a(m,!0);t[f]=v;var y=r.mountComponent(v,l,u,s,c,d);n.push(y)}}for(f in e)!e.hasOwnProperty(f)||t&&t.hasOwnProperty(f)||(p=e[f],o[f]=r.getHostNode(p),r.unmountComponent(p,!1))}},unmountChildren:function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];r.unmountComponent(o,t)}}});e.exports=u}).call(t,n(149))},function(e,t,n){"use strict";var o=n(109),r=n(369),a={processChildrenUpdates:r.dangerouslyProcessChildrenUpdates,replaceNodeWithMarkup:o.dangerouslyReplaceNodeWithMarkup};e.exports=a},function(e,t,n){"use strict";function o(e){}function r(e,t){}function a(e){return!(!e.prototype||!e.prototype.isReactComponent)}function i(e){return!(!e.prototype||!e.prototype.isPureReactComponent)}var l=n(11),u=n(14),s=n(48),c=n(115),d=n(30),f=n(116),p=n(59),h=(n(23),n(181)),m=n(46),v=n(67),y=(n(10),n(100)),g=n(123),b=(n(12),{ImpureClass:0,PureClass:1,StatelessFunctional:2});o.prototype.render=function(){var e=p.get(this)._currentElement.type,t=e(this.props,this.context,this.updater);return r(e,t),t};var _=1,C={construct:function(e){this._currentElement=e,this._rootNodeID=0,this._compositeType=null,this._instance=null,this._hostParent=null,this._hostContainerInfo=null,this._updateBatchNumber=null,this._pendingElement=null,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,this._renderedNodeType=null,this._renderedComponent=null,this._context=null,this._mountOrder=0,this._topLevelWrapper=null,this._pendingCallbacks=null,this._calledComponentWillUnmount=!1},mountComponent:function(e,t,n,u){this._context=u,this._mountOrder=_++,this._hostParent=t,this._hostContainerInfo=n;var c,d=this._currentElement.props,f=this._processContext(u),h=this._currentElement.type,m=e.getUpdateQueue(),y=a(h),g=this._constructComponent(y,d,f,m);y||null!=g&&null!=g.render?i(h)?this._compositeType=b.PureClass:this._compositeType=b.ImpureClass:(c=g,r(h,c),null===g||g===!1||s.isValidElement(g)?void 0:l("105",h.displayName||h.name||"Component"),g=new o(h),this._compositeType=b.StatelessFunctional),g.props=d,g.context=f,g.refs=v,g.updater=m,this._instance=g,p.set(g,this);var C=g.state;void 0===C&&(g.state=C=null),"object"!=typeof C||Array.isArray(C)?l("106",this.getName()||"ReactCompositeComponent"):void 0,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1;var E;return E=g.unstable_handleError?this.performInitialMountWithErrorHandling(c,t,n,e,u):this.performInitialMount(c,t,n,e,u),g.componentDidMount&&e.getReactMountReady().enqueue(g.componentDidMount,g),E},_constructComponent:function(e,t,n,o){return this._constructComponentWithoutOwner(e,t,n,o)},_constructComponentWithoutOwner:function(e,t,n,o){var r=this._currentElement.type;return e?new r(t,n,o):r(t,n,o)},performInitialMountWithErrorHandling:function(e,t,n,o,r){var a,i=o.checkpoint();try{a=this.performInitialMount(e,t,n,o,r)}catch(l){o.rollback(i),this._instance.unstable_handleError(l),this._pendingStateQueue&&(this._instance.state=this._processPendingState(this._instance.props,this._instance.context)),i=o.checkpoint(),this._renderedComponent.unmountComponent(!0),o.rollback(i),a=this.performInitialMount(e,t,n,o,r)}return a},performInitialMount:function(e,t,n,o,r){var a=this._instance,i=0;a.componentWillMount&&(a.componentWillMount(),this._pendingStateQueue&&(a.state=this._processPendingState(a.props,a.context))),void 0===e&&(e=this._renderValidatedComponent());var l=h.getType(e);this._renderedNodeType=l;var u=this._instantiateReactComponent(e,l!==h.EMPTY);this._renderedComponent=u;var s=m.mountComponent(u,o,t,n,this._processChildContext(r),i);return s},getHostNode:function(){return m.getHostNode(this._renderedComponent)},unmountComponent:function(e){if(this._renderedComponent){var t=this._instance;if(t.componentWillUnmount&&!t._calledComponentWillUnmount)if(t._calledComponentWillUnmount=!0,e){var n=this.getName()+".componentWillUnmount()";f.invokeGuardedCallback(n,t.componentWillUnmount.bind(t))}else t.componentWillUnmount();this._renderedComponent&&(m.unmountComponent(this._renderedComponent,e),this._renderedNodeType=null,this._renderedComponent=null,this._instance=null),this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,this._pendingCallbacks=null,this._pendingElement=null,this._context=null,this._rootNodeID=0,this._topLevelWrapper=null,p.remove(t)}},_maskContext:function(e){var t=this._currentElement.type,n=t.contextTypes;if(!n)return v;var o={};for(var r in n)o[r]=e[r];return o},_processContext:function(e){var t=this._maskContext(e);return t},_processChildContext:function(e){var t,n=this._currentElement.type,o=this._instance;if(o.getChildContext&&(t=o.getChildContext()),t){"object"!=typeof n.childContextTypes?l("107",this.getName()||"ReactCompositeComponent"):void 0;for(var r in t)r in n.childContextTypes?void 0:l("108",this.getName()||"ReactCompositeComponent",r);return u({},e,t)}return e},_checkContextTypes:function(e,t,n){},receiveComponent:function(e,t,n){var o=this._currentElement,r=this._context;this._pendingElement=null,this.updateComponent(t,o,e,r,n)},performUpdateIfNecessary:function(e){null!=this._pendingElement?m.receiveComponent(this,this._pendingElement,e,this._context):null!==this._pendingStateQueue||this._pendingForceUpdate?this.updateComponent(e,this._currentElement,this._currentElement,this._context,this._context):this._updateBatchNumber=null},updateComponent:function(e,t,n,o,r){var a=this._instance;null==a?l("136",this.getName()||"ReactCompositeComponent"):void 0;var i,u=!1;this._context===r?i=a.context:(i=this._processContext(r),u=!0);var s=t.props,c=n.props;t!==n&&(u=!0),u&&a.componentWillReceiveProps&&a.componentWillReceiveProps(c,i);var d=this._processPendingState(c,i),f=!0;this._pendingForceUpdate||(a.shouldComponentUpdate?f=a.shouldComponentUpdate(c,d,i):this._compositeType===b.PureClass&&(f=!y(s,c)||!y(a.state,d))),this._updateBatchNumber=null,f?(this._pendingForceUpdate=!1,this._performComponentUpdate(n,c,d,i,e,r)):(this._currentElement=n,this._context=r,a.props=c,a.state=d,a.context=i)},_processPendingState:function(e,t){var n=this._instance,o=this._pendingStateQueue,r=this._pendingReplaceState;if(this._pendingReplaceState=!1,this._pendingStateQueue=null,!o)return n.state;if(r&&1===o.length)return o[0];for(var a=u({},r?o[0]:n.state),i=r?1:0;i<o.length;i++){var l=o[i];u(a,"function"==typeof l?l.call(n,a,e,t):l)}return a},_performComponentUpdate:function(e,t,n,o,r,a){var i,l,u,s=this._instance,c=Boolean(s.componentDidUpdate);c&&(i=s.props,l=s.state,u=s.context),s.componentWillUpdate&&s.componentWillUpdate(t,n,o),this._currentElement=e,this._context=a,s.props=t,s.state=n,s.context=o,this._updateRenderedComponent(r,a),c&&r.getReactMountReady().enqueue(s.componentDidUpdate.bind(s,i,l,u),s)},_updateRenderedComponent:function(e,t){var n=this._renderedComponent,o=n._currentElement,r=this._renderValidatedComponent(),a=0;if(g(o,r))m.receiveComponent(n,r,e,this._processChildContext(t));else{var i=m.getHostNode(n);m.unmountComponent(n,!1);var l=h.getType(r);this._renderedNodeType=l;var u=this._instantiateReactComponent(r,l!==h.EMPTY);this._renderedComponent=u;var s=m.mountComponent(u,e,this._hostParent,this._hostContainerInfo,this._processChildContext(t),a);this._replaceNodeWithMarkup(i,s,n)}},_replaceNodeWithMarkup:function(e,t,n){c.replaceNodeWithMarkup(e,t,n)},_renderValidatedComponentWithoutOwnerOrContext:function(){var e,t=this._instance;return e=t.render()},_renderValidatedComponent:function(){var e;if(this._compositeType!==b.StatelessFunctional){d.current=this;try{e=this._renderValidatedComponentWithoutOwnerOrContext()}finally{d.current=null}}else e=this._renderValidatedComponentWithoutOwnerOrContext();return null===e||e===!1||s.isValidElement(e)?void 0:l("109",this.getName()||"ReactCompositeComponent"),e},attachRef:function(e,t){var n=this.getPublicInstance();null==n?l("110"):void 0;var o=t.getPublicInstance(),r=n.refs===v?n.refs={}:n.refs;r[e]=o},detachRef:function(e){var t=this.getPublicInstance().refs;delete t[e]},getName:function(){var e=this._currentElement.type,t=this._instance&&this._instance.constructor;return e.displayName||t&&t.displayName||e.name||t&&t.name||null},getPublicInstance:function(){var e=this._instance;return this._compositeType===b.StatelessFunctional?null:e},_instantiateReactComponent:null};e.exports=C},function(e,t,n){"use strict";var o=n(15),r=n(377),a=n(180),i=n(46),l=n(28),u=n(390),s=n(406),c=n(185),d=n(413);n(12),r.inject();var f={findDOMNode:s,render:a.render,unmountComponentAtNode:a.unmountComponentAtNode,version:u,unstable_batchedUpdates:l.batchedUpdates,unstable_renderSubtreeIntoContainer:d};"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.inject&&__REACT_DEVTOOLS_GLOBAL_HOOK__.inject({ComponentTree:{getClosestInstanceFromNode:o.getClosestInstanceFromNode,getNodeFromInstance:function(e){return e._renderedComponent&&(e=c(e)),e?o.getNodeFromInstance(e):null}},Mount:a,Reconciler:i}),e.exports=f},function(e,t,n){"use strict";function o(e){if(e){var t=e._currentElement._owner||null;if(t){var n=t.getName();if(n)return" This DOM node was rendered by `"+n+"`."}}return""}function r(e,t){t&&(X[e._tag]&&(null!=t.children||null!=t.dangerouslySetInnerHTML?v("137",e._tag,e._currentElement._owner?" Check the render method of "+e._currentElement._owner.getName()+".":""):void 0),null!=t.dangerouslySetInnerHTML&&(null!=t.children?v("60"):void 0,"object"==typeof t.dangerouslySetInnerHTML&&W in t.dangerouslySetInnerHTML?void 0:v("61")),null!=t.style&&"object"!=typeof t.style?v("62",o(e)):void 0)}function a(e,t,n,o){if(!(o instanceof A)){var r=e._hostContainerInfo,a=r._node&&r._node.nodeType===q,l=a?r._node:r._ownerDocument;F(t,l),o.getReactMountReady().enqueue(i,{inst:e,registrationName:t,listener:n})}}function i(){var e=this;N.putListener(e.inst,e.registrationName,e.listener)}function l(){var e=this;O.postMountWrapper(e)}function u(){var e=this;D.postMountWrapper(e)}function s(){var e=this;M.postMountWrapper(e)}function c(){L.track(this)}function d(){var e=this;e._rootNodeID?void 0:v("63");var t=U(e);switch(t?void 0:v("64"),e._tag){case"iframe":case"object":e._wrapperState.listeners=[w.trapBubbledEvent("topLoad","load",t)];break;case"video":case"audio":e._wrapperState.listeners=[];for(var n in z)z.hasOwnProperty(n)&&e._wrapperState.listeners.push(w.trapBubbledEvent(n,z[n],t));break;case"source":e._wrapperState.listeners=[w.trapBubbledEvent("topError","error",t)];break;case"img":e._wrapperState.listeners=[w.trapBubbledEvent("topError","error",t),w.trapBubbledEvent("topLoad","load",t)];break;case"form":e._wrapperState.listeners=[w.trapBubbledEvent("topReset","reset",t),w.trapBubbledEvent("topSubmit","submit",t)];break;case"input":case"select":case"textarea":e._wrapperState.listeners=[w.trapBubbledEvent("topInvalid","invalid",t)]}}function f(){P.postUpdateWrapper(this)}function p(e){J.call(Z,e)||(Q.test(e)?void 0:v("65",e),Z[e]=!0)}function h(e,t){return e.indexOf("-")>=0||null!=t.is}function m(e){var t=e.type;p(t),this._currentElement=e,this._tag=t.toLowerCase(),this._namespaceURI=null,this._renderedChildren=null,this._previousStyle=null,this._previousStyleCopy=null,this._hostNode=null,this._hostParent=null,this._rootNodeID=0,this._domID=0,this._hostContainerInfo=null,this._wrapperState=null,this._topLevelWrapper=null,this._flags=0}var v=n(11),y=n(14),g=n(352),b=n(354),_=n(44),C=n(110),E=n(45),x=n(173),N=n(57),k=n(111),w=n(77),S=n(174),T=n(15),O=n(370),M=n(371),P=n(175),D=n(374),I=(n(23),n(383)),A=n(388),R=(n(26),n(80)),L=(n(10),n(122),n(100),n(187)),j=(n(124),n(12),S),B=N.deleteListener,U=T.getNodeFromInstance,F=w.listenTo,H=k.registrationNameModules,V={string:!0,number:!0},K="style",W="__html",$={children:null,dangerouslySetInnerHTML:null,suppressContentEditableWarning:null},q=11,z={topAbort:"abort",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topSeeked:"seeked",topSeeking:"seeking",topStalled:"stalled",topSuspend:"suspend",topTimeUpdate:"timeupdate",topVolumeChange:"volumechange",topWaiting:"waiting"},G={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},Y={listing:!0,pre:!0,textarea:!0},X=y({menuitem:!0},G),Q=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,Z={},J={}.hasOwnProperty,ee=1;m.displayName="ReactDOMComponent",m.Mixin={mountComponent:function(e,t,n,o){this._rootNodeID=ee++,this._domID=n._idCounter++,this._hostParent=t,this._hostContainerInfo=n;var a=this._currentElement.props;switch(this._tag){case"audio":case"form":case"iframe":case"img":case"link":case"object":case"source":case"video":this._wrapperState={listeners:null},e.getReactMountReady().enqueue(d,this);break;case"input":O.mountWrapper(this,a,t),a=O.getHostProps(this,a),e.getReactMountReady().enqueue(c,this),e.getReactMountReady().enqueue(d,this);break;case"option":M.mountWrapper(this,a,t),a=M.getHostProps(this,a);break;case"select":P.mountWrapper(this,a,t),a=P.getHostProps(this,a),e.getReactMountReady().enqueue(d,this);break;case"textarea":D.mountWrapper(this,a,t),a=D.getHostProps(this,a),e.getReactMountReady().enqueue(c,this),e.getReactMountReady().enqueue(d,this)}r(this,a);var i,f;null!=t?(i=t._namespaceURI,f=t._tag):n._tag&&(i=n._namespaceURI,f=n._tag),(null==i||i===C.svg&&"foreignobject"===f)&&(i=C.html),i===C.html&&("svg"===this._tag?i=C.svg:"math"===this._tag&&(i=C.mathml)),this._namespaceURI=i;var p;if(e.useCreateElement){var h,m=n._ownerDocument;if(i===C.html)if("script"===this._tag){var v=m.createElement("div"),y=this._currentElement.type;v.innerHTML="<"+y+"></"+y+">",h=v.removeChild(v.firstChild)}else h=a.is?m.createElement(this._currentElement.type,a.is):m.createElement(this._currentElement.type);else h=m.createElementNS(i,this._currentElement.type);T.precacheNode(this,h),this._flags|=j.hasCachedChildNodes,this._hostParent||x.setAttributeForRoot(h),this._updateDOMProperties(null,a,e);var b=_(h);this._createInitialChildren(e,a,o,b),p=b}else{var E=this._createOpenTagMarkupAndPutListeners(e,a),N=this._createContentMarkup(e,a,o);p=!N&&G[this._tag]?E+"/>":E+">"+N+"</"+this._currentElement.type+">"}switch(this._tag){case"input":e.getReactMountReady().enqueue(l,this),a.autoFocus&&e.getReactMountReady().enqueue(g.focusDOMComponent,this);break;case"textarea":e.getReactMountReady().enqueue(u,this),a.autoFocus&&e.getReactMountReady().enqueue(g.focusDOMComponent,this);break;case"select":a.autoFocus&&e.getReactMountReady().enqueue(g.focusDOMComponent,this);break;case"button":a.autoFocus&&e.getReactMountReady().enqueue(g.focusDOMComponent,this);break;case"option":e.getReactMountReady().enqueue(s,this)}return p},_createOpenTagMarkupAndPutListeners:function(e,t){var n="<"+this._currentElement.type;for(var o in t)if(t.hasOwnProperty(o)){var r=t[o];if(null!=r)if(H.hasOwnProperty(o))r&&a(this,o,r,e);else{o===K&&(r&&(r=this._previousStyleCopy=y({},t.style)),r=b.createMarkupForStyles(r,this));var i=null;null!=this._tag&&h(this._tag,t)?$.hasOwnProperty(o)||(i=x.createMarkupForCustomAttribute(o,r)):i=x.createMarkupForProperty(o,r),i&&(n+=" "+i);
}}return e.renderToStaticMarkup?n:(this._hostParent||(n+=" "+x.createMarkupForRoot()),n+=" "+x.createMarkupForID(this._domID))},_createContentMarkup:function(e,t,n){var o="",r=t.dangerouslySetInnerHTML;if(null!=r)null!=r.__html&&(o=r.__html);else{var a=V[typeof t.children]?t.children:null,i=null!=a?null:t.children;if(null!=a)o=R(a);else if(null!=i){var l=this.mountChildren(i,e,n);o=l.join("")}}return Y[this._tag]&&"\n"===o.charAt(0)?"\n"+o:o},_createInitialChildren:function(e,t,n,o){var r=t.dangerouslySetInnerHTML;if(null!=r)null!=r.__html&&_.queueHTML(o,r.__html);else{var a=V[typeof t.children]?t.children:null,i=null!=a?null:t.children;if(null!=a)""!==a&&_.queueText(o,a);else if(null!=i)for(var l=this.mountChildren(i,e,n),u=0;u<l.length;u++)_.queueChild(o,l[u])}},receiveComponent:function(e,t,n){var o=this._currentElement;this._currentElement=e,this.updateComponent(t,o,e,n)},updateComponent:function(e,t,n,o){var a=t.props,i=this._currentElement.props;switch(this._tag){case"input":a=O.getHostProps(this,a),i=O.getHostProps(this,i);break;case"option":a=M.getHostProps(this,a),i=M.getHostProps(this,i);break;case"select":a=P.getHostProps(this,a),i=P.getHostProps(this,i);break;case"textarea":a=D.getHostProps(this,a),i=D.getHostProps(this,i)}switch(r(this,i),this._updateDOMProperties(a,i,e),this._updateDOMChildren(a,i,e,o),this._tag){case"input":O.updateWrapper(this),L.updateValueIfChanged(this);break;case"textarea":D.updateWrapper(this);break;case"select":e.getReactMountReady().enqueue(f,this)}},_updateDOMProperties:function(e,t,n){var o,r,i;for(o in e)if(!t.hasOwnProperty(o)&&e.hasOwnProperty(o)&&null!=e[o])if(o===K){var l=this._previousStyleCopy;for(r in l)l.hasOwnProperty(r)&&(i=i||{},i[r]="");this._previousStyleCopy=null}else H.hasOwnProperty(o)?e[o]&&B(this,o):h(this._tag,e)?$.hasOwnProperty(o)||x.deleteValueForAttribute(U(this),o):(E.properties[o]||E.isCustomAttribute(o))&&x.deleteValueForProperty(U(this),o);for(o in t){var u=t[o],s=o===K?this._previousStyleCopy:null!=e?e[o]:void 0;if(t.hasOwnProperty(o)&&u!==s&&(null!=u||null!=s))if(o===K)if(u?u=this._previousStyleCopy=y({},u):this._previousStyleCopy=null,s){for(r in s)!s.hasOwnProperty(r)||u&&u.hasOwnProperty(r)||(i=i||{},i[r]="");for(r in u)u.hasOwnProperty(r)&&s[r]!==u[r]&&(i=i||{},i[r]=u[r])}else i=u;else if(H.hasOwnProperty(o))u?a(this,o,u,n):s&&B(this,o);else if(h(this._tag,t))$.hasOwnProperty(o)||x.setValueForAttribute(U(this),o,u);else if(E.properties[o]||E.isCustomAttribute(o)){var c=U(this);null!=u?x.setValueForProperty(c,o,u):x.deleteValueForProperty(c,o)}}i&&b.setValueForStyles(U(this),i,this)},_updateDOMChildren:function(e,t,n,o){var r=V[typeof e.children]?e.children:null,a=V[typeof t.children]?t.children:null,i=e.dangerouslySetInnerHTML&&e.dangerouslySetInnerHTML.__html,l=t.dangerouslySetInnerHTML&&t.dangerouslySetInnerHTML.__html,u=null!=r?null:e.children,s=null!=a?null:t.children,c=null!=r||null!=i,d=null!=a||null!=l;null!=u&&null==s?this.updateChildren(null,n,o):c&&!d&&this.updateTextContent(""),null!=a?r!==a&&this.updateTextContent(""+a):null!=l?i!==l&&this.updateMarkup(""+l):null!=s&&this.updateChildren(s,n,o)},getHostNode:function(){return U(this)},unmountComponent:function(e){switch(this._tag){case"audio":case"form":case"iframe":case"img":case"link":case"object":case"source":case"video":var t=this._wrapperState.listeners;if(t)for(var n=0;n<t.length;n++)t[n].remove();break;case"input":case"textarea":L.stopTracking(this);break;case"html":case"head":case"body":v("66",this._tag)}this.unmountChildren(e),T.uncacheNode(this),N.deleteAllListeners(this),this._rootNodeID=0,this._domID=0,this._wrapperState=null},getPublicInstance:function(){return U(this)}},y(m.prototype,m.Mixin,I.Mixin),e.exports=m},function(e,t,n){"use strict";function o(e,t){var n={_topLevelWrapper:e,_idCounter:1,_ownerDocument:t?t.nodeType===r?t:t.ownerDocument:null,_node:t,_tag:t?t.nodeName.toLowerCase():null,_namespaceURI:t?t.namespaceURI:null};return n}var r=(n(124),9);e.exports=o},function(e,t,n){"use strict";var o=n(14),r=n(44),a=n(15),i=function(e){this._currentElement=null,this._hostNode=null,this._hostParent=null,this._hostContainerInfo=null,this._domID=0};o(i.prototype,{mountComponent:function(e,t,n,o){var i=n._idCounter++;this._domID=i,this._hostParent=t,this._hostContainerInfo=n;var l=" react-empty: "+this._domID+" ";if(e.useCreateElement){var u=n._ownerDocument,s=u.createComment(l);return a.precacheNode(this,s),r(s)}return e.renderToStaticMarkup?"":"<!--"+l+"-->"},receiveComponent:function(){},getHostNode:function(){return a.getNodeFromInstance(this)},unmountComponent:function(){a.uncacheNode(this)}}),e.exports=i},function(e,t){"use strict";var n={useCreateElement:!0,useFiber:!1};e.exports=n},function(e,t,n){"use strict";var o=n(109),r=n(15),a={dangerouslyProcessChildrenUpdates:function(e,t){var n=r.getNodeFromInstance(e);o.processUpdates(n,t)}};e.exports=a},function(e,t,n){"use strict";function o(){this._rootNodeID&&f.updateWrapper(this)}function r(e){var t="checkbox"===e.type||"radio"===e.type;return t?null!=e.checked:null!=e.value}function a(e){var t=this._currentElement.props,n=s.executeOnChange(t,e);d.asap(o,this);var r=t.name;if("radio"===t.type&&null!=r){for(var a=c.getNodeFromInstance(this),l=a;l.parentNode;)l=l.parentNode;for(var u=l.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),f=0;f<u.length;f++){var p=u[f];if(p!==a&&p.form===a.form){var h=c.getInstanceFromNode(p);h?void 0:i("90"),d.asap(o,h)}}}return n}var i=n(11),l=n(14),u=n(173),s=n(114),c=n(15),d=n(28),f=(n(10),n(12),{getHostProps:function(e,t){var n=s.getValue(t),o=s.getChecked(t),r=l({type:void 0,step:void 0,min:void 0,max:void 0},t,{defaultChecked:void 0,defaultValue:void 0,value:null!=n?n:e._wrapperState.initialValue,checked:null!=o?o:e._wrapperState.initialChecked,onChange:e._wrapperState.onChange});return r},mountWrapper:function(e,t){var n=t.defaultValue;e._wrapperState={initialChecked:null!=t.checked?t.checked:t.defaultChecked,initialValue:null!=t.value?t.value:n,listeners:null,onChange:a.bind(e),controlled:r(t)}},updateWrapper:function(e){var t=e._currentElement.props,n=t.checked;null!=n&&u.setValueForProperty(c.getNodeFromInstance(e),"checked",n||!1);var o=c.getNodeFromInstance(e),r=s.getValue(t);if(null!=r)if(0===r&&""===o.value)o.value="0";else if("number"===t.type){var a=parseFloat(o.value,10)||0;(r!=a||r==a&&o.value!=r)&&(o.value=""+r)}else o.value!==""+r&&(o.value=""+r);else null==t.value&&null!=t.defaultValue&&o.defaultValue!==""+t.defaultValue&&(o.defaultValue=""+t.defaultValue),null==t.checked&&null!=t.defaultChecked&&(o.defaultChecked=!!t.defaultChecked)},postMountWrapper:function(e){var t=e._currentElement.props,n=c.getNodeFromInstance(e);switch(t.type){case"submit":case"reset":break;case"color":case"date":case"datetime":case"datetime-local":case"month":case"time":case"week":n.value="",n.value=n.defaultValue;break;default:n.value=n.value}var o=n.name;""!==o&&(n.name=""),n.defaultChecked=!n.defaultChecked,n.defaultChecked=!n.defaultChecked,""!==o&&(n.name=o)}});e.exports=f},function(e,t,n){"use strict";function o(e){var t="";return a.Children.forEach(e,function(e){null!=e&&("string"==typeof e||"number"==typeof e?t+=e:u||(u=!0))}),t}var r=n(14),a=n(48),i=n(15),l=n(175),u=(n(12),!1),s={mountWrapper:function(e,t,n){var r=null;if(null!=n){var a=n;"optgroup"===a._tag&&(a=a._hostParent),null!=a&&"select"===a._tag&&(r=l.getSelectValueContext(a))}var i=null;if(null!=r){var u;if(u=null!=t.value?t.value+"":o(t.children),i=!1,Array.isArray(r)){for(var s=0;s<r.length;s++)if(""+r[s]===u){i=!0;break}}else i=""+r===u}e._wrapperState={selected:i}},postMountWrapper:function(e){var t=e._currentElement.props;if(null!=t.value){var n=i.getNodeFromInstance(e);n.setAttribute("value",t.value)}},getHostProps:function(e,t){var n=r({selected:void 0,children:void 0},t);null!=e._wrapperState.selected&&(n.selected=e._wrapperState.selected);var a=o(t.children);return a&&(n.children=a),n}};e.exports=s},function(e,t,n){"use strict";function o(e,t,n,o){return e===n&&t===o}function r(e){var t=document.selection,n=t.createRange(),o=n.text.length,r=n.duplicate();r.moveToElementText(e),r.setEndPoint("EndToStart",n);var a=r.text.length,i=a+o;return{start:a,end:i}}function a(e){var t=window.getSelection&&window.getSelection();if(!t||0===t.rangeCount)return null;var n=t.anchorNode,r=t.anchorOffset,a=t.focusNode,i=t.focusOffset,l=t.getRangeAt(0);try{l.startContainer.nodeType,l.endContainer.nodeType}catch(e){return null}var u=o(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),s=u?0:l.toString().length,c=l.cloneRange();c.selectNodeContents(e),c.setEnd(l.startContainer,l.startOffset);var d=o(c.startContainer,c.startOffset,c.endContainer,c.endOffset),f=d?0:c.toString().length,p=f+s,h=document.createRange();h.setStart(n,r),h.setEnd(a,i);var m=h.collapsed;return{start:m?p:f,end:m?f:p}}function i(e,t){var n,o,r=document.selection.createRange().duplicate();void 0===t.end?(n=t.start,o=n):t.start>t.end?(n=t.end,o=t.start):(n=t.start,o=t.end),r.moveToElementText(e),r.moveStart("character",n),r.setEndPoint("EndToStart",r),r.moveEnd("character",o-n),r.select()}function l(e,t){if(window.getSelection){var n=window.getSelection(),o=e[c()].length,r=Math.min(t.start,o),a=void 0===t.end?r:Math.min(t.end,o);if(!n.extend&&r>a){var i=a;a=r,r=i}var l=s(e,r),u=s(e,a);if(l&&u){var d=document.createRange();d.setStart(l.node,l.offset),n.removeAllRanges(),r>a?(n.addRange(d),n.extend(u.node,u.offset)):(d.setEnd(u.node,u.offset),n.addRange(d))}}}var u=n(20),s=n(410),c=n(186),d=u.canUseDOM&&"selection"in document&&!("getSelection"in window),f={getOffsets:d?r:a,setOffsets:d?i:l};e.exports=f},function(e,t,n){"use strict";var o=n(11),r=n(14),a=n(109),i=n(44),l=n(15),u=n(80),s=(n(10),n(124),function(e){this._currentElement=e,this._stringText=""+e,this._hostNode=null,this._hostParent=null,this._domID=0,this._mountIndex=0,this._closingComment=null,this._commentNodes=null});r(s.prototype,{mountComponent:function(e,t,n,o){var r=n._idCounter++,a=" react-text: "+r+" ",s=" /react-text ";if(this._domID=r,this._hostParent=t,e.useCreateElement){var c=n._ownerDocument,d=c.createComment(a),f=c.createComment(s),p=i(c.createDocumentFragment());return i.queueChild(p,i(d)),this._stringText&&i.queueChild(p,i(c.createTextNode(this._stringText))),i.queueChild(p,i(f)),l.precacheNode(this,d),this._closingComment=f,p}var h=u(this._stringText);return e.renderToStaticMarkup?h:"<!--"+a+"-->"+h+"<!--"+s+"-->"},receiveComponent:function(e,t){if(e!==this._currentElement){this._currentElement=e;var n=""+e;if(n!==this._stringText){this._stringText=n;var o=this.getHostNode();a.replaceDelimitedText(o[0],o[1],n)}}},getHostNode:function(){var e=this._commentNodes;if(e)return e;if(!this._closingComment)for(var t=l.getNodeFromInstance(this),n=t.nextSibling;;){if(null==n?o("67",this._domID):void 0,8===n.nodeType&&" /react-text "===n.nodeValue){this._closingComment=n;break}n=n.nextSibling}return e=[this._hostNode,this._closingComment],this._commentNodes=e,e},unmountComponent:function(){this._closingComment=null,this._commentNodes=null,l.uncacheNode(this)}}),e.exports=s},function(e,t,n){"use strict";function o(){this._rootNodeID&&c.updateWrapper(this)}function r(e){var t=this._currentElement.props,n=l.executeOnChange(t,e);return s.asap(o,this),n}var a=n(11),i=n(14),l=n(114),u=n(15),s=n(28),c=(n(10),n(12),{getHostProps:function(e,t){null!=t.dangerouslySetInnerHTML?a("91"):void 0;var n=i({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue,onChange:e._wrapperState.onChange});return n},mountWrapper:function(e,t){var n=l.getValue(t),o=n;if(null==n){var i=t.defaultValue,u=t.children;null!=u&&(null!=i?a("92"):void 0,Array.isArray(u)&&(u.length<=1?void 0:a("93"),u=u[0]),i=""+u),null==i&&(i=""),o=i}e._wrapperState={initialValue:""+o,listeners:null,onChange:r.bind(e)}},updateWrapper:function(e){var t=e._currentElement.props,n=u.getNodeFromInstance(e),o=l.getValue(t);if(null!=o){var r=""+o;r!==n.value&&(n.value=r),null==t.defaultValue&&(n.defaultValue=r)}null!=t.defaultValue&&(n.defaultValue=t.defaultValue)},postMountWrapper:function(e){var t=u.getNodeFromInstance(e),n=t.textContent;n===e._wrapperState.initialValue&&(t.value=n)}});e.exports=c},function(e,t,n){"use strict";function o(e,t){"_hostNode"in e?void 0:u("33"),"_hostNode"in t?void 0:u("33");for(var n=0,o=e;o;o=o._hostParent)n++;for(var r=0,a=t;a;a=a._hostParent)r++;for(;n-r>0;)e=e._hostParent,n--;for(;r-n>0;)t=t._hostParent,r--;for(var i=n;i--;){if(e===t)return e;e=e._hostParent,t=t._hostParent}return null}function r(e,t){"_hostNode"in e?void 0:u("35"),"_hostNode"in t?void 0:u("35");for(;t;){if(t===e)return!0;t=t._hostParent}return!1}function a(e){return"_hostNode"in e?void 0:u("36"),e._hostParent}function i(e,t,n){for(var o=[];e;)o.push(e),e=e._hostParent;var r;for(r=o.length;r-- >0;)t(o[r],"captured",n);for(r=0;r<o.length;r++)t(o[r],"bubbled",n)}function l(e,t,n,r,a){for(var i=e&&t?o(e,t):null,l=[];e&&e!==i;)l.push(e),e=e._hostParent;for(var u=[];t&&t!==i;)u.push(t),t=t._hostParent;var s;for(s=0;s<l.length;s++)n(l[s],"bubbled",r);for(s=u.length;s-- >0;)n(u[s],"captured",a)}var u=n(11);n(10),e.exports={isAncestor:r,getLowestCommonAncestor:o,getParentInstance:a,traverseTwoPhase:i,traverseEnterLeave:l}},function(e,t,n){"use strict";function o(){this.reinitializeTransaction()}var r=n(14),a=n(28),i=n(79),l=n(26),u={initialize:l,close:function(){f.isBatchingUpdates=!1}},s={initialize:l,close:a.flushBatchedUpdates.bind(a)},c=[s,u];r(o.prototype,i,{getTransactionWrappers:function(){return c}});var d=new o,f={isBatchingUpdates:!1,batchedUpdates:function(e,t,n,o,r,a){var i=f.isBatchingUpdates;return f.isBatchingUpdates=!0,i?e(t,n,o,r,a):d.perform(e,null,t,n,o,r,a)}};e.exports=f},function(e,t,n){"use strict";function o(){x||(x=!0,g.EventEmitter.injectReactEventListener(y),g.EventPluginHub.injectEventPluginOrder(l),g.EventPluginUtils.injectComponentTree(f),g.EventPluginUtils.injectTreeTraversal(h),g.EventPluginHub.injectEventPluginsByName({SimpleEventPlugin:E,EnterLeaveEventPlugin:u,ChangeEventPlugin:i,SelectEventPlugin:C,BeforeInputEventPlugin:a}),g.HostComponent.injectGenericComponentClass(d),g.HostComponent.injectTextComponentClass(m),g.DOMProperty.injectDOMPropertyConfig(r),g.DOMProperty.injectDOMPropertyConfig(s),g.DOMProperty.injectDOMPropertyConfig(_),g.EmptyComponent.injectEmptyComponentFactory(function(e){return new p(e)}),g.Updates.injectReconcileTransaction(b),g.Updates.injectBatchingStrategy(v),g.Component.injectEnvironment(c))}var r=n(351),a=n(353),i=n(355),l=n(357),u=n(358),s=n(360),c=n(362),d=n(365),f=n(15),p=n(367),h=n(375),m=n(373),v=n(376),y=n(380),g=n(381),b=n(386),_=n(391),C=n(392),E=n(393),x=!1;e.exports={inject:o}},199,function(e,t,n){"use strict";function o(e){r.enqueueEvents(e),r.processEventQueue(!1)}var r=n(57),a={handleTopLevel:function(e,t,n,a){var i=r.extractEvents(e,t,n,a);o(i)}};e.exports=a},function(e,t,n){"use strict";function o(e){for(;e._hostParent;)e=e._hostParent;var t=d.getNodeFromInstance(e),n=t.parentNode;return d.getClosestInstanceFromNode(n)}function r(e,t){this.topLevelType=e,this.nativeEvent=t,this.ancestors=[]}function a(e){var t=p(e.nativeEvent),n=d.getClosestInstanceFromNode(t),r=n;do e.ancestors.push(r),r=r&&o(r);while(r);for(var a=0;a<e.ancestors.length;a++)n=e.ancestors[a],m._handleTopLevel(e.topLevelType,n,e.nativeEvent,p(e.nativeEvent))}function i(e){var t=h(window);e(t)}var l=n(14),u=n(146),s=n(20),c=n(37),d=n(15),f=n(28),p=n(121),h=n(277);l(r.prototype,{destructor:function(){this.topLevelType=null,this.nativeEvent=null,this.ancestors.length=0}}),c.addPoolingTo(r,c.twoArgumentPooler);var m={_enabled:!0,_handleTopLevel:null,WINDOW_HANDLE:s.canUseDOM?window:null,setHandleTopLevel:function(e){m._handleTopLevel=e},setEnabled:function(e){m._enabled=!!e},isEnabled:function(){return m._enabled},trapBubbledEvent:function(e,t,n){return n?u.listen(n,t,m.dispatchEvent.bind(null,e)):null},trapCapturedEvent:function(e,t,n){return n?u.capture(n,t,m.dispatchEvent.bind(null,e)):null},monitorScrollValue:function(e){var t=i.bind(null,e);u.listen(window,"scroll",t)},dispatchEvent:function(e,t){if(m._enabled){var n=r.getPooled(e,t);try{f.batchedUpdates(a,n)}finally{r.release(n)}}}};e.exports=m},function(e,t,n){"use strict";var o=n(45),r=n(57),a=n(112),i=n(115),l=n(176),u=n(77),s=n(178),c=n(28),d={Component:i.injection,DOMProperty:o.injection,EmptyComponent:l.injection,EventPluginHub:r.injection,EventPluginUtils:a.injection,EventEmitter:u.injection,HostComponent:s.injection,Updates:c.injection};e.exports=d},function(e,t,n){"use strict";var o=n(404),r=/\/?>/,a=/^<\!\-\-/,i={CHECKSUM_ATTR_NAME:"data-react-checksum",addChecksumToMarkup:function(e){var t=o(e);return a.test(e)?e:e.replace(r," "+i.CHECKSUM_ATTR_NAME+'="'+t+'"$&')},canReuseMarkup:function(e,t){var n=t.getAttribute(i.CHECKSUM_ATTR_NAME);n=n&&parseInt(n,10);var r=o(e);return r===n}};e.exports=i},function(e,t,n){"use strict";function o(e,t,n){return{type:"INSERT_MARKUP",content:e,fromIndex:null,fromNode:null,toIndex:n,afterNode:t}}function r(e,t,n){return{type:"MOVE_EXISTING",content:null,fromIndex:e._mountIndex,fromNode:f.getHostNode(e),toIndex:n,afterNode:t}}function a(e,t){return{type:"REMOVE_NODE",content:null,fromIndex:e._mountIndex,fromNode:t,toIndex:null,afterNode:null}}function i(e){return{type:"SET_MARKUP",content:e,fromIndex:null,fromNode:null,toIndex:null,afterNode:null}}function l(e){return{type:"TEXT_CONTENT",content:e,fromIndex:null,fromNode:null,toIndex:null,afterNode:null}}function u(e,t){return t&&(e=e||[],e.push(t)),e}function s(e,t){d.processChildrenUpdates(e,t)}var c=n(11),d=n(115),f=(n(59),n(23),n(30),n(46)),p=n(361),h=(n(26),n(407)),m=(n(10),{Mixin:{_reconcilerInstantiateChildren:function(e,t,n){return p.instantiateChildren(e,t,n)},_reconcilerUpdateChildren:function(e,t,n,o,r,a){var i,l=0;return i=h(t,l),p.updateChildren(e,i,n,o,r,this,this._hostContainerInfo,a,l),i},mountChildren:function(e,t,n){var o=this._reconcilerInstantiateChildren(e,t,n);this._renderedChildren=o;var r=[],a=0;for(var i in o)if(o.hasOwnProperty(i)){var l=o[i],u=0,s=f.mountComponent(l,t,this,this._hostContainerInfo,n,u);l._mountIndex=a++,r.push(s)}return r},updateTextContent:function(e){var t=this._renderedChildren;p.unmountChildren(t,!1);for(var n in t)t.hasOwnProperty(n)&&c("118");var o=[l(e)];s(this,o)},updateMarkup:function(e){var t=this._renderedChildren;p.unmountChildren(t,!1);for(var n in t)t.hasOwnProperty(n)&&c("118");var o=[i(e)];s(this,o)},updateChildren:function(e,t,n){this._updateChildren(e,t,n)},_updateChildren:function(e,t,n){var o=this._renderedChildren,r={},a=[],i=this._reconcilerUpdateChildren(o,e,a,r,t,n);if(i||o){var l,c=null,d=0,p=0,h=0,m=null;for(l in i)if(i.hasOwnProperty(l)){var v=o&&o[l],y=i[l];v===y?(c=u(c,this.moveChild(v,m,d,p)),p=Math.max(v._mountIndex,p),v._mountIndex=d):(v&&(p=Math.max(v._mountIndex,p)),c=u(c,this._mountChildAtIndex(y,a[h],m,d,t,n)),h++),d++,m=f.getHostNode(y)}for(l in r)r.hasOwnProperty(l)&&(c=u(c,this._unmountChild(o[l],r[l])));c&&s(this,c),this._renderedChildren=i}},unmountChildren:function(e){var t=this._renderedChildren;p.unmountChildren(t,e),this._renderedChildren=null},moveChild:function(e,t,n,o){if(e._mountIndex<o)return r(e,t,n)},createChild:function(e,t,n){return o(n,t,e._mountIndex)},removeChild:function(e,t){return a(e,t)},_mountChildAtIndex:function(e,t,n,o,r,a){return e._mountIndex=o,this.createChild(e,n,t)},_unmountChild:function(e,t){var n=this.removeChild(e,t);return e._mountIndex=null,n}}});e.exports=m},function(e,t,n){"use strict";function o(e){return!(!e||"function"!=typeof e.attachRef||"function"!=typeof e.detachRef)}var r=n(11),a=(n(10),{addComponentAsRefTo:function(e,t,n){o(n)?void 0:r("119"),n.attachRef(t,e)},removeComponentAsRefFrom:function(e,t,n){o(n)?void 0:r("120");var a=n.getPublicInstance();a&&a.refs[t]===e.getPublicInstance()&&n.detachRef(t)}});e.exports=a},function(e,t){"use strict";var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";e.exports=n},function(e,t,n){"use strict";function o(e){this.reinitializeTransaction(),this.renderToStaticMarkup=!1,this.reactMountReady=a.getPooled(null),this.useCreateElement=e}var r=n(14),a=n(172),i=n(37),l=n(77),u=n(179),s=(n(23),n(79)),c=n(117),d={initialize:u.getSelectionInformation,close:u.restoreSelection},f={initialize:function(){var e=l.isEnabled();return l.setEnabled(!1),e},close:function(e){l.setEnabled(e)}},p={initialize:function(){this.reactMountReady.reset()},close:function(){this.reactMountReady.notifyAll()}},h=[d,f,p],m={getTransactionWrappers:function(){return h},getReactMountReady:function(){return this.reactMountReady},getUpdateQueue:function(){return c},checkpoint:function(){return this.reactMountReady.checkpoint()},rollback:function(e){this.reactMountReady.rollback(e)},destructor:function(){a.release(this.reactMountReady),this.reactMountReady=null}};r(o.prototype,s,m),i.addPoolingTo(o),e.exports=o},function(e,t,n){"use strict";function o(e,t,n){"function"==typeof e?e(t.getPublicInstance()):a.addComponentAsRefTo(t,e,n)}function r(e,t,n){"function"==typeof e?e(null):a.removeComponentAsRefFrom(t,e,n)}var a=n(384),i={};i.attachRefs=function(e,t){if(null!==t&&"object"==typeof t){var n=t.ref;null!=n&&o(n,e,t._owner)}},i.shouldUpdateRefs=function(e,t){var n=null,o=null;null!==e&&"object"==typeof e&&(n=e.ref,o=e._owner);var r=null,a=null;return null!==t&&"object"==typeof t&&(r=t.ref,a=t._owner),n!==r||"string"==typeof r&&a!==o},i.detachRefs=function(e,t){if(null!==t&&"object"==typeof t){var n=t.ref;null!=n&&r(n,e,t._owner)}},e.exports=i},function(e,t,n){"use strict";function o(e){this.reinitializeTransaction(),this.renderToStaticMarkup=e,this.useCreateElement=!1,this.updateQueue=new l(this)}var r=n(14),a=n(37),i=n(79),l=(n(23),n(389)),u=[],s={enqueue:function(){}},c={getTransactionWrappers:function(){return u},getReactMountReady:function(){return s},getUpdateQueue:function(){return this.updateQueue},destructor:function(){},checkpoint:function(){},rollback:function(){}};r(o.prototype,i,c),a.addPoolingTo(o),e.exports=o},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){}var a=n(117),i=(n(12),function(){function e(t){o(this,e),this.transaction=t}return e.prototype.isMounted=function(e){return!1},e.prototype.enqueueCallback=function(e,t,n){this.transaction.isInTransaction()&&a.enqueueCallback(e,t,n)},e.prototype.enqueueForceUpdate=function(e){this.transaction.isInTransaction()?a.enqueueForceUpdate(e):r(e,"forceUpdate")},e.prototype.enqueueReplaceState=function(e,t){this.transaction.isInTransaction()?a.enqueueReplaceState(e,t):r(e,"replaceState")},e.prototype.enqueueSetState=function(e,t){this.transaction.isInTransaction()?a.enqueueSetState(e,t):r(e,"setState")},e}());e.exports=i},function(e,t){"use strict";e.exports="15.6.2"},function(e,t){"use strict";var n={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},o={accentHeight:"accent-height",accumulate:0,additive:0,alignmentBaseline:"alignment-baseline",allowReorder:"allowReorder",alphabetic:0,amplitude:0,arabicForm:"arabic-form",ascent:0,attributeName:"attributeName",attributeType:"attributeType",autoReverse:"autoReverse",azimuth:0,baseFrequency:"baseFrequency",baseProfile:"baseProfile",baselineShift:"baseline-shift",bbox:0,begin:0,bias:0,by:0,calcMode:"calcMode",capHeight:"cap-height",clip:0,clipPath:"clip-path",clipRule:"clip-rule",clipPathUnits:"clipPathUnits",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",contentScriptType:"contentScriptType",contentStyleType:"contentStyleType",cursor:0,cx:0,cy:0,d:0,decelerate:0,descent:0,diffuseConstant:"diffuseConstant",direction:0,display:0,divisor:0,dominantBaseline:"dominant-baseline",dur:0,dx:0,dy:0,edgeMode:"edgeMode",elevation:0,enableBackground:"enable-background",end:0,exponent:0,externalResourcesRequired:"externalResourcesRequired",fill:0,fillOpacity:"fill-opacity",fillRule:"fill-rule",filter:0,filterRes:"filterRes",filterUnits:"filterUnits",floodColor:"flood-color",floodOpacity:"flood-opacity",focusable:0,fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",format:0,from:0,fx:0,fy:0,g1:0,g2:0,glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",glyphRef:"glyphRef",gradientTransform:"gradientTransform",gradientUnits:"gradientUnits",hanging:0,horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",ideographic:0,imageRendering:"image-rendering","in":0,in2:0,intercept:0,k:0,k1:0,k2:0,k3:0,k4:0,kernelMatrix:"kernelMatrix",kernelUnitLength:"kernelUnitLength",kerning:0,keyPoints:"keyPoints",keySplines:"keySplines",keyTimes:"keyTimes",lengthAdjust:"lengthAdjust",letterSpacing:"letter-spacing",lightingColor:"lighting-color",limitingConeAngle:"limitingConeAngle",local:0,markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",markerHeight:"markerHeight",markerUnits:"markerUnits",markerWidth:"markerWidth",mask:0,maskContentUnits:"maskContentUnits",maskUnits:"maskUnits",mathematical:0,mode:0,numOctaves:"numOctaves",offset:0,opacity:0,operator:0,order:0,orient:0,orientation:0,origin:0,overflow:0,overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pathLength:"pathLength",patternContentUnits:"patternContentUnits",patternTransform:"patternTransform",patternUnits:"patternUnits",pointerEvents:"pointer-events",points:0,pointsAtX:"pointsAtX",pointsAtY:"pointsAtY",pointsAtZ:"pointsAtZ",preserveAlpha:"preserveAlpha",preserveAspectRatio:"preserveAspectRatio",primitiveUnits:"primitiveUnits",r:0,radius:0,refX:"refX",refY:"refY",renderingIntent:"rendering-intent",repeatCount:"repeatCount",repeatDur:"repeatDur",requiredExtensions:"requiredExtensions",requiredFeatures:"requiredFeatures",restart:0,result:0,rotate:0,rx:0,ry:0,scale:0,seed:0,shapeRendering:"shape-rendering",slope:0,spacing:0,specularConstant:"specularConstant",specularExponent:"specularExponent",speed:0,spreadMethod:"spreadMethod",startOffset:"startOffset",stdDeviation:"stdDeviation",stemh:0,stemv:0,stitchTiles:"stitchTiles",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",string:0,stroke:0,strokeDasharray:"stroke-dasharray",strokeDashoffset:"stroke-dashoffset",strokeLinecap:"stroke-linecap",strokeLinejoin:"stroke-linejoin",strokeMiterlimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",surfaceScale:"surfaceScale",systemLanguage:"systemLanguage",tableValues:"tableValues",targetX:"targetX",targetY:"targetY",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",textLength:"textLength",to:0,transform:0,u1:0,u2:0,underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicode:0,unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",values:0,vectorEffect:"vector-effect",version:0,vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",viewBox:"viewBox",viewTarget:"viewTarget",visibility:0,widths:0,wordSpacing:"word-spacing",writingMode:"writing-mode",x:0,xHeight:"x-height",x1:0,x2:0,xChannelSelector:"xChannelSelector",xlinkActuate:"xlink:actuate",xlinkArcrole:"xlink:arcrole",xlinkHref:"xlink:href",xlinkRole:"xlink:role",xlinkShow:"xlink:show",xlinkTitle:"xlink:title",xlinkType:"xlink:type",xmlBase:"xml:base",xmlns:0,xmlnsXlink:"xmlns:xlink",xmlLang:"xml:lang",xmlSpace:"xml:space",y:0,y1:0,y2:0,yChannelSelector:"yChannelSelector",z:0,zoomAndPan:"zoomAndPan"},r={Properties:{},DOMAttributeNamespaces:{xlinkActuate:n.xlink,xlinkArcrole:n.xlink,xlinkHref:n.xlink,xlinkRole:n.xlink,xlinkShow:n.xlink,xlinkTitle:n.xlink,xlinkType:n.xlink,xmlBase:n.xml,xmlLang:n.xml,xmlSpace:n.xml},DOMAttributeNames:{}};Object.keys(o).forEach(function(e){r.Properties[e]=0,o[e]&&(r.DOMAttributeNames[e]=o[e])}),e.exports=r},function(e,t,n){"use strict";function o(e){if("selectionStart"in e&&u.hasSelectionCapabilities(e))return{start:e.selectionStart,end:e.selectionEnd};if(window.getSelection){var t=window.getSelection();return{anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset}}if(document.selection){var n=document.selection.createRange();return{parentElement:n.parentElement(),text:n.text,top:n.boundingTop,left:n.boundingLeft}}}function r(e,t){if(g||null==m||m!==c())return null;var n=o(m);if(!y||!f(y,n)){y=n;var r=s.getPooled(h.select,v,e,t);return r.type="select",r.target=m,a.accumulateTwoPhaseDispatches(r),r}return null}var a=n(58),i=n(20),l=n(15),u=n(179),s=n(29),c=n(148),d=n(189),f=n(100),p=i.canUseDOM&&"documentMode"in document&&document.documentMode<=11,h={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:["topBlur","topContextMenu","topFocus","topKeyDown","topKeyUp","topMouseDown","topMouseUp","topSelectionChange"]}},m=null,v=null,y=null,g=!1,b=!1,_={eventTypes:h,extractEvents:function(e,t,n,o){if(!b)return null;var a=t?l.getNodeFromInstance(t):window;switch(e){case"topFocus":(d(a)||"true"===a.contentEditable)&&(m=a,v=t,y=null);break;case"topBlur":m=null,v=null,y=null;break;case"topMouseDown":g=!0;break;case"topContextMenu":case"topMouseUp":return g=!1,r(n,o);case"topSelectionChange":if(p)break;case"topKeyDown":case"topKeyUp":return r(n,o)}return null},didPutListener:function(e,t,n){"onSelect"===t&&(b=!0)}};e.exports=_},function(e,t,n){"use strict";function o(e){return"."+e._rootNodeID}function r(e){return"button"===e||"input"===e||"select"===e||"textarea"===e}var a=n(11),i=n(146),l=n(58),u=n(15),s=n(394),c=n(395),d=n(29),f=n(398),p=n(400),h=n(78),m=n(397),v=n(401),y=n(402),g=n(60),b=n(403),_=n(26),C=n(119),E=(n(10),{}),x={};["abort","animationEnd","animationIteration","animationStart","blur","canPlay","canPlayThrough","click","contextMenu","copy","cut","doubleClick","drag","dragEnd","dragEnter","dragExit","dragLeave","dragOver","dragStart","drop","durationChange","emptied","encrypted","ended","error","focus","input","invalid","keyDown","keyPress","keyUp","load","loadedData","loadedMetadata","loadStart","mouseDown","mouseMove","mouseOut","mouseOver","mouseUp","paste","pause","play","playing","progress","rateChange","reset","scroll","seeked","seeking","stalled","submit","suspend","timeUpdate","touchCancel","touchEnd","touchMove","touchStart","transitionEnd","volumeChange","waiting","wheel"].forEach(function(e){var t=e[0].toUpperCase()+e.slice(1),n="on"+t,o="top"+t,r={phasedRegistrationNames:{bubbled:n,captured:n+"Capture"},dependencies:[o]};E[e]=r,x[o]=r});var N={},k={eventTypes:E,extractEvents:function(e,t,n,o){var r=x[e];if(!r)return null;var i;switch(e){case"topAbort":case"topCanPlay":case"topCanPlayThrough":case"topDurationChange":case"topEmptied":case"topEncrypted":case"topEnded":case"topError":case"topInput":case"topInvalid":case"topLoad":case"topLoadedData":case"topLoadedMetadata":case"topLoadStart":case"topPause":case"topPlay":case"topPlaying":case"topProgress":case"topRateChange":case"topReset":case"topSeeked":case"topSeeking":case"topStalled":case"topSubmit":case"topSuspend":case"topTimeUpdate":case"topVolumeChange":case"topWaiting":i=d;break;case"topKeyPress":if(0===C(n))return null;case"topKeyDown":case"topKeyUp":i=p;break;case"topBlur":case"topFocus":i=f;break;case"topClick":if(2===n.button)return null;case"topDoubleClick":case"topMouseDown":case"topMouseMove":case"topMouseUp":case"topMouseOut":case"topMouseOver":case"topContextMenu":i=h;break;case"topDrag":case"topDragEnd":case"topDragEnter":case"topDragExit":
case"topDragLeave":case"topDragOver":case"topDragStart":case"topDrop":i=m;break;case"topTouchCancel":case"topTouchEnd":case"topTouchMove":case"topTouchStart":i=v;break;case"topAnimationEnd":case"topAnimationIteration":case"topAnimationStart":i=s;break;case"topTransitionEnd":i=y;break;case"topScroll":i=g;break;case"topWheel":i=b;break;case"topCopy":case"topCut":case"topPaste":i=c}i?void 0:a("86",e);var u=i.getPooled(r,t,n,o);return l.accumulateTwoPhaseDispatches(u),u},didPutListener:function(e,t,n){if("onClick"===t&&!r(e._tag)){var a=o(e),l=u.getNodeFromInstance(e);N[a]||(N[a]=i.listen(l,"click",_))}},willDeleteListener:function(e,t){if("onClick"===t&&!r(e._tag)){var n=o(e);N[n].remove(),delete N[n]}}};e.exports=k},function(e,t,n){"use strict";function o(e,t,n,o){return r.call(this,e,t,n,o)}var r=n(29),a={animationName:null,elapsedTime:null,pseudoElement:null};r.augmentClass(o,a),e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o){return r.call(this,e,t,n,o)}var r=n(29),a={clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}};r.augmentClass(o,a),e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o){return r.call(this,e,t,n,o)}var r=n(29),a={data:null};r.augmentClass(o,a),e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o){return r.call(this,e,t,n,o)}var r=n(78),a={dataTransfer:null};r.augmentClass(o,a),e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o){return r.call(this,e,t,n,o)}var r=n(60),a={relatedTarget:null};r.augmentClass(o,a),e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o){return r.call(this,e,t,n,o)}var r=n(29),a={data:null};r.augmentClass(o,a),e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o){return r.call(this,e,t,n,o)}var r=n(60),a=n(119),i=n(408),l=n(120),u={key:i,location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:l,charCode:function(e){return"keypress"===e.type?a(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?a(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}};r.augmentClass(o,u),e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o){return r.call(this,e,t,n,o)}var r=n(60),a=n(120),i={touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:a};r.augmentClass(o,i),e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o){return r.call(this,e,t,n,o)}var r=n(29),a={propertyName:null,elapsedTime:null,pseudoElement:null};r.augmentClass(o,a),e.exports=o},function(e,t,n){"use strict";function o(e,t,n,o){return r.call(this,e,t,n,o)}var r=n(78),a={deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null};r.augmentClass(o,a),e.exports=o},function(e,t){"use strict";function n(e){for(var t=1,n=0,r=0,a=e.length,i=a&-4;r<i;){for(var l=Math.min(r+4096,i);r<l;r+=4)n+=(t+=e.charCodeAt(r))+(t+=e.charCodeAt(r+1))+(t+=e.charCodeAt(r+2))+(t+=e.charCodeAt(r+3));t%=o,n%=o}for(;r<a;r++)n+=t+=e.charCodeAt(r);return t%=o,n%=o,t|n<<16}var o=65521;e.exports=n},function(e,t,n){"use strict";function o(e,t,n,o){var r=null==t||"boolean"==typeof t||""===t;if(r)return"";var i=isNaN(t);return o||i||0===t||a.hasOwnProperty(e)&&a[e]?""+t:("string"==typeof t&&(t=t.trim()),t+"px")}var r=n(171),a=(n(12),r.isUnitlessNumber);e.exports=o},function(e,t,n){"use strict";function o(e){if(null==e)return null;if(1===e.nodeType)return e;var t=i.get(e);return t?(t=l(t),t?a.getNodeFromInstance(t):null):void("function"==typeof e.render?r("44"):r("45",Object.keys(e)))}var r=n(11),a=(n(30),n(15)),i=n(59),l=n(185);n(10),n(12),e.exports=o},function(e,t,n){(function(t){"use strict";function o(e,t,n,o){if(e&&"object"==typeof e){var r=e,a=void 0===r[n];a&&null!=t&&(r[n]=t)}}function r(e,t){if(null==e)return e;var n={};return a(e,o,n),n}var a=(n(113),n(191));n(12),e.exports=r}).call(t,n(149))},function(e,t,n){"use strict";function o(e){if(e.key){var t=a[e.key]||e.key;if("Unidentified"!==t)return t}if("keypress"===e.type){var n=r(e);return 13===n?"Enter":String.fromCharCode(n)}return"keydown"===e.type||"keyup"===e.type?i[e.keyCode]||"Unidentified":""}var r=n(119),a={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},i={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};e.exports=o},function(e,t){"use strict";function n(e){var t=e&&(o&&e[o]||e[r]);if("function"==typeof t)return t}var o="function"==typeof Symbol&&Symbol.iterator,r="@@iterator";e.exports=n},function(e,t){"use strict";function n(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function o(e){for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}}function r(e,t){for(var r=n(e),a=0,i=0;r;){if(3===r.nodeType){if(i=a+r.textContent.length,a<=t&&i>=t)return{node:r,offset:t-a};a=i}r=n(o(r))}}e.exports=r},function(e,t,n){"use strict";function o(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n["ms"+e]="MS"+t,n["O"+e]="o"+t.toLowerCase(),n}function r(e){if(l[e])return l[e];if(!i[e])return e;var t=i[e];for(var n in t)if(t.hasOwnProperty(n)&&n in u)return l[e]=t[n];return""}var a=n(20),i={animationend:o("Animation","AnimationEnd"),animationiteration:o("Animation","AnimationIteration"),animationstart:o("Animation","AnimationStart"),transitionend:o("Transition","TransitionEnd")},l={},u={};a.canUseDOM&&(u=document.createElement("div").style,"AnimationEvent"in window||(delete i.animationend.animation,delete i.animationiteration.animation,delete i.animationstart.animation),"TransitionEvent"in window||delete i.transitionend.transition),e.exports=r},function(e,t,n){"use strict";function o(e){return'"'+r(e)+'"'}var r=n(80);e.exports=o},function(e,t,n){"use strict";var o=n(180);e.exports=o.renderSubtreeIntoContainer},function(e,t){"use strict";function n(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case a:switch(e=e.type){case f:case p:case l:case s:case u:case m:return e;default:switch(e=e&&e.$$typeof){case d:case h:case c:return e;default:return t}}case y:case v:case i:return t}}}function o(e){return n(e)===p}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&Symbol["for"],a=r?Symbol["for"]("react.element"):60103,i=r?Symbol["for"]("react.portal"):60106,l=r?Symbol["for"]("react.fragment"):60107,u=r?Symbol["for"]("react.strict_mode"):60108,s=r?Symbol["for"]("react.profiler"):60114,c=r?Symbol["for"]("react.provider"):60109,d=r?Symbol["for"]("react.context"):60110,f=r?Symbol["for"]("react.async_mode"):60111,p=r?Symbol["for"]("react.concurrent_mode"):60111,h=r?Symbol["for"]("react.forward_ref"):60112,m=r?Symbol["for"]("react.suspense"):60113,v=r?Symbol["for"]("react.memo"):60115,y=r?Symbol["for"]("react.lazy"):60116;t.typeOf=n,t.AsyncMode=f,t.ConcurrentMode=p,t.ContextConsumer=d,t.ContextProvider=c,t.Element=a,t.ForwardRef=h,t.Fragment=l,t.Lazy=y,t.Memo=v,t.Portal=i,t.Profiler=s,t.StrictMode=u,t.Suspense=m,t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===l||e===p||e===s||e===u||e===m||"object"==typeof e&&null!==e&&(e.$$typeof===y||e.$$typeof===v||e.$$typeof===c||e.$$typeof===d||e.$$typeof===h)},t.isAsyncMode=function(e){return o(e)||n(e)===f},t.isConcurrentMode=o,t.isContextConsumer=function(e){return n(e)===d},t.isContextProvider=function(e){return n(e)===c},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===a},t.isForwardRef=function(e){return n(e)===h},t.isFragment=function(e){return n(e)===l},t.isLazy=function(e){return n(e)===y},t.isMemo=function(e){return n(e)===v},t.isPortal=function(e){return n(e)===i},t.isProfiler=function(e){return n(e)===s},t.isStrictMode=function(e){return n(e)===u},t.isSuspense=function(e){return n(e)===m}},function(e,t,n){"use strict";e.exports=n(414)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var l=n(8),u=o(l),s=n(70),c=o(s),d=n(1),f=o(d),p=n(19),h=o(p),m=n(82),v=o(m),y=n(47),g=o(y),b=function(e){function t(){var n,o,i;r(this,t);for(var l=arguments.length,u=Array(l),s=0;s<l;s++)u[s]=arguments[s];return n=o=a(this,e.call.apply(e,[this].concat(u))),o._mountOverlayTarget=function(){o._overlayTarget||(o._overlayTarget=document.createElement("div"),o._portalContainerNode=(0,v["default"])(o.props.container,(0,g["default"])(o).body),o._portalContainerNode.appendChild(o._overlayTarget))},o._unmountOverlayTarget=function(){o._overlayTarget&&(o._portalContainerNode.removeChild(o._overlayTarget),o._overlayTarget=null),o._portalContainerNode=null},o._renderOverlay=function(){var e=o.props.children?f["default"].Children.only(o.props.children):null;if(null!==e){o._mountOverlayTarget();var t=!o._overlayInstance;o._overlayInstance=h["default"].unstable_renderSubtreeIntoContainer(o,e,o._overlayTarget,function(){t&&o.props.onRendered&&o.props.onRendered()})}else o._unrenderOverlay(),o._unmountOverlayTarget()},o._unrenderOverlay=function(){o._overlayTarget&&(h["default"].unmountComponentAtNode(o._overlayTarget),o._overlayInstance=null)},o.getMountNode=function(){return o._overlayTarget},i=n,a(o,i)}return i(t,e),t.prototype.componentDidMount=function(){this._isMounted=!0,this._renderOverlay()},t.prototype.componentDidUpdate=function(){this._renderOverlay()},t.prototype.componentWillReceiveProps=function(e){this._overlayTarget&&e.container!==this.props.container&&(this._portalContainerNode.removeChild(this._overlayTarget),this._portalContainerNode=(0,v["default"])(e.container,(0,g["default"])(this).body),this._portalContainerNode.appendChild(this._overlayTarget))},t.prototype.componentWillUnmount=function(){this._isMounted=!1,this._unrenderOverlay(),this._unmountOverlayTarget()},t.prototype.render=function(){return null},t}(f["default"].Component);b.displayName="Portal",b.propTypes={container:u["default"].oneOfType([c["default"],u["default"].func]),onRendered:u["default"].func},t["default"]=b,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},u=n(139),s=o(u),c=n(43),d=o(c),f=n(33),p=o(f),h=n(8),m=o(h),v=n(70),y=o(v),g=n(283),b=o(g),_=n(13),C=o(_),E=n(1),x=o(E),N=n(19),k=o(N),w=n(22),S=o(w),T=n(418),O=o(T),M=n(192),P=o(M),D=n(421),I=o(D),A=n(195),R=o(A),L=n(422),j=o(L),B=n(82),U=o(B),F=n(47),H=o(F),V=new O["default"],K=function(e){function t(){var n,o,i;r(this,t);for(var l=arguments.length,u=Array(l),s=0;s<l;s++)u[s]=arguments[s];return n=o=a(this,e.call.apply(e,[this].concat(u))),W.call(o),i=n,a(o,i)}return i(t,e),t.prototype.omitProps=function(e,t){var n=Object.keys(e),o={};return n.map(function(n){Object.prototype.hasOwnProperty.call(t,n)||(o[n]=e[n])}),o},t.prototype.render=function(){var e=this.props,n=e.show,o=e.container,r=e.children,a=e.transition,i=e.backdrop,u=e.dialogTransitionTimeout,s=e.className,c=e.style,d=e.onExit,f=e.onExiting,p=e.onEnter,h=e.onEntering,m=e.onEntered,v=x["default"].Children.only(r),y=this.omitProps(this.props,t.propTypes),g=n||a&&!this.state.exited;if(!g)return null;var b=v.props,_=b.role,C=b.tabIndex;return void 0!==_&&void 0!==C||(v=(0,E.cloneElement)(v,{role:void 0===_?"document":_,tabIndex:null==C?"-1":C})),a&&(v=x["default"].createElement(a,{transitionAppear:!0,unmountOnExit:!0,"in":n,timeout:u,onExit:d,onExiting:f,onExited:this.handleHidden,onEnter:p,onEntering:h,onEntered:m},v)),x["default"].createElement(P["default"],{ref:this.setMountNode,container:o,onRendered:this.onPortalRendered},x["default"].createElement("div",l({ref:this.setModalNodeRef,role:_||"dialog"},y,{style:c,className:s}),i&&this.renderBackdrop(),x["default"].createElement(I["default"],{ref:this.setDialogRef},v)))},t.prototype.componentWillReceiveProps=function(e){e.show?this.setState({exited:!1}):e.transition||this.setState({exited:!0})},t.prototype.componentWillUpdate=function(e){!this.props.show&&e.show&&this.checkForFocus()},t.prototype.componentDidMount=function(){this._isMounted=!0,this.props.show&&this.onShow()},t.prototype.componentDidUpdate=function(e){var t=this.props.transition;!e.show||this.props.show||t?!e.show&&this.props.show&&this.onShow():this.onHide()},t.prototype.componentWillUnmount=function(){var e=this.props,t=e.show,n=e.transition;this._isMounted=!1,(t||n&&!this.state.exited)&&this.onHide()},t.prototype.autoFocus=function(){if(this.props.autoFocus){var e=this.getDialogElement(),t=(0,s["default"])((0,H["default"])(this));e&&!(0,d["default"])(e,t)&&(this.lastFocus=t,e.hasAttribute("tabIndex")||((0,S["default"])(!1,'The modal content node does not accept focus. For the benefit of assistive technologies, the tabIndex of the node is being set to "-1".'),e.setAttribute("tabIndex",-1)),e.focus())}},t.prototype.restoreLastFocus=function(){this.lastFocus&&this.lastFocus.focus&&(this.lastFocus.focus(),this.lastFocus=null)},t.prototype.getDialogElement=function(){return k["default"].findDOMNode(this.dialog)},t.prototype.isTopModal=function(){return this.props.manager.isTopModal(this)},t}(x["default"].Component);K.propTypes=l({},P["default"].propTypes,{show:m["default"].bool,container:m["default"].oneOfType([y["default"],m["default"].func]),onShow:m["default"].func,onHide:m["default"].func,backdrop:m["default"].oneOfType([m["default"].bool,m["default"].oneOf(["static"])]),renderBackdrop:m["default"].func,onEscapeKeyDown:m["default"].func,onEscapeKeyUp:(0,b["default"])(m["default"].func,"Please use onEscapeKeyDown instead for consistency"),onBackdropClick:m["default"].func,backdropStyle:m["default"].object,backdropClassName:m["default"].string,containerClassName:m["default"].string,keyboard:m["default"].bool,transition:C["default"],dialogTransitionTimeout:m["default"].number,backdropTransitionTimeout:m["default"].number,autoFocus:m["default"].bool,enforceFocus:m["default"].bool,restoreFocus:m["default"].bool,onEnter:m["default"].func,onEntering:m["default"].func,onEntered:m["default"].func,onExit:m["default"].func,onExiting:m["default"].func,onExited:m["default"].func,manager:m["default"].object.isRequired}),K.defaultProps={show:!1,backdrop:!0,keyboard:!0,autoFocus:!0,enforceFocus:!0,restoreFocus:!0,onHide:function(){},manager:V,renderBackdrop:function(e){return x["default"].createElement("div",e)}};var W=function(){var e=this;this.state={exited:!this.props.show},this.renderBackdrop=function(){var t=e.props,n=t.backdropStyle,o=t.backdropClassName,r=t.renderBackdrop,a=t.transition,i=t.backdropTransitionTimeout,l=function(t){return e.backdrop=t},u=r({ref:l,style:n,className:o,onClick:e.handleBackdropClick});return a&&(u=x["default"].createElement(a,{transitionAppear:!0,"in":e.props.show,timeout:i},u)),u},this.onPortalRendered=function(){e.autoFocus(),e.props.onShow&&e.props.onShow()},this.onShow=function(){var t=(0,H["default"])(e),n=(0,U["default"])(e.props.container,t.body);e.props.manager.add(e,n,e.props.containerClassName),e._onDocumentKeydownListener=(0,R["default"])(t,"keydown",e.handleDocumentKeyDown),e._onDocumentKeyupListener=(0,R["default"])(t,"keyup",e.handleDocumentKeyUp),e._onFocusinListener=(0,j["default"])(e.enforceFocus)},this.onHide=function(){e.props.manager.remove(e),e._onDocumentKeydownListener.remove(),e._onDocumentKeyupListener.remove(),e._onFocusinListener.remove(),e.props.restoreFocus&&e.restoreLastFocus()},this.setMountNode=function(t){e.mountNode=t?t.getMountNode():t},this.setModalNodeRef=function(t){e.modalNode=t},this.setDialogRef=function(t){e.dialog=t},this.handleHidden=function(){if(e.setState({exited:!0}),e.onHide(),e.props.onExited){var t;(t=e.props).onExited.apply(t,arguments)}},this.handleBackdropClick=function(t){t.target===t.currentTarget&&(e.props.onBackdropClick&&e.props.onBackdropClick(t),e.props.backdrop===!0&&e.props.onHide())},this.handleDocumentKeyDown=function(t){e.props.keyboard&&27===t.keyCode&&e.isTopModal()&&(e.props.onEscapeKeyDown&&e.props.onEscapeKeyDown(t),e.props.onHide())},this.handleDocumentKeyUp=function(t){e.props.keyboard&&27===t.keyCode&&e.isTopModal()&&e.props.onEscapeKeyUp&&e.props.onEscapeKeyUp(t)},this.checkForFocus=function(){p["default"]&&(e.lastFocus=(0,s["default"])())},this.enforceFocus=function(){if(e.props.enforceFocus&&e._isMounted&&e.isTopModal()){var t=e.getDialogElement(),n=(0,s["default"])((0,H["default"])(e));t&&!(0,d["default"])(t,n)&&t.focus()}}};K.Manager=O["default"],t["default"]=K,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){var n=-1;return e.some(function(e,o){if(t(e,o))return n=o,!0}),n}function i(e,t){return a(e,function(e){return e.modals.indexOf(t)!==-1})}function l(e,t){var n={overflow:"hidden"};e.style={overflow:t.style.overflow,paddingRight:t.style.paddingRight},e.overflowing&&(n.paddingRight=parseInt((0,f["default"])(t,"paddingRight")||0,10)+(0,h["default"])()+"px"),(0,f["default"])(t,n)}function u(e,t){var n=e.style;Object.keys(n).forEach(function(e){return t.style[e]=n[e]})}t.__esModule=!0;var s=n(256),c=o(s),d=n(66),f=o(d),p=n(145),h=o(p),m=n(196),v=o(m),y=n(424),g=function b(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.hideSiblingNodes,o=void 0===n||n,a=t.handleContainerOverflow,s=void 0===a||a;r(this,b),this.add=function(t,n,o){var r=e.modals.indexOf(t),a=e.containers.indexOf(n);if(r!==-1)return r;if(r=e.modals.length,e.modals.push(t),e.hideSiblingNodes&&(0,y.hideSiblings)(n,t.mountNode),a!==-1)return e.data[a].modals.push(t),r;var i={modals:[t],classes:o?o.split(/\s+/):[],overflowing:(0,v["default"])(n)};return e.handleContainerOverflow&&l(i,n),i.classes.forEach(c["default"].addClass.bind(null,n)),e.containers.push(n),e.data.push(i),r},this.remove=function(t){var n=e.modals.indexOf(t);if(n!==-1){var o=i(e.data,t),r=e.data[o],a=e.containers[o];r.modals.splice(r.modals.indexOf(t),1),e.modals.splice(n,1),0===r.modals.length?(r.classes.forEach(c["default"].removeClass.bind(null,a)),e.handleContainerOverflow&&u(r,a),e.hideSiblingNodes&&(0,y.showSiblings)(a,t.mountNode),e.containers.splice(o,1),e.data.splice(o,1)):e.hideSiblingNodes&&(0,y.ariaHidden)(!1,r.modals[r.modals.length-1].mountNode)}},this.isTopModal=function(t){return!!e.modals.length&&e.modals[e.modals.length-1]===t},this.hideSiblingNodes=o,this.handleContainerOverflow=s,this.modals=[],this.containers=[],this.data=[]};t["default"]=g,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},s=n(8),c=o(s),d=n(13),f=o(d),p=n(1),h=o(p),m=n(192),v=o(m),y=n(420),g=o(y),b=n(193),_=o(b),C=function(e){function t(n,o){a(this,t);var r=i(this,e.call(this,n,o));return r.handleHidden=function(){if(r.setState({exited:!0}),r.props.onExited){var e;(e=r.props).onExited.apply(e,arguments)}},r.state={exited:!n.show},r.onHiddenListener=r.handleHidden.bind(r),r}return l(t,e),t.prototype.componentWillReceiveProps=function(e){e.show?this.setState({exited:!1}):e.transition||this.setState({exited:!0})},t.prototype.render=function(){var e=this.props,t=e.container,n=e.containerPadding,o=e.target,a=e.placement,i=e.shouldUpdatePosition,l=e.rootClose,u=e.children,s=e.transition,c=r(e,["container","containerPadding","target","placement","shouldUpdatePosition","rootClose","children","transition"]),d=c.show||s&&!this.state.exited;if(!d)return null;var f=u;if(f=h["default"].createElement(g["default"],{container:t,containerPadding:n,target:o,placement:a,shouldUpdatePosition:i},f),s){var p=c.onExit,m=c.onExiting,y=c.onEnter,b=c.onEntering,C=c.onEntered;f=h["default"].createElement(s,{"in":c.show,transitionAppear:!0,onExit:p,onExiting:m,onExited:this.onHiddenListener,onEnter:y,onEntering:b,onEntered:C},f)}return l&&(f=h["default"].createElement(_["default"],{onRootClose:c.onHide},f)),h["default"].createElement(v["default"],{container:t},f)},t}(h["default"].Component);C.propTypes=u({},v["default"].propTypes,g["default"].propTypes,{show:c["default"].bool,rootClose:c["default"].bool,onHide:function(e){var t=c["default"].func;e.rootClose&&(t=t.isRequired);for(var n=arguments.length,o=Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];return t.apply(void 0,[e].concat(o))},transition:f["default"],onEnter:c["default"].func,onEntering:c["default"].func,onEntered:c["default"].func,onExit:c["default"].func,onExiting:c["default"].func,onExited:c["default"].func}),t["default"]=C,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},s=n(7),c=o(s),d=n(8),f=o(d),p=n(70),h=o(p),m=n(1),v=o(m),y=n(19),g=o(y),b=n(423),_=o(b),C=n(82),E=o(C),x=n(47),N=o(x),k=function(e){function t(n,o){a(this,t);var r=i(this,e.call(this,n,o));return r.getTarget=function(){var e=r.props.target,t="function"==typeof e?e():e;return t&&g["default"].findDOMNode(t)||null},r.maybeUpdatePosition=function(e){var t=r.getTarget();(r.props.shouldUpdatePosition||t!==r._lastTarget||e)&&r.updatePosition(t)},r.state={positionLeft:0,positionTop:0,arrowOffsetLeft:null,arrowOffsetTop:null},r._needsFlush=!1,r._lastTarget=null,r}return l(t,e),t.prototype.componentDidMount=function(){this.updatePosition(this.getTarget())},t.prototype.componentWillReceiveProps=function(){this._needsFlush=!0},t.prototype.componentDidUpdate=function(e){this._needsFlush&&(this._needsFlush=!1,this.maybeUpdatePosition(this.props.placement!==e.placement))},t.prototype.render=function(){var e=this.props,t=e.children,n=e.className,o=r(e,["children","className"]),a=this.state,i=a.positionLeft,l=a.positionTop,s=r(a,["positionLeft","positionTop"]);delete o.target,delete o.container,delete o.containerPadding,delete o.shouldUpdatePosition;var d=v["default"].Children.only(t);return(0,m.cloneElement)(d,u({},o,s,{positionLeft:i,positionTop:l,className:(0,c["default"])(n,d.props.className),style:u({},d.props.style,{left:i,top:l})}))},t.prototype.updatePosition=function(e){if(this._lastTarget=e,!e)return void this.setState({positionLeft:0,positionTop:0,arrowOffsetLeft:null,arrowOffsetTop:null});var t=g["default"].findDOMNode(this),n=(0,E["default"])(this.props.container,(0,N["default"])(this).body);this.setState((0,_["default"])(this.props.placement,t,e,n,this.props.containerPadding))},t}(v["default"].Component);k.propTypes={target:f["default"].oneOfType([h["default"],f["default"].func]),container:f["default"].oneOfType([h["default"],f["default"].func]),containerPadding:f["default"].number,placement:f["default"].oneOf(["top","right","bottom","left"]),shouldUpdatePosition:f["default"].bool},k.displayName="Position",k.defaultProps={containerPadding:0,placement:"right",shouldUpdatePosition:!1},t["default"]=k,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var l=n(8),u=o(l),s=n(1),c=o(s),d={children:u["default"].node},f=function(e){function t(){return r(this,t),a(this,e.apply(this,arguments))}return i(t,e),t.prototype.render=function(){return this.props.children},t}(c["default"].Component);f.propTypes=d,t["default"]=f,e.exports=t["default"]},function(e,t){"use strict";function n(e){var t=!document.addEventListener,n=void 0;return t?(document.attachEvent("onfocusin",e),n=function(){return document.detachEvent("onfocusin",e)}):(document.addEventListener("focus",e,!0),n=function(){return document.removeEventListener("focus",e,!0)}),{remove:n}}t.__esModule=!0,t["default"]=n,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e){var t=void 0,n=void 0,o=void 0;if("BODY"===e.tagName)t=window.innerWidth,n=window.innerHeight,o=(0,p["default"])((0,m["default"])(e).documentElement)||(0,p["default"])(e);else{var r=(0,s["default"])(e);t=r.width,n=r.height,o=(0,p["default"])(e)}return{width:t,height:n,scroll:o}}function a(e,t,n,o){var a=r(n),i=a.scroll,l=a.height,u=e-o-i,s=e+o-i+t;return u<0?-u:s>l?l-s:0}function i(e,t,n,o){var a=r(n),i=a.width,l=e-o,u=e+o+t;return l<0?-l:u>i?i-u:0}function l(e,t,n,o,r){var l="BODY"===o.tagName?(0,s["default"])(n):(0,d["default"])(n,o),u=(0,s["default"])(t),c=u.height,f=u.width,p=void 0,h=void 0,m=void 0,v=void 0;if("left"===e||"right"===e){h=l.top+(l.height-c)/2,p="left"===e?l.left-f:l.left+l.width;var y=a(h,c,o,r);h+=y,v=50*(1-2*y/c)+"%",m=void 0}else{if("top"!==e&&"bottom"!==e)throw new Error('calcOverlayPosition(): No such placement of "'+e+'" found.');p=l.left+(l.width-f)/2,h="top"===e?l.top-c:l.top+l.height;var g=i(p,f,o,r);p+=g,m=50*(1-2*g/f)+"%",v=void 0}return{positionLeft:p,positionTop:h,arrowOffsetLeft:m,arrowOffsetTop:v}}t.__esModule=!0,t["default"]=l;var u=n(141),s=o(u),c=n(262),d=o(c),f=n(142),p=o(f),h=n(47),m=o(h);e.exports=t["default"]},function(e,t){"use strict";function n(e,t){t&&(e?t.setAttribute("aria-hidden","true"):t.removeAttribute("aria-hidden"))}function o(e,t){l(e,t,function(e){return n(!0,e)})}function r(e,t){l(e,t,function(e){return n(!1,e)})}t.__esModule=!0,t.ariaHidden=n,t.hideSiblings=o,t.showSiblings=r;var a=["template","script","style"],i=function(e){var t=e.nodeType,n=e.tagName;return 1===t&&a.indexOf(n.toLowerCase())===-1},l=function(e,t,n){t=[].concat(t),[].forEach.call(e.children,function(e){t.indexOf(e)===-1&&i(e)&&n(e)})}},113,[439,61],function(e,t,n){"use strict";function o(e){return(""+e).replace(_,"$&/")}function r(e,t){this.func=e,this.context=t,this.count=0}function a(e,t,n){var o=e.func,r=e.context;o.call(r,t,e.count++)}function i(e,t,n){if(null==e)return e;var o=r.getPooled(t,n);y(e,a,o),r.release(o)}function l(e,t,n,o){this.result=e,this.keyPrefix=t,this.func=n,this.context=o,this.count=0}function u(e,t,n){var r=e.result,a=e.keyPrefix,i=e.func,l=e.context,u=i.call(l,t,e.count++);Array.isArray(u)?s(u,r,n,v.thatReturnsArgument):null!=u&&(m.isValidElement(u)&&(u=m.cloneAndReplaceKey(u,a+(!u.key||t&&t.key===u.key?"":o(u.key)+"/")+n)),r.push(u))}function s(e,t,n,r,a){var i="";null!=n&&(i=o(n)+"/");var s=l.getPooled(t,i,r,a);y(e,u,s),l.release(s)}function c(e,t,n){if(null==e)return e;var o=[];return s(e,o,null,t,n),o}function d(e,t,n){return null}function f(e,t){return y(e,d,null)}function p(e){var t=[];return s(e,t,null,v.thatReturnsArgument),t}var h=n(426),m=n(49),v=n(26),y=n(436),g=h.twoArgumentPooler,b=h.fourArgumentPooler,_=/\/+/g;r.prototype.destructor=function(){this.func=null,this.context=null,this.count=0},h.addPoolingTo(r,g),l.prototype.destructor=function(){this.result=null,this.keyPrefix=null,this.func=null,this.context=null,this.count=0},h.addPoolingTo(l,b);var C={forEach:i,map:c,mapIntoWithKeyPrefixInternal:s,count:f,toArray:p};e.exports=C},function(e,t,n){"use strict";var o=n(49),r=o.createFactory,a={a:r("a"),abbr:r("abbr"),address:r("address"),area:r("area"),article:r("article"),aside:r("aside"),audio:r("audio"),b:r("b"),base:r("base"),bdi:r("bdi"),bdo:r("bdo"),big:r("big"),blockquote:r("blockquote"),body:r("body"),br:r("br"),button:r("button"),canvas:r("canvas"),caption:r("caption"),cite:r("cite"),code:r("code"),col:r("col"),colgroup:r("colgroup"),data:r("data"),datalist:r("datalist"),dd:r("dd"),del:r("del"),details:r("details"),dfn:r("dfn"),dialog:r("dialog"),div:r("div"),dl:r("dl"),dt:r("dt"),em:r("em"),embed:r("embed"),fieldset:r("fieldset"),figcaption:r("figcaption"),figure:r("figure"),footer:r("footer"),form:r("form"),h1:r("h1"),h2:r("h2"),h3:r("h3"),h4:r("h4"),h5:r("h5"),h6:r("h6"),head:r("head"),header:r("header"),hgroup:r("hgroup"),hr:r("hr"),html:r("html"),i:r("i"),iframe:r("iframe"),img:r("img"),input:r("input"),ins:r("ins"),kbd:r("kbd"),keygen:r("keygen"),label:r("label"),legend:r("legend"),li:r("li"),link:r("link"),main:r("main"),map:r("map"),mark:r("mark"),menu:r("menu"),menuitem:r("menuitem"),meta:r("meta"),meter:r("meter"),nav:r("nav"),noscript:r("noscript"),object:r("object"),ol:r("ol"),optgroup:r("optgroup"),
option:r("option"),output:r("output"),p:r("p"),param:r("param"),picture:r("picture"),pre:r("pre"),progress:r("progress"),q:r("q"),rp:r("rp"),rt:r("rt"),ruby:r("ruby"),s:r("s"),samp:r("samp"),script:r("script"),section:r("section"),select:r("select"),small:r("small"),source:r("source"),span:r("span"),strong:r("strong"),style:r("style"),sub:r("sub"),summary:r("summary"),sup:r("sup"),table:r("table"),tbody:r("tbody"),td:r("td"),textarea:r("textarea"),tfoot:r("tfoot"),th:r("th"),thead:r("thead"),time:r("time"),title:r("title"),tr:r("tr"),track:r("track"),u:r("u"),ul:r("ul"),"var":r("var"),video:r("video"),wbr:r("wbr"),circle:r("circle"),clipPath:r("clipPath"),defs:r("defs"),ellipse:r("ellipse"),g:r("g"),image:r("image"),line:r("line"),linearGradient:r("linearGradient"),mask:r("mask"),path:r("path"),pattern:r("pattern"),polygon:r("polygon"),polyline:r("polyline"),radialGradient:r("radialGradient"),rect:r("rect"),stop:r("stop"),svg:r("svg"),text:r("text"),tspan:r("tspan")};e.exports=a},function(e,t,n){"use strict";var o=n(49),r=o.isValidElement,a=n(150);e.exports=a(r)},390,function(e,t,n){"use strict";var o=n(197),r=o.Component,a=n(49),i=a.isValidElement,l=n(200),u=n(254);e.exports=u(r,i,l)},409,function(e,t){"use strict";function n(){return o++}var o=1;e.exports=n},function(e,t,n){"use strict";var o=function(){};e.exports=o},function(e,t,n){"use strict";function o(e){return a.isValidElement(e)?void 0:r("143"),e}var r=n(61),a=n(49);n(10),e.exports=o},function(e,t,n){"use strict";function o(e,t){return e&&"object"==typeof e&&null!=e.key?s.escape(e.key):t.toString(36)}function r(e,t,n,a){var f=typeof e;if("undefined"!==f&&"boolean"!==f||(e=null),null===e||"string"===f||"number"===f||"object"===f&&e.$$typeof===l)return n(a,e,""===t?c+o(e,0):t),1;var p,h,m=0,v=""===t?c:t+d;if(Array.isArray(e))for(var y=0;y<e.length;y++)p=e[y],h=v+o(p,y),m+=r(p,h,n,a);else{var g=u(e);if(g){var b,_=g.call(e);if(g!==e.entries)for(var C=0;!(b=_.next()).done;)p=b.value,h=v+o(p,C++),m+=r(p,h,n,a);else for(;!(b=_.next()).done;){var E=b.value;E&&(p=E[1],h=v+s.escape(E[0])+d+o(p,0),m+=r(p,h,n,a))}}else if("object"===f){var x="",N=String(e);i("31","[object Object]"===N?"object with keys {"+Object.keys(e).join(", ")+"}":N,x)}}return m}function a(e,t,n){return null==e?0:r(e,"",t,n)}var i=n(61),l=(n(30),n(199)),u=n(432),s=(n(10),n(425)),c=(n(12),"."),d=":";e.exports=a},function(e,t,n){"use strict";function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){function n(o,r){function u(e,n){var o=m.getLinkName(e),a=this.props[r[e]];o&&c(this.props,o)&&!a&&(a=this.props[o].requestChange);for(var i=arguments.length,l=Array(i>2?i-2:0),u=2;u<i;u++)l[u-2]=arguments[u];t(this,e,a,n,l)}function c(e,t){return void 0!==e[t]}function f(e){var t={};return m.each(e,function(e,n){x.indexOf(n)===-1&&(t[n]=e)}),t}var h,v,y,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],b=o.displayName||o.name||"Component",_=m.getType(o).propTypes,C=m.isReactComponent(o),E=Object.keys(r),x=["valueLink","checkedLink"].concat(E.map(m.defaultKey));y=m.uncontrolledPropTypes(r,_,b),(0,p["default"])(C||!g.length,"[uncontrollable] stateless function components cannot pass through methods because they have no associated instances. Check component: "+b+", attempting to pass through methods: "+g.join(", ")),g=m.transform(g,function(e,t){e[t]=function(){var e;return(e=this.refs.inner)[t].apply(e,arguments)}},{});var N=(v=h=function(t){function n(){return a(this,n),i(this,t.apply(this,arguments))}return l(n,t),n.prototype.shouldComponentUpdate=function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];return!e.shouldComponentUpdate||e.shouldComponentUpdate.apply(this,n)},n.prototype.componentWillMount=function(){var e=this,t=this.props;this._values={},E.forEach(function(n){e._values[n]=t[m.defaultKey(n)]})},n.prototype.componentWillReceiveProps=function(t){var n=this,o=this.props;e.componentWillReceiveProps&&e.componentWillReceiveProps.call(this,t),E.forEach(function(e){void 0===m.getValue(t,e)&&void 0!==m.getValue(o,e)&&(n._values[e]=t[m.defaultKey(e)])})},n.prototype.componentWillUnmount=function(){this.unmounted=!0},n.prototype.getControlledInstance=function(){return this.refs.inner},n.prototype.render=function(){var e=this,t={},n=f(this.props);return m.each(r,function(n,o){var r=m.getLinkName(o),a=e.props[o];r&&!c(e.props,o)&&c(e.props,r)&&(a=e.props[r].value),t[o]=void 0!==a?a:e._values[o],t[n]=u.bind(e,o)}),t=s({},n,t,{ref:C?"inner":null}),d["default"].createElement(o,t)},n}(d["default"].Component),h.displayName="Uncontrolled("+b+")",h.propTypes=y,v);return s(N.prototype,g),N.ControlledComponent=o,N.deferControlTo=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments[2];return n(e,s({},r,t),o)},N}return n}t.__esModule=!0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};t["default"]=u;var c=n(1),d=r(c),f=n(68),p=r(f),h=n(438),m=o(h);e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,n){var o={};return o}function a(e){return g[0]>=15||0===g[0]&&g[1]>=13?e:e.type}function i(e,t){var n=u(t);return n&&!l(e,t)&&l(e,n)?e[n].value:e[t]}function l(e,t){return void 0!==e[t]}function u(e){return"value"===e?"valueLink":"checked"===e?"checkedLink":null}function s(e){return"default"+e.charAt(0).toUpperCase()+e.substr(1)}function c(e,t,n){return function(){for(var o=arguments.length,r=Array(o),a=0;a<o;a++)r[a]=arguments[a];t&&t.call.apply(t,[e].concat(r)),n&&n.call.apply(n,[e].concat(r))}}function d(e,t,n){return f(e,t.bind(null,n=n||(Array.isArray(e)?[]:{}))),n}function f(e,t,n){if(Array.isArray(e))return e.forEach(t,n);for(var o in e)p(e,o)&&t.call(n,e[o],o,e)}function p(e,t){return!!e&&Object.prototype.hasOwnProperty.call(e,t)}function h(e){return!!(e&&e.prototype&&e.prototype.isReactComponent)}t.__esModule=!0,t.version=void 0,t.uncontrolledPropTypes=r,t.getType=a,t.getValue=i,t.getLinkName=u,t.defaultKey=s,t.chain=c,t.transform=d,t.each=f,t.has=p,t.isReactComponent=h;var m=n(1),v=o(m),y=n(68),g=(o(y),t.version=v["default"].version.split(".").map(parseFloat))},function(e,t,n,o){"use strict";var r=n(o),a=(n(10),function(e){var t=this;if(t.instancePool.length){var n=t.instancePool.pop();return t.call(n,e),n}return new t(e)}),i=function(e,t){var n=this;if(n.instancePool.length){var o=n.instancePool.pop();return n.call(o,e,t),o}return new n(e,t)},l=function(e,t,n){var o=this;if(o.instancePool.length){var r=o.instancePool.pop();return o.call(r,e,t,n),r}return new o(e,t,n)},u=function(e,t,n,o){var r=this;if(r.instancePool.length){var a=r.instancePool.pop();return r.call(a,e,t,n,o),a}return new r(e,t,n,o)},s=function(e){var t=this;e instanceof t?void 0:r("25"),e.destructor(),t.instancePool.length<t.poolSize&&t.instancePool.push(e)},c=10,d=a,f=function(e,t){var n=e;return n.instancePool=[],n.getPooled=t||d,n.poolSize||(n.poolSize=c),n.release=s,n},p={addPoolingTo:f,oneArgumentPooler:a,twoArgumentPooler:i,threeArgumentPooler:l,fourArgumentPooler:u};e.exports=p}]));;;;
!function(e){function o(e,o,t,n){if(n.test("bookings")){e.state("root.bookings",{url:"/bookings",searchText:"dockets bookings jobs",searchName:"Bookings Table",searchIcon:"event_note",permission:"Bookings",views:{"content-wrapper@root":{controller:"BookingsTableController",templateUrl:"/webapp/management/bookings/all/bookings-table.partial.html",resolve:{rDrivers:["Model",function(e){return e.Driver.query().select("Id,Firstname,Surname,Callsign,ImageUrl,Vehicles/Id,Vehicles/Registration").include("Vehicles").parseAs(function(e){this.Id=e.Id,this.Name="("+e.Callsign+") "+e.Firstname+" "+e.Surname,e.Vehicles&&e.Vehicles[0]?(this.DefaultVehicleId=e.Vehicles[0].Id,this.Description=e.Vehicles[0].Registration):(this.DefaultVehicleId=null,this.Description="No Vehicle")}).execute()}]}}}}),n.test("bookings","W")&&e.state("root.bookings.create",{url:"/create",views:{"content-wrapper@root":{controller:"BookingCreateController",templateUrl:"/webapp/management/bookings/new/booking-new.partial.html"}},resolve:{rCompany:["Model","Auth",function(e,o){return e.Company.query().filter("Id eq guid'"+o.getSession().TenantId+"'").select("AutoCopyPassengerNotes,RequiresClient,RequiresBooker,RequiresContactNumber,DefaultPax,DefaultBax,TextConfirmation,EmailConfirmation,TextOnArrival,CallOnArrival,TextAssigned,EmailAssigned,TextOnCompletion,TextOnOnRoute").execute()}],rTags:["Model","Auth",function(e,o){return e.Tag.query().filter("TenantId eq guid'"+o.getSession().TenantId+"'").execute()}]}}),n.test("bookings.validation")&&e.state("root.bookings.validation",{url:"/validation",permission:"Bookings - Validation",views:{"content-wrapper@root":{controller:"BookingValidationController",templateUrl:"/webapp/management/bookings/validation/booking-validation.partial.html"}},resolve:{rVehicleTypes:["Model",function(e){return e.VehicleType.query().execute()}]}}),n.test("bookings.cc-bookings")&&e.state("root.bookings.cc-bookings",{url:"/cc-bookings",permission:"Bookings - CC-Bookings",views:{"content-wrapper@root":{controller:"CCBookingsController",templateUrl:"/webapp/management/bookings/cc-bookings/partial.html"}}}),n.test("bookings.calls")&&e.state("root.bookings.calls",{url:"/calls",permission:"Bookings - Calls",views:{"content-wrapper@root":{controller:"CallsController",templateUrl:"/webapp/management/bookings/calls/partial.html"}},resolve:{rStaff:["Model",function(e){return e.Staff.query().select("Id,Firstname,Surname,ImageUrl").parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname}).execute()}]}}),n.test("bookings.repeat")&&e.state("root.bookings.repeat",{url:"/repeat-bookings",permission:"Bookings - Repeat",views:{"content-wrapper@root":{controller:"RepeatBookingsController",templateUrl:"/webapp/management/bookings/repeat/partial.html"}}}),e.state("root.bookings.search",{url:"/:localId",views:{"content-wrapper@root":{controller:"BookingsTableController",templateUrl:"/webapp/management/bookings/all/bookings-table.partial.html",resolve:{rDrivers:["Model",function(e){return e.Driver.query().select("Id,Firstname,Surname,Callsign,ImageUrl,Vehicles/Id,Vehicles/Registration").include("Vehicles").parseAs(function(e){this.Id=e.Id,this.Name="("+e.Callsign+") "+e.Firstname+" "+e.Surname,e.Vehicles&&e.Vehicles[0]?(this.DefaultVehicleId=e.Vehicles[0].Id,this.Description=e.Vehicles[0].Registration):(this.DefaultVehicleId=null,this.Description="No Vehicle")}).execute()}]}}}});var i=[{title:"All",state:"root.bookings",icon:"event_note"}];n.test("bookings.validation")&&i.push({title:"Validation",state:"root.bookings.validation",icon:"event_note"}),n.test("bookings.cc-bookings")&&i.push({title:"CC Bookings",state:"root.bookings.cc-bookings",icon:"event_note"}),n.test("bookings.repeat")&&i.push({title:"Repeat Bookings",state:"root.bookings.repeat",icon:"repeat"}),n.test("bookings.calls")&&i.push({title:"Calls",state:"root.bookings.calls",icon:"event_note"}),o.registerMenuItem({subMenus:i.filter(function(e){return e.state.substring(5)}),icon:"event_note",title:"Bookings"})}}function t(){}var n=e.module("cab9.bookings",["cab9.common"]);n.config(o),n.run(t),o.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider","$permissions"],t.$inject=[]}(angular);;;;
!function(e){function t(t,a,n,o,i,r,l,s,m,f,d,g){function u(e){e&&e.length>2?t.fetchedStaff=d("filter")(t.staff,{Name:e}):t.fetchedStaff=[]}function c(a){t.paging.loading=!0,t.paging.currentPage=a,t.filters.pageNum=a,t.filters.startDateTime=p(t.filters.$startDate,t.filters.$startTime),t.filters.endDateTime=p(t.filters.$endDate,t.filters.$endTime);var n=e.copy(t.filters);i.get(r.API_ENDPOINT+"/api/calls/all",{params:n}).success(function(e){console.log(e),t.paging.loading=!1,t.paging.totalResults=e.Stats.Calls,t.paging.maxPages=Math.ceil(t.paging.totalResults/t.paging.resultsPerPage),console.log(e.Stats),t.stats=e.Stats,t.Calls=e.Calls,t.Calls.map(function(e){e.$StartTime=moment(e.StartTime),e.$AnsweredTime=moment(e.AnsweredTime),e.$EndTime=moment(e.EndTime),e.$RingingDuration=e.$AnsweredTime.diff(e.$StartTime,"seconds"),e.$CallDuration=e.$EndTime.diff(e.$AnsweredTime,"seconds")})}).error(function(e){t.paging.loading=!1,swal("Error",e.Message,"error")})}function D(){t.filters={$startDate:(new moment).add(-1,"days").toDate(),$startTime:(new moment).add(-1,"days").startOf("minute").toDate(),$endDate:(new moment).toDate(),$endTime:(new moment).startOf("minute").toDate(),startDateTime:moment().add(-1,"days").format("YYYY-MM-DDTHH:mm"),endDateTime:moment().format("YYYY-MM-DDTHH:mm"),staffId:null,minDurationCall:null,minDurationRinging:null,pageNum:1,records:20}}function T(e){e.$Expanded=!0}function $(e,a){t.opened[a]=!0,e.preventDefault(),e.stopPropagation()}function p(e,t){function a(e,t){var a="000000000"+e;return a.substr(a.length-t)}e||(e=new Date);var n=e.getFullYear(),o=e.getMonth(),i=e.getDate(),r=t.getHours(),l=t.getMinutes(),s=a(n,4)+"-"+a(o+1,2)+"-"+a(i,2)+"T"+a(r,2)+":"+a(l,2)+":00";return s}t.showStartTime=!1,t.showEndTime=!1,t.staff=g,t.Calls=[],t.searchCalls=[],t.searchTerm="hi",t.opened={},t.paging={currentPage:1,resultsPerPage:20,totalResults:null,maxPages:null,loading:!0},t.filters={$startDate:(new moment).add(-6,"days").toDate(),$startTime:(new moment).add(-6,"days").startOf("hour").toDate(),$endDate:(new moment).toDate(),$endTime:(new moment).startOf("hour").toDate(),startDateTime:moment().add(-1,"days").format("YYYY-MM-DDTHH:mm"),endDateTime:moment().format("YYYY-MM-DDTHH:mm"),staffId:null,minDurationCall:null,minDurationRinging:null,pageNum:1,records:20},t.fetchCalls=c,t.openCalendar=$,t.expandCall=T,t.searchStaff=u,t.clearFilters=D,n.TelephonyIntegration.query().execute().then(function(e){e&&e.length>0?(t.noTelephonySet=!1,c(1)):t.noTelephonySet=!0})}var a=e.module("cab9.bookings");a.controller("CallsController",t),t.$inject=["$scope","$modal","Model","$q","$http","$config","$rootScope","$compile","$timeout","Notification","$filter","rStaff"]}(angular);;;;
!function(){function e(e,n,o,i,t,a,r,s,l,c){function d(n){e.fetchingFinance=!0,a.put(t.API_ENDPOINT+"api/bookings/recalculate?bookingId="+n.Id).success(function(e){f(n)}).error(function(n){swal("Error",n.Message,"error"),e.fetchingFinance=!1})}function g(n,o){swal({title:"Are you sure?",text:"This will convert the booking payment method as "+o,type:"warning",showCancelButton:!0,confirmButtonText:"Confirm"},function(){a.post(t.API_ENDPOINT+"api/bookings/update-paymentType?bookingId="+n+"&paymentType="+o+"&paymentCardId="+e.converToCardParams.paymentCardId).success(function(e){swal({title:"Payment Type Updated",text:"Payment Type has been successfully updated to "+o,type:"success",confirmButtonColor:i.COLOURS.brandSecondary},function(){})}).error(function(e){swal("Error",e.ExceptionMessage,"error")})}),$}function m(){var n=window.encodeURIComponent(t.API_ENDPOINT+"Exports/BookingReceipt/template.html#/?bookingid="+e.booking.Id);window.open("http://h2p.utilities.e9ine.com/?url="+n+"&filename="+e.booking.LocalId,"_blank")}function u(e,n){o.open({templateUrl:"/webapp/common/views/conversations/conversations-list.partial.html",controller:"ConversationsModalController",windowClass:"chat",backdropClass:"chatBG",resolve:{rBooking:function(){return e},rType:function(){return n}}})}function p(n){n.$expanded=!0;var o=[];o.push("(EntityType eq 'Booking' and EntityId eq guid'"+n.Id+"')"),o.push("(BookingId eq guid'"+n.Id+"')");for(var i=0;i<n.BookingStops.length;i++){var a=n.BookingStops[i];o.push("(EntityType eq 'BookingStop' and EntityId eq guid'"+a.Id+"')")}y(1,n),f(e.booking),h(e.booking),t.CARD_PAYMENTS_ENABLED&&I()}function k(e){e.$expanded=!0,e.Request=JSON.parse(e.Request),e.Response=JSON.parse(e.Response)}function f(n){e.fetchingFinance=!0,a.get(t.API_ENDPOINT+"api/bookings/getbookingfinancedetails",{params:{bookingId:n.Id}}).success(function(o){n.$FinanceInfo=o,"Card"==n.PaymentMethod?a.get(t.API_ENDPOINT+"api/Transactions/DetailedTransactions",{params:{bookingId:n.Id}}).success(function(o){n.$Transactions=o,t.CARD_PAYMENTS_ENABLED?I():e.fetchingFinance=!1}):e.fetchingFinance=!1})}function h(n){e.fetchingCalls=!0,a.get(t.API_ENDPOINT+"api/calls/for-bookings",{params:{bookingId:n.Id}}).success(function(o){n.$Calls=o,n.$Calls.map(function(e){e.$StartTime=moment(e.StartTime),e.$AnsweredTime=moment(e.AnsweredTime),e.$EndTime=moment(e.EndTime),e.$RingingDuration=e.$AnsweredTime.diff(e.$StartTime,"seconds"),e.$CallDuration=e.$EndTime.diff(e.$AnsweredTime,"seconds")}),e.fetchingCalls=!1})}function I(){r.PaymentCard.query().where("PassengerId eq guid'"+e.booking.LeadPassengerId+"'").where("Active eq true").execute().then(function(n){e.fetchingFinance=!1,e.passengerCards=n,null!=e.booking.ClientId&&r.PaymentCard.query().where("ClientId eq guid'"+e.booking.ClientId+"'").where("Active eq true").execute().then(function(n){e.clientCards=n})})}function b(){e.paymentParams.collectingPayment=!0,e.paymentParams.PaymentCardId?a({method:"POST",url:t.API_ENDPOINT+"api/Bookings/TakePayment?bookingId="+e.booking.Id+"&paymentCardId="+e.paymentParams.PaymentCardId}).then(function(n){swal("Payment Successful","Payment has been taken successfully using the selected card.","success"),f(e.booking),e.booking.CardPaymentStatus="Success",e.booking.PaymentMethod="Card",e.paymentParams.collectingPayment=!1,e.paymentParams={showCardPayment:!1}},function(n){f(e.booking),e.booking.CardPaymentStatus="Failure",swal("Payment Error","An error occurred while collecting payment. "+n.data.Message,"error"),e.paymentParams.collectingPayment=!1,e.paymentParams={showCardPayment:!1}}):(swal("Payment Error","Please make sure that a card is selected and payment amount is more than £0.00.","error"),e.paymentParams.collectingPayment=!1,e.paymentParams={showCardPayment:!1})}function y(n,o){var i=10,s=(n-1)*i;a.get(t.API_ENDPOINT+"api/Audit/ForBooking",{params:{bookingId:o.Id,top:i,skip:s}}).success(function(o){1==n&&0==o.length&&(e.noHistory=!0),(o.length<i||"Booking Created"==o[o.length-1].BookingEvent)&&(e.noMoreHistory=!0),angular.forEach(o,function(n){var o=moment(n.Timestamp).format("DD MMM");e.history[o]||(e.history[o]=[]),e.history[o].push(new r.AuditRecord(n))})})}function P(n){e.historyPage++,y(e.historyPage,n)}function v(n){n.$expanded=!1,e.noHistory=!1,e.noMoreHistory=!1,e.historyPage=1,e.history&&(e.history={})}e.BS=["Completed","Cancelled","COA"],e.CARD_PAYMENTS_ENABLED=t.CARD_PAYMENTS_ENABLED,e.paymentParams={showCardPayment:!1},e.converToCardParams={showCards:!1,paymentCardId:null},e.tab={current:"Info"},e.exportReceipt=m,e.history={},e.noHistory=!1,e.noMoreHistory=!1,e.historyPage=1,e.fetchMoreHistory=P,e.expandTransaction=k,e.takeCardPayment=b,e.recalculateBooking=d,e.updateBookingPaymentType=g,e.iconsIndex={"N/A":"assignment","Booking Offer Sent":"assignment","Booking Created":"assignment","Booking Cancelled":"assignment","Infinity Cancelled":"assignment","OT Cancelled":"assignment",FlightTrackingStarted:"flight_land",FlightTrackingStopped:"flight_land","SMS Confirmation":"insert_comment","Email Client Confirmation":"email","Email Booker Confirmation":"email","SMS Driver Arrived":"insert_comment","Call Driver Arrived":"phone","Email Manual Confirmation":"email","Driver Read Offer":"person_pin","Driver Accepted":"person_pin","Driver Rejected":"person_pin","Driver Allocated":"person_pin","Driver Unallocated":"person_pin","Booking Offered To Driver":"person_pin","Booking Pre Allocated To Driver":"person_pin","Booking Patched":"assignment","Booking Edited":"assignment",DriverUpdate:"person_pin",DriverPaymentIssued:"account_balance_wallet",DriverPaymentGenerated:"account_balance_wallet",DriverPaymentCancelled:"account_balance_wallet",ClientInvoiceIssued:"check_circle",ClientInvoiceCancelled:"check_circle","Flight Update":"flight_land",Repricing:"border_color","Booking Sent to Bidding Portal":"assignment","Booking Removed from Bidding Portal":"assignment","Driver Bidded for Booking":"person_pin"},e.coloursIndex={"N/A":"orange-bg","Booking Offer Sent":"green-bg","Booking Created":"green-bg",FlightTrackingStarted:"green-bg",FlightTrackingStopped:"red-bg","SMS Confirmation":"green-bg","Email Client Confirmation":"green-bg","Email Booker Confirmation":"green-bg","SMS Driver Arrived":"green-bg","Call Driver Arrived":"green-bg","Email Manual Confirmation":"orange-bg","Driver Read Offer":"green-bg",DriverUpdate:"green-bg","Driver Accepted":"green-bg","Driver Rejected":"orange-bg","Driver Allocated":"green-bg","Driver Unallocated":"green-bg","Booking Offered To Driver":"green-bg","Booking Pre Allocated To Driver":"green-bg","Booking Patched":"orange-bg","Booking Edited":"orange-bg",DriverPaymentIssued:"green-bg",DriverPaymentGenerated:"green-bg",DriverPaymentCancelled:"red-bg",ClientInvoiceIssued:"green-bg",ClientInvoiceCancelled:"red-bg","Booking Cancelled":"red-bg","Infinity Cancelled":"red-bg","OT Cancelled":"red-bg","Flight Update":"orange-bg",Repricing:"orange-bg","Booking Sent to Bidding Portal":"green-bg","Booking Removed from Bidding Portal":"green-bg","Driver Bidded for Booking":"green-bg"},e.PERMISSIONS=l;var C=s.currency().getCurrent();e.booking.Client?e.CurrencyId=e.booking.Client.DefaultCurrencyId:e.CurrencyId=C.Id,e.assignDriver=function(e,n){e.DriverId=n.Id,e.VehicleId=n.DefaultVehicleId,e.$patch(!0).then(function(){e.$commit(!0)})},e.closeBooking=v,e.expandBooking=p,e.trackBooking=function(e){a({method:"GET",url:window.endpoint+"api/bookingcodes?bookingid="+e.Id}).then(function(e){e.data&&e.data.Code?window.open("/track/"+e.data.Code,"_blank","height=870,width=1000,left=0,top=0"):swal({title:"Tracking Not Available.",text:"The tracking information for this booking is not yet available.",type:"warning",confirmButtonColor:i.COLOURS.brandSecondary})},function(e){})},e.getTaxAmount=function(e){if(e.Tax&&e.Tax.TaxComponents)return e.Tax.TaxComponents.reduce(function(e,n){return e+n.Rate/100},0)},e.loading=!1,e.$watch("booking.$expanded",function(n){e.booking.$expanded&&(e.loading=!0,r.Booking.query().select("Id,AdjustmentTotal,BookingExpense/Amount,BookingExpense/BookingExpenseType/Name,BookingValidations/Value,BookingValidations/ClientReference/ReferenceName,BookingRequirements/Name,Invoice/Id,Invoice/Reference,DriverPayment/Id,DriverPayment/Reference,EncodedRoute,ActualRoute,Tax,Tax/TaxComponents,BookingTags/Type,BookingTags/Tag/Name").include("BookingExpense,BookingExpense/BookingExpenseType,BookingValidations,BookingValidations/ClientReference,BookingRequirements,Invoice,DriverPayment,Tax,Tax/TaxComponents,BookingTags,BookingTags/Tag").filter("Id eq guid'"+e.booking.Id+"'").execute().then(function(n){e.booking.$WaitTime=0,e.booking.AdjustmentTotal=n[0].AdjustmentTotal,e.booking.BookingValidations=n[0].BookingValidations,e.booking.BookingTags=n[0].BookingTags,e.booking.BookingExpense=n[0].BookingExpense,e.booking.BookingRequirements=n[0].BookingRequirements,e.booking.Invoice=n[0].Invoice,e.booking.DriverPayment=n[0].DriverPayment,e.booking.BookingStops.map(function(n){e.booking.$WaitTime+=n.WaitTime}),e.booking.Tax=n[0].Tax,e.loading=!1},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:i.COLOURS.brandSecondary})}),a.post(t.API_ENDPOINT+"api/quote",e.booking).success(function(n){e.booking.quote=n}))}),e.updateBookingStatus=function(e,n){var o=new r.Booking(e),i="";return e.$updating=!0,e.DriverPaymentId||e.InvoiceId?(swal("Warning","Booking status cannot be modified as the booking is Invoiced/Driver Paid","warning"),void(e.$updating=!1)):"Completed"!=n||e.DriverId?("Cancelled"==n?i="The Booking will be cancelled and not billed to client.":"COA"==n?i="The Booking will be marked COA and client may be billed a minimum amount.":(n="Completed")&&(i="The Booking will be marked completed."),void swal({title:"Are you sure?",text:i,type:"warning",showCancelButton:!0,confirmButtonText:"Confirm"},function(){o.BookingStatus=n,o.$patch(!0).then(function(){e.$updating=!1,o.$commit(!0)})})):(swal("Complete Warning","Booking cannot be completed as there is no driver attached to it.","warning"),void(e.$updating=!1))},e.assignVehicle=function(e,n){e.$driverUpdate=!0,e.VehicleId=n.Id,e.$patch(!0).then(function(){e.Vehicle=n,e.$commit(!0),e.$driverUpdate=!1})},e.removeDriver=function(e){e.$driverUpdate=!0,e.DriverId=null,e.VehicleId=null,e.$patch(!0).then(function(){e.Driver=null,e.$commit(!0),e.$driverUpdate=!1})},e.removeVehicle=function(e){e.VehicleId=null,e.$patch(!0).then(function(){e.Vehicle=null,e.$commit(!0)})},e.toggleComplete=function(n,o){"Completed"==n.BookingStatus?(n.BookingStatus="Allocated",$(o.target).removeClass("animated tada")):(n.BookingStatus="Completed",$(o.target).addClass("animated tada")),n.$patch(!0).then(function(){c.success("Booking Saved"),setTimeout(function(){e.onCompleted()},1e3)})},e.getLocation=function(n){var o=[],i=new google.maps.DirectionsService,a={origin:n._FromSummary,destination:n._ToSummary,waypoints:o,optimizeWaypoints:!0,travelMode:google.maps.TravelMode.DRIVING};i.route(a,function(o,i){i==google.maps.DirectionsStatus.OK&&(staticMapUrl=encodeURI(t.GMAPS_STATIC_URL+"&markers=shadow:false|scale:2|icon:http://d1a3f4spazzrp4.cloudfront.net/receipt-new/marker-start@2x.png|"+n._FromSummary+"&markers=shadow:false|scale:2|icon:http://d1a3f4spazzrp4.cloudfront.net/receipt-new/marker-finish@2x.png|"+n._ToSummary+"&path=weight:5|color:0x2dbae4ff|enc:"+o.routes[0].overview_polyline),e.booking.mapUrl=staticMapUrl),e.$apply()})},e.openEditModal=function(e,n){n?window.open("/webapp/common/modals/bookings/reuse-booking/window.html#?id="+e.Id+"&clientId="+e.ClientId+"&repeat=true","_blank","height=870,width=1000,left=0,top=0"):window.open("/webapp/common/modals/bookings/edit-booking/window.html#?id="+e.Id+"&clientId="+e.ClientId,"EDIT:"+e.Id,"height=870,width=1000,left=0,top=0")},e.reUse=function(e){window.open("/webapp/common/modals/bookings/reuse-booking/window.html#?id="+e.Id+"&clientId="+e.ClientId,"_blank","height=870,width=1000,left=0,top=0")},e.textTo=function(e,n){var i=o.open({templateUrl:"/webapp/common/modals/text-to.modal.html",controller:["$scope","emailAddress","$modalInstance",function(e,n,o){null!=n&&(e.email=n),e.sendEmail=function(){o.close(e.email)}}],resolve:{emailAddress:function(){return n.PassengerNotificationPhone}}});i.result.then(function(e){null!=e&&(swal("Success","User will receive the SMS soon..","success"),a.post(t.API_ENDPOINT+"api/email",{Type:"SMSConfirmation",BookingId:n.Id,EmailId:e}).success(function(){c.success("SMS Sent")}))})},e.emailTo=function(e,n){var i=o.open({templateUrl:"/webapp/common/modals/email-to.modal.html",controller:["$scope","emailAddress","$modalInstance",function(e,n,o){null!=n&&(e.email=n),e.sendEmail=function(){o.close(e.email)}}],resolve:{emailAddress:function(){var o=null;switch(e){case"DRIVER":o=n.Driver?n.Driver.Email:null;break;case"PAX":o=n.LeadPassenger?n.LeadPassenger.Email:null;break;case"CLIENT":o=n.Client?n.Client.Email:null;break;case"RECEIPT":o=n.LeadPassenger?n.LeadPassenger.Email:null}return o}}});i.result.then(function(o){null!=o&&(swal("Success","User will receive the email soon..","success"),"DRIVER"==e?a.post(t.API_ENDPOINT+"api/email",{Type:"DriverConfirmation",BookingId:n.Id,DriverId:n.DriverId,EmailId:o}).success(function(){c.success("Email Sent")}):"PAX"==e?a.post(t.API_ENDPOINT+"api/email",{Type:"PassengerConfirmation",BookingId:n.Id,PassengerId:n.LeadPassengerId,EmailId:o}).success(function(){c.success("Email Sent")}):"CLIENT"==e?a.get(t.API_ENDPOINT+"api/email/booking",{params:{bookingId:n.Id,email:o}},function(){c.success("Email Sent"),console.log("Email Sent")}):"PAYMENT"==e?a.get(t.API_ENDPOINT+"api/email/payment-link",{params:{bookingId:n.Id,email:o}},function(){c.success("Email Sent")}):"RECEIPT"==e&&a.post(t.API_ENDPOINT+"api/email",{Type:"PassengerBookingPaymentReceipt",BookingId:n.Id,EmailId:o}).success(function(){c.success("Email Sent")}))})};var T={toggle:!1,cancel:function(){e.booking.$rollback(),this.toggle=!1},save:function(){e.booking.$patch(),this.toggle=!1}};e.API_ENDPOINT=t.API_ENDPOINT;var B={toggle:!1,editDestination:function(n,i){this.toggle=!0;var r=o.open({templateUrl:"/webapp/management/bookings/stop-edit.modal.html",controller:"BookingDestinationStopModal",resolve:{dropOffLoc:function(){if(n)return e.booking._ToSummary}}});r.result["finally"](function(){B.toggle=!1}),r.result.then(function(o){if(n){var i=e.booking.BookingStops.length-1,r=e.booking.BookingStops.splice(i,1,o);o.Id=r[0].Id,o.BookingId=e.booking.Id,a({method:"PATCH",url:t.API_ENDPOINT+"api/BookingStops?id="+o.Id,data:o})}else{o.Type="Via";var i=e.booking.BookingStops.length-1;e.booking.BookingStops.splice(i,0,o),o.BookingId=e.booking.Id,a.post(t.API_ENDPOINT+"api/BookingStops",o)}})}};e.stopSummary=function(e){return e.Address1+" "+e.Area+", "+e.TownCity+", "+e.Postcode},e.editing={any:function(){return this.expenses.toggle||this.waiting.toggle||this.notes.toggle||this.stops.toggle},expenses:angular.copy(T),waiting:angular.copy(T),notes:angular.copy(T),stops:B},e.showConversations=u}function n(e,n,o){if(o){var i=new google.maps.Geocoder;i.geocode({address:o},function(n,o){e.choosen=n[0]})}else e.choosen=null;e.destinationValid=!1,e.map={center:{latitude:45,longitude:-73},zoom:17},e.markers=[],e.$watch("choosen",function(n){n&&angular.isObject(n)&&n.geometry?(e.destinationValid=!0,e.map.center={latitude:n.geometry.location.lat(),longitude:n.geometry.location.lng()},e.markers=[{id:"5WnUJbhPEg",coords:{latitude:n.geometry.location.lat(),longitude:n.geometry.location.lng()}}]):e.destinationValid=!1}),e.confirmDestination=function(){var o={};angular.forEach(e.choosen.address_components,function(e){var n=e.types[0];switch(n){case"street_number":o.Address2=e.long_name;break;case"route":o.Address1=e.long_name;break;case"locality":o.Area=e.long_name;break;case"postal_town":o.TownCity=e.long_name;break;case"administrative_area_level_2":o.County=e.long_name;break;case"postal_code":o.Postcode=e.long_name}}),e.choosen.types.filter(function(e){return"airport"===e||"transit_station"===e}).length?o.Alias=e.choosen.name:o.Alias=e.choosen.formatted_address;try{o.Latitude=e.choosen.geometry.lat(),o.Longitude=e.choosen.geometry.lng()}catch(i){}n.close(o)}}var o=angular.module("cab9.bookings");o.controller("BookingDestinationStopModal",n),o.directive("bookingStrip",function(){return{restrict:"E",templateUrl:"/webapp/management/bookings/booking-strip.template.html",scope:{booking:"=",drivers:"=",vehicles:"=",onCompleted:"&"},controller:e,link:function(e,n,o){e.$expanded=!1}}}),e.$inject=["$scope","Auth","$modal","$UI","$config","$http","Model","Localisation","$permissions","Notification"],n.$inject=["$scope","$modalInstance","dropOffLoc"]}();;;;
!function(){function n(n,o,t,e,a,d,s,r,l,g){function c(n){n.$loading=!0,d.put(a.API_ENDPOINT+"api/bookings/validation/setvalidate?bookingId="+n.Id+"&valid=true").success(function(o){n.$loading=!1,b(o)}).error(function(o){n.$loading=!1,swal("Error",o.Message,"error")})}function u(n){n.$loading=!0,d.put(a.API_ENDPOINT+"api/bookings/validation/setcommissions?bookingId="+n.Id+"&manualCost="+n.ActualCost+"&manualCommission="+n.JourneyCommission).success(function(o){f(n,o),n.$loading=!1}).error(function(o){swal("Error",o.Message,"error"),n.$loading=!1})}function p(n){n.$loading=!0,d.put(a.API_ENDPOINT+"api/bookings/validation/setvalidate?bookingId="+n.Id+"&valid=false").success(function(o){n.$loading=!1,b(o)}).error(function(o){n.$loading=!1,swal("Error",o.Message,"error")})}function I(n){n.$loading=!0,d.put(a.API_ENDPOINT+"api/bookings/validation/recalculate?bookingId="+n.Id).success(function(o){f(n,o),n.$loading=!1}).error(function(o){swal("Error",o.Message,"error"),n.$loading=!1})}function m(o,i){i?(n.editOptions[o][i]=!n.editOptions[o][i],n.overlay=n.editOptions[o][i]):(n.editOptions[o]=!n.editOptions[o],n.overlay=n.editOptions[o]),n.booking.Stops=n.booking.Stops.map(function(n){return n.StopSummary=$(n),n})}function f(o,i){var t=n.$parent.bookings.findIndex(function(n){return n.Id==i.Id});document.getElementById(o.Id).classList.add("animated","pulse"),g(function(){"Cash"==i.PaymentMethod?i.$invLbl="Cash":"Card"==i.PaymentMethod?i.$invLbl="Card":i.$invLbl="Invoice",n.$parent.bookings.splice(t,1,i)},400)}function b(o){var t=n.$parent.bookings.findIndex(function(n){return n.Id==o.Id});document.getElementById(o.Id).classList.add("animated","flipOutX"),g(function(){for(i=t+1;i<n.$parent.bookings.length;i++)document.getElementById(n.$parent.bookings[i].Id).classList.add("animated","slideInUp");n.$parent.bookings.splice(t,1)},400),g(function(){for(i=t;i<n.$parent.bookings.length;i++)document.getElementById(n.$parent.bookings[i].Id).classList.remove("animated","slideInUp")},1e3)}function k(n){window.open("/webapp/common/modals/bookings/edit-booking/window.html#?id="+n.Id+"&clientId="+n.ClientId,"EDIT:"+n.Id,"height=870,width=1000,left=0,top=0")}function $(n){var o="";return n.Address1&&n.Address1.length>0&&(o+=n.Address1),n.TownCity&&n.TownCity.length>0?(o.trim().length>0&&(o+=", "),o+=n.TownCity):n.Area&&n.Area.length>0&&(o.trim().length>0&&(o+=", "),o+=n.Area),n.County&&0===o.length&&n.County.length>0&&(o+=n.County),n.Postcode&&n.Postcode.length>0&&(o.trim().length>0&&(o+=", "),o+=n.Postcode),o}n.togglePopup=m,n.openEditModal=k,n.validateBooking=c,n.inValidateBooking=p,n.recalculateBooking=I,n.setCommissions=u;var v=r.currency().getCurrent();n.editOptions={mileage:!1,client:{waiting:!1,extras:!1},driver:{waiting:!1,extras:!1}},n.showLabel=!0,n.defaultFill=!0,n.booking.Client?n.CurrencyId=n.booking.Client.DefaultCurrencyId:n.CurrencyId=v.Id,n.PERMISSIONS=l,n.API_ENDPOINT=a.API_ENDPOINT,n.loading=!1}var o=angular.module("cab9.bookings");o.directive("bookingValidationStrip",function(){return{restrict:"E",templateUrl:"/webapp/management/bookings/validation/booking-validation-strip/booking-validation-strip.template.html",scope:{booking:"="},controller:n,link:function(n,o,i){n.mode="VIEW"}}}),n.$inject=["$scope","Auth","$modal","$UI","$config","$http","Model","Localisation","$permissions","$timeout"]}();;;;
!function(){function o(o,n,r,e){o.booking=n,o.tabDefs=r,o.accessors={LogoUrl:function(){return o.booking._ImageUrl}}}var n=angular.module("cab9.bookings");n.controller("BookingsViewerController",o),o.$inject=["$scope","rBooking","rTabs","$config"]}();;;;
!function(e){function t(t,r,o,n,a,l,s,f,u,d,g,m,d){function c(e){if(t.bookingGroups=null,t.paging.currentPage=e,t.searchTerm.$.length>0)u.get(l.API_ENDPOINT+"api/search",{params:{searchText:t.searchTerm.$,top:50,skip:t.paging.resultsPerPage*(t.paging.currentPage-1)}}).success(function(e){console.log(e);var t=[];[].push.apply(t,e.map(function(e){return new n.Booking(e)})),p(t)});else{var r={From:new moment(t.filter.date.from).startOf("day").format(),To:new moment(t.filter.date.to).endOf("day").format(),Page:t.paging.currentPage};if(t.filter.PartnerIds.length>0&&(r.PartnerIds=t.filter.PartnerIds),t.filter.ClientIds.length>0&&(r.ClientIds=t.filter.ClientIds),t.filter.DriverIds.length>0&&(r.DriverIds=t.filter.DriverIds),t.filter.LeadPassengerIds.length>0&&(r.LeadPassengerIds=t.filter.LeadPassengerIds),t.filter.VehicleTypeIds.length>0&&(r.VehicleTypeIds=t.filter.VehicleTypeIds),t.filter.BookingSource&&(r.BookingSource=t.filter.BookingSource),t.filter.PaymentMethod&&(r.PaymentMethod=t.filter.PaymentMethod),t.filter.PartnerType&&(r.PartnerType=t.filter.PartnerType),t.filter.Amount.from&&(r.AmountFrom=t.filter.Amount.from),t.filter.Amount.to&&(r.AmountTo=t.filter.Amount.to),t.filter.ShowClientServicesBookings&&(r.Dispute=!0),t.filter.Status)for(var o=Object.keys(t.filter.Status),i=0;i<o.length;i++)t.filter.Status[o[i]]&&("InProgress"==o[i]&&(r.Arrived=!0),r[o[i]]=!0);u.post(l.API_ENDPOINT+"api/bookings/filtered",r).success(function(e){var t=[];[].push.apply(t,e.map(function(e){return new n.Booking(e)})),p(t),h()}).error(function(e){swal("Error","Please try again or contact admin","error")})}}function p(e){if(t.bookingGroups=[],e.length>0){for(var r={date:e[0].BookedDateTime,day:moment(e[0].BookedDateTime).format("dddd"),bookings:[]},o=0;o<e.length;o++){var n=e[o];n.FlightInfo&&(moment().diff(moment(n.FlightInfo.LastUpdate),"hours")>10?n.FlightInfo.$Status="No updates yet.":n.FlightInfo.$Status="Last Updated "+moment(n.FlightInfo.LastUpdate).fromNow()),n.BookingStops=s("orderBy")(n.BookingStops,"StopOrder"),new moment(n.BookedDateTime).format("DD/MM/YYYY")==new moment(r.date).format("DD/MM/YYYY")?(r.day=moment(n.BookedDateTime).format("dddd"),r.bookings.push(n)):(t.bookingGroups.push(r),r={date:n.BookedDateTime,day:moment(n.BookedDateTime).format("dddd"),bookings:[]},r.bookings.push(n))}t.bookingGroups.push(r)}}function h(){var e=new moment(t.filter.date.from),r=new moment(t.filter.date.to);t.filterSummary=t.fetchStatus,e.format("DD/MM/YYYY")==r.format("DD/MM/YYYY")?t.filterSummary+=" Bookings for "+s("date")(e.toDate(),"shortDate"):t.filterSummary+=" Bookings from "+s("date")(e.toDate(),"shortDate")+" to "+s("date")(r.toDate(),"shortDate")}function I(){t.showSearch=!t.showSearch,t.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):t.searchTerm.$=""}function k(r){swal({title:"Are You Sure?",text:"This will initiate a booking export and the exported file will be sent to you via email.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Confirm",cancelButtonText:"Cancel",closeOnConfirm:!1,closeOnCancel:!1},function(n){if(n){if(!t.filter.date.from||!t.filter.date.to)return void swal({title:"Date Range not selected.",text:"Please select date range in filters to export.",type:"warning",confirmButtonColor:o.COLOURS.brandSecondary});var i="from="+moment(t.filter.date.from).startOf("day").format().replace("+","%2B")+"&to="+moment(t.filter.date.to).endOf("day").format().replace("+","%2B");t.filter.PartnerIds.length>0&&(i+="&partnerids="+t.filter.PartnerIds.reduce(function(e,t){return e?e+", ''"+t+"''":"''"+t+"''"},null)),t.filter.DriverIds.length>0&&(i+="&driverids="+t.filter.DriverIds.reduce(function(e,t){return e?e+", ''"+t+"''":"''"+t+"''"},null)),t.filter.ClientIds.length>0&&(i+="&clientIds="+t.filter.ClientIds.reduce(function(e,t){return e?e+", ''"+t+"''":"''"+t+"''"},null)),t.filter.VehicleTypeIds.length>0&&(i+="&vehicleTypeIds="+t.filter.VehicleTypeIds.reduce(function(e,t){return e?e+", ''"+t+"''":"''"+t+"''"},null)),t.filter.LeadPassengerIds.length>0&&(i+="&leadPassengerIds="+t.filter.LeadPassengerIds.reduce(function(e,t){return e?e+", ''"+t+"''":"''"+t+"''"},null)),t.filter.Amount&&t.filter.Amount.from>=0&&(i+="&actualCostFrom="+t.filter.Amount.from),t.filter.Amount&&t.filter.Amount.to>=0&&(i+="&actualCostTo="+t.filter.Amount.to),t.filter.ClientServices&&(i+="&clientServices=1"),t.filter.BookingSource&&(i+="&bookingSource="+t.filter.BookingSource),t.filter.PaymentMethod&&(i+="&paymentMethod="+t.filter.PaymentMethod),t.filter.PartnerType&&(i+="&partnerType="+t.filter.PartnerType);var a=[];e.forEach(t.filter.Status,function(e,t){if(e)switch(t){case"Cancelled":a.push("-1");break;case"COA":a.push("0");break;case"Incoming":a.push("1");break;case"PreAllocated":a.push("5");break;case"Allocated":a.push("10");break;case"OnRoute":a.push("20");break;case"Arrived":a.push("30,40");break;case"InProgress":a.push("30,40");break;case"Clearing":a.push("80");break;case"Completed":a.push("100");break;case"OpenToBid":a.push("120")}});var s=m.getSession().Claims.TenantId[0];i+="&tenantId="+s+"&management=true&withReferences="+r+"&BookingStatuses="+a.join(","),u.get(l.API_ENDPOINT+"api/bookings/export?"+i,"_blank").then(function(e){swal({title:"Export Initiated",text:"Thank you for your request, The bookings export file will be sent to you via an email in few minutes.",type:"success",confirmButtonColor:o.COLOURS.brandSecondary})},function(e){swal({title:"Some Error Occured",text:e.data.Message,type:"error",confirmButtonColor:o.COLOURS.brandSecondary})})}else swal.close()})}function P(){f.open({templateUrl:"/webapp/management/bookings/modals/filter.modal.partial.html",controller:"BookingsFilterModalController",resolve:{rFilter:function(){return t.filter}},size:"lg"}).result.then(function(e){t.filter=e,t.filter.$inc++,sessionStorage.setItem("CAB9_BOOKING_FILTERS",JSON.stringify(e))})}function S(e,r){for(i=0;i<t.bookingGroups.length;i++)for(j=0;j<t.bookingGroups[i].bookings.length;j++){var o=t.bookingGroups[i].bookings[j];r[0].Id==o.Id&&(t.bookingGroups[i].bookings.splice(j,1,new n.Booking(r[0])),t.$apply())}}function y(){var e={date:{from:moment().startOf("day"),to:moment().endOf("week"),span:"week",selectedPeriod:"("+moment().startOf("day").format("DD/MM/YYYY")+" - "+moment().endOf("week").format("DD/MM/YYYY")+")"},Amount:{from:null,to:null},Partners:[],Clients:[],Drivers:[],VehicleTypes:[],Passengers:[],ClientIds:[],PartnerIds:[],DriverIds:[],VehicleTypeIds:[],LeadPassengerIds:[],ShowCompletedBookings:!1,ShowClientServicesBookings:!1,Status:null,$inc:0},t=null,r=sessionStorage.getItem("CAB9_BOOKING_FILTERS");if(r)try{t=JSON.parse(r)}catch(o){sessionStorage.removeItem("CAB9_BOOKING_FILTERS"),t=null}return t||e}t.toggleSearch=I,t.searchTerm={$:""},d.localId&&(t.searchTerm.$=d.localId,t.showSearch=!0),t.drivers=g,t.paging={currentPage:1,resultsPerPage:50,totalResults:null,maxPages:null},t.setPage=c,t.filter=y(),t.BS=["OnRoute","Arrived","InProgress","Completed","Cancelled","COA","OpenToBid"],t.onCompleted=function(e,r){1==t.bookingGroups[e].bookings.length?t.bookingGroups.splice(e,1):t.bookingGroups[e].bookings.splice(r,1)},t.bookingGroups=null,t.showFilterModal=P,t.exportBookings=k,t.$watchGroup(["filter.$inc","filter.date.from.valueOf()","filter.date.to.valueOf()","searchTerm.$","filter.ClientIds","filter.LeadPassengerIds","filter.VehicleTypeIds","filter.DriverIds","filter.ShowCompletedBookings","filter.ShowClientServicesBookings","filter.Status.Incoming","filter.Status.PreAllocated","filter.Status.Allocated","filter.Status.OnRoute","filter.Status.InProgress","filter.Status.Completed","filter.Status.Cancelled","filter.Status.COA","filter.Amount.from","filter.Amount.to","filter.BookingSource","filter.PaymentMethod","filter.PartnerType"],function(e,r){if(t.bookingGroups=null,t.fetchStatus="Fetching",e[3])t.filterSummary="Searching Bookings for : '"+e[3]+"'",u.get(l.API_ENDPOINT+"api/search/Count",{params:{searchText:e[3]}}).success(function(r){t.paging.totalResults=r.length,t.filterSummary="Showing Bookings for : '"+e[3]+"'",t.paging.maxPages=Math.ceil(t.paging.totalResults/t.paging.resultsPerPage),c(t.paging.maxPages)});else{h();var o={From:new moment(t.filter.date.from).startOf("day").format(),To:new moment(t.filter.date.to).endOf("day").format(),Page:t.paging.currentPage};if(t.filter.PartnerIds.length>0&&(o.PartnerIds=t.filter.PartnerIds),t.filter.ClientIds.length>0&&(o.ClientIds=t.filter.ClientIds),t.filter.DriverIds.length>0&&(o.DriverIds=t.filter.DriverIds),t.filter.LeadPassengerIds.length>0&&(o.LeadPassengerIds=t.filter.LeadPassengerIds),t.filter.VehicleTypeIds.length>0&&(o.VehicleTypeIds=t.filter.VehicleTypeIds),t.filter.BookingSource&&(o.BookingSource=t.filter.BookingSource),t.filter.PaymentMethod&&(o.PaymentMethod=t.filter.PaymentMethod),t.filter.PartnerType&&(o.PartnerType=t.filter.PartnerType),t.filter.Amount.from&&(o.AmountFrom=t.filter.Amount.from),t.filter.Amount.to&&(o.AmountTo=t.filter.Amount.to),t.filter.ShowClientServicesBookings&&(o.Dispute=!0),t.filter.Status)for(var n=Object.keys(t.filter.Status),i=0;i<n.length;i++)t.filter.Status[n[i]]&&("InProgress"==n[i]&&(o.Arrived=!0),o[n[i]]=!0);u.post(l.API_ENDPOINT+"api/bookings/FilteredCount",o).success(function(e){t.paging.totalResults=e,t.fetchStatus="Showing "+e,h(),t.paging.maxPages=Math.ceil(t.paging.totalResults/t.paging.resultsPerPage),c(1)}).error(function(e){swal("Error","Please try again or contact admin","error")})}}),t.$on("SIGNALR_updateBooking",S)}var r=e.module("cab9.bookings");r.controller("BookingsTableController",t),t.$inject=["$scope","CSV","$UI","Model","$q","$config","$filter","$modal","$http","$stateParams","rDrivers","Auth","$stateParams"]}(angular);;;;
!function(e){function t(t,n,i,s,o,a,r,l,c){function u(){t.paging={currentPage:1,resultsPerPage:20,totalResults:null,maxPages:null,loading:!0},t.filters={From:moment().subtract(7,"days").startOf("isoweek").format("YYYY-MM-DD"),To:moment().subtract(7,"days").endOf("isoweek").format("YYYY-MM-DD"),DriverIds:[],ClientIds:[],PassengerIds:[],VehicleTypeIds:[],ClientStaffIds:[],PaymentMethods:[],BookingSources:[],Top:20,Skip:0,MinCost:null,MaxCost:null,MinProfit:null,MaxProfit:null,SortBy:"BookedDateTime",SearchTerm:null,ValidFilter:"NON",NonDispute:!1},t.paymentTypes=[],(new a.Booking).$$schema.PaymentMethod["enum"].forEach(function(e,n){t.paymentTypes.push({Id:n,Name:e})}),t.bookingSources=[],(new a.Booking).$$schema.BookingSource["enum"].forEach(function(e,n){t.bookingSources.push({Id:n,Name:e})}),d(1)}function g(){var e={},n=t.filters.SortBy.split(" ");return e.Filter=n[0],n.length>1&&(e.Desc=!0),e}function p(e){t.filters.ValidFilter=e,d(1)}function f(e){t.filters.SortBy=e,d(1),t.showSort=!1}function d(n){t.paging.loading=!0,t.paging.currentPage=n,t.filters.Skip=t.paging.resultsPerPage*(t.paging.currentPage-1);var i=e.copy(t.filters),o=["DriverIds","ClientIds","VehicleTypeIds","ClientStaffIds","PassengerIds","PaymentMethods","BookingSources"];o.map(function(e){i[e].length>0&&(i[e].map(function(t,n){i[e][n]=C(t)}),i[e]=i[e].join(","))}),s.get($config.API_ENDPOINT+"api/bookings/validation/fetch",{params:i}).success(function(e){t.paging.loading=!1,t.paging.totalResults=e.Stats.Bookings,t.paging.maxPages=Math.ceil(t.paging.totalResults/t.paging.resultsPerPage),e.Bookings.map(function(e){e.Profit&&(e.Profit=e.Profit.toFixed(2)),"Cash"==e.PaymentMethod?e.$invLbl="Cash":"Card"==e.PaymentMethod?e.$invLbl="Card":e.$invLbl="Invoice"}),t.bookings=e.Bookings,t.stats=e.Stats}).error(function(e){t.paging.loading=!1,swal("Error",e.Message,"error")})}function h(e,n){t.opened[n]=!0,e.preventDefault(),e.stopPropagation()}function m(e){t.fetchedDrivers.length=0,e&&a.Driver.query().where("substringof('"+e+"', concat(concat(Firstname, ' '), Surname)) or substringof('"+e+"', Callsign)").select("Id,Firstname,Surname,Callsign,DriverType/Name").include("DriverType").parseAs(function(e){this.Id=e.Id,this.Name="("+e.Callsign+") "+e.Firstname+" "+e.Surname,this.Description=e.DriverType&&e.DriverType.Name,this.Callsign=e.Callsign}).top(10).execute().then(function(e){[].push.apply(t.fetchedDrivers,e)})}function y(e){t.fetchedClients.length=0,e&&a.Client.query().where("substringof('"+e+"', Name) or substringof('"+e+"', AccountNo)").select("Id,AccountNo,Name, ClientType/Name").include("ClientType").parseAs(function(e){this.Id=e.Id,this.Name="("+e.AccountNo+") "+e.Name,this.Description=e.ClientType&&e.ClientType.Name,this.AccountNo=e.AccountNo}).top(10).execute().then(function(e){[].push.apply(t.fetchedClients,e)})}function P(e){t.fetchedPassengers.length=0,e&&a.Passenger.query().where("substringof('"+e+"', concat(concat(Firstname, ' '), Surname))").select("Id,Firstname,Surname,Client/Name").include("Client").top(10).parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname,this.Description=e.Client&&e.Client.Name,this.Firstname=e.Firstname}).execute().then(function(e){[].push.apply(t.fetchedPassengers,e)})}function C(e){return"'"+e+"'"}t.vehicleTypes=c,t.fetchedDrivers=[],t.fetchedClients=[],t.fetchedPassengers=[],t.opened={},t.setPage=d,t.openCalendar=h,t.setupPageDefaults=u,t.searchClients=y,t.searchDrivers=m,t.searchPassengers=P,t.setValidFilter=p,t.sortResult=f,t.currentFilter=g,u()}var n=e.module("cab9.bookings");n.controller("BookingValidationController",t),t.$inject=["$scope","$state","$modal","$http","$filter","Model","$timeout","$UI","rVehicleTypes"]}(angular);;;;
!function(e){function n(n,t,o,a,s,l,c,r,u,g){function d(t){n.paging.loading=!0,n.paging.currentPage=t,n.filters.Skip=n.paging.resultsPerPage*(n.paging.currentPage-1);var o=e.copy(n.filters),a=["ClientIds","PaymentMethods","CardPaymentStatus"];a.map(function(e){o[e].length>0&&(o[e].map(function(n,t){o[e][t]=N(n)}),o[e]=o[e].join(","))}),s.get(l.API_ENDPOINT+"api/bookings/validation/fetch",{params:o}).success(function(e){n.paging.loading=!1,n.paging.totalResults=e.Stats.Bookings,n.paging.maxPages=Math.ceil(n.paging.totalResults/n.paging.resultsPerPage),n.bookings=e.Bookings,n.stats=e.Stats}).error(function(e){n.paging.loading=!1,swal("Error",e.Message,"error")})}function m(){n.filters={From:moment().subtract(1,"days").format("YYYY-MM-DD"),To:moment().format("YYYY-MM-DD"),DriverIds:[],ClientIds:[],PassengerIds:[],VehicleTypeIds:[],ClientStaffIds:[],PaymentMethods:["1"],BookingSources:[],Top:100,Skip:0,MinCost:null,MaxCost:null,MinProfit:null,MaxProfit:null,SortBy:"BookedDateTime",SearchTerm:null,ValidFilter:"NON",NoPaidInvoiced:!1,CardPaymentStatus:[]}}function p(e){e.$Expanded=!0,f(e)}function f(e){n.fetchingFinance=!0,s.get(l.API_ENDPOINT+"api/bookings/getbookingfinancedetails",{params:{bookingId:e.Id}}).success(function(t){e.$FinanceInfo=t,s.get(l.API_ENDPOINT+"api/Transactions/DetailedTransactions",{params:{bookingId:e.Id}}).success(function(t){e.$Transactions=t,n.fetchingFinance=!1})})}function P(e){e.$expanded=!0,e.Request=JSON.parse(e.Request),e.Response=JSON.parse(e.Response)}function I(){1==n.paging.allBookingsSelected?n.bookings.map(function(e){"Pending"!=e.CardPaymentStatus&&"Success"!=e.CardPaymentStatus&&(e.$Selected=!0)}):n.bookings.map(function(e){e.$Selected=!1})}function S(e,n){var o=t.open({templateUrl:"/webapp/common/modals/email-to.modal.html",controller:["$scope","emailAddress","$modalInstance",function(e,n,t){null!=n&&(e.email=n),e.sendEmail=function(){t.close(e.email)}}],resolve:{emailAddress:function(){var t=null;switch(e){case"RECEIPT":t=n.LeadPassengerEmail?n.LeadPassengerEmail:null}return t}}});o.result.then(function(t){null!=t&&"RECEIPT"==e&&s.post(l.API_ENDPOINT+"api/email",{Type:"PassengerBookingPaymentReceipt",BookingId:n.Id,EmailId:t}).success(function(){g.success("Email Sent")})})}function h(e){n.fetchedClients.length=0,e&&o.Client.query().where("substringof('"+e+"', Name) or substringof('"+e+"', AccountNo)").select("Id,AccountNo,Name, ClientType/Name").include("ClientType").parseAs(function(e){this.Id=e.Id,this.Name="("+e.AccountNo+") "+e.Name,this.Description=e.ClientType&&e.ClientType.Name,this.AccountNo=e.AccountNo}).top(10).execute().then(function(e){[].push.apply(n.fetchedClients,e)})}function y(){var e=n.bookings.filter(function(e){return 1==e.$Selected});if(e.length>0){n.paging.collectingPayments=!0,n.bar={Total:0,Success:0,Failure:0};var t=a.when();for(i=0;i<e.length;i++){var o=e[i];n.bar.Total+=1,t=t.then(function(){return console.log("Collecting Payment for "+this.LocalId),k(this)}.bind(o))}n.paging.collectingPayments=!1}else swal("No Bookings","Please select at least one booking","warning")}function k(e){return e.CardPaymentStatus="Pending",s({method:"POST",url:l.API_ENDPOINT+"api/Bookings/TakePayment?bookingId="+e.Id}).then(function(t){return console.log("Payment Succeeded for "+e.LocalId),e.CardPaymentStatus="Success",e.$Selected=!1,n.bar.Success+=1,a.when()},function(t){return console.error("Payment Failed for "+e.LocalId),e.CardPaymentStatus="Failure",e.$Selected=!1,n.bar.Failure+=1,a.when()})}function C(e,t){n.opened[t]=!0,e.preventDefault(),e.stopPropagation()}function N(e){return"'"+e+"'"}n.bookings=[],n.selectedBookings=[],n.opened={},n.fetchedClients=[],n.allBookingsSelected=!1,n.bar=null,n.paging={currentPage:1,resultsPerPage:100,totalResults:null,maxPages:null,loading:!0,allBookingsSelected:!1,collectingPayments:!1},n.filters={From:moment().subtract(1,"days").format("YYYY-MM-DD"),To:moment().format("YYYY-MM-DD"),DriverIds:[],ClientIds:[],PassengerIds:[],VehicleTypeIds:[],ClientStaffIds:[],PaymentMethods:["1"],BookingSources:[],Top:100,Skip:0,MinCost:null,MaxCost:null,MinProfit:null,MaxProfit:null,SortBy:"BookedDateTime",SearchTerm:null,ValidFilter:"VAL",NoPaidInvoiced:!1,CardPaymentStatus:[],NonDispute:!0},n.fetchBookings=d,n.openCalendar=C,n.searchClients=h,n.toggleSelect=I,n.takeAllPayments=y,n.expandBooking=p,n.expandTransaction=P,n.clearFilters=m,n.emailTo=S,n.cardPaymentStatuses=[],(new o.Booking).$$schema.CardPaymentStatus["enum"].forEach(function(e,t){n.cardPaymentStatuses.push({Id:t,Name:e})}),d(1)}var t=e.module("cab9.bookings");t.controller("CCBookingsController",n),n.$inject=["$scope","$modal","Model","$q","$http","$config","$rootScope","$compile","$timeout","Notification"]}(angular);;;;
!function(e){function o(e,o,n,t,i,c,s,l,r){function a(){e.fetching=!0,i.get(c.API_ENDPOINT+"api/bookings/repeat/").success(function(o){e.fetching=!1,e.bookings=o,e.bookings.map(function(e){e.$numberOfBookings=e.BookingsAttached.split("|").length,moment()<moment(e.CreationTime).add(15,"minutes")&&(e.$cancel=!0)})}).error(function(o){e.fetching=!1,swal("Error Fetching Repeat Bookings",o.Message,"error")})}function u(e){swal({title:"Confirm Cancel",text:"Are you sure you want to cancel this repeat booking? This will only effect the future bookings and will not cancel any existing bookings which are Completed or COA.",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm",showLoaderOnConfirm:!0,closeOnConfirm:!1},function(){i["delete"](c.API_ENDPOINT+"api/bookings/RemoveScheduled?scheduleId="+e).success(function(e){a(),swal("Scheduled Booking Cancelled","Your request to cancel a scheduled booking is successful. It could take upto 30 mins for all the scheduled bookings to be cancelled.","success")}).error(function(e){swal("Error Cancelling Repeat Bookings",e.Message,"error")})})}e.repeatBookings=[],a(),e.cancelRepeat=u}var n=e.module("cab9.bookings");n.controller("RepeatBookingsController",o),o.$inject=["$scope","$modal","Model","$q","$http","$config","$rootScope","$compile","$timeout"]}(angular);;;;
!function(e){function t(t,o,i,s,n,r,c,l,a,d,u,g,C,k,B,m,p,v,h,D){function I(){t.selectedBooking=new a.Booking,t.selectedBooking.BookingStops.length=0;var e=new a.BookingStop;t.selectedBooking.BookingStops.push(e),t.selectedBooking.Pax=1,t.selectedBooking.Bax=0,t.selectedBooking.TaxId=t.COMPANY.DefaultTaxId,1==t.COMPANY.ChauffeurModeActive&&(t.selectedBooking.ChauffeurMode=!0),t.selectedBooking.VehicleTypeId=l.defaultVehicleType,t.selectedBooking.VehicleClassId=l.defaultVehicleClass;var o=new moment.tz(m.timeZone().getTimeZone());t.selectedBooking.BookedDateTime=o.toDate(),t.selectedBooking.Time=o.startOf("minute").add(15,"minutes").toDate(),t.selectedBooking.CurrencyId=t.COMPANY.DefaultCurrencyId,t.EstimatedCost=0}function f(e){var o=t.selectedBooking.Passengers.filter(function(t){return t.Id==e})[0];if(o)return o.Firstname+" "+o.Surname}function E(){var e=new a.BookingStop;t.selectedBooking.BookingStops.push(e)}function y(){console.log(t.selectedBooking.BookingStops),o.post(i.API_ENDPOINT+"api/quote",t.selectedBooking).success(function(e){t.quote=e,t.selectedBooking.CurrencyId!=t.COMPANY.DefaultCurrencyId?(t.selectedBooking.EstimatedCost=p("Convert")(e.FinalCost),t.selectedBooking.ActualCost=p("Convert")(e.FinalCost),t.selectedBooking.DriverExclusions=p("Convert")(e.DriverExclusion),t.selectedBooking.DriverCost=p("Convert")(e.DriverCost),t.EstimatedCost=e.FinalCost,t.ActualCost=e.FinalCost,t.DriverCost=e.DriverCost,t.DriverExclusions=e.DriverExclusion):(t.selectedBooking.EstimatedMins=e.EstimatedMins,t.selectedBooking.EstimatedCost=e.FinalCost,t.selectedBooking.ActualCost=e.FinalCost,t.selectedBooking.DriverExclusions=e.DriverExclusion,t.selectedBooking.DriverCost=e.DriverCost,t.EstimatedCost=e.FinalCost,t.ActualCost=e.FinalCost,t.DriverCost=e.DriverCost,t.DriverExclusions=e.DriverExclusion)}).error(function(e){console.log(e)})}function T(e){var n=new moment(t.selectedBooking.Time).tz(m.timeZone().getTimeZone()),r=new moment(t.selectedBooking.BookedDateTime).format("YYYY-MM-DD")+"T"+n.format("HH:mm")+moment.tz(m.timeZone().getTimeZone()).format("Z");if("amount"!=t.discount.type){t.discount.type="amount";var c=t.selectedBooking.ActualCost*t.selectedBooking.Discount/100;t.selectedBooking.Discount=Math.round(100*c)/100}var l=t.selectedBooking,e={BookingStatus:"Confirmed",BookingSource:"Manual",BookedDateTime:r,Bax:l.Bax,Pax:l.Pax,EstimatedCost:l.EstimatedCost,ActualCost:l.ActualCost,DriverCost:l.DriverCost,InvoiceCost:l.InvoiceCost,VehicleClassId:l.VehicleClassId,VehicleTypeId:l.VehicleTypeId,DriverId:l.DriverId,VehicleId:l.VehicleId,ClientId:l.ClientId,BookingStops:t.selectedBooking.BookingStops,PassengerNotes:l.PassengerNotes,DriverNotes:l.DriverNotes,OfficeNotes:l.OfficeNotes,AutoDispatch:!l.DriverId,AsDirected:l.AsDirected,EncodedRoute:l.EncodedRoute,CurrencyId:l.CurrencyId,CurrencyRate:M.getCurrent().CurrentRate,TaxId:l.TaxId,Discount:l.Discount,ChauffeurMode:l.ChauffeurMode,EstimatedMins:l.EstimatedMins,EstimatedDuration:l.EstimatedDuration,EstimatedDistance:l.EstimatedDistance};if(t.paxMode.value){if(!l._LeadPassenger)return void swal("Invalid","Please add passenger details.","error");var a=l._LeadPassenger.split(" ");e.LeadPassenger={Firstname:a[0],Surname:a.slice(1).join(" "),Mobile:l._LeadPassengerNumber,ClientId:l.ClientId}}else{if(!l.LeadPassengerId)return void swal("Invalid","Please add passenger details.","error");e.LeadPassengerId=l.LeadPassengerId}e.CurrencyId&&t.COMPANY.DefaultCurrencyId!=e.CurrencyId&&(e.ActualCost=p("Convert")(e.ActualCost,t.COMPANY.DefaultCurrencyId,e.CurrencyId),e.EstimatedCost=p("Convert")(e.EstimatedCost,t.COMPANY.DefaultCurrencyId,e.CurrencyId),e.DriverCost&&(e.DriverCost=p("Convert")(e.DriverCost,t.COMPANY.DefaultCurrencyId,e.CurrencyId)),e.InvoiceCost&&(e.InvoiceCost=p("Convert")(e.InvoiceCost,t.COMPANY.DefaultCurrencyId,e.CurrencyId))),o.post(i.API_ENDPOINT+"api/bookings",e).success(function(e){swal("Success","Booking Saved","success"),s.go("root.bookings")}).error(function(){swal("Error","Something didn't work, please check input and try again","error")})}function A(e){c.Maps.Directions.route(e).then(function(e){t.directions.setDirections(e)})}function w(e){t.startNew(),M.setCurrent(t.COMPANY.DefaultCurrencyId)}var P=null;t.viewMode="CREATE",t.paxMode={value:!1},t.showTraffic=!1,t.selectedBooking=null,t.clients=d,t.vehicleTypes=g,t.vehicleClasses=C,t.passengers=u,t.drivers=k,t.vehicles=B,t.taxes=h,t.historic=[],t.setupComplete=!1,t.startNew=I,t.book=T,t.cancel=w,t.addStop=E,t.getQuote=y,t.getPassengerName=f,t.discount={type:"amount"},t.available=v;var M=m.currency();t.map={center:{latitude:t.COMPANY.BaseLatitude||51.471507,longitude:t.COMPANY.BaseLongitude||-.487904},disableDefaultUI:!0,styles:[{featureType:"landscape",stylers:[{hue:"#FFBB00"},{saturation:43.400000000000006},{lightness:37.599999999999994},{gamma:1}]},{featureType:"road.highway",stylers:[{hue:"#FFC200"},{saturation:-61.8},{lightness:45.599999999999994},{gamma:1}]},{featureType:"road.arterial",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:51.19999999999999},{gamma:1}]},{featureType:"road.local",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:52},{gamma:1}]},{featureType:"water",stylers:[{hue:"#0078FF"},{saturation:-13.200000000000003},{lightness:2.4000000000000057},{gamma:1}]},{featureType:"poi",stylers:[{hue:"#00FF6A"},{saturation:-1.0989010989011234},{lightness:11.200000000000017},{gamma:1}]}],zoom:t.COMPANY.BaseZoom||7,traffic:{show:!1,options:{}}},t.paxFilter=function(e){return!t.selectedBooking.ClientId||e.ClientId==t.selectedBooking.ClientId},t.directions={renderer:null,current:null,currentRoute:null,currentStep:null,setRoute:function(e){e!=this.currentRoute&&(this.currentRoute=e,this.currentStep=null,this.renderer.setRouteIndex(this.current.routes.indexOf(e)))},viewStep:function(e){this.currentStep=e,t.map.center.latitude=e.start_point.lat(),t.map.center.longitude=e.start_point.lng()},setDirections:function(e){this.current=e,this.currentStep=null,this.currentRoute=e?e.routes[0]:null,this.options.directions=e,e?(t.selectedBooking.EncodedRoute=this.currentRoute.overview_polyline,this.renderer?(this.renderer.setDirections(e),this.renderer.setMap(t.map.getGMap())):(this.options.map=t.map.getGMap(),this.renderer=new google.maps.DirectionsRenderer(this.options))):(this.current=null,this.options.directions=null,this.renderer&&this.renderer.setMap(null)),this.currentRoute&&this.currentRoute.legs&&this.currentRoute.legs[0]&&(t.selectedBooking.EstimatedDuration=10*Math.ceil(this.currentRoute.legs[0].duration.value/600),t.selectedBooking.EstimatedDistance=621371e-9*this.currentRoute.legs[0].distance.value)},options:{suppressInfoWindows:!0,suppressMarkers:!1,directions:null,panel:document.getElementById("google-directions")}},t.$watch("selectedBooking.AsDirected",function(e){if(e)t.selectedBooking.BookingStops.length--;else{var o=new a.BookingStop;t.selectedBooking.BookingStops.push(o)}}),t.$watch("selectedBooking.BookingStops",function(){if(t.selectedBooking.AsDirected);else if(t.selectedBooking.BookingStops.length<2)return t.selectedBooking.EstimatedCost=0,void(t.selectedBooking.validStops=!1);var o=!0;e.forEach(t.selectedBooking.BookingStops,function(e){e.Latitude&&e.Longitude||(o=!1)}),o?(A(t.selectedBooking.BookingStops.map(function(e){return new google.maps.LatLng(e.Latitude,e.Longitude)})),t.selectedBooking.validStops=!0,y()):(t.directions.setDirections(null),t.selectedBooking.EstimatedCost=0,t.selectedBooking.ActualCost=0,t.selectedBooking.DriverExclusions=0,t.selectedBooking.DriverCost=0,t.selectedBooking.Discount=0,t.selectedBooking.validStops=!1)},!0),t.$watch("selectedBooking.ClientId",function(){if(t.selectedBooking.ClientId){var e=t.clients.filter(function(e){return e.Id==t.selectedBooking.ClientId})[0];e&&(t.selectedBooking.CurrencyId=e.DefaultCurrencyId)}},!0),t.$watchGroup(["selectedBooking.BookingStops.length","selectedBooking.ClientId","selectedBooking.VehicleTypeId","selectedBooking.ChauffeurMode","selectedBooking.EstimatedMins"],function(){P&&(n.cancel(P),P=null),1==t.setupComplete&&(P=n(y,500))}),t.$watch("selectedBooking.VehicleTypeId",function(e){function o(e,t){return e?"http"==e.slice(0,4)?e:i.API_ENDPOINT+e:i.API_ENDPOINT+"api/imagegen?text="+t}a.Vehicle.query().select("Id,Registration,Colour,Make,Model,Class,Type").where("VehicleTypeId","==","guid'"+e+"'").include("Class,Type").parseAs(function(e){this.Id=e.Id,this.Name=e.Registration,this.Description=e.Colour+" "+e.Make+" "+e.Model,this.DriverId=e.DriverId,this.ImageUrl=o(e.ImageUrl,e.Registration)}).execute().then(function(e){t.vehicles=e})}),t.$watch("selectedBooking.CurrencyId",function(){M.setCurrent(t.selectedBooking.CurrencyId);var e=t.available.filter(function(e){return e.Id==t.selectedBooking.CurrencyId})[0];t.selectedBooking.CurrencyRate=e.CurrentRate,t.symbol=e.Prepend,t.selectedBooking.Currency=e,t.selectedBooking.ActualCost=Number(((t.ActualCost||0)*e.CurrentRate).toFixed(2)),t.selectedBooking.EstimatedCost=Number(((t.EstimatedCost||0)*e.CurrentRate).toFixed(2)),t.selectedBooking.DriverCost&&(t.selectedBooking.DriverCost=Number(((t.DriverCost||t.selectedBooking.DriverCost)*e.CurrentRate).toFixed(2))),t.selectedBooking.DriverExclusions&&(t.selectedBooking.DriverExclusions=Number(((t.DriverExclusions||t.selectedBooking.DriverExclusions)*e.CurrentRate).toFixed(2))),t.selectedBooking.InvoiceCost&&(t.selectedBooking.InvoiceCost=Number(((t.InvoiceCost||t.selectedBooking.InvoiceCost)*e.CurrentRate).toFixed(2))),"amount"==t.discount.type&&(t.selectedBooking.Discount=Number(((t.Discount||t.selectedBooking.Discount)*e.CurrentRate).toFixed(2))),t.setupComplete=!0}),t.startNew()}function o(t,o,i,s,n,r,c,l,a,d,u,g,C,k,B,m,p,n,v,h,D,I,f){function E(){var e=D.getSession().access_token,o=window.encodeURIComponent(s.API_ENDPOINT+"Exports/BookingReceipt/template.html#/?token="+e+"&bookingid="+t.selectedBooking.Id);h.open("http://h2p.utilities.e9ine.com/?url="+o+"&filename="+t.selectedBooking.Id,"_blank")}function y(e){c.Maps.Directions.route(e).then(function(e){t.directions.setDirections(e)})}function T(){t.viewMode="EDIT"}function A(){var e={ActualCost:t.selectedBooking.ActualCost,EstimatedCost:t.selectedBooking.EstimatedCost,DriverCost:t.selectedBooking.DriverCost,InvoiceCost:t.selectedBooking.InvoiceCost,DiscountCost:t.selectedBooking.DiscountCost};t.selectedBooking.$rollback(!0),t.selectedBooking.ActualCost=e.ActualCost,t.selectedBooking.EstimatedCost=e.EstimatedCost,t.selectedBooking.DriverCost=e.DriverCost,t.selectedBooking.InvoiceCost=e.InvoiceCost,t.selectedBooking.DiscountCost=e.DiscountCost,t.selectedBooking.Client?x.setCurrent(t.selectedBooking.Client.DefaultCurrencyId):x.setCurrent(t.COMPANY.DefaultCurrencyId),t.viewMode="VIEW"}function w(e){var o=t.selectedBooking.Passengers.filter(function(t){return t.Id==e})[0];if(o)return o.Firstname+" "+o.Surname}function P(){i({url:s.API_ENDPOINT+"api/bookings",params:{Id:t.selectedBooking.Id},method:"PATCH",data:{Id:t.selectedBooking.Id,BookingStatus:"Cancelled"}}).success(function(){t.selectedBooking.BookingStatus="Cancelled",swal("Booking Cancelled","This Booking has been cancelled","success")}).error(function(){swal("Error","Something didn't work, please check input and try again","error")})}function M(){var o=(t.selectedBooking.BookedDateTime,t.selectedBooking.Time),n=new moment(t.selectedBooking.Time).tz(p.timeZone().getTimeZone()),r=new moment(t.selectedBooking.BookedDateTime).format("YYYY-MM-DD")+"T"+n.format("HH:mm")+":00"+moment.tz(p.timeZone().getTimeZone()).format("Z");if(t.selectedBooking.BookedDateTime=r,t.selectedBooking.LeadPassenger=null,"amount"!=t.discount.type){t.discount.type="amount";var c=t.selectedBooking.ActualCost*t.selectedBooking.Discount/100;t.selectedBooking.Discount=Math.round(100*c)/100}t.EstimatedCost=t.selectedBooking.EstimatedCost,t.ActualCost=t.selectedBooking.ActualCost,t.DriverCost=t.selectedBooking.DriverCost,t.InvoiceCost=t.selectedBooking.InvoiceCost,t.DiscountCost=t.selectedBooking.Discount,t.selectedBooking.ActualCost=t.selectedBooking.ActualCost/t.selectedBooking.CurrencyRate,t.selectedBooking.DriverCost=t.selectedBooking.DriverCost/t.selectedBooking.CurrencyRate,t.selectedBooking.EstimatedCost=t.selectedBooking.EstimatedCost/t.selectedBooking.CurrencyRate,t.selectedBooking.InvoiceCost=t.selectedBooking.InvoiceCost/t.selectedBooking.CurrencyRate,t.selectedBooking.Discount=t.selectedBooking.Discount/t.selectedBooking.CurrencyRate,delete t.selectedBooking.Time;var l=e.copy(t.selectedBooking);delete l.Currency,delete l.Client,delete l.Time,delete l.Vehicle,delete l.LeadPassenger,i.put(s.API_ENDPOINT+"api/bookings",l,{params:{Id:l.Id}}).success(function(){t.selectedBooking.BookedDateTime=new moment(t.selectedBooking.BookedDateTime).format(),swal("Booking Updated","This Booking has been updated","success"),t.viewMode="VIEW",t.selectedBooking.ActualCost=t.ActualCost,t.selectedBooking.DriverCost=t.DriverCost,t.selectedBooking.EstimatedCost=t.EstimatedCost,t.selectedBooking.InvoiceCost=t.InvoiceCost,t.selectedBooking.Discount=t.DiscountCost,t.selectedBooking.Time=o}).error(function(){t.selectedBooking.BookedDateTime=new moment(t.selectedBooking.BookedDateTime).format(),swal("Error","Something didn't work, please check input and try again","error"),t.selectedBooking.ActualCost=t.ActualCost,t.selectedBooking.DriverCost=t.DriverCost,t.selectedBooking.EstimatedCost=t.EstimatedCost,t.selectedBooking.InvoiceCost=t.InvoiceCost,t.selectedBooking.Discount=t.DiscountCost,t.selectedBooking.Time=o})}function N(){i.post(s.API_ENDPOINT+"api/quote",t.selectedBooking).success(function(e){t.EstimatedCost=e.FinalCost,t.selectedBooking.EstimatedCost=Number((t.EstimatedCost*t.selectedBooking.CurrencyRate).toFixed(2)),t.selectedBooking.EstimatedMins=e.EstimatedMins}).error(function(e){console.log(e)})}t.viewMode="VIEW";var R=null;t.showTraffic=!1,t.setupComplete=!1,t.paxMode={value:!1},t.discount={type:"amount"},t.selectedBooking=d,t.selectedBooking.BookedDateTime=new Date(t.selectedBooking.BookedDateTime);var S=new moment(d.BookedDateTime);S.tz(p.timeZone().getTimeZone()),t.selectedBooking.Time=S.startOf("minute").toDate(),t.selectedBooking.$commit(!0),t.selectedBooking.BookingStops.map(function(e){e.id=idCounter++}),t.clients=u,t.vehicleTypes=g,t.vehicleClasses=C,t.drivers=k,t.vehicles=B,t.passengers=m,t.taxes=v,t.symbol=t.selectedBooking.Currency.Prepend,t.startEdits=T,t.cancel=A,t.save=M,t.cancelBooking=P,t.getPassengerName=w,t.EstimatedCost=t.selectedBooking.EstimatedCost,t.ActualCost=t.selectedBooking.ActualCost,t.DriverCost=t.selectedBooking.DriverCost,t.InvoiceCost=t.selectedBooking.InvoiceCost,t.Discount=t.selectedBooking.Discount,t.selectedBooking.ActualCost=t.ActualCost*t.selectedBooking.CurrencyRate,t.selectedBooking.DriverCost=t.DriverCost*t.selectedBooking.CurrencyRate,t.selectedBooking.EstimatedCost=t.EstimatedCost*t.selectedBooking.CurrencyRate,t.selectedBooking.InvoiceCost=t.InvoiceCost*t.selectedBooking.CurrencyRate,t.selectedBooking.Discount=t.Discount*t.selectedBooking.CurrencyRate,t.selectedBooking.ActualCost&&(t.selectedBooking.ActualCost=Number(t.selectedBooking.ActualCost.toFixed(2))),t.selectedBooking.DriverCost&&(t.selectedBooking.DriverCost=Number(t.selectedBooking.DriverCost.toFixed(2))),t.selectedBooking.EstimatedCost&&(t.selectedBooking.EstimatedCost=Number(t.selectedBooking.EstimatedCost.toFixed(2))),t.selectedBooking.InvoiceCost&&(t.selectedBooking.InvoiceCost=Number(t.selectedBooking.InvoiceCost.toFixed(2))),t.selectedBooking.Discount&&(t.selectedBooking.Discount=Number(t.selectedBooking.Discount.toFixed(2))),t.getQuote=N;var x=p.currency();t.exportReceipt=E,t.paxFilter=function(e){return!t.selectedBooking.ClientId||e.ClientId==t.selectedBooking.ClientId},t.map={center:{latitude:t.COMPANY.BaseLatitude||51.471507,longitude:t.COMPANY.BaseLongitude||-.487904},disableDefaultUI:!0,styles:[{featureType:"landscape",stylers:[{hue:"#FFBB00"},{saturation:43.400000000000006},{lightness:37.599999999999994},{gamma:1}]},{featureType:"road.highway",stylers:[{hue:"#FFC200"},{saturation:-61.8},{lightness:45.599999999999994},{gamma:1}]},{featureType:"road.arterial",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:51.19999999999999},{gamma:1}]},{featureType:"road.local",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:52},{gamma:1}]},{featureType:"water",stylers:[{hue:"#0078FF"},{saturation:-13.200000000000003},{lightness:2.4000000000000057},{gamma:1}]},{featureType:"poi",stylers:[{hue:"#00FF6A"},{saturation:-1.0989010989011234},{lightness:11.200000000000017},{gamma:1}]}],zoom:t.COMPANY.BaseZoom||7,traffic:{show:!1,options:{}}},t.directions={renderer:null,current:null,currentRoute:null,currentStep:null,setRoute:function(e){e!=this.currentRoute&&(this.currentRoute=e,this.currentStep=null,this.renderer.setRouteIndex(this.current.routes.indexOf(e)))},viewStep:function(e){this.currentStep=e,t.map.center.latitude=e.start_point.lat(),t.map.center.longitude=e.start_point.lng()},setDirections:function(e){this.current=e,this.currentStep=null,this.currentRoute=e?e.routes[0]:null,this.options.directions=e,e?(t.selectedBooking.EncodedRoute=this.currentRoute.overview_polyline,this.renderer?(this.renderer.setDirections(e),this.renderer.setMap(t.map.getGMap())):(this.options.map=t.map.getGMap(),this.renderer=new google.maps.DirectionsRenderer(this.options))):(this.current=null,this.options.directions=null,this.renderer&&this.renderer.setMap(null))},options:{suppressInfoWindows:!0,suppressMarkers:!1,directions:null,panel:document.getElementById("google-directions")}},t.$watchGroup(["selectedBooking.BookingStops.length","selectedBooking.ClientId","selectedBooking.VehicleTypeId","selectedBooking.ChaffuerMode","selectedBooking.EstimatedMins"],function(){return 0==t.setupComplete?void(t.setupComplete=!0):(R&&(r.cancel(R),R=null),void(R=r(N,500)))}),t.$watch("selectedBooking.BookingStops",function(){if("EDIT"===t.viewMode){if(t.selectedBooking.AsDirected);else if(t.selectedBooking.BookingStops.length<2)return t.selectedBooking.EstimatedCost=0,void(t.selectedBooking.validStops=!1);var o=!0;e.forEach(t.selectedBooking.BookingStops,function(e){e.Latitude&&e.Longitude||(o=!1)}),o?(y(t.selectedBooking.BookingStops.map(function(e){return new google.maps.LatLng(e.Latitude,e.Longitude)})),t.selectedBooking.validStops=!0):(t.directions.setDirections(null),t.selectedBooking.EstimatedCost=0,t.selectedBooking.validStops=!1)}},!0),y(t.selectedBooking.BookingStops.map(function(e){return new google.maps.LatLng(e.Latitude,e.Longitude)})),t.emailTo=function(e,t){var o=f.open({templateUrl:"/webapp/common/modals/email-to.modal.html",controller:["$scope","emailAddress","$modalInstance",function(e,t,o){null!=t&&(e.email=t),e.sendEmail=function(){o.close(e.email)}}],resolve:{emailAddress:function(){var o=null;switch(e){case"DRIVER":o=t.Driver?t.Driver.Email:null;break;case"PAX":o=t.LeadPassenger?t.LeadPassenger.Email:null;break;case"CLIENT":o=t.Client?t.Client.Email:null}return o}}});o.result.then(function(o){null!=o&&(swal("Success","User will receive the email soon..","success"),"DRIVER"==e?i.post(s.API_ENDPOINT+"api/email",{Type:"DriverConfirmation",BookingId:t.Id,DriverId:t.DriverId,EmailId:o}).success(function(){I.success("Email Sent")}):"PAX"==e?i.post(s.API_ENDPOINT+"api/email",{Type:"PassengerConfirmation",BookingId:t.Id,PassengerId:t.LeadPassengerId,EmailId:o}).success(function(){I.success("Email Sent")}):"CLIENT"==e&&i.post(s.API_ENDPOINT+"api/email",{Type:"ClientConfirmation",BookingId:t.Id,ClientId:t.ClientId,EmailId:o}).success(function(){I.success("Email Sent")}))})}}var i=e.module("cab9.bookings");i.controller("BookingCreateController",t),i.controller("BookingEditController",o),t.$inject=["$scope","$http","$config","$state","$timeout","Auth","Google","$tenantConfig","Model","rClients","rPassengers","rVehicleTypes","rVehicleClasses","rDrivers","rVehicles","Localisation","$filter","rCurrencies","rTaxes","$window"],o.$inject=["$scope","$q","$http","$config","$filter","$timeout","Google","$tenantConfig","Model","rBooking","rClients","rVehicleTypes","rVehicleClasses","rDrivers","rVehicles","rPassengers","Localisation","$filter","rTaxes","$window","Auth","Notification","$modal"]}(angular);;;;
!function(e){function n(n,o,t,i,a,l,s,r,d,u,c,g,p,f,m,h,k,C){function b(){n._dbooking.ChauffeurMode=!0,n._dbooking.EstimatedMins="60"}function I(){n._dbooking.ChauffeurMode=!1,n._dbooking.EstimatedMins=null}function T(){var e=t.open({templateUrl:"/webapp/common/modals/add-payment-card/partial.html",controller:"AddPaymentCardController",windowClass:"add-payment-card-modal-wrapper",resolve:{rPassengerId:function(){return n._dbooking.LeadPassengerId},rClientId:function(){return null},rDriverId:function(){return null}}});e.result.then(function(e){n.card={Id:e.Id,Name:e.CardNumber,Description:e.Type.toUpperCase()+" - Expiring "+e.ExpirationMonth+"/"+e.ExpirationYear},n.filteredPaymentCards.push(n.card),n._dbooking.PaymentCardId=e.Id})}function y(e){"add-passenger"!==n._dbooking.LeadPassengerId&&(n.searchText=e)}function _(){var e=n._dbooking.BookingStops[0];n._dbooking.BookingStops[0]=n._dbooking.BookingStops[1],n._dbooking.BookingStops[1]=e;for(var o=0;o<n._dbooking.BookingStops.length;o++)n._dbooking.BookingStops[o].StopOrder=o+1}function A(e){for(var n="[a-z]",o="[A-Z]",t="[0-9]",i="^",a=0,l=!1,s=!1,r=0;r<e.length;r++){var d=e[r];if("'"===d)i+=s?")":"(",s=!s;else if(s)["."].indexOf(d)!=-1&&(d="\\"+d),i+=d;else if(">"===d){if(a++,a>1)throw"Bad Mask - Case blocks have consecutive > without ending previous block"}else if("<"===d){if(a--,a<-1)throw"Bad Mask - Case blocks have consecutive < without ending previous block"}else"0"===d?(l=!0,i+="("+t+")"):"9"===d?i+="("+t+"?)":1===a?"A"===d?(l=!0,i+="("+o+"|"+t+")"):"a"===d?i+="("+o+"?|"+t+"?)":"L"===d?(l=!0,i+="("+o+")"):"l"===d&&(i+="("+o+"?)"):0===a?"A"===d?(l=!0,i+="("+n+"|"+o+"|"+t+")"):"a"===d?i+="("+n+"?|"+o+"?|"+t+"?)":"L"===d?(l=!0,i+="("+n+"|"+o+")"):"l"===d&&(i+="("+n+"?|"+o+"?)"):a===-1&&("A"===d?(l=!0,i+="("+n+"|"+t+")"):"a"===d?i+="("+n+"?|"+t+"?)":"L"===d?(l=!0,i+="("+n+")"):"l"===d&&(i+="("+n+"?)"))}if(s)throw"Bad Mask - Quoted section not terminated";if(!l)throw"Bad Mask - Must contain at least 1 mandatory symbol (A, L, 0)";return i+="$",new RegExp(i)}function v(e){e&&e.length>2?n.fetchedClients=p("filter")(n.clients,{Name:e}):n.fetchedClients=[]}function w(){n._dbooking.Coupon=n._dbooking.$Coupon,W(n._dbooking)}function P(e){n._dbooking.WaitAndReturn&&n._dbooking.BookingStops.length<4?swal("Cannot remove via Stop","WaitAndReturn booking should have a via stop","warning"):n._dbooking.BookingStops.splice(e,1),n._dbooking.BookingStops.length<3&&(n.sortableOptions.disabled=!0)}function B(o){n.fetchedPassengers.length=0,c.get(i.API_ENDPOINT+"api/Passengers/Search",{params:{searchText:o,clientId:n._dbooking.ClientId}}).success(function(o){e.forEach(o,function(e){e.Client&&(e.Client.ImageUrl=u.formatUrl(e.Client.ImageUrl,e.Client.Name)),n.fetchedPassengers.push({Id:e.Id,ClientId:e.ClientId,Name:e.Firstname+" "+e.Surname,Description:e.Client&&e.Client.Name?e.Client.Name:"No Client",Mobile:e.Mobile,Phone:e.Phone,Addresses:e.Addresses,DefaultVehicleTypeId:e.DefaultVehicleTypeId,ImageUrl:u.formatUrl(e.ImageUrl,e.Firstname)})}),n.fetchedPassengers.push({Id:"add-passenger",Name:"Add Passenger",Description:"Create New Passenger",ImageUrl:"/includes/images/add-icon.png"})})}function O(o){n._dbooking.ClientId&&(n.filteredBookers.length=0,c.get(i.API_ENDPOINT+"api/Bookers/Search",{params:{searchText:o,clientId:n._dbooking.ClientId}}).success(function(o){e.forEach(o,function(e){e.Client&&(e.Client.ImageUrl=u.formatUrl(e.Client.ImageUrl,e.Client.Name)),n.filteredBookers.push({Id:e.Id,ClientId:e.ClientId,Name:e.Firstname+" "+e.Surname,Description:e.Client&&e.Client.Name?e.Client.Name:"No Client",Mobile:e.Mobile,ImageUrl:u.formatUrl(e.ImageUrl,e.Firstname)})}),n.filteredBookers.push({Id:"add-booker",Name:"Add Booker",Description:"Create New Booker",ImageUrl:"/includes/images/add-icon.png"})}))}function D(e,o){var t=d.timeZone().getTimeZone(),i=(new Date).getTimezoneOffset(),a=moment.tz.zone(t).offset(new Date),l=new moment.tz(t).add(i-a,"minutes");"day"==o?n._dbooking.Date=l.add(e,"minutes").toDate():"time"==o&&(n._dbooking.Time=l.startOf("minute").add(e,"minutes").toDate())}function S(){n.flightData={Number:"",DateTime:null,MinsAfterLanding:0,GetDate:function(e){var n=this.DateTime&&new moment(this.DateTime).add(this.MinsAfterLanding||0,"minute");return e?n.format(e):n}};var e=n._dbooking=new l.Booking;n.displayMode="CREATE",e.BookingStops=[],e.BookingValidations=[],e.BookingStops.push(new l.BookingStop),e.BookingStops.push(new l.BookingStop),e.TaxId=n.COMPANY.DefaultTaxId,e.Pax=n.company.DefaultPax,e.Bax=n.company.DefaultBax,e.PaymentMethod="Cash",e.AsDirected=!1;var o=d.timeZone().getTimeZone()||"Europe/London",t=(new Date).getTimezoneOffset(),i=moment.tz.zone(o).offset(new Date),a=new moment.tz(o).add(t-i,"minutes");e.Date=a.toDate(),e.Time=new Date(a.startOf("minute").add(15,"minutes").format()),e.CurrencyId=n.COMPANY.DefaultCurrencyId,e.EstimatedCost=0,e.TextConfirmation=n.company.TextConfirmation,e.EmailConfirmation=n.company.EmailConfirmation,e.TextOnArrival=n.company.TextOnArrival,e.CallOnArrival=n.company.CallOnArrival,e.TextAssigned=n.company.TextAssigned,e.EmailAssigned=n.company.EmailAssigned,e.TextOnCompletion=n.company.TextOnCompletion,e.TextOnOnRoute=n.company.TextOnOnRoute,e._AutoDispatchOffset=15,n.repeatSchedule=new l.RepeatBooking}function L(){var e=[];n.dataReady=!1;var o=l.Client.query().where("Active eq true").select("Id,Name,AccountNo,AccountPassword,DefaultCurrencyId,ImageUrl,OnHold,Priority,AutoDispatch,ClientType/Name,ClientReferences,Tags,AllVehicleTypeAccess,Phone,DefaultPaymentType,DefaultVehicleTypeId,TextConfirmation,EmailConfirmation,TextOnArrival,CallOnArrival,TextAssigned,EmailAssigned,TextOnCompletion,TextOnOnRoute").include("ClientType,ClientReferences,Tags").parseAs(function(e){this.Id=e.Id,this.Name=(e.AccountNo?e.AccountNo+" - ":"")+e.Name,this.DefaultCurrencyId=e.DefaultCurrencyId,this.Description=e.ClientType.Name,this.Phone=e.Phone,this.OnHold=e.OnHold,this.AccountPassword=e.AccountPassword,this.ImageUrl=u.formatUrl(e.ImageUrl,e.Name),this.AllVehicleTypeAccess=e.AllVehicleTypeAccess,this.DefaultPaymentType=e.DefaultPaymentType,this.DefaultVehicleTypeId=e.DefaultVehicleTypeId,this.TextConfirmation=e.TextConfirmation,this.EmailConfirmation=e.EmailConfirmation,this.TextOnArrival=e.TextOnArrival,this.CallOnArrival=e.CallOnArrival,this.TextAssigned=e.TextAssigned,this.EmailAssigned=e.EmailAssigned,this.TextOnCompletion=e.TextOnCompletion,this.TextOnOnRoute=e.TextOnOnRoute,this.Priority=e.Priority,this.AutoDispatch=e.AutoDispatch,this.Tags=e.Tags,this.ClientReferences=e.ClientReferences.filter(function(e){return e.Active}).map(function(e){return{Id:e.Id,ReferenceName:e.ReferenceName,Mandatory:e.Mandatory,AllowAddToList:e.AllowAddToList,Value:e.Value,ReferenceType:e.ReferenceType,ShowList:e.ShowList}})}).execute().then(function(e){n.clients=e}),t=l.VehicleType.query().parseAs(function(e){this.Id=e.Id,this.Name=e.Name,this.Description=e.Description,this.IsDefault=e.IsDefault,this.Priority=e.Priority,this.Order=e.Order,this.ImageUrl=null}).execute().then(function(e){n.filteredVehicleTypes=n.vehicleTypes=e.sort(function(e,n){return(e.Order||99)-(n.Order||99)})}),i=l.BookingRequirement.query().execute().then(function(e){n.bookingRequirements=n.unlinkedRequirements=e});e.push(o),e.push(t),e.push(i),a.all(e).then(function(){n.dataReady=!0})}function x(e,n){n?c({method:"GET",url:i.API_ENDPOINT+"/api/ClientReferences/suggest?ClientReferenceId="+e.Id+"&Value="+n}).then(function(n){e.$suggested=n.data.map(function(e){return{custom:!1,text:e}}),e.AllowAddToList&&e.$suggested.push({custom:!0,text:"Add '{{$select.search}}' to References"})},function(n){e.$suggested=[]}):e.$suggested=[]}function N(e,t,a){e.custom&&(e.text=t,swal({title:"Add New Reference?",text:"Are you sure you want to add '"+t+"' to the list of known '"+a.ReferenceName+"' references?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, Add it!",cancelButtonText:"Cancel",closeOnConfirm:!1,closeOnCancel:!1},function(e){e?c.post(i.API_ENDPOINT+"/api/clientreferences/add?ClientReferenceId="+a.Id+"&ClientReferenceKnownValue="+t).then(function(e){swal({title:"Client Reference Updated.",text:"Changes have been updated.",type:"success",confirmButtonColor:o.COLOURS.brandSecondary})},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:o.COLOURS.brandSecondary}),a.$knownValue=null}):(a.$knownValue=null,swal.close(),n.$apply())}))}function E(e,o){var t=n._dbooking.Tags.find(function(n){return n.Id==e.Id});if(!t){n._dbooking.Tags.push(e);var i=n.unlinkedTags.find(function(n){return n.Id==e.Id});i&&n.unlinkedTags.splice(n.unlinkedTags.indexOf(i),1),n._dbooking.$selectedTag=null,o.selected=null}}function R(e){n.unlinkedTags.push(e);var o=n._dbooking.Tags.find(function(n){return n.Id==e.Id});o&&n._dbooking.Tags.splice(n._dbooking.Tags.indexOf(o),1),n._dbooking.$selectedTag=null}function M(e){n._dbooking.BookingRequirements.push(e);var o=n.unlinkedRequirements.filter(function(n){return n.Id==e.Id});o[0]&&n.unlinkedRequirements.splice(n.unlinkedRequirements.indexOf(o[0]),1),n._dbooking.$selectedRequirement=null}function V(e){n.unlinkedRequirements.push(e);var o=n._dbooking.BookingRequirements.filter(function(n){return n.Id==e.Id});o[0]&&n._dbooking.BookingRequirements.splice(n._dbooking.BookingRequirements.indexOf(o[0]),1)}function q(){if(n.clientReferences.length>0)for(var e=0;e<n.clientReferences.length;e++){var o=n.clientReferences[e];if("Mask"==o.ReferenceType)return!(o.$testReg.test(o.$knownValue)||!o.$knownValue&&!o.Mandatory)}return!1}function U(){n._dbooking.BookingStops.reverse()}function F(e,n,o){function t(e,n){var o="000000000"+e;return o.substr(o.length-n)}e||(e=new Date);var i=e.getFullYear(),a=e.getMonth(),e=e.getDate(),l=n.getHours(),s=n.getMinutes(),r=t(i,4)+"-"+t(a+1,2)+"-"+t(e,2)+"T"+t(l,2)+":"+t(s,2)+":00",u=moment.tz(r,"YYYY-MM-DDTHH:mm:ss",d.timeZone().getTimeZone()).subtract(o||0,"minutes").format();return u}function Q(e){moment(n._dbooking.BookedDateTime).isBefore(moment.utc(),"minute")?swal({title:"Booking in the Past",text:"The booking date & time are in the past. Are you Sure?",type:"warning",showCancelButton:!0,closeOnConfirm:!0,closeOnCancel:!0},function(n){n&&j(e)}):j(e)}function j(e){$("#bookingsave").prop("disabled",!0),$("#bookingrepeat").prop("disabled",!0);var t=!1;if(n.week.filter(function(e){return 1==e.selected}).length>0){if(null==n.repeatSchedule.EndDate||null==n.repeatSchedule.Label||0==n.repeatSchedule.Label.length)return swal({title:"Scheduled Booking Error",text:"Scheduled booking should have a label and an end date.",type:"error",confirmButtonColor:o.COLOURS.brandSecondary}),$("#bookingsave").prop("disabled",!1),void $("#bookingrepeat").prop("disabled",!1);t=!0,n.repeatSchedule.DaysOfWeek=n.week.reduce(function(e,n){return n.selected?e+n.value:e},0)}e?$("#bookingrepeat").html("<i class='fa fa-circle-o-notch fa-spin'></i> Saving..."):$("#bookingsave").html("<i class='fa fa-circle-o-notch fa-spin'></i> Saving..."),n.dataReady=!1;var s=[];n.dataReady=!0,n.newBooker&&n.newBooker.Id==n._dbooking.ClientStaffId&&(n.newBooker.Passengers=[],n.newBooker.Passengers.push(n.selectedPassenger),c.post(i.API_ENDPOINT+"api/ClientStaff/ManagePassengers",n.newBooker).then(function(e){},function(e){swal({title:"Error adding passenger to booker",text:"Some error has occured.",type:"error",confirmButtonColor:o.COLOURS.brandSecondary})}));var r=n._dbooking;if(r.$$originalValues.Id=null,n.paxMode.value){if(!r._LeadPassenger)return void swal("Invalid","Please add passenger details.","error");var d=r._LeadPassenger.split(" ");n._dbooking.LeadPassenger={Firstname:d[0],Surname:d.slice(1).join(" "),Mobile:r._LeadPassengerNumber,ClientId:r.ClientId}}if(n._dbooking.BookingValidations=[],n.clientReferences.length>0)for(var u=0;u<n.clientReferences.length;u++){var g=n.clientReferences[u],p=new l.BookingValidation;p.ClientReferenceId=g.Id,"List"==g.ReferenceType?p.Value=g.$knownValue&&g.$knownValue.text:p.Value=g.$knownValue,p.Value&&n._dbooking.BookingValidations.push(p)}if(n._dbooking.BookingTags=[],n._dbooking.Tags&&n._dbooking.Tags.length>0&&n._dbooking.Tags.forEach(function(e){var o={TagId:e.Id,Type:e.Type};n._dbooking.BookingTags.push(o)}),n._dbooking.FlightInfo){n._dbooking.FlightInfo.MinsAfterLanding=n.flightData.MinsAfterLanding;var f=n.flightData.GetDate().toDate();n._dbooking.BookedDateTime=F(f,f)}else n._dbooking.BookedDateTime=F(n._dbooking.Date,n._dbooking.Time);n._dbooking.AutoDispatch&&(n._dbooking.DispatchDateTime=F(n._dbooking.Date,n._dbooking.Time,n._dbooking._AutoDispatchOffset)),1==t?s.push(c.post(i.API_ENDPOINT+"/api/bookings/CreateScheduled",{Schedule:n.repeatSchedule,Booking:n._dbooking})):s.push(n._dbooking.$save()),a.all(s).then(function(t){var i=t[t.length-1].data.LocalId;swal({title:"Booking Saved.",text:"Booking Reference: #"+i,type:"success",confirmButtonColor:o.COLOURS.brandSecondary}),$("#bookingsave").prop("disabled",!1),$("#bookingrepeat").prop("disabled",!1),n.phoneCall=null,e?(n.dataReady=!0,$("#bookingrepeat").html("<i class='material-icons'>repeat_one</i>Save &amp; Repeat")):(z(),n.dataReady=!0,$("#bookingsave").html("<i class='material-icons'>send</i>Save"))},function(e){n.dataReady=!0,e.data&&e.data.Message?swal({title:"Some Error Occured.",text:e.data.Message,type:"error"}):swal({title:"Some Error Occured.",text:"Something went wrong. Cab9 team have been alrerted.",type:"error"}),$("#bookingsave").prop("disabled",!1),$("#bookingrepeat").prop("disabled",!1),$("#bookingsave").html("<i class='material-icons'>send</i>Save"),$("#bookingrepeat").html("<i class='material-icons'>repeat_one</i>Save &amp; Repeat")})}function z(){H(),S(),ie=null,n.paxMode.value=!1,n.paxHistory=null,ae&&(ae.setMap(null),ae=null)}function Y(e){var o=new l.BookingStop;o.id=idCounter++,n._dbooking.WaitAndReturn?n._dbooking.BookingStops.splice(e,0,o):n._dbooking.BookingStops.splice(e+1,0,o),n._dbooking.BookingStops.length>2&&(n.sortableOptions.disabled=!1)}function G(){n._dbooking.FlightInfo=null,n.flightData.Number.length>0?c({url:i.API_ENDPOINT+"/api/flightinfo/getflightinfo",method:"GET",params:{flightno:n.flightData.Number,flightDate:F(n._dbooking.Date,n._dbooking.Time)}}).then(function(e){if(e.data){e.data.Id=null,e.data.BookingId=null,e.data.TenantId=null,e.data.MinsAfterLanding=n.flightData.MinsAfterLanding,n._dbooking.FlightInfo=new l.FlightInfo(e.data);var o=d.timeZone().getTimeZone(),t=moment(n._dbooking.FlightInfo.ArrivalTime).toDate(),i=t.getTimezoneOffset(),a=moment.tz.zone(o).offset(t),s=new moment.tz(n._dbooking.FlightInfo.ArrivalTime,o).add(i-a,"minutes");if(n.flightData.DateTime=s,n._dbooking.Time=s.toDate(),n.timeSet=!0,e.data.SuggestedAddressId&&n._dbooking.BookingStops[0].$$Id!=e.data.SuggestedAddressId){var r=e.data.SuggestedAddressId;l.Location.query().where("Id eq guid'"+e.data.SuggestedAddressId+"'").execute().then(function(e){var o=new l.BookingStop;o.Address1=e[0].Name?e[0].Name:"",o.StopSummary=e[0].Name?e[0].Name:"",o.Latitude=e[0].Latitude?e[0].Latitude:null,o.Longitude=e[0].Longitude?e[0].Longitude:null,o.$$Id=r,center_moved=!1,n._dbooking.BookingStops[0]=o})}}else swal("Flight Not Found","Please check flight number.","warning")},function(e){swal("Incorrect Flight Number","Please check flight number.","warning")}):swal("Incorrect Flight Number","Please check flight number.","warning")}function H(){ae&&(ae.setMap(null),ae=null),e.forEach(te,function(e){e.setMap(null)}),te.length=0}function W(e){n.dataReady=!1,ae&&(ae.setMap(null),ae=null),e.BookedDateTime=F(n._dbooking.Date||new Date,n._dbooking.Time),e.BookingStatus="Incoming";for(var o=0;o<n._dbooking.BookingStops.length;o++)n._dbooking.BookingStops[o].StopOrder=o+1;c.post(i.API_ENDPOINT+"api/quote",e).success(function(t){if(t.Error?(n.quote=t,e.EstimatedCost=0,e.EstimatedDistance=0,e.EstimatedDuration=0,e.ActualCost=0,n.dataReady=!0,n.directions=null):(e.EstimatedCost=t.FinalCost,e.EstimatedDistance=t.EstimatedDistance.toFixed(2),e.EstimatedDuration=t.EstimatedMins,e.ActualCost=t.FinalCost,n.dataReady=!0,n.directions=t.Directions,n.quote=t,e._AutoDispatchOffset=Math.max(15,t.DispatchOffset||15)),t.Directions&&t.Directions.EncodedRoute){var i=google.maps.geometry.encoding.decodePath(t.Directions.EncodedRoute);ae?ae.setPath(i):ae=new google.maps.Polyline({map:n.dispatchObj.map.mapObject,path:i,geodesic:!0,strokeColor:"#63C4E1",strokeOpacity:.8,strokeWeight:6});var a=new google.maps.LatLngBounds;for(o=0;o<i.length;o++)a.extend(i[o]);g(function(){n.dispatchObj.map.mapObject.fitBounds(a)},500)}else ae&&(ae.setMap(null),ae=null)}).error(function(e){n.dataReady=!0,swal("Could not quote","Could not quote, please manually price and set driver payment amount for this booking.","warning")})}function Z(o){n.journeyCopied=!1,n._dbooking.BookingStops=[],n._dbooking.BookingStops=e.copy(o.BookingStops).map(function(e){return e.Id=null,e.BookingId=null,e.Booking=null,e}),n.journeyCopied=!0,n._dbooking.BookingStops.length>2?n.sortableOptions.disabled=!1:n.sortableOptions.disabled=!0}function K(e){c.post(i.API_ENDPOINT+"api/clientreferences/validate?ClientReferenceId="+e.Id+"&ReferenceValue="+e.$knownValue).then(function(o){e.$valid=!0,n.validReference=!0},function(t){return 404==t.status?(n.validReference=!1,void(e.$valid=!1)):void swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:o.COLOURS.brandSecondary})})}function J(){var e=new google.maps.LatLng(51.49638419822335,(-.12875142186092203));n.dispatchObj.map.mapObject=new google.maps.Map(document.getElementById("dispatch-map"),{center:e,zoom:11,maxZoom:16,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},panControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},mapTypeControlOptions:{position:google.maps.ControlPosition.TOP_CENTER}})}function X(){var e=JSON.parse(n._dbooking.$selectedCaller);e.$Description?(n.fetchedPassengers.push(e),n._dbooking.LeadPassengerId=e.Id):(n.fetchedClients=p("filter")(n.clients,{Id:e.Id}),n._dbooking.LeadPassengerId=null,n._dbooking.ClientId=e.Id)}function ee(){n.phoneCall&&(n._dbooking.Calls=[],n._dbooking.Calls.push(n.phoneCall))}function ne(e,o){n.opened[o]=!0,e.preventDefault(),e.stopPropagation()}n.company=f[0],n.bookingTags=n.unlinkedTags=C,S(),L();n.current={tab:"Client"},n.opened={},n.week=[{day:"Su",value:1,selected:!1,full:"Sunday"},{day:"Mo",value:2,selected:!1,full:"Monday"},{day:"Tu",value:4,selected:!1,full:"Tuesday"},{day:"We",value:8,selected:!1,full:"Wednesday"},{day:"Th",value:16,selected:!1,full:"Thursday"},{day:"Fr",value:32,selected:!1,full:"Friday"},{day:"Sa",value:64,selected:!1,full:"Saturday"}],n.active={Tab:!1},n.paxMode={value:!1},n.addCard=T,n.showPaymentCards=!1,n.newBooker=null,n.sortableOptions={stop:function(e,n){},ondragstart:function(e,n){},disabled:!0};var oe=$(window).height();$("#new-booking").css("height",oe-90),n.selectedPassenger=null,n.flightInfoAvailable=!1,n.save=j,n.flipAddress=_,n.repeatBooking=Z,n.cancel=z,n.addTime=D,n.reverseStops=U,n.validateClientRef=K,n.getSearchText=y,n.searchPassengers=B,n.searchBookers=O,n.searchClients=v,n.testMaskReferences=q,n.clientReferences=[],n.fetchedPassengers=[],n.fetchedClients=[],n.filteredBookers=[{Id:"add-booker",Name:"Add Booker",Description:"Create New Booker",ImageUrl:"/includes/images/add-icon.png"}],n.clients=[],n.vehicleTypes=[],n.suggestReferences=x,n.refSelected=N,n.enableChauffering=b,n.disableChauffering=I,n.validateBooking=Q,n.openCalendar=ne,n.addStop=Y,n.removeStop=P,n.fetchFlightInformation=G,n.getQuote=W,n.externalLocations={knownLocations:[],historic:[]};var te=[],ie=null,ae=null;n.applyCoupon=w,c.get(i.API_ENDPOINT+"api/DispatchSettings").then(function(e){e.data[0]&&(n.dispatchSettings=e.data[0])}),n.formatErrorName=function(e){return e.replace("Input","").replace("Id","")},n.$watch("_dbooking.PaymentMethod",function(o){"Card"==o?n._dbooking.TaxId=n.COMPANY.DefaultCardTaxId||n.COMPANY.DefaultTaxId:"Cash"==o?n._dbooking.TaxId=n.COMPANY.DefaultCashTaxId||n.COMPANY.DefaultTaxId:n._dbooking.TaxId=n.COMPANY.DefaultTaxId,n.canQuote=!0,"Card"==o&&void 0!=n._dbooking.LeadPassengerId&&i.CARD_PAYMENTS_ENABLED?(n.filteredPaymentCards=[],c.get(i.API_ENDPOINT+"api/payments/getcardsforpassenger",{params:{passengerId:n._dbooking.LeadPassengerId}}).success(function(o){n.showPaymentCards=!0,e.forEach(o,function(e){n.filteredPaymentCards.push({Id:e.Id,Name:e.CardNumber,Description:e.Type.toUpperCase()+" - Expiring "+e.ExpirationMonth+"/"+e.ExpirationYear})})})):(n.showPaymentCards=!1,n._dbooking.PaymentCard=null,n._dbooking.PaymentCardId=null),e.forEach(n._dbooking.BookingStops,function(e,o){e.Latitude&&e.Longitude||(n.canQuote=!1)}),n.canQuote?W(n._dbooking):(ae&&(ae.setMap(null),ae=null),n.quote=null,n.directions=null,n._dbooking.EstimatedCost=0,n._dbooking.ActualCost=0)},!0),n.$watch("_dbooking.PaymentCardId",function(e){"Card"==n._dbooking.PaymentMethod&&void 0!=n._dbooking.LeadPassengerId&&i.CARD_PAYMENTS_ENABLED&&(null==e||void 0==e?n.canQuote=!1:n.canQuote=!0)}),n.addRequirement=M,n.removeRequirement=V,n.addTag=E,n.removeTag=R,n.$watch("_dbooking.ClientStaffId",function(e){if("add-booker"===e){var o=t.open({templateUrl:"/webapp/common/modals/booker/modal.html",controller:"BookerCreateController",resolve:{rBooker:function(){var e=new l.ClientStaff;return e.Phone=n.clients.filter(function(e){return e.Id==n._dbooking.ClientId})[0].Phone,e.ClientId=n._dbooking.ClientId,e}}});o.result.then(function(e){var o={Id:e.Id,ClientId:e.ClientId,Name:e.Firstname+" "+e.Surname,Description:e.Email?e.Email:"",Mobile:e.Mobile,ImageUrl:u.formatUrl(e.ImageUrl,e.Firstname)};n.newBooker=e,n.filteredBookers.push(o),n._dbooking.ClientStaffId=e.Id},function(){n._dbooking.ClientStaffId=null})}e?n.selectedBooker=n.filteredBookers.filter(function(n){return n.Id==e})[0]:n.selectedBooker=null}),n.$watch("selectedPassenger.Mobile",function(e){n._dbooking.PassengerNotificationPhone=e}),n.$watch("selectedPassenger.Phone",function(e){n._dbooking.PassengerNotificationPhone||(n._dbooking.PassengerNotificationPhone=e)}),n.$watch("_dbooking.LeadPassengerId",function(o){function a(){l.Passenger.query().where("Id","eq","guid'"+o+"'").include("Tags").select("Tags").execute().then(function(e){d.Tags=e[0].Tags,n.passengerTags=d.Tags;for(var o=0;o<d.Tags.length;o++)E(d.Tags[o])})}if("add-passenger"===o){var s=t.open({templateUrl:"/webapp/common/modals/passenger/create.modal.html",controller:"PassengerItemCreateModalController",resolve:{rClientId:function(){return n._dbooking.ClientId},rNavigateAfterSave:function(){return!1}}});return void s.result.then(function(e){var o={Id:e.Id,ClientId:e.ClientId,Name:e.Firstname+" "+e.Surname,Description:e.Email?e.Email:"",Mobile:e.Mobile,Phone:e.Phone,ImageUrl:u.formatUrl(e.ImageUrl,e.Firstname),Notes:e.Notes};n.fetchedPassengers.push(o),n._dbooking.ClientId=e.ClientId,n._dbooking.LeadPassengerId=e.Id},function(){})}n.filteredPaymentCards=[],n._dbooking.PaymentCardId=null;var r=n._dbooking;if(o){var d=n.fetchedPassengers.filter(function(e){return e.Id==o})[0];n.selectedPassenger=d,l.Note.query().where("OwnerType eq 'Passenger'").where("OwnerId eq guid'"+o+"'").execute().then(function(e){var o="";for(m=0;m<e.length;m++)o+=e[m].Content,m<e.length-1&&(o+="\r\n\r\n");d.Notes=o,d.Notes&&(n.company.AutoCopyPassengerNotes&&(r.DriverNotes="Passenger Note: \r\n"+d.Notes),g(function(){$("tab-heading:contains(Passenger)")[0].click()}))}),r.ClientId=d.ClientId?d.ClientId:void 0,r.PassengerNotificationPhone=d.Mobile?d.Mobile:d.Phone,e.forEach(d.Addresses,function(e){if(e.Latitude&&e.Longitude){var o="";e.Address1&&e.Address1.length>1&&(o+=e.Address1),e.TownCity?(o.length>0&&(o+=", "),o+=e.TownCity):e.Area&&(o.length>0&&(o+=", "),o+=e.Area),e.Postcode&&(o.length>0&&(o+=", "),o+=e.Postcode),n.externalLocations.knownLocations.push({Address1:e.Address1,Address2:e.Address2,Area:e.Area,TownCity:e.TownCity,County:e.County,Postcode:e.Postcode,Country:e.Country,Latitude:e.Latitude,Longitude:e.Longitude,Name:e.Name,StopSummary:e.StopSummary||o,LocationType:"Passenger Address"})}});var p=n.clients.filter(function(e){return e.Id==d.ClientId})[0];if(p?n.fetchedClients=[p]:n.fetchedClients=[],l.Booking.query().where("LeadPassengerId","eq","guid'"+o+"'").include("BookingStops").orderBy("BookedDateTime desc").top(5).execute().then(function(e){n.paxHistory=e,n.currentTab="HISTORY"}),n.externalLocations.historic.length=0,l.BookingStop.query().where("Booking/LeadPassengerId","eq","guid'"+o+"'").top(10).execute().then(function(e){var o={};uniqueResults=e.filter(function(e){return!o[e.Address1]&&(o[e.Address1]=!0,!0)}),[].push.apply(n.externalLocations.historic,uniqueResults)}),"Card"==n._dbooking.PaymentMethod&&i.CARD_PAYMENTS_ENABLED&&(n.filteredPaymentCards=[],c.get(i.API_ENDPOINT+"api/payments/getcardsforpassenger",{params:{passengerId:n._dbooking.LeadPassengerId}}).success(function(o){n.showPaymentCards=!0,e.forEach(o,function(e){n.filteredPaymentCards.push({Id:e.Id,Name:e.CardNumber,Description:e.Type.toUpperCase()+" - Expiring "+e.ExpirationMonth+"/"+e.ExpirationYear})})})),null!=d.DefaultVehicleTypeId&&(n._dbooking.VehicleTypeId=d.DefaultVehicleTypeId,!n.filteredVehicleTypes.some(function(e){return e.Id==d.DefaultVehicleTypeId}))){var f=n.vehicleTypes.find(function(e){return e.Id==d.DefaultVehicleTypeId});f&&n.filteredVehicleTypes.push(f)}d.Tags||a()}else if(ie||(ie=!0,n.filteredPassengers=n.passengers),n.selectedPassenger=null,r.PassengerNotificationPhone=null,n.externalLocations.knownLocations=n.externalLocations.knownLocations.filter(function(e){return"Passenger Address"!==e.LocationType}),n.passengerTags)for(var m=0;m<n.passengerTags.length;m++)R(n.passengerTags[m])});var le=!0;n.$watch("_dbooking.ClientId",function(o,t){if(n._dbooking.$clientOnHold=!1,le)setTimeout(function(){le=!1},0);else if(o){n._dbooking.ClientStaffId=null;var a=n.clients.filter(function(e){return e.Id==o})[0];if(a){if(a.OnHold)return swal({title:"Account On Hold",text:"This account is currently on hold, new bookings have been disabled.",type:"error",animation:"slide-from-top"}),n._dbooking.$clientOnHold=!0,void(n._dbooking.ClientId=null);if(a.AccountPassword&&swal({title:"Account Password",text:"This account is password enabled.",type:"input",showCancelButton:!0,closeOnConfirm:!1,closeOnCancel:!1,animation:"slide-from-top",inputPlaceholder:"Account Password",allowEscapeKey:!1,allowOutsideClick:!1},function(e){return e===!1?(n._dbooking.ClientId=null,n.$apply(),swal.close(),!1):""===e?(swal.showInputError("You need to write something!"),!1):e!=a.AccountPassword?(swal.showInputError("Incorrect Password"),!1):void swal("Accepted","The password is valid. Please continue with the booking.","success")}),l.Note.query().where("OwnerType eq 'Client'").where("OwnerId eq guid'"+o+"'").execute().then(function(e){var o="";for(r=0;r<e.length;r++)o+=e[r].Content+"\r\n\r\n";n.clientNotes=o}),n.clientReferences=e.copy(a.ClientReferences),n.clientReferences.map(function(e){return"Mask"==e.ReferenceType&&(e.$testReg=A(e.Value)),"List"==e.ReferenceType&&e.ShowList&&c({method:"GET",url:i.API_ENDPOINT+"/api/ClientReferences/list?ClientReferenceId="+e.Id}).then(function(n){e.$list=n.data.map(function(e){return{custom:!1,text:e}}),e.AllowAddToList&&e.$list.push({custom:!0,text:"Add '{{$select.search}}' to References"})}),e}),n.selectedClient=a,a.AllVehicleTypeAccess===!1?l.Client.query().where("Id eq guid'"+o+"'").include("VehicleTypes").select("VehicleTypes").execute().then(function(e){if(n.filteredVehicleTypes=e[0].VehicleTypes.sort(function(e,n){return(e.Order||99)-(n.Order||99)}).map(function(e){return e.ImageUrl=null,e}),a.DefaultVehicleTypeId){if(n._dbooking.VehicleTypeId=a.DefaultVehicleTypeId,!n.filteredVehicleTypes.some(function(e){return e.Id==a.DefaultVehicleTypeId})){var o=n.vehicleTypes.find(function(e){return e.Id==a.DefaultVehicleTypeId});o&&n.filteredVehicleTypes.push(o)}}else n._dbooking.VehicleTypeId=n.filteredVehicleTypes[0].Id}):(n.filteredVehicleTypes=n.vehicleTypes,a.DefaultVehicleTypeId&&(n._dbooking.VehicleTypeId=a.DefaultVehicleTypeId)),a.DefaultPaymentType&&(n._dbooking.PaymentMethod=a.DefaultPaymentType),n._dbooking.TextConfirmation=e.isDefined(a.TextConfirmation)&&null!==a.TextConfirmation?a.TextConfirmation:n.company.TextConfirmation,n._dbooking.EmailConfirmation=e.isDefined(a.EmailConfirmation)&&null!==a.EmailConfirmation?a.EmailConfirmation:n.company.EmailConfirmation,n._dbooking.TextOnArrival=e.isDefined(a.TextOnArrival)&&null!==a.TextOnArrival?a.TextOnArrival:n.company.TextOnArrival,n._dbooking.CallOnArrival=e.isDefined(a.CallOnArrival)&&null!==a.CallOnArrival?a.CallOnArrival:n.company.CallOnArrival,n._dbooking.TextAssigned=e.isDefined(a.TextAssigned)&&null!==a.TextAssigned?a.TextAssigned:n.company.TextAssigned,n._dbooking.EmailAssigned=e.isDefined(a.EmailAssigned)&&null!==a.EmailAssigned?a.EmailAssigned:n.company.EmailAssigned,n._dbooking.TextOnCompletion=e.isDefined(a.TextOnCompletion)&&null!==a.TextOnCompletion?a.TextOnCompletion:n.company.TextOnCompletion,n._dbooking.TextOnOnRoute=e.isDefined(a.TextOnOnRoute)&&null!==a.TextOnOnRoute?a.TextOnOnRoute:n.company.TextOnOnRoute,n._dbooking.AutoDispatch=a.AutoDispatch,a.Priority){var s=["P1","P2","P3","P4","P5"].indexOf(a.Priority)+1;n._dbooking.Priority=s.toFixed(0)}else n._dbooking.Priority="P1";if(a.Tags)for(var r=0;r<a.Tags.length;r++)E(a.Tags[r]);l.Client.query().where("Id eq guid'"+o+"'").include("KnownLocations").select("KnownLocations,Address1,Address2,Area,TownCity,County,Postcode,Country,Latitude,Longitude,BillingAddress1,BillingAddress2,BillingArea,BillingTownCity,BillingCounty,BillingPostcode,BillingCountry,BillingLatitude,BillingLongitude").execute().then(function(e){if([].push.apply(n.externalLocations.knownLocations,e[0].KnownLocations),e[0].Latitude&&e[0].Longitude){var o="";e[0].Address1&&e[0].Address1.length>1&&(o+=e[0].Address1),e[0].TownCity?(o.length>0&&(o+=", "),o+=e[0].TownCity):e[0].Area&&(o.length>0&&(o+=", "),o+=e[0].Area),e[0].Postcode&&(o.length>0&&(o+=", "),o+=e[0].Postcode),n.externalLocations.knownLocations.push({Address1:e[0].Address1,Address2:e[0].Address2,Area:e[0].Area,TownCity:e[0].TownCity,County:e[0].County,Postcode:e[0].Postcode,Country:e[0].Country,Latitude:e[0].Latitude,Longitude:e[0].Longitude,Name:"Office Address",StopSummary:o,LocationType:"OFFICE"})}if(e[0].BillingLatitude&&e[0].BillingLongitude&&e[0].BillingLatitude!=e[0].Latitude&&e[0].Longitude!=e[0].BillingLongitude){var o="";e[0].BillingAddress1&&e[0].BillingAddress1.length>1&&(o+=e[0].BillingAddress1),e[0].BillingTownCity?(o.length>0&&(o+=", "),o+=e[0].BillingTownCity):e[0].BillingArea&&(o.length>0&&(o+=", "),o+=e[0].BillingArea),e[0].BillingPostcode&&(o.length>0&&(o+=", "),o+=e[0].BillingPostcode),n.externalLocations.knownLocations.push({Address1:e[0].BillingAddress1,Address2:e[0].BillingAddress2,Area:e[0].BillingArea,TownCity:e[0].BillingTownCity,County:e[0].BillingCounty,Postcode:e[0].BillingPostcode,Country:e[0].BillingCountry,Latitude:e[0].BillingLatitude,Longitude:e[0].BillingLongitude,Name:"Billing Address",StopSummary:o,LocationType:"OFFICE"})}})}else n.clientReferences=[],n.selectedClient=null,n.filteredVehicleTypes=n.vehicleTypes,n._dbooking.PaymentMethod="Cash";g(function(){var e=$("#passenger-info").height()-37;$(".form-control.client-notes").css("height",e+"px")},100)}else n.filteredVehicleTypes=n.vehicleTypes,n._dbooking.PaymentMethod="Cash",n._dbooking.ClientStaffId=null,n._dbooking.LeadPassengerId=null,n._dbooking.ClientId=null,n.fetchedClients=[],n.clientReferences=[],n.selectedClient=null,n.externalLocations.knownLocations.length=0,n._dbooking.Tags.length=0;if(n._dbooking.ClientId){var d=n.clients.filter(function(e){return e.Id==n._dbooking.ClientId})[0];d&&(n._dbooking.CurrencyId=d.DefaultCurrencyId)}else n._dbooking.CurrencyId=n.COMPANY.DefaultCurrencyId;le||(n.canQuote=!0,e.forEach(n._dbooking.BookingStops,function(e,o){e.Latitude&&e.Longitude||(n.canQuote=!1);
}),n.canQuote?W(n._dbooking):(ae&&(ae.setMap(null),ae=null),n.quote=null,n.directions=null,n._dbooking.EstimatedCost=0,n._dbooking.ActualCost=0))},!0),n.$watch("_dbooking.Date",function(e,o){n.flightData.Number&&e&&e!=o&&G()}),n.$watch("_dbooking.BookingStops[0]",function(o){if(n._dbooking.WaitAndReturn){var t=new l.BookingStop(e.copy(n._dbooking.BookingStops[0]));t.id=idCounter++,n._dbooking.BookingStops.splice(n._dbooking.BookingStops.length-1,1,t)}},!0),n.$watch("_dbooking.WaitAndReturn",function(o){if(o===!1)n._dbooking.BookingStops.splice(n._dbooking.BookingStops.length-1,1);else if(o===!0){var t=new l.BookingStop(e.copy(n._dbooking.BookingStops[0]));t.id=idCounter++,n._dbooking.BookingStops.push(t)}n.canQuote=!0;var i=new google.maps.LatLngBounds,a=0;H(),e.forEach(n._dbooking.BookingStops,function(e,o){if(e.Latitude&&e.Longitude){a++;var t=new google.maps.LatLng(e.Latitude,e.Longitude);te.push(new google.maps.Marker({position:t,visible:!0,icon:0==o?"/includes/images/user.png":"/includes/images/userTo.png",map:n.dispatchObj.map.mapObject,zIndex:1e3})),i.extend(t)}else n.canQuote=!1}),a>0&&n.dispatchObj.map.mapObject.fitBounds(i)}),n.$watchGroup(["_dbooking.Date","_dbooking.Time"],function(o){n._dbooking.BookedDateTime=F(o[0],o[1]),n.canQuote=!0,n.timeSet||(n._dbooking.FlightInfo=null),n.timeSet=!1,e.forEach(n._dbooking.BookingStops,function(e,o){e.Latitude&&e.Longitude||(n.canQuote=!1)}),n.canQuote?W(n._dbooking):(ae&&(ae.setMap(null),ae=null),n.quote=null,n.directions=null,n._dbooking.EstimatedCost=0,n._dbooking.ActualCost=0)}),n.$watch("_dbooking.BookingStops",function(o){console.log("StopsChanged"),n.canQuote=!0;var t=new google.maps.LatLngBounds,i=0;H(),e.forEach(o,function(e,o){if(e.Latitude&&e.Longitude){i++;var a=new google.maps.LatLng(e.Latitude,e.Longitude);te.push(new google.maps.Marker({position:a,visible:!0,icon:0==o?"/includes/images/user.png":"/includes/images/userTo.png",map:n.dispatchObj.map.mapObject,zIndex:1e3})),t.extend(a)}else n.canQuote=!1}),i>0&&n.dispatchObj.map.mapObject.fitBounds(t),n.canQuote?W(n._dbooking):(ae&&(ae.setMap(null),ae=null),n.quote=null,n.directions=null,n._dbooking.EstimatedCost=0,n._dbooking.ActualCost=0)},!0),n.$watchGroup(["_dbooking.AsDirected","_dbooking.ChauffeurMode","_dbooking.EstimatedMins","_dbooking.ActualDistance","_dbooking.BookingStops.length"],function(o,t){if(n._dbooking.AsDirected===!0)n._dbooking.BookingStops.length=1;else if(1==n._dbooking.BookingStops.length){var i=new l.BookingStop;i.id=idCounter++,n._dbooking.BookingStops.push(i)}n.canQuote=!0;var a=new google.maps.LatLngBounds,s=0;H(),e.forEach(n._dbooking.BookingStops,function(e,o){if(e.Latitude&&e.Longitude){s++;var t=new google.maps.LatLng(e.Latitude,e.Longitude);te.push(new google.maps.Marker({position:t,visible:!0,icon:0==o?"/includes/images/user.png":"/includes/images/userTo.png",map:n.dispatchObj.map.mapObject,zIndex:1e3})),a.extend(t)}else n.canQuote=!1}),0==s&&(n.canQuote=!1),s>0&&n.dispatchObj.map.mapObject.fitBounds(a),n.canQuote?W(n._dbooking):(ae&&(ae.setMap(null),ae=null),n.quote=null,n.directions=null,n._dbooking.EstimatedCost=0,n._dbooking.ActualCost=0)}),n.$watch("_dbooking.VehicleTypeId",function(o){n.canQuote=!0;var t=new google.maps.LatLngBounds,i=0;H(),e.forEach(n._dbooking.BookingStops,function(e,o){if(e.Latitude&&e.Longitude){i++;var a=new google.maps.LatLng(e.Latitude,e.Longitude);te.push(new google.maps.Marker({position:a,visible:!0,icon:0==o?"/includes/images/user.png":"/includes/images/userTo.png",map:n.dispatchObj.map.mapObject,zIndex:1e3})),t.extend(a)}else n.canQuote=!1}),i>0&&n.dispatchObj.map.mapObject.fitBounds(t),n.canQuote?W(n._dbooking):(ae&&(ae.setMap(null),ae=null),n.quote=null,n.directions=null,n._dbooking.EstimatedCost=0,n._dbooking.ActualCost=0)}),n.dispatchObj={map:{mapObject:null}},J(),g(function(){m.server.startTelephonyEvents()},1e3);var se=[];n.$on("SIGNALR_ringing",function(e,o){var t=se.filter(function(e){return e.$id==o[0].CallIdentifier});if(!t||0==t.length){var a=n.$new();a.callData={label:"Calling...",value:o[0].Caller,status:"RINGING"},a.removeNotification=function(){this.kill(!0)},a.chooseBookingFromCall=function(e){},a.handleNewBooking=function(e){n.phoneCall=new l.TelephonyCall,n.phoneCall.Caller=o[0].Caller,n.phoneCall.CallIdentifier=o[0].CallIdentifier,c({method:"GET",url:i.API_ENDPOINT+"/api/telephony/callers-for-number",params:{number:n.phoneCall.Caller.replaceAll(" ","")},paramSerializer:"$httpParamSerializerJQLike"}).then(function(e){e.data&&(e.data.Passengers.map(function(e){e.$Description=e.Name,e.Client&&e.Client.Name&&(e.$Description+=" - "+e.Client.Name)}),n.listOfCallers=e.data)},function(e){}),n.$broadcast("CALLNEWBOOKINGREQUESTED",null)},c({method:"GET",url:i.API_ENDPOINT+"/api/telephony/caller-name",params:{number:o[0].Caller.replaceAll(" ","")},paramSerializer:"$httpParamSerializerJQLike"}).then(function(e){e.data.length>0&&(a.callData.value=e.data)},function(e){}),c({method:"GET",url:i.API_ENDPOINT+"/api/telephony/existing-booking",params:{number:o[0].Caller.replaceAll(" ","")},paramSerializer:"$httpParamSerializerJQLike"}).then(function(e){e.data&&(a.callData.existingBooking=e.data)},function(e){});var s=h.success({message:"Incoming Call",closeOnClick:!1,templateUrl:"phone_notification_template.html",scope:a});se.push({$id:o[0].CallIdentifier,$caller:o[0].Caller,$notification:s,$scope:a}),console.log(se)}}),n.$on("SIGNALR_answered",function(e,n){var o=se.filter(function(e){return e.$id==n[0].CallIdentifier});if(n[0].StaffId==r.STAFF_ID){var t=o[0].$scope.callData.value,i=o[0].$scope.callData.existingBooking;o[0].$scope.callData={label:"Talking to "+t,value:"00:00",seconds:0,status:"ANSWERED",existingBooking:i},o[0].$scope.timer=k(function(){o[0].$scope.callData.seconds+=1,o[0].$scope.callData.value=window.$utilities.secondsToHms(o[0].$scope.callData.seconds)},1e3)}else o[0].$notification.then(function(e){e.kill(!0)})}),n.$on("SIGNALR_hungUp",function(e,n){var o=se.filter(function(e){return e.$id==n[0].CallIdentifier});o.length>0&&(o[0].$notification.then(function(e){e.kill(!0)}),se.splice(se.indexOf(o[0]),1),k.cancel(o[0].$scope.timer))}),n.$on("$destroy",function(){m.server.stopTelephonyEvents()}),n.prefillInfoSelected=X,n.$on("CALLNEWBOOKINGREQUESTED",function(){ee()})}function o(){return function(e,n){return n.trim().length>0&&(e=e.filter(function(e){return(e.Name+e.Mobile+e.Description+"").toLowerCase().indexOf(n.toLowerCase())>-1||"add-passenger"==e.Id})),e}}var t=e.module("cab9.bookings");t.controller("BookingCreateController",n),t.filter("PassengerFilter",o),n.$inject=["$scope","$UI","$modal","$config","$q","Model","$stateParams","$rootScope","Localisation","$utilities","$http","$timeout","$filter","rCompany","SignalR","Notification","$interval","rTags"]}(angular);;;;
!function(e){function t(t,n,i,r,a){function s(e,n){t.filterOptions[n]=e}function o(e){e&&(t.loadingClients=!0,a.get($config.API_ENDPOINT+"api/Clients/Search",{params:{searchText:e,lite:!0}}).then(function(e){t.clients=[];for(var n=0;n<e.data.length;n++){var i=e.data[n];t.filterOptions.ClientIds.indexOf(i.Id)==-1&&t.clients.push({Id:i.Id,Name:"("+i.AccountNo+") "+i.Name,Description:i.ClientType&&i.ClientType.Name?i.ClientType.Name:""})}t.loadingClients=!1}))}function d(e){e&&(t.loadingDrivers=!0,a.get($config.API_ENDPOINT+"api/Drivers/Search",{params:{searchText:e,lite:!0}}).then(function(e){t.drivers=[];for(var n=0;n<e.data.length;n++){var i=e.data[n];t.filterOptions.DriverIds.indexOf(i.Id)==-1&&t.drivers.push({Id:i.Id,Name:i.Firstname+" "+i.Surname+" ("+i.Callsign+")",Description:i.DriverType.Name})}t.loadingDrivers=!1}))}function p(e){e&&(t.loadingPartners=!0,a.get($config.API_ENDPOINT+"api/partners/search",{params:{searchText:e,lite:!0}}).then(function(e){t.worksharePartners=[];for(var n=0;n<e.data.length;n++){var i=e.data[n];t.filterOptions.PartnerIds.indexOf(i.Id)==-1&&t.worksharePartners.push({Id:i.Id,Name:i.PartnerName})}t.loadingPartners=!1}))}function c(e){e&&(t.loadingPassengers=!0,a.get($config.API_ENDPOINT+"api/Passengers/Search",{params:{searchText:e,clientId:t.filterOptions.ClientIds[0],lite:!0}}).then(function(e){t.passengers=[];for(var n=0;n<e.data.length;n++){var i=e.data[n];t.filterOptions.LeadPassengerIds.indexOf(i.Id)==-1&&t.passengers.push({Id:i.Id,Firstname:i.Firstname,Surname:i.Surname})}t.loadingPassengers=!1}))}function l(){i.close(t.filterOptions)}t.filterOptions=e.copy(n),t.clients=t.filterOptions.Clients,t.worksharePartners=t.filterOptions.Partners,t.vehicleTypes=t.filterOptions.VehicleTypes,t.drivers=t.filterOptions.Drivers,t.passengers=t.filterOptions.Passengers,t.searchPartners=p,r.VehicleType.query().select("Id,Name,Description").execute().then(function(e){t.vehicleTypes=e}),t.status={},t.bookingSources=[{Id:"APP",Name:"Mobile App",Description:""},{Id:"WEB",Name:"Web Application",Description:""},{Id:"PHONE",Name:"Phone",Description:""},{Id:"OTHER",Name:"Other",Description:""},{Id:"ONETRANSPORT",Name:"One Transport",Description:""},{Id:"CLIENT_PORTAL",Name:"Client Portal",Description:""},{Id:"IMPORTED",Name:"Imported",Description:""},{Id:"MORGAN_STANLEY",Name:"Morgan Stanley",Description:""},{Id:"INFI9NITY",Name:"Infi9nty",Description:""},{Id:"GROUNDSCOPE",Name:"Ground Scope",Description:""},{Id:"HEREMaps",Name:"HERE Maps",Description:""},{Id:"GETT",Name:"Gett",Description:""},{Id:"CITYFLEET",Name:"City Fleet",Description:""}],t.paymentMethods=[{Id:"CASH",Name:"Cash",Description:""},{Id:"CARD",Name:"Card",Description:""},{Id:"ONACCOUNT",Name:"OnAccount",Description:""},{Id:"OTHER",Name:"Other",Description:""}],t.partnerTypes=[{Id:"GETT",Name:"GETT",Description:""},{Id:"CITYFLEET",Name:"CITYFLEET",Description:""},{Id:"CAB9",Name:"CAB9",Description:""}],setTimeout(function(){$("#daterangepicker_bookings").daterangepicker({locale:{format:"DD/MM/YYYY"},autoApply:!0,startDate:moment(t.filterOptions.date.from).startOf("day"),endDate:moment(t.filterOptions.date.to).endOf("day"),opens:"right",parentEl:"#time-controls",ranges:{Today:[moment().startOf("day"),moment().endOf("day")],"This Week":[moment().startOf("isoweek"),moment().endOf("isoweek")],"This Month":[moment().startOf("month"),moment().endOf("month")]},alwaysShowCalendars:!0}),$("#daterangepicker_bookings").on("apply.daterangepicker",function(e,n){t.filterOptions.date.selectedPeriod=n.chosenLabel,t.filterOptions.date.from=n.startDate.toISOString(),t.filterOptions.date.to=n.endDate.toISOString(),"Custom Range"==t.filterOptions.date.selectedPeriod&&(t.filterOptions.date.selectedPeriod=" ("+moment(t.filterOptions.date.from).format("DD/MM/YYYY")+" - "+moment(t.filterOptions.date.to).format("DD/MM/YYYY")+")"),t.$apply()})},100),t.datePickers={from:!1,to:!1},t.openDatePicker=function(e,n){t.datePickers[n]=!t.datePickers[n],event.preventDefault(),event.stopPropagation()};var m=!0;t.$watchCollection("filterOptions.ClientIds",function(e){m?m=!1:(t.passengers=[],t.filterOptions.LeadPassengerIds=[])}),t.searchClients=o,t.searchDrivers=d,t.searchPassengers=c,t.saveSelected=s,t.confirmFilters=l}var n=e.module("cab9.bookings");n.controller("BookingsFilterModalController",t),t.$inject=["$scope","rFilter","$modalInstance","Model","$http"]}(angular);;;;
!function(e,r){function t(e,t,i,s){if(s.test("drivers")){i.when("/drivers","/drivers/cards"),e.state("root.drivers",{url:"/drivers","abstract":!0,"default":"root.drivers.cards",hasHelp:"/webapp/management/drivers/all/brands-help.modal.html",permission:"Drivers",resolve:{rMenu:[function(){return[]}],rId:function(){return"Id"},rData:["Model",function(e){return e.Driver.query().include("DriverType").select("Id,Active,Firstname,Callsign,Surname,ImageUrl,Email,Mobile,DriverType,DriverTypeId,DriverType/Name,ScoreOverall").top(100).orderBy("Callsign").trackingEnabled().execute().then(function(r){return r.pullMore=e.Driver.query().include("DriverType").select("Id,Active,Firstname,Callsign,Surname,ImageUrl,Email,Mobile,DriverType,DriverTypeId,DriverType/Name,ScoreOverall").trackingEnabled(),r})}],rQuery:["Model",function(e){return e.Driver.query().include("DriverType,Cards").parseAs(e.Driver)}],rServerSearch:function(){return function(e,r){return r.$&&e.where("(substringof('"+r.$+"', Firstname) or substringof('"+r.$+"', Callsign) or substringof('"+r.$+"', Surname) or substringof('"+r.$+"', Mobile) or substringof('"+r.$+"', DriverType/Name))"),e.clone()}}},views:{"content-wrapper@root":{templateUrl:"/e9_components/layouts/module/module-base.layout.html",controller:"DriversController"},"options-area@root.drivers":{templateUrl:"/webapp/management/drivers/all/drivers-module-options.partial.html",controller:"DriversModuleOptionsController"},"stats-area@root.drivers":{templateUrl:"/webapp/management/drivers/all/drivers-module-stats.partial.html",controller:"DriversModuleStatsController"}}}),s.test("drivers.earnings")&&e.state("root.drivers.earnings",{url:"/earnings",permission:"Drivers - Earnings",resolve:{},showTimeControl:!0,views:{"content-wrapper@root":{controller:"DriverEstimateController",templateUrl:"/webapp/management/drivers/estimates/template.html"}}}),s.test("drivers.expenses")&&e.state("root.drivers.expenses",{url:"/expenses",permission:"Drivers - Expenses",resolve:{},showTimeControl:!0,views:{"content-wrapper@root":{controller:"DriverExpenseController",templateUrl:"/webapp/management/drivers/expenses/template.html"}}}),s.test("drivers.documents")&&e.state("root.drivers.documents",{url:"/documents",permission:"Drivers - Documents",resolve:{rDriverDocuments:["$http","$config",function(e,r){return e.get(r.API_ENDPOINT+"api/docs/expired")}],rDocumentTypes:["Model",function(e){return e.DocumentType.query().execute()}]},views:{"content-wrapper@root":{controller:["$scope","rDriverDocuments","rDocumentTypes","$timeout","CSV",function(e,r,t,i,s){function n(){s.download(e.drivers.map(function(e){return{Callsign:e.Callsign,Name:e.Firstname+" "+e.Surname,Email:e.Email,Active:e.Active?"Yes":"No",InactiveReason:e.InactiveReason,DrivingLicense:o(e.Docs["75bb45ff-d712-e611-80c8-141877289421"]),PCOLicense:o(e.Docs["8fd1aee6-bfc9-4086-9eb1-9753a9d8b130"]),NationalInsurance:o(e.Docs["1129bff7-d712-e611-80c8-141877289421"]),VehicleRegistration:e.Vehicle.Registration?e.Vehicle.Registration:"NA",VehicleDescription:e.Vehicle?(e.Vehicle.Colour?e.Vehicle.Colour:"")+" "+(e.Vehicle.Make?e.Vehicle.Make:"")+" "+(e.Vehicle.Model?e.Vehicle.Model:""):"NA",V5Registration:o(e.Docs["2422ff28-8cd5-463a-8c62-1c864ddeeaf3"]),MOTCertificate:o(e.Docs["2e846662-e86b-e611-80ca-14187728d133"]),VehiclePCOLicense:o(e.Docs["44a72205-eb55-4021-9b00-acdaf653b40a"]),Insurance:o(e.Docs["3bd9cc4f-6383-4dc4-91e1-bfc8808af0c3"])}}),"DriverDocuments")}function o(e){return e[0]&&e[0].ExpiryDate?moment(e[0].ExpiryDate).format("DD/MM/YYYY"):"Missing"}function a(){e.showSearch=!e.showSearch,e.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):e.searchTerm.$=""}function l(e,r){return e?"http"==e.slice(0,4)?e:$config.RESOURCE_ENDPOINT+e:$config.API_ENDPOINT+"api/imagegen?text="+r}e.drivers=r.data,e.documentTypes=t,e.formatUrl=l,e.today=(new moment).startOf("day"),e.warning=(new moment).subtract(1,"month").startOf("day"),e.searchTerm={},e.toggleSearch=a,e.exportData=n}],templateUrl:"/webapp/management/drivers/documents/template.html"}}}),e.state("root.drivers.cards",{url:"/cards",resolve:{rAccessors:["$config",function(e){return{Id:function(e){if(e)return e.Id},Title:function(e){if(e){var r="";return r+=e.Callsign}},SubTitle:function(e){if(e){var r=e.Firstname+" "+e.Surname;return r}},LogoUrl:function(e){if(e)return e._ImageUrl},Score:function(e){if(e)return e.ScoreOverall},Group:function(e){if(e)return e.DriverType.Name}}}],rNavTo:function(){return"root.drivers.viewer.dashboard"}},views:{"view-area@root.drivers":{templateUrl:"/e9_components/layouts/module/module-cards.partial.html",controller:"ModuleCardsController"}}}),e.state("root.drivers.table",{url:"/table",resolve:{rNavTo:function(){return"root.drivers.viewer.dashboard"},rSchema:function(){return"Driver"},rDriverTypes:["Model",function(e){return e.DriverType.query().execute()}],rColumns:function(){return null}},views:{"options-area@root.drivers":{templateUrl:"/webapp/management/drivers/all/drivers-module-table-options.partial.html",controller:"DriversModuleOptionsController"},"view-area@root.drivers":{templateUrl:"/webapp/management/drivers/all/driver-paged-table.partial.html",controller:"DriverPagedTableController"}}}),s.test("drivers.viewer")&&(e.state("root.drivers.viewer",{url:"/{Id:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}}","default":"root.drivers.viewer.dashboard",viewerType:"Driver",permission:"View Driver",resolve:{rTabs:["$stateParams",function(e){var r=[{heading:"Dashboard",route:"root.drivers.viewer.dashboard",params:{driverId:e.Id}}];return r.push({heading:"Info",route:"root.drivers.viewer.info",params:{driverId:e.Id}}),s.test("drivers.viewer.bookings")&&r.push({heading:"Bookings",route:"root.drivers.viewer.bookings",params:{driverId:e.Id}}),s.test("drivers.viewer.documents")&&r.push({heading:"Documents",route:"root.drivers.viewer.documents",params:{driverId:e.Id}}),s.test("drivers.viewer.vehicles")&&r.push({heading:"Vehicles",route:"root.drivers.viewer.vehicles",params:{driverId:e.Id}}),s.test("drivers.viewer.payments")&&r.push({heading:"Payments",route:"root.drivers.viewer.payments",params:{driverId:e.Id}}),s.test("drivers.viewer.fixed")&&r.push({heading:"Fixed Rates",route:"root.drivers.viewer.fixed",params:{driverId:e.Id}}),s.test("drivers.viewer.adjustments")&&r.push({heading:"Adjustments",route:"root.drivers.viewer.adjustments",params:{driverId:e.Id}}),s.test("drivers.viewer.notes")&&r.push({heading:"notes",route:"root.drivers.viewer.notes",params:{driverId:e.Id}}),s.test("drivers.viewer.user")&&r.push({heading:"User",route:"root.drivers.viewer.user",params:{driverId:e.Id}}),s.test("drivers.viewer.history")&&r.push({heading:"History",route:"root.drivers.viewer.history",params:{driverId:e.Id}}),s.test("drivers.viewer.creditcards")&&r.push({heading:"Credit cards",route:"root.drivers.viewer.creditcards.cards",params:{driverId:e.Id}}),r}],rData:["Model","$stateParams",function(e,r){return e.Driver.query().where("Id","==","guid'"+r.Id+"'").include("DriverType,DefaultDriverPaymentModel, Tags").trackingEnabled().execute()}],rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){return e._Fullname},SubTitle:function(e){return e.Callsign},LogoUrl:function(e){return e._ImageUrl}}}]},views:{"content-wrapper@root":{controller:"ModuleItemViewController",templateUrl:"/e9_components/layouts/module/module-item.layout.html"}}}),e.state("root.drivers.viewer.dashboard",{url:"/dashboard",viewerType:"Driver",templateUrl:"/webapp/management/drivers/item/driver-item-dashboard.partial.html",controller:"DriverItemDashboardController"}),s.test("drivers.viewer.history")&&e.state("root.drivers.viewer.history",{url:"/history",viewerType:"Driver",permission:"Driver - History",templateUrl:"/webapp/management/drivers/item/driver-item-history.partial.html",resolve:{rHistory:["Model","$stateParams",function(e,r){return e.AuditRecord.query().include("Properties").include("User").trackingEnabled().where("EntityId","eq","guid'"+r.Id+"'").where("EntityType","eq","'Driver'").orderBy("Timestamp desc").execute()}]},controller:["$scope","rHistory","rData",function(e,t,i){e.iconsIndex={Modified:"assignment",ImageUpdate:"assignment"},e.coloursIndex={Modified:"orange-bg",ImageUpdate:"orange-bg"},e.noHistory=!1,e.history={},e.getImage=function(e){if(e)return"http"==e.slice(0,4)?e:$config.API_ENDPOINT+e;var r=i[0].Callsign,t=r.indexOf(" ");return t!=-1&&(r=r.substring(0,t)),$config.API_ENDPOINT+"api/imagegen?text="+r},0==t.length&&(e.noHistory=!0),r.forEach(t,function(r){var t=moment(r.Timestamp).format("DD MMM YYYY");e.history[t]||(e.history[t]=[]),e.history[t].push(r)})}]}),s.test("drivers.viewer.user")&&e.state("root.drivers.viewer.user",{url:"/user",viewerType:"Driver",permission:"Driver - User",templateUrl:"/webapp/common/views/drivers/user/partial.html",controller:"DriverUserController",resolve:{rUser:["$http","$stateParams","$config","$q",function(e,r,t,i){var s=i.defer();return e.get(t.API_ENDPOINT+"api/account/UserForOwner?ownerType=DriverId&OwnerId="+r.Id).then(function(e){s.resolve(e.data)},function(e){s.resolve({Message:"User Not Found"})}),s.promise}]}}),s.test("drivers.viewer.bookings")&&e.state("root.drivers.viewer.bookings",{url:"/bookings",viewerType:"Driver",permission:"Driver - Bookings",controller:"DriverBookingsController",templateUrl:"/webapp/common/views/bookings/partial.html",resolve:{}}),s.test("drivers.viewer.documents")&&e.state("root.drivers.viewer.documents",{url:"/documents",viewerType:"Driver",permission:"Driver - Documents",controller:"ModuleDocumentsController",templateUrl:"/e9_components/layouts/module/module-documents.layout.html",resolve:{rDocuments:["$stateParams","Model","$q",function(e,r,t){return r.Document.query().where("OwnerType eq 'Driver'").where("OwnerId eq guid'"+e.Id+"'").include("DocumentType").trackingEnabled().execute()}],rConfig:["$stateParams",function(e){return{type:"Driver",id:e.Id}}]}}),s.test("drivers.viewer.payments")&&e.state("root.drivers.viewer.payments",{url:"/payments",viewerType:"Payments",permission:"Driver - Payments",controller:"DriverPaymentsController",templateUrl:"/webapp/common/views/drivers/payments/partial.html"}),s.test("drivers.viewer.adjustments")&&e.state("root.drivers.viewer.adjustments",{url:"/adjustments",viewerType:"Adjustments",permission:"Driver - Adjustments",controller:"DriverItemAdjustmentsController",templateUrl:"/webapp/common/views/drivers/adjustments/partial.html",resolve:{rAdjustments:["$stateParams","Model","$q",function(e,r,t){return r.DriverAdjustment.query().include("Tax").where("DriverId eq guid'"+e.Id+"'").execute()}],rRecurring:function(){return!1}}}),s.test("drivers.viewer.fixed")&&e.state("root.drivers.viewer.fixed",{url:"/fixed",viewerType:"Fixed Rates",permission:"Driver - Fixed Rates",controller:"DriverItemFixedRatesController",templateUrl:"/webapp/management/drivers/item/fixed/partial.html",resolve:{rFixedCount:["Model","$stateParams",function(e,r){return e.DriverFixed.query().select("Id").parseAs(function(e){this.Id=e.Id}).where("DriverId","eq","guid'"+r.Id+"'").execute()}],rFixeds:["Model","$stateParams",function(e,r){return e.DriverFixed.query().include("VehicleTypes,From,To").where("DriverId","eq","guid'"+r.Id+"'").top(10).trackingEnabled().execute()}],rZones:["Model",function(e){return e.Zone.query().execute()}],rVehicleTypes:["Model",function(e){return e.VehicleType.query().trackingEnabled().execute()}]}}),s.test("drivers.viewer.notes")&&e.state("root.drivers.viewer.notes",{url:"/notes",viewerType:"Notes",permission:"Driver - Notes",controller:"DriverItemNotesController",templateUrl:"/webapp/management/drivers/item/driver-item-notes.partial.html",resolve:{rNotes:["$stateParams","Model","$q",function(e,r,t){return r.Note.query().where("OwnerType eq 'DRIVER'").where("OwnerId eq guid'"+e.Id+"'").trackingEnabled().execute()}],rStaffs:["Model",function(e){return e.Staff.query().select("Id, Firstname, Surname").parseAs(function(e){this.Name=e.Firstname+" "+e.Surname,this.Id=e.Id}).execute()}],rUsers:["Model",function(e){return e.User.query().include("Claims").execute()}]}}),s.test("drivers.viewer.vehicles")&&e.state("root.drivers.viewer.vehicles",{url:"/vehicles",viewerType:"Driver",permission:"Driver - Vehicles",resolve:{rData:["Model","$stateParams",function(e,r){return e.Vehicle.query().where("DriverId eq guid'"+r.Id+"'").include("Type").include("Class").include("Driver").execute()}],rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){var r="";return r+=e.Colour+" "+e.Make+" "+e.Model},SubTitle:function(e){if(e.Driver)var r=e.Driver.Firstname+" "+e.Driver.Surname;else var r="Company Car";return r},LogoUrl:function(e){return e._ImageUrl},Group:function(e){return e.Type.Name},Score:function(e){return e.ScoreOverall}}}],rNavTo:function(){return"root.vehicles.viewer.dashboard"}},views:{"options-area@root.drivers.viewer":{templateUrl:"/webapp/management/drivers/item/driver-item-vehicles.partial.html"},"@root.drivers.viewer":{templateUrl:"/webapp/common/views/numplate/module-number-plate-secondary.partial.html",controller:"ModuleNumPlateSecondaryController"}}}),e.state("root.drivers.viewer.info",{url:"/info",viewerType:"Driver",templateUrl:"/webapp/management/drivers/item/driver-item-info.partial.html",controller:"DriverItemInfoController",resolve:{rDriverTypes:["LookupCache","Model",function(e,r){return e.DriverType&&e.DriverType.$updated.isAfter((new moment).subtract(10,"minutes"))?e.DriverType:r.DriverType.query().execute().then(function(r){return e.DriverType=r,e.DriverType.$updated=new moment,e.DriverType})}],rTags:["Model",function(e){return e.Tag.query().execute().then(function(e){return e.filter(function(e){return e.EntityType.indexOf("Driver")!=-1})})}],rVehicles:["Model",function(e){return e.Vehicle.query().select("Id, Make, Model, Colour, Registration").parseAs(function(e){this.Id=e.Id,this.Name=e.Registration+" "+e.Colour+" "+e.Make+" "+e.Model}).execute()}],rPaymentModels:["Model",function(e){return e.DriverPaymentModel.query().select("Id, Name").parseAs(function(e){this.Id=e.Id,this.Name=e.Name}).execute()}]}}));var n=[{title:"All",state:"root.drivers.cards",icon:"icon-user-tie"}];s.test("drivers.earnings")&&n.push({title:"Driver Earnings",state:"root.drivers.earnings",icon:"icon-user-tie"}),s.test("drivers.expenses")&&n.push({title:"Driver Expenses",state:"root.drivers.expenses",icon:"icon-user-tie"}),s.test("drivers.paymentmodels")&&n.push({title:"Payment Assignments",state:"root.drivers.paymentmodels",icon:"icon-coins"}),s.test("drivers.documents")&&n.push({title:"Document Expiration",state:"root.drivers.documents",icon:"icon-coins"}),s.test("drivers.shifts")&&n.push({title:"Driver Shifts",state:"root.drivers.shifts",icon:"icon-format-line-spacing"}),t.registerMenuItem({icon:"person_pin",title:"Drivers",subMenus:n.filter(function(e){return e.state.substring(5)})}),s.test("drivers","W")&&e.state("root.drivers.create",{url:"/create",views:{"content-wrapper@root":{controller:"DriverItemCreateController",templateUrl:"/webapp/management/drivers/item/driver-item-info.partial.html",resolve:{rDriverTypes:["LookupCache","Model",function(e,r){return e.DriverType&&e.DriverType.$updated.isAfter((new moment).subtract(10,"minutes"))?e.DriverType:r.DriverType.query().execute().then(function(r){return e.DriverType=r,e.DriverType.$updated=new moment,e.DriverType})}],rDriverTags:["Model",function(e){return e.Tag.query().execute().then(function(e){return e.filter(function(e){return e.EntityType.indexOf("Driver")!=-1})})}],rPaymentModels:["Model",function(e){return e.DriverPaymentModel.query().select("Id, Name").parseAs(function(e){this.Id=e.Id,this.Name=e.Name}).execute()}]}}}}),s.test("drivers.shifts")&&e.state("root.drivers.shifts",{url:"/shifts",permission:"Drivers - Shifts",views:{"content-wrapper@root":{controller:"DriverShiftsController",templateUrl:"/webapp/management/drivers/shifts/partial.html"}}}),s.test("drivers.paymentmodels")&&e.state("root.drivers.paymentmodels",{url:"/paymentmodels",viewerType:"Driver",permission:"Drivers - Payment Models",resolve:{rPaymentModels:["Model",function(e){return e.DriverPaymentModel.query().trackingEnabled().execute()}]},views:{"content-wrapper@root":{templateUrl:"/webapp/management/drivers/paymentmodels/model-assignments.partial.html",controller:"PaymentModelAssignmentsController"}}}),s.test("drivers.viewer.creditcards")&&(e.state("root.drivers.viewer.creditcards",{url:"/creditcards",viewerType:"CreditCard","default":"root.drivers.viewer.creditcards.cards",permission:"Drivers - Credit Cards",templateUrl:"/webapp/management/drivers/item/creditcards/partial.html",controller:["$scope","rTabs",function(e,r){e.tabDefs=r}],resolve:{rTabs:[function(){return[{heading:"Credit Cards",route:"root.drivers.viewer.creditcards.cards"},{heading:"Transactions",route:"root.drivers.viewer.creditcards.transactions"}]}]}}),e.state("root.drivers.viewer.creditcards.cards",{url:"/cards",templateUrl:"/webapp/common/views/clients/creditcards/cards/partial.html",controller:"CreditCardsCardsController",resolve:{rCards:["$http","Model","$stateParams",function(e,r,t){return e.get($config.API_ENDPOINT+"api/Payments/getcardsfordriver?driverId="+t.Id).then(function(e){return e.data})}],rClientId:["$stateParams",function(e){return null}],rPassengerId:["$stateParams",function(e){return null}],rDriverId:["$stateParams",function(e){return e.Id}]}}),e.state("root.drivers.viewer.creditcards.transactions",{url:"/transactions",templateUrl:"/webapp/management/drivers/item/transactions/partial.html",controller:"DriverCreditCardsTransactionsController",resolve:{rDriverId:["$stateParams",function(e){return e.Id}]}}))}}function i(){}function s(e,t,i){function s(e){var r='<a ui-sref="'+e.state+'" style="color:white;width:100%;display:inline-block;"><i class="'+e.icon+'"></i>'+e.title+"</a>";return r}e.menu=t,e.searchTerm={},e.serverSearchTerm={},r.forEach(t,function(e){e.$html=s(e)})}var n=r.module("cab9.drivers",[]);n.config(t),n.controller("DriversController",s),n.run(i),t.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider","$permissions"],s.$inject=["$scope","rMenu","rData"]}(window,angular);;;;
!function(e){function r(e,r,t){function a(){e.showSearch=!e.showSearch,!e.showSearch&&e.searchTerm?e.searchTerm.$="":!e.showSearch&&e.serverSearchTerm?e.serverSearchTerm.$="":setTimeout(function(){$("#searchTerm").focus()},500)}function o(){r.open({template:'<div class="modal-header"><button class="close" type="button" ng-click="$close()"><i class="material-icons">close</i></button><h3 class="modal-title">Driver Stats</h3></div><div class="modal-body"><div ng-include="\'/webapp/management/drivers/all/drivers-module-stats.partial.html\'"></div></div>',controller:"DriversModuleStatsController",size:"sm",resolve:{rData:function(){return t}}}).result.then(function(e){})}function n(){r.open({templateUrl:"/webapp/management/drivers/modals/driver-types-modal.partial.html",controller:"DriverTypesModalController",size:"lg",resolve:{rData:["Model","$stateParams","LookupCache",function(e,r,t){return e.DriverType.query().include("DefaultDriverPaymentModel").trackingEnabled().execute().then(function(e){return t.DriverType=e,t.DriverType.$updated=new moment,t.DriverType})}],rPaymentModels:["Model",function(e){return e.DriverPaymentModel.query().select("Id, Name").parseAs(function(e){this.Id=e.Id,this.Name=e.Name}).execute()}]}}).result.then(function(e){})}e.toggleSearch=a,e.showStatsModal=o,e.openDriverTypeModal=n}var t=e.module("cab9.drivers");t.controller("DriversModuleOptionsController",r),r.$inject=["$scope","$modal","rData"]}(angular);;;;
!function(e){function t(e,t,r,n,i,c){var o=(new moment).subtract(2,"weeks");r.Driver.query().select("Id,Active,CreationTime").execute().then(function(t){e.recentDrivers=t.filter(function(e){return new moment(e.CreationTime).isAfter(o)}),e.quickStats={total:t.length,active:t.filter(function(e){return e.Active}).length,recent:e.recentDrivers.length}}),e.recentDrivers=c.filter(function(e){return new moment(e.CreationTime).isAfter(o)}),e.quickStats={total:c.length,active:c.filter(function(e){return e.Active}).length,recent:e.recentDrivers.length}}var r=e.module("cab9.drivers");r.controller("DriversModuleStatsController",t),t.$inject=["$scope","$UI","Model","$config","$http","rData"]}(angular);;;;
!function(e){function r(e,r,n,c,l,t,i){function s(){e.newDriverType=new c.DriverType}function u(r){e.selected=r}function o(r){r.$patch().success(function(){swal("Success","Driver Type Updated","success"),y()}),e.selected=null}function a(){e.newDriverType.Name.length>0&&e.newDriverType.$save().success(function(){swal("Success","Driver Type Saved","success"),e.newDriverType=null,y()}).error(function(){swal({title:"Error Occured",type:"error"})})}function p(r){r.$rollback(),e.selected=null}function v(){e.newDriverType=null}function d(e){e.$delete().success(function(){swal("Success","Driver Type Deleted","success"),y()})}function y(){c.DriverType.query().include("DefaultDriverPaymentModel").trackingEnabled().execute().then(function(r){t.DriverType=r,t.DriverType.$updated=new moment,e.driverTypes=r})}e.driverTypes=n,e.selected=null,e.newDriverType=null,e.selectDriverType=u,e.updateDriverType=o,e.cancelUpdate=p,e.deleteDriverType=d,e.createNewDriverType=s,e.cancelSave=v,e.saveDriverType=a,e.paymentModels=i}var n=e.module("cab9.drivers");n.controller("DriverTypesModalController",r),r.$inject=["$scope","$modal","rData","Model","$q","LookupCache","rPaymentModels"]}(angular);;;;
;;;
!function(t){function a(t,a,e,o,r,i,s){t.driver=s[0],t.dispayMode="VIEW";var n=t.DATETIME_FORMAT.replace(/[.|/|-][y|Y][y|Y]*/g,"");t.quickStats={today:"-",week:"-",month:"-"},t.bookingGraph={options:{series:{lines:{show:!0,lineWidth:2,fill:!0,fillColor:{colors:[{opacity:.4},{opacity:.4}]}},points:{show:!0,lineWidth:2},shadowSize:0},grid:{hoverable:!0,clickable:!0,tickColor:"#eee",borderWidth:0},colors:[a.COLOURS.lighterGrey,a.COLOURS.brandPrimary],xaxis:{mode:"time",tickFormatter:function(t,a){var e=i("date")(moment(t).toDate(),n);return e},minTickSize:[1,"day"]},yaxis:{min:0,minTickSize:1,ticks:3,tickDecimals:0}},data:[]};var m=(o({url:e.API_ENDPOINT+"/api/reports/booking",method:"GET",params:{driverIds:"'"+t.item.Id+"'",from:(new moment).startOf("isoweek").format(),to:(new moment).startOf("day").format(),periodLength:"ww"}}).success(function(a){t.quickStats.week=a.Totals.TotalBookings}),o({url:e.API_ENDPOINT+"/api/reports/booking",method:"GET",params:{driverIds:"'"+t.item.Id+"'",from:(new moment).startOf("month").format(),to:(new moment).startOf("day").format(),periodLength:"mm"}}).success(function(a){t.quickStats.month=a.Totals.TotalBookings}),o({url:e.API_ENDPOINT+"/api/stats",method:"GET",params:{driverId:t.item.Id,from:(new moment).subtract(2,"weeks").startOf("day").format(),to:(new moment).startOf("day").format(),fillNulls:!0}})),d=o({url:e.API_ENDPOINT+"/api/stats",method:"GET",params:{from:(new moment).subtract(2,"weeks").startOf("day").format(),to:(new moment).startOf("day").format(),fillNulls:!0}});r.all([m,d]).then(function(a){var e=a[0].data,o=a[1].data,r={label:"Avg Driver",data:[]},i={label:t.item.Firstname+" "+t.item.Surname,data:[]};t.bookingGraph.data.push(r),t.bookingGraph.data.push(i);for(var s=0;s<e.Periods.length;s++){var n=e.Periods[s];i.data.push([new moment(n.Date).valueOf(),n.CountBookings])}for(var s=0;s<o.Periods.length;s++){var m=o.Periods[s];r.data.push([new moment(m.Date).valueOf(),m.CountAssignedBookings/m.UniqueDrivers])}t.lastWeekData=a[0].data.Periods.reverse().slice(0,7),t.quickStats.today=t.lastWeekData[0].CountBookings},function(t){})}var e=t.module("cab9.drivers");e.controller("DriverItemDashboardController",a),a.$inject=["$scope","$UI","$config","$http","$q","$filter","rData"]}(angular);;;;
!function(e){function r(r,i,d,n,a,t,o,c,s,v){function l(){r.driver.$delete()}function u(){o.openPicker({type:"Driver",id:r.driver.Id,searchTerm:r.driver.Firstname+" "+r.driver.Surname}).then(function(e){r.driver.ImageUrl=e,I()},function(e){})}function f(){r.displayMode="EDIT"}function I(){var n=[];if(e.isDefined(r.driver.$$changedValues.Tags)){var a=h.changes(r.driver.$$changedValues.Tags,function(e,r){return e.Id==r.Id});e.forEach(a.removed,function(e){n.push(d.$dissociate("Driver","DriverTags",r.driver.Id,e.Id))}),e.forEach(a.added,function(e){n.push(d.$associate("Driver","DriverTags",r.driver.Id,e.Id))})}n.push(r.driver.$patch()),i.all(n).then(function(){swal({title:"Driver Saved.",text:"Changes have been updated.",type:"success",confirmButtonColor:c.COLOURS.brandSecondary}),r.displayMode="VIEW",r.$emit("ITEM_UPDATED",r.driver)},function(e){alert("Error")})}function p(){r.driver.$rollback(!0),r.displayMode="VIEW"}function g(e){var i=r.driver.Tags.map(function(e){return e.Id});return i.indexOf(e.Id)==-1}r.driver=n[0],r.vehicles=v,r.driverTypes=a,r.driverTags=t,r.displayMode="VIEW",r.paymentModels=s;var h=e.copy(r.driver.Tags);r.chooseImage=u,r.startEditing=f,r.saveEdits=I,r.cancelEditing=p,r.deleteD=l,r.alreadySelected=g}var i=e.module("cab9.drivers");i.controller("DriverItemInfoController",r),r.$inject=["$scope","$q","Model","rData","rDriverTypes","rTags","ImageUpload","$UI","rPaymentModels","rVehicles"]}(angular);;;;
!function(r){function e(e,a,i,o,d,n,s,t){function v(){e.saving=!0;var o=[];r.forEach(e.driver.Tags,function(r){o.push(i.$associate("Driver","DriverTags",e.driver.Id,r.Id))}),o.push(e.driver.$save()),s.all(o).then(function(r){swal({title:"Driver Saved.",text:"New Driver has been added.",type:"success",confirmButtonColor:n.COLOURS.brandSecondary}),a.go("root.drivers.viewer.dashboard",{Id:r[0].data.Id})},function(){alert("Error"),console.log(arguments)})}function c(){a.go("root.drivers.cards")}e.driverTypes=o,e.driver=new i.Driver,e.displayMode="CREATE",e.driverTags=d,e.paymentModels=t,e.driver.Tags=[],e.saveEdits=v,e.cancelEditing=c}var a=r.module("cab9.drivers");a.controller("DriverItemCreateController",e),e.$inject=["$scope","$state","Model","rDriverTypes","rDriverTags","$UI","$q","rPaymentModels"]}(angular);;;;
!function(e){function t(e,t,o,r,n,l,i,c,a,u,s){function d(t){var o=e.notes.indexOf(t),n=r.open({templateUrl:"/webapp/common/modals/notes.modal.html",controller:"NoteEditController",size:"lg",resolve:{rNote:function(){return new i.Note(t)}}});n.result.then(function(t){i.Note.query().where("Id","==","guid'"+t.Id+"'").execute().then(function(t){e.notes[o]=t[0]},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:a.COLOURS.brandSecondary})})},function(){})}function f(){var t=r.open({templateUrl:"/webapp/common/modals/notes.modal.html",controller:"NoteCreateController",size:"lg",resolve:{rOwner:function(){return"DRIVER"}}});t.result.then(function(t){i.Note.query().where("Id","==","guid'"+t.Id+"'").execute().then(function(t){e.notes.push(t[0])},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:a.COLOURS.brandSecondary})})})}function m(t){swal({title:"Are you sure?",text:"Note will be deleted",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){var o=e.notes.indexOf(t);new i.Note(t).$delete().then(function(t){swal({title:"Note Deleted.",text:"Note has been deleted.",type:"success",confirmButtonColor:a.COLOURS.brandSecondary}),e.notes.splice(o,1)})},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:a.COLOURS.brandSecondary})})}function p(e){console.log(e);var t=null,o=s.filter(function(t){return t.Id==e})[0];if(o)switch(o.UserType){case"Staff":var r=o.Claims.filter(function(e){return"StaffId"==e.ClaimType})[0];if(r){var n=u.filter(function(e){return e.Id==r.ClaimValue})[0];t=n?n.Name:null}}return t}e.displayMode="VIEW",e.addNote=f,e.editNote=d,e.deleteNote=m,e.getUserName=p,e.notes=t.map(function(e){return e.CreationUserName=p(e.CreationUserId),e.ModificationUserName=p(e.ModificationUserId),e})}var o=e.module("cab9.drivers");o.controller("DriverItemNotesController",t),t.$inject=["$scope","rNotes","$state","$modal","$stateParams","$q","Model","$config","$UI","rStaffs","rUsers"]}(angular);;;;
!function(e){function t(t,r,n,i,o,l,c,s,u,a,f,d,g){function p(){t.currentlyCreating=new l.DriverFixed,t.currentlyCreating.DriverId=t.item.Id}function y(){var e=l.DriverFixed.query().select("Id").parseAs(function(e){this.Id=e.Id}).filter("DriverId","eq","guid'"+o.Id+"'");t.filters.fromZone&&""!=t.filters.fromZone&&e.filter("FromId eq guid'"+t.filters.fromZone+"'"),t.filters.toZone&&""!=t.filters.toZone&&e.filter("ToId eq guid'"+t.filters.toZone+"'"),t.filters.fromPostcode&&""!=t.filters.fromPostcode&&e.filter("FromPostcode eq'"+t.filters.fromPostcode+"'"),t.filters.toPostcode&&""!=t.filters.toPostcode&&e.filter("ToPostcode eq '"+t.filters.toPostcode+"'"),e.execute().then(function(e){t.paging.totalResults=e.length,t.paging.maxPages=Math.ceil(t.paging.totalResults/t.paging.resultsPerPage),m(1)},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:r.COLOURS.brandSecondary})})}function m(n){t.paging.currentPage=n;var i=l.DriverFixed.query().include("VehicleTypes,From,To").filter("DriverId","eq","guid'"+o.Id+"'").skip(t.paging.resultsPerPage*(t.paging.currentPage-1)).top(t.paging.resultsPerPage).trackingEnabled();t.filters.fromZone&&""!=t.filters.fromZone&&i.filter("FromId eq guid'"+t.filters.fromZone+"'"),t.filters.toZone&&""!=t.filters.toZone&&i.filter("ToId eq guid'"+t.filters.toZone+"'"),t.filters.fromPostcode&&""!=t.filters.fromPostcode&&i.filter("FromPostcode eq'"+t.filters.fromPostcode+"'"),t.filters.toPostcode&&""!=t.filters.toPostcode&&i.filter("ToPostcode eq '"+t.filters.toPostcode+"'"),i.execute().then(function(r){t.fixeds=r,e.forEach(t.fixeds,function(e){var t=e.VehicleTypes.map(function(e){return new l.VehicleTypeInDriverFixed(e)});e.VehicleTypes.length=0,[].push.apply(e.VehicleTypes,t)})},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:r.COLOURS.brandSecondary})})}function h(){function e(){t.currentlyCreating.$save(!0).success(function(e){t.currentlyCreating=null,i.go(i.current,o,{reload:!0})})}e()}function P(){t.currentlyCreating=null}function x(e){t.currentlyEditing=e}function T(e){swal({title:"Are you sure?",text:"You will not be able to recover this fixed rate!",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},function(){e.$delete().success(function(){var r=t.fixeds.indexOf(e);t.fixeds.splice(r,1)}).error(function(){})})}function I(e){f.post(d.API_ENDPOINT+"api/PricingModels/updatepaymentfixed",e).then(function(){t.currentlyEditing=null,m(t.paging.currentPage),swal({title:"Fixed Price Updated.",text:"Changes have been updated.",type:"success",confirmButtonColor:r.COLOURS.brandSecondary})},function(){console.log("Error occured")})}function v(r){t.currentlyEditing.$rollback(!0),e.forEach(r.VehicleTypes,function(e){e.$rollback(!0)}),t.currentlyEditing=null}function V(e,t){var r=e.VehicleTypes.filter(function(e){return e.VehicleTypeId==t.Id})[0];return r?r.FixedPayment:null}function C(e,t,r){e.VehicleTypes=e.VehicleTypes||[];var n=e.VehicleTypes.filter(function(e){return e.VehicleTypeId==t.Id})[0];if(n)n.FixedPayment=r;else if(r){var i=new l.VehicleTypeInDriverFixed;i.VehicleTypeId=t.Id,i.PaymentFixedId=e.Id,i.FixedPayment=r,e.VehicleTypes.push(i)}}t.paging={currentPage:1,resultsPerPage:10,totalResults:null,maxPages:null},t.paging.totalResults=c.length,t.paging.maxPages=Math.ceil(t.paging.totalResults/t.paging.resultsPerPage),t.setPage=m,t.filter=y,t.fixeds=s,e.forEach(t.fixeds,function(e){var t=e.VehicleTypes.map(function(e){return new l.VehicleTypeInDriverFixed(e)});e.VehicleTypes.length=0,[].push.apply(e.VehicleTypes,t)}),t.vehicleTypes=u,t.zones=a,t.currentlyEditing=null,t.currentlyCreating=null,t.startNew=p,t.confirmNew=h,t.cancelNew=P,t.startEditing=x,t.remove=T,t.confirmEditing=I,t.cancelEditing=v,t.getVehicleTypeCost=V,t.setVehicleTypeCost=C,t.prices=[],t._pindex=0,t.zones.unshift({Id:null,Name:"Custom Postcode -"}),t.filters={fromZone:null,toZone:null,fromPostcode:null,toPostcode:null}}var r=e.module("cab9.drivers");r.controller("DriverItemFixedRatesController",t),t.$inject=["$scope","$UI","$q","$state","$stateParams","Model","rFixedCount","rFixeds","rVehicleTypes","rZones","$http","$config","$modal"]}(angular);;;;
!function(r){function e(r,e,n,t,a,o,s,i,c,d){function u(){r.fetching=!0;var e=t.API_ENDPOINT+"api/Transactions/driver-transactions?driverId="+r.driverId;n({method:"GET",url:e}).then(function(e){r.fetching=!1,r.transactions=e.data},function(r){swal({title:"Some Error Occured.",text:r.data.ExceptionMessage,type:"error",confirmButtonColor:d.COLOURS.brandSecondary})})}function f(r){r.$expanded=!0,r.Request=JSON.parse(r.Request),r.Response=JSON.parse(r.Response)}r.transactions=[],r.fetchTransactions=u,r.driverId=i,r.expandTransaction=f,r.fetchTransactions()}var n=r.module("cab9.drivers");n.controller("DriverCreditCardsTransactionsController",e),e.$inject=["$scope","$state","$http","$config","Model","$stateParams","$q","rDriverId","$modal","$UI"]}(angular);;;;
!function(e){function t(t,r,o,n,i,s,a,l,f,c,d){function u(){o.open({templateUrl:"/webapp/management/bookings/modals/filter.modal.partial.html",controller:["$scope","rFilter","$modalInstance","Model",function(t,r,o,i){function s(e,r){t.filterOptions[r]=e}function a(e){e&&(t.loadingClients=!0,n.get($config.API_ENDPOINT+"api/Clients/Search",{params:{searchText:e,lite:!0}}).then(function(e){t.clients=[];for(var r=0;r<e.data.length;r++){var o=e.data[r];t.filterOptions.ClientIds.indexOf(o.Id)==-1&&t.clients.push({Id:o.Id,Name:"("+o.AccountNo+") "+o.Name,Description:o.ClientType&&o.ClientType.Name?o.ClientType.Name:""})}t.loadingClients=!1}))}function l(e){e&&(t.loadingPassengers=!0,n.get($config.API_ENDPOINT+"api/Passengers/Search",{params:{searchText:e,clientId:t.filterOptions.ClientIds[0],lite:!0}}).then(function(e){t.passengers=[];for(var r=0;r<e.data.length;r++){var o=e.data[r];t.filterOptions.LeadPassengerIds.indexOf(o.Id)==-1&&t.passengers.push({Id:o.Id,Firstname:o.Firstname,Surname:o.Surname})}t.loadingPassengers=!1}))}function f(){o.close(t.filterOptions)}t.filterOptions=e.copy(r),t.clients=t.filterOptions.Clients,t.vehicleTypes=t.filterOptions.VehicleTypes,t.passengers=t.filterOptions.Passengers,t.searchClients=a,t.searchPassengers=l,t.saveSelected=s,i.VehicleType.query().select("Id,Name,Description").execute().then(function(e){t.vehicleTypes=e}),window.setInterval(function(){var e=document.getElementsByClassName(".select2-choices ");e.scrollTop=e.scrollHeight},5e3),t.status={},t.bookingSources=[{Id:"APP",Name:"Mobile App",Description:""},{Id:"WEB",Name:"Web Application",Description:""},{Id:"PHONE",Name:"Phone",Description:""},{Id:"OTHER",Name:"Other",Description:""},{Id:"ONETRANSPORT",Name:"One Transport",Description:""},{Id:"CLIENT_PORTAL",Name:"Client Portal",Description:""}],setTimeout(function(){t.hideDriver=!0,$("#daterangepicker_bookings").daterangepicker({locale:{format:"DD/MM/YYYY"},autoApply:!0,startDate:moment(t.filterOptions.date.from).startOf("day"),endDate:moment(t.filterOptions.date.to).endOf("day"),opens:"right",parentEl:"#time-controls",ranges:{Today:[moment().startOf("day"),moment().endOf("day")],"This Week":[moment().startOf("isoweek"),moment().endOf("isoweek")],"This Month":[moment().startOf("month"),moment().endOf("month")]},alwaysShowCalendars:!0}),$("#daterangepicker_bookings").on("apply.daterangepicker",function(e,r){t.filterOptions.date.selectedPeriod=r.chosenLabel,t.filterOptions.date.from=r.startDate.toISOString(),t.filterOptions.date.to=r.endDate.toISOString(),"Custom Range"==t.filterOptions.date.selectedPeriod&&(t.filterOptions.date.selectedPeriod=" ("+moment(t.filterOptions.date.from).format("DD/MM/YYYY")+" - "+moment(t.filterOptions.date.to).format("DD/MM/YYYY")+")"),t.$apply()})},100),t.datePickers={from:!1,to:!1},t.openDatePicker=function(e,r){t.datePickers[r]=!t.datePickers[r],event.preventDefault(),event.stopPropagation()};var c=!0;t.$watchCollection("filterOptions.ClientIds",function(e){c?c=!1:(t.passengers=[],t.filterOptions.LeadPassengerIds=[])}),t.confirmFilters=f}],resolve:{rFilter:function(){return t.filter}},size:"lg"}).result.then(function(e){t.filter=e,t.filter.$inc++})}function g(e){if(t.bookingGroups=[],t.paging.currentPage=e,t.searchTerm.$.length>0)n.get($config.API_ENDPOINT+"api/search",{params:{searchText:t.searchTerm.$,driverId:a.Id,top:50,skip:t.paging.resultsPerPage*(t.paging.currentPage-1)}}).success(function(e){var t=[];[].push.apply(t,e.map(function(e){return new l.Booking(e)})),m(t)});else{var r={From:new moment(t.filter.date.from).startOf("day").format(),To:new moment(t.filter.date.to).endOf("day").format(),Page:t.paging.currentPage};if(t.filter.ClientIds.length>0&&(r.ClientIds=t.filter.ClientIds),t.filter.DriverIds.length>0&&(r.DriverIds=t.filter.DriverIds),t.filter.LeadPassengerIds.length>0&&(r.LeadPassengerIds=t.filter.LeadPassengerIds),t.filter.VehicleTypeIds.length>0&&(r.VehicleTypeIds=t.filter.VehicleTypeIds),t.filter.BookingSource&&(r.BookingSource=t.filter.BookingSource),t.filter.Amount.from&&(r.AmountFrom=t.filter.Amount.from),t.filter.Amount.to&&(r.AmountTo=t.filter.Amount.to),t.filter.ShowClientServicesBookings&&(r.Dispute=!0),t.filter.Status)for(var o=Object.keys(t.filter.Status),i=0;i<o.length;i++)t.filter.Status[o[i]]&&("InProgress"==o[i]&&(r.Arrived=!0),r[o[i]]=!0);n.post($config.API_ENDPOINT+"api/bookings/filtered",r).success(function(e){var t=[];[].push.apply(t,e.map(function(e){return new l.Booking(e)})),m(t),p()}).error(function(e){swal("Error","Please try again or contact admin","error")})}}function m(e){if(e.length>0){t.bookingGroups.length=0;for(var r={date:e[0].BookedDateTime,bookings:[]},o=0;o<e.length;o++){var n=e[o];n.BookingStops=s("orderBy")(n.BookingStops,"StopOrder"),new moment(n.BookedDateTime).format("DD/MM/YYYY")==new moment(r.date).format("DD/MM/YYYY")?r.bookings.push(n):(t.bookingGroups.push(r),r={date:n.BookedDateTime,bookings:[]},r.bookings.push(n))}t.bookingGroups.push(r)}}function p(){var e=new moment(t.filter.date.from),r=new moment(t.filter.date.to);t.filterSummary=t.fetchStatus,e.format("DD/MM/YYYY")==r.format("DD/MM/YYYY")?t.filterSummary+=" Bookings for "+s("date")(e.toDate(),"shortDate"):t.filterSummary+=" Bookings from "+s("date")(e.toDate(),"shortDate")+" to "+s("date")(r.toDate(),"shortDate")}function h(){t.showSearch=!t.showSearch,t.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):t.searchTerm.$=""}function I(){if(!t.filter.date.from||!t.filter.date.to)return void swal({title:"Date Range not selected.",text:"Please select date range in filters to export.",type:"warning",confirmButtonColor:f.COLOURS.brandSecondary});var r="from="+moment(t.filter.date.from).startOf("day").format().replace("+","%2B")+"&to="+moment(t.filter.date.to).endOf("day").format().replace("+","%2B");t.filter.DriverIds.length>0&&(r+="&driverids="+t.filter.DriverIds.reduce(function(e,t){return e?e+", ''"+t+"''":"''"+t+"''"},null)),t.filter.ClientIds.length>0&&(r+="&clientIds="+t.filter.ClientIds.reduce(function(e,t){return e?e+", ''"+t+"''":"''"+t+"''"},null)),t.filter.VehicleTypeIds.length>0&&(r+="&vehicleTypeIds="+t.filter.VehicleTypeIds.reduce(function(e,t){return e?e+", ''"+t+"''":"''"+t+"''"},null)),t.filter.LeadPassengerIds.length>0&&(r+="&leadPassengerIds="+t.filter.LeadPassengerIds.reduce(function(e,t){return e?e+", ''"+t+"''":"''"+t+"''"},null)),t.filter.Amount&&t.filter.Amount.from>=0&&(r+="&actualCostFrom="+t.filter.Amount.from),t.filter.Amount&&t.filter.Amount.to>=0&&(r+="&actualCostTo="+t.filter.Amount.to),t.filter.ClientServices&&(r+="&clientServices=1"),t.filter.BookingSource&&(r+="&bookingSource="+t.filter.BookingSource);var o=[];e.forEach(t.filter.Status,function(e,t){if(e)switch(t){case"Cancelled":o.push("-1");break;case"COA":o.push("0");break;case"Incoming":o.push("1");break;case"PreAllocated":o.push("5");break;case"Allocated":o.push("10");break;case"OnRoute":o.push("20");break;case"Arrived":o.push("30,40");break;case"InProgress":o.push("30,40");break;case"Clearing":o.push("80");break;case"Completed":o.push("100")}});var n=d.getSession().Claims.TenantId[0];r+="&tenantId="+n+"&BookingStatuses="+o.join(","),window.open($config.API_ENDPOINT+"api/bookings/export?"+r,"_blank")}t.toggleSearch=h,t.searchTerm={$:""},t.paging={currentPage:1,resultsPerPage:50,totalResults:null,maxPages:null},t.setPage=g,t.selectedPeriod="Today",t.filter={date:{from:moment().startOf("day"),to:moment().endOf("day"),span:"day",selectedPeriod:"Today"},Amount:{from:null,to:null},Clients:[],VehicleTypes:[],Passengers:[],ClientIds:[],DriverId:a.Id,DriverIds:[a.Id],VehicleTypeIds:[],LeadPassengerIds:[],ShowCompletedBookings:!1,ShowClientServicesBookings:!1,Status:null,$inc:0},t.onCompleted=function(e,r){1==t.bookingGroups[e].bookings.length?t.bookingGroups.splice(e,1):t.bookingGroups[e].bookings.splice(r,1)},t.bookingGroups=[],t.showFilterModal=u,t.exportBookings=I,t.$watchGroup(["filter.$inc","filter.date.from.valueOf()","filter.date.to.valueOf()","searchTerm.$","filter.ClientIds","filter.LeadPassengerIds","filter.VehicleTypeIds","filter.DriverIds","filter.ShowCompletedBookings","filter.ShowClientServicesBookings","filter.Status.Incoming","filter.Status.PreAllocated","filter.Status.Allocated","filter.Status.OnRoute","filter.Status.InProgress","filter.Status.Completed","filter.Status.Cancelled","filter.Status.COA","filter.Amount.from","filter.Amount.to","filter.BookingSource"],function(e,r){if(t.bookingGroups.length=0,t.fetchStatus="Fetching",e[3])t.filterSummary="Searching Bookings for : '"+e[3]+"'",n.get($config.API_ENDPOINT+"api/search/Count",{params:{searchText:e[3],driverId:a.Id}}).success(function(r){t.paging.totalResults=r.length,t.filterSummary="Showing Bookings for : '"+e[3]+"'",t.paging.maxPages=Math.ceil(t.paging.totalResults/t.paging.resultsPerPage),g(1)});else{p();var o={From:new moment(t.filter.date.from).startOf("day").format(),To:new moment(t.filter.date.to).endOf("day").format(),Page:t.paging.currentPage};if(t.filter.ClientIds.length>0&&(o.ClientIds=t.filter.ClientIds),t.filter.DriverIds.length>0&&(o.DriverIds=t.filter.DriverIds),t.filter.LeadPassengerIds.length>0&&(o.LeadPassengerIds=t.filter.LeadPassengerIds),t.filter.VehicleTypeIds.length>0&&(o.VehicleTypeIds=t.filter.VehicleTypeIds),t.filter.BookingSource&&(o.BookingSource=t.filter.BookingSource),t.filter.Amount.from&&(o.AmountFrom=t.filter.Amount.from),t.filter.Amount.to&&(o.AmountTo=t.filter.Amount.to),t.filter.ShowClientServicesBookings&&(o.Dispute=!0),t.filter.Status)for(var i=Object.keys(t.filter.Status),s=0;s<i.length;s++)t.filter.Status[i[s]]&&("InProgress"==i[s]&&(o.Arrived=!0),o[i[s]]=!0);n.post($config.API_ENDPOINT+"api/bookings/FilteredCount",o).success(function(e){t.paging.totalResults=e,t.fetchStatus="Showing "+e,p(),t.paging.maxPages=Math.ceil(t.paging.totalResults/t.paging.resultsPerPage),g(1)}).error(function(e){swal("Error","Please try again or contact admin","error")})}})}var r=e.module("cab9.drivers");r.controller("DriverBookingsController",t),t.$inject=["$scope","CSV","$modal","$http","$state","$filter","$stateParams","Model","$UI","$q","Auth"]}(angular);;;;
!function(){function e(e,r,t){function n(e){e.$patch(!0).success(function(){e.$selected=!1})}function a(e){e.$selected=!1,e.DefaultDriverPaymentModelId=e.CommDefaultId}function l(e){e.$selected=!0,e.CommDefaultId=e.DefaultDriverPaymentModelId}function d(r){var t="Company Default",n="Group Default",a=null;return r.DefaultDriverPaymentModelId?(a=e.paymentModels.filter(function(e){return e.Id==r.DefaultDriverPaymentModelId})[0],t=a?a.Name:t):r.DriverType&&r.DriverType.DefaultDriverPaymentModelId&&(a=e.paymentModels.filter(function(e){return e.Id==r.DriverType.DefaultDriverPaymentModelId})[0],t=a?n:t),t}e.paymentModels=r,e.driverTypes={},angular.forEach(t,function(r){e.driverTypes[r.DriverType.Name]||(e.driverTypes[r.DriverType.Name]=[],e.driverTypes[r.DriverType.Name].push(r.DriverType)),e.driverTypes[r.DriverType.Name].push(r)}),e.updateCommModel=n,e.cancelUpdate=a,e.EditModel=l,e.getCommModel=d}var r=angular.module("cab9.drivers");r.controller("PaymentModelAssignmentsController",e),e.$inject=["$scope","rPaymentModels","rData"]}();;;;
!function(o){function e(e,r,t,n,i,a,m){function s(){e.showSearch=!e.showSearch,e.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):e.searchTerm.$=""}function c(){i.get(a.API_ENDPOINT+"api/DriverPayments/estimate",{params:{from:new moment(m.reportFilters.from).format(),to:new moment(m.reportFilters.to).format()}}).then(function(r){e.data=r.data;var t=0,n=null,i=0,a=0;o.forEach(e.data,function(o){o.JourneyCommission>t&&(t=o.JourneyCommission,n=o),o.JourneyCommission>0&&a++,i+=o.JourneyCommission}),e.MaxCommission=t,e.DriverCount=a,e.AveCommission=i/a||0,e.MaxItem=n})}e.data=[],e.formatUrl=function(o,e){return o?"http"==o.slice(0,4)?o:a.RESOURCE_ENDPOINT+o:a.API_ENDPOINT+"api/imagegen?text="+(e||"").replace(/ /g,"+")},e.showSearch=!1,e.searchTerm={},e.toggleSearch=s,e.AveCommission=0,e.MaxCommission=0,e.DriverCount=0,e.$watch("reportFilters",function(){c()},!0)}var r=o.module("cab9.drivers");r.controller("DriverEstimateController",e),e.$inject=["$scope","$modal","Model","$q","$http","$config","$rootScope"]}(angular);;;;
!function(e){function n(e,n,s,t,o,p,r,l,c){function a(){e.showSearch=!e.showSearch,e.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):e.searchTerm.$=""}function x(e,n){window.open("/webapp/common/modals/bookings/edit-booking/window.html#?id="+n.BookingId+"&clientId="+n.ClientId,"EDIT:"+n.BookingId,"height=850,width=1000,left=0,top=0"),e.stopPropagation()}function E(n){o.patch(p.API_ENDPOINT+"api/Expense/bookingexpense?BookingExpenseId="+n.ExpenseId+"&Status=true").then(function(n){l.success("Expense Approved"),e.fetch()},function(e){swal("Error","Something didn't work, please try again","error")})}function d(n){swal({title:"Confirm Decline",text:"Are you sure you want to decline this expense?",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm Decline"},function(){o.patch(p.API_ENDPOINT+"api/Expense/bookingexpense?BookingExpenseId="+n.ExpenseId+"&Status=false").then(function(n){l.warning("Expense Declined"),e.fetch()},function(e){swal("Error","Something didn't work, please try again","error")})})}function u(n){swal({title:"Confirm Delete",text:"Are you sure you want to delete this expense?",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm Delete"},function(){o["delete"](p.API_ENDPOINT+"api/Expense/bookingExpense?ExpenseId="+n.ExpenseId).then(function(n){l.warning("Expense Deleted"),e.fetch()},function(e){swal("Error","Something didn't work, please try again","error")})})}e.data=[],e.tab={current:"PENDING"},e.showSearch=!1,e.searchTerm={},e.toggleSearch=a,e.acceptExpense=E,e.declineExpense=d,e.deleteExpense=u,e.openEditModal=x,e.formatUrl=window.$utilities.formatUrl,e.AllExpenses=[],e.ApprovedExpenses=[],e.PendingExpenses=[],e.DeclinedExpenses=[],e.fetch=function(){e.fetching=!0,o.get(p.API_ENDPOINT+"api/Expense/DriverExpenses").then(function(n){e.fetching=!1,e.AllExpenses=n.data,e.processExpensesList(e.AllExpenses)},function(n){swal("Error","Something didn't work, please try again","error"),e.fetching=!1})},e.fetch(),e.processExpensesList=function(n){for(e.ApprovedExpenses=[],e.PendingExpenses=[],e.DeclinedExpenses=[],i=0;i<n.length;i++){var s=n[i];1==s.Approved?(s.$Status="Approved",e.ApprovedExpenses.push(s)):null==s.Approved?(s.$Status="Pending",e.PendingExpenses.push(s)):(s.$Status="Declined",e.DeclinedExpenses.push(s))}};e.$on("SIGNALR_newExpenseNotification",function(n,s){e.AllExpenses.push(s[0]),e.processExpensesList(e.AllExpenses),e.$apply()}),e.$on("SIGNALR_declinedExpenseNotification",function(n,s){var t=e.AllExpenses.filter(function(e){return e.ExpenseId==s[0].ExpenseId});t.length>0&&(e.AllExpenses.splice(e.AllExpenses.indexOf(t[0]),1),e.AllExpenses.push(s[0]),e.processExpensesList(e.AllExpenses)),e.$apply()}),e.$on("SIGNALR_approvedExpenseNotification",function(n,s){var t=e.AllExpenses.filter(function(e){return e.ExpenseId==s[0].ExpenseId});t.length>0&&(e.AllExpenses.splice(e.AllExpenses.indexOf(t[0]),1),e.AllExpenses.push(s[0]),e.processExpensesList(e.AllExpenses)),e.$apply()}),e.$on("SIGNALR_deletedExpenseNotification",function(n,s){var t=e.AllExpenses.filter(function(e){return e.ExpenseId==s[0].ExpenseId});t.length>0&&(e.AllExpenses.splice(e.AllExpenses.indexOf(t[0]),1),e.processExpensesList(e.AllExpenses)),e.$apply()})}var s=e.module("cab9.drivers");s.controller("DriverExpenseController",n),n.$inject=["$scope","$modal","Model","$q","$http","$config","$rootScope","Notification","$state"]}(angular);;;;
!function(t){function e(t,e,a,o,n,r,i,f){function d(){t.showSearch=!t.showSearch}function s(){var e="api/drivershift/export?tenantId="+f.getSession().TenantId+"&startDate="+moment(t.filter.date.from).format("YYYY-MM-DD")+"&endDate="+moment(t.filter.date.to).format("YYYY-MM-DD");i.open(r.API_ENDPOINT+e,"_blank")}function m(){t.filterdDates=[];for(var e=moment(t.filter.date.to).diff(t.filter.date.from,"days"),a=0;a<=e;a++){var o={_date:moment(t.filter.date.from).add(a,"days").format("YYYY-MM-DD"),_uidate:moment(t.filter.date.from).add(a,"days").format("DD/MM/YYYY")};t.filterdDates.push(o)}}function l(t){e.open({templateUrl:"/webapp/management/dispatch/modals/shiftnotes/partial.html",controller:"DispatchDriverNotesController",resolve:{rShiftId:function(){return t.Id},rShiftNotes:function(){return t.Notes}},size:"sm"}).result.then(function(e){t.Notes=e})}function c(){t.fetchingShifts=!0;var e="api/drivershift/ShiftStatsFormatted?startDate="+moment(t.filter.date.from).format("YYYY-MM-DD")+"&endDate="+moment(t.filter.date.to).format("YYYY-MM-DD");n.get(r.API_ENDPOINT+e).then(function(e){m(),t.fetchingShifts=!1,e.data.map(function(e){e.$totalTime=0,e.$totalCommission=0,t.filterdDates.map(function(t){e.$totalTime+=e.Shifts[t._date]?e.Shifts[t._date]:0}),t.filterdDates.map(function(t){e.$totalCommission+=e.Commissions[t._date]?e.Commissions[t._date]:0})});var a=0;e.data.map(function(t){a+=t.$totalCommission}),t.dailyAvg=a/e.data.length/t.filterdDates.length,t.fdAvg=a/e.data.length,t.shifts=e.data},function(e){t.shifts=[],swal("Some Error Occurred",e.data.ExceptionMessage,"error"),t.fetchingShifts=!1})}function h(t,e,a){if(t.$expanded)t.$expanded=null,t.$data=[];else{t.$expanded=a._uidate,t.$data=[];var o="api/drivershift/ShiftsForDriver?startDate="+a._date+"&endDate="+moment(a._date).endOf("day").format("YYYY-MM-DDTHH:mm")+"&driverId="+t.DriverId;n.get(r.API_ENDPOINT+o).then(function(e){e.data.map(function(t){t.$minutes=moment(t.ShiftEnd).diff(t.ShiftStart,"minutes")}),t.$data=e.data},function(){swal("Error!","Error Fetching Driver Shifts.","error")})}}t.shifts=[],t.filterdDates=[],t.fetchingShifts=!1,t.currentWeekEnding=(new moment).endOf("isoweek").toDate(),t.filter={date:{from:(new moment).startOf("isoweek").toDate(),to:(new moment).endOf("isoweek").toDate(),span:"week",selectedPeriod:"This Week"}},setTimeout(function(){$("#daterangepicker_shifts").daterangepicker({locale:{format:"DD/MM/YYYY"},autoApply:!0,startDate:moment(t.filter.date.from).startOf("day"),endDate:moment(t.filter.date.to).endOf("day"),opens:"right",ranges:{Today:[moment().startOf("day"),moment().endOf("day")],"This Week":[moment().startOf("isoweek"),moment().endOf("isoweek")],"This Month":[moment().startOf("month"),moment().endOf("month")]},alwaysShowCalendars:!0}),$("#daterangepicker_shifts").on("apply.daterangepicker",function(e,a){t.filter.date.selectedPeriod=a.chosenLabel,t.filter.date.from=a.startDate.toISOString(),t.filter.date.to=a.endDate.toISOString(),"Custom Range"==t.filter.date.selectedPeriod&&(t.filter.date.selectedPeriod=" ("+moment(t.filter.date.from).format("DD/MM/YYYY")+" - "+moment(t.filter.date.to).format("DD/MM/YYYY")+")"),t.$apply(),c()})},100),t.datePickers={from:!1,to:!1},t.openDatePicker=function(e,a){t.datePickers[a]=!t.datePickers[a],event.preventDefault(),event.stopPropagation()},t.fetchShifts=c,t.expandShifts=h,t.exportDriverShifts=s,t.toggleSearch=d,t.openNotesModal=l,c()}var a=t.module("cab9.drivers");a.controller("DriverShiftsController",e),e.$inject=["$scope","$modal","Model","$q","$http","$config","$window","Auth"]}(angular);;;;
!function(e){function r(e,r,a,t,n,c,i,o,s,l){function m(e){var r={};r[s]=e.Id,i.go(a,r)}r.clone();e.viewItem=m,e.Schema=t,e.customColumns=c,e.rId=s,e.driverTypes=l,e.items=r,e.$watchGroup(["serverSearchTerm.$","chosenDriverType"],function(a,t){var c=r.clone();e.chosenDriverType&&c.where("DriverTypeId eq guid'"+e.chosenDriverType+"'"),e.serverSearchTerm.$?e.items=n(c.clone(),{$:e.serverSearchTerm.$}):e.serverSearchTerm.$!=t&&(e.items=c.clone()),e.items.clone({filters:!0}).select("Id").raw().execute().then(function(r){e.paging.totalItems=r.length,e.paging.maxPages=Math.ceil(r.length/e.paging.maxPerPage)})}),e.fetchStatus="Fetching",e.paging={currentPage:1,maxPerPage:50,totalItems:null,maxPages:null},e.state=a}var a=e.module("cab9.drivers");a.controller("DriverPagedTableController",r),r.$inject=["$scope","rQuery","rNavTo","rSchema","rServerSearch","rColumns","$state","$q","rId","rDriverTypes"]}(angular);;;;
!function(e){function r(r,t,i,l){l.test("vehicles")&&(r.state("root.vehicles",{url:"/vehicles","abstract":!0,permission:"Vehicles",resolve:{rId:function(){return"Id"},rServerSearch:function(){return function(e,r){return r.$&&e.where("substringof('"+r.$+"', Model) or (substringof('"+r.$+"', Make) or substringof('"+r.$+"', Colour) or (substringof('"+r.$+"', Registration) or substringof('"+r.$+"', Driver/Firstname) or substringof('"+r.$+"', Driver/Surname) or substringof('"+r.$+"', Driver/Callsign) or substringof('"+r.$+"', VehicleType/Name))"),e.clone()}}},views:{"content-wrapper@root":{templateUrl:"/e9_components/layouts/module/module-base.layout.html",controller:["$scope",function(e){e.searchTerm={},e.serverSearchTerm={}}]},"options-area@root.vehicles":{templateUrl:"/webapp/management/vehicles/all/vehicles-module-options.partial.html",controller:"VehiclesModuleOptionsController"},"stats-area@root.vehicles":{templateUrl:"/webapp/management/vehicles/all/vehicles-module-stats.partial.html",controller:"VehiclesModuleStatsController",resolve:{rData:["Model",function(e){return e.Vehicle.query().include("Type").include("Driver").include("Tags").select("Id,Colour,Make,Model,Registration,Driver/Surname,Driver/Firstname,Driver/Callsign,Type/Id,Type/Name,ScoreOverall,Active,CreationTime,ImageUrl").execute()}]}}}}),r.state("root.vehicles.cards",{url:"/cards",resolve:{rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){var r="";return e&&(r+=e.Colour+" "+e.Make+" "+e.Model),r},SubTitle:function(e){if(e&&e.Driver)var r="("+e.Driver.Callsign+") "+e.Driver.Firstname+" "+e.Driver.Surname;else var r="Company Car";return r},LogoUrl:function(e){return e._ImageUrl},Group:function(e){return e.Type.Name},Score:function(e){return e.ScoreOverall}}}],rData:["Model",function(e){return e.Vehicle.query().include("Type").include("Class").include("Driver").include("Tags").select("Id,Colour,Make,Model,Registration,Driver/Surname,Driver/Firstname,Driver/Callsign,Type/Id,Type/Name,ScoreOverall,ImageUrl,Active").parseAs(e.Vehicle).execute()}],rNavTo:function(){return"root.vehicles.viewer.dashboard"}},views:{"view-area@root.vehicles":{templateUrl:"/webapp/common/views/numplate/module-number-plate.partial.html",controller:"ModuleNumPlateController"}}}),r.state("root.vehicle-types",{url:"/vehicle-types",resolve:{rData:["Model","$stateParams","LookupCache",function(e,r,t){return e.VehicleType.query().trackingEnabled().orderBy("Priority").execute().then(function(e){return t.VehicleType=e,t.VehicleType.$updated=new moment,t.VehicleType})}]},views:{"content-wrapper@root":{templateUrl:"/webapp/management/vehicles/item/vehicle-type/partial.html",controller:"vehicleTypesController"}}}),r.state("root.vehicles.table",{url:"/table",hasHelp:"/webapp/management/vehicles/all/vehicles-help.modal.html",resolve:{rNavTo:function(){return"root.vehicles.viewer.dashboard"},rSchema:function(){return"Vehicle"},rVehicleTypes:["Model",function(e){return e.VehicleType.query().execute()}],rData:["Model",function(e){return e.Vehicle.query().include("Type").include("Class").include("Driver").include("Tags").select("Id,Colour,Make,Model,Registration,Driver/Surname,Driver/Firstname,Driver/Callsign,Type/Id,Type/Name,ScoreOverall,Active,CreationTime,ImageUrl").top(100).execute()}],rQuery:["Model",function(e){return e.Vehicle.query().include("Type").include("Class").include("Driver").include("Tags").select("Id,Colour,Make,Model,Registration,Driver/Surname,Driver/Firstname,Driver/Callsign,Type/Id,Type/Name,ScoreOverall,Active,CreationTime,ImageUrl").parseAs(e.Vehicle)}]},views:{"options-area@root.vehicles":{templateUrl:"/webapp/management/vehicles/all/vehicles-module-table-options.partial.html",controller:"VehiclesModuleOptionsController"},"view-area@root.vehicles":{templateUrl:"/e9_components/layouts/module/module-paged-table.partial.html",controller:"VehiclePagedTableController"}}}),l.test("vehicles.viewer")&&(r.state("root.vehicles.viewer",{url:"/{Id:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}}","default":"root.vehicles.viewer.dashboard",viewerType:"Vehicle",permission:"View Vehicle",resolve:{rTabs:["$stateParams",function(e){var r=[{heading:"Dashboard",route:"root.vehicles.viewer.dashboard",params:{vehicleId:e.Id}}];return r.push({heading:"Info",route:"root.vehicles.viewer.info",params:{vehicleId:e.Id}}),l.test("vehicles.viewer.documents")&&r.push({heading:"Documents",route:"root.vehicles.viewer.documents",params:{vehicleId:e.Id}}),l.test("vehicles.viewer.notes")&&r.push({heading:"Notes",route:"root.vehicles.viewer.notes",params:{vehicleId:e.Id}}),l.test("vehicles.viewer.history")&&r.push({heading:"History",route:"root.vehicles.viewer.history",params:{vehicleId:e.Id}}),r}],rData:["Model","$stateParams",function(e,r){return e.Vehicle.query().where("Id","==","guid'"+r.Id+"'").include("Type,Class,Driver,Driver/Tags,Tags").trackingEnabled().execute()}],rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){return e._Description},SubTitle:function(e){return e.Type.Name},LogoUrl:function(e){return e._ImageUrl}}}]},views:{"content-wrapper@root":{controller:"ModuleItemViewController",templateUrl:"/e9_components/layouts/module/module-item.layout.html"}}}),r.state("root.vehicles.viewer.dashboard",{url:"/dashboard",viewerType:"Vehicle",templateUrl:"/webapp/management/vehicles/item/vehicle-item-dashboard.partial.html",controller:"VehicleItemDashboardController"}),r.state("root.vehicles.viewer.history",{url:"/history",viewerType:"Vehicle",permission:"Vehicle - History",templateUrl:"/webapp/management/vehicles/item/vehicle-item-history.partial.html",resolve:{rHistory:["Model","$stateParams",function(e,r){return e.AuditRecord.query().include("Properties").include("User").trackingEnabled().where("EntityId","eq","guid'"+r.Id+"'").where("EntityType","eq","'Vehicle'").orderBy("Timestamp desc").execute()}]},controller:["$scope","rHistory",function(r,t){r.iconsIndex={Modified:"assignment"},r.coloursIndex={Modified:"orange-bg"},r.noHistory=!1,r.history={},0==t.length&&(r.noHistory=!0),e.forEach(t,function(e){var t=moment(e.Timestamp).format("DD MMM YYYY");r.history[t]||(r.history[t]=[]),r.history[t].push(e)})}]}),r.state("root.vehicles.viewer.info",{url:"/info",viewerType:"Vehicle",templateUrl:"/webapp/management/vehicles/item/vehicle-item-info.partial.html",controller:"VehicleItemInfoController",resolve:{rVehicleTypes:["LookupCache","Model",function(e,r){return e.VehicleType&&e.VehicleType.$updated.isAfter((new moment).subtract(10,"minutes"))?e.VehicleType:r.VehicleType.query().execute().then(function(r){return e.VehicleType=r,e.VehicleType.$updated=new moment,e.VehicleType})}],rVehicleClasses:["LookupCache","Model",function(e,r){return e.VehicleClass&&e.VehicleClass.$updated.isAfter((new moment).subtract(10,"minutes"))?e.VehicleClass:r.VehicleClass.query().execute().then(function(r){return e.VehicleClass=r,e.VehicleClass.$updated=new moment,e.VehicleClass})}],rVehicleTags:["Model",function(e){return e.Tag.query().execute().then(function(e){return e.filter(function(e){return e.EntityType.indexOf("Vehicle")!=-1})})}],rDrivers:["Model",function(e){return e.Driver.query().select("Id,Firstname,Surname,Callsign,ImageUrl,DriverType/Name").include("DriverType").parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname+" ("+e.Callsign+")",this.Description=e.DriverType.Name,this.ImageUrl=window.formatImage(e.ImageUrl,e.Callsign)}).execute()}]}}),l.test("vehicles.viewer.notes")&&r.state("root.vehicles.viewer.notes",{url:"/notes",viewerType:"Notes",permission:"Vehicle - Notes",controller:"VehicleItemNotesController",templateUrl:"/webapp/management/vehicles/item/vehicle-item-notes.partial.html",resolve:{rNotes:["$stateParams","Model","$q",function(e,r,t){return r.Note.query().where("OwnerType eq 'VEHICLE'").where("OwnerId eq guid'"+e.Id+"'").execute()}],rStaffs:["Model",function(e){return e.Staff.query().select("Id, Firstname, Surname").parseAs(function(e){this.Name=e.Firstname+" "+e.Surname,this.Id=e.Id}).execute()}],rUsers:["Model",function(e){return e.User.query().include("Claims").execute()}]}}),l.test("vehicles.viewer.documents")&&r.state("root.vehicles.viewer.documents",{url:"/documents",viewerType:"Vehicle",controller:"ModuleDocumentsController",templateUrl:"/e9_components/layouts/module/module-documents.layout.html",permission:"Vehicle - Documents",resolve:{rDocuments:["$stateParams","Model","$q",function(e,r,t){return r.Document.query().where("OwnerType eq 'Vehicle'").where("OwnerId eq guid'"+e.Id+"'").include("DocumentType").trackingEnabled().execute()}],rConfig:["$stateParams",function(e){return{type:"Vehicle",id:e.Id}}]}})),l.test("vehicles","W")&&r.state("root.vehicles.create",{url:"/create/?DriverId",views:{"content-wrapper@root":{controller:"VehicleItemCreateController",templateUrl:"/webapp/management/vehicles/item/vehicle-item-info.partial.html",resolve:{rVehicleTypes:["LookupCache","Model",function(e,r){return e.VehicleType&&e.VehicleType.$updated.isAfter((new moment).subtract(10,"minutes"))?e.VehicleType:r.VehicleType.query().execute().then(function(r){return e.VehicleType=r,e.VehicleType.$updated=new moment,e.VehicleType})}],rVehicleClasses:["LookupCache","Model",function(e,r){return e.VehicleClass&&e.VehicleClass.$updated.isAfter((new moment).subtract(10,"minutes"))?e.VehicleClass:r.VehicleClass.query().execute().then(function(r){return e.VehicleClass=r,e.VehicleClass.$updated=new moment,e.VehicleClass})}],rVehicleTags:["Model",function(e){return e.Tag.query().execute().then(function(e){return e.filter(function(e){return e.EntityType.indexOf("Vehicle")!=-1})})}],rDrivers:["Model",function(e){return e.Driver.query().select("Id,Firstname,Surname,Callsign,ImageUrl,DriverType/Name").include("DriverType").parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname+" ("+e.Callsign+")",this.Description=e.DriverType.Name,this.ImageUrl=window.formatImage(e.ImageUrl,e.Callsign)}).execute()}]}}}}),t.registerMenuItem({icon:"local_taxi",title:"Vehicles",subMenus:[{state:"root.vehicles.cards",icon:"local_taxi",title:"All"},{title:"Vehicle Types",state:"root.vehicle-types",icon:"icon-user-tie"}]}))}function t(){}var i=e.module("cab9.vehicles",[]);i.config(r),i.run(t),r.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider","$permissions"],t.$inject=[]}(angular);;;;
!function(e){function l(e,l){function t(){e.showSearch=!e.showSearch,e.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):e.searchTerm.$=""}function s(){l.open({template:'<div class="modal-header"><button class="close" type="button" ng-click="$close()"><i class="material-icons">close</i></button><h3 class="modal-title">Driver Stats</h3></div><div class="modal-body"><div ng-include="\'/webapp/management/vehicles/all/vehicles-module-stats.partial.html\'"></div></div>',controller:"VehiclesModuleStatsController",size:"sm",resolve:{rData:["Model","Auth",function(e,l){return e.Vehicle.query().filter("DriverId eq guid'"+l.getSession().Claims.DriverId[0]+"'").include("Type").include("Class").include("Driver").include("VehicleTags").execute()}]}}).result.then(function(e){})}function a(){l.open({templateUrl:"/webapp/management/vehicles/modals/vehicle-classes-modal.partial.html",controller:"VehicleClassesModalController",size:"lg",resolve:{rData:["Model","$stateParams","LookupCache",function(e,l,t){return e.VehicleClass.query().trackingEnabled().execute().then(function(e){return t.VehicleClass=e,t.VehicleClass.$updated=new moment,t.VehicleClass})}]}}).result.then(function(e){})}e.showStatsModal=s,e.toggleSearch=t,e.openVehicleClassModal=a}var t=e.module("cab9.vehicles");t.controller("VehiclesModuleOptionsController",l),l.$inject=["$scope","$modal"]}(angular);;;;
!function(e){function t(e,t,n,c,r,i){var l=(new moment).subtract(2,"weeks");e.recentVehicles=i.filter(function(e){return new moment(e.CreationTime).isAfter(l)}),e.quickStats={total:i.length,active:i.filter(function(e){return e.Active}).length,recent:e.recentVehicles.length}}var n=e.module("cab9.vehicles");n.controller("VehiclesModuleStatsController",t),t.$inject=["$scope","$UI","Model","$config","$http","rData"]}(angular);;;;
!function(e){function l(e,l,s,c,n,a,t){function i(){e.newVehicleClass=new n.VehicleClass}function u(l){e.selected=l}function o(l){l.$patch().success(function(){swal("Success","Vehicle Type Updated","success"),V()}),e.selected=null}function h(){e.newVehicleClass.Name.length>0&&e.newVehicleClass.$save().success(function(){swal("Success","Vehicle Type Saved.","success"),V(),e.newVehicleClass=null}).error(function(){swal({title:"Error Occured",type:"error"})})}function r(l){l.$rollback(),e.selected=null}function d(){e.newVehicleClass=null}function C(e){e.$delete().success(function(){V(),swal({title:"Vehicle Class Deleted",text:"Changes have been updated.",type:"success",confirmButtonColor:c.COLOURS.brandSecondary})})}function V(){n.VehicleClass.query().trackingEnabled().execute().then(function(l){t.VehicleClass=l,t.VehicleClass.$updated=new moment,e.vehicleClasses=l})}e.vehicleClasses=s,e.selected=null,e.newVehicleClass=null,e.selectVehicleClass=u,e.updateVehicleClass=o,e.cancelUpdate=r,e.deleteVehicleClass=C,e.createNewVehicleClass=i,e.cancelSave=d,e.saveVehicleClass=h}var s=e.module("cab9.vehicles");s.controller("VehicleClassesModalController",l),l.$inject=["$scope","$modal","rData","$UI","Model","$q","LookupCache"]}(angular);;;;
!function(t){function a(t,a,e,o,i,s,r,n){t.vehicle=n[0];var l=t.DATETIME_FORMAT.replace(/[.|/|-][y|Y][y|Y]*/g,"");t.quickStats={today:"-",week:"-",month:"-"},t.bookingGraph={options:{series:{lines:{show:!0,lineWidth:2,fill:!0,fillColor:{colors:[{opacity:.4},{opacity:.4}]}},points:{show:!0,lineWidth:2},shadowSize:0},grid:{hoverable:!0,clickable:!0,tickColor:"#eee",borderWidth:0},colors:[e.COLOURS.lighterGrey,e.COLOURS.brandPrimary],xaxis:{mode:"time",tickFormatter:function(t,a){var e=r("date")(moment(t).toDate(),l);return e},minTickSize:[1,"day"]},yaxis:{ticks:3,tickDecimals:0}},data:[]};var m=(i({url:o.API_ENDPOINT+"/api/stats",method:"GET",params:{vehicleId:t.item.Id,from:(new moment).startOf("isoweek").format(),to:(new moment).startOf("day").format(),totalsOnly:!0}}).success(function(a){t.quickStats.week=a.Totals.CountBookings}),i({url:o.API_ENDPOINT+"/api/stats",method:"GET",params:{vehicleId:t.item.Id,from:(new moment).startOf("month").format(),to:(new moment).startOf("day").format(),totalsOnly:!0}}).success(function(a){t.quickStats.month=a.Totals.CountBookings}),i({url:o.API_ENDPOINT+"/api/stats",method:"GET",params:{vehicleId:t.item.Id,from:(new moment).subtract(2,"weeks").startOf("day").format(),to:(new moment).startOf("day").format(),fillNulls:!0}})),d=i({url:o.API_ENDPOINT+"/api/stats",method:"GET",params:{from:(new moment).subtract(2,"weeks").startOf("day").format(),to:(new moment).startOf("day").format(),fillNulls:!0}});s.all([m,d]).then(function(a){var e=a[0].data,o=a[1].data,i={label:"Avg Vehicle",data:[]},s={label:t.item.Make+" "+t.item.Model,data:[]};t.bookingGraph.data.push(i),t.bookingGraph.data.push(s);for(var r=0;r<e.Periods.length;r++){var n=e.Periods[r];s.data.push([new moment(n.Date).valueOf(),n.CountBookings])}for(var r=0;r<o.Periods.length;r++){var l=o.Periods[r];i.data.push([new moment(l.Date).valueOf(),l.CountAssignedBookings/l.UniqueVehicles])}t.lastWeekData=a[0].data.Periods.reverse().slice(0,7),t.quickStats.today=t.lastWeekData[0].CountBookings},function(t){})}var e=t.module("cab9.vehicles");e.controller("VehicleItemDashboardController",a),a.$inject=["$scope","$modal","$UI","$config","$http","$q","$filter","rData"]}(angular);;;;
!function(e){function c(c,i,l,a,n,s,t,o,d,r){function h(){c.displayMode="EDIT"}function u(){c.vehicle.$rollback(!0),c.displayMode="VIEW"}function v(){c.vehicle.$delete(!0)}function f(){var a=[];if(e.isDefined(c.vehicle.$$changedValues.Tags)){var n=I.changes(c.vehicle.$$changedValues.Tags,function(e,c){return e.Id==c.Id});e.forEach(n.removed,function(e){a.push(l.$dissociate("Vehicle","VehicleTags",c.vehicle.Id,e.Id))}),e.forEach(n.added,function(e){a.push(l.$associate("Vehicle","VehicleTags",c.vehicle.Id,e.Id))})}a.push(c.vehicle.$patch(!0)),i.all(a).then(function(){swal({title:"Vehicle Saved.",text:"Changes have been updated.",type:"success",confirmButtonColor:d.COLOURS.brandSecondary}),c.displayMode="VIEW",c.$emit("ITEM_UPDATED",c.vehicle)},function(){alert("Error"),console.log(arguments)})}function g(e){var i=c.vehicle.Tags.map(function(e){return e.Id});return i.indexOf(e.Id)==-1}c.vehicle=a[0],c.vehicleTypes=n,c.vehicleTags=s,c.vehicleClasses=t,c.drivers=o,c.displayMode="VIEW";var I=e.copy(c.vehicle.Tags);c.startEditing=h,c.cancelEditing=u,c.saveEdits=f,c.deleteV=v,c.alreadySelected=g}var i=e.module("cab9.vehicles");i.controller("VehicleItemInfoController",c),c.$inject=["$scope","$q","Model","rData","rVehicleTypes","rVehicleTags","rVehicleClasses","rDrivers","$UI","$config"]}(angular);;;;
!function(e){function t(e,t,o,r,n,l,c,i,a,u,s){function d(t){var o=e.notes.indexOf(t),n=r.open({templateUrl:"/webapp/common/modals/notes.modal.html",controller:"NoteEditController",size:"lg",resolve:{rNote:function(){return new c.Note(t)}}});n.result.then(function(t){c.Note.query().where("Id","==","guid'"+t.Id+"'").trackingEnabled().execute().then(function(t){e.notes[o]=t[0]},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:a.COLOURS.brandSecondary})})},function(){})}function f(){var t=r.open({templateUrl:"/webapp/common/modals/notes.modal.html",controller:"NoteCreateController",size:"lg",resolve:{rOwner:function(){return"VEHICLE"}}});t.result.then(function(t){c.Note.query().where("Id","==","guid'"+t.Id+"'").execute().then(function(t){e.notes.push(t[0])},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:a.COLOURS.brandSecondary})})})}function m(t){swal({title:"Are you sure?",text:"Note will be deleted",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){var o=e.notes.indexOf(t);new c.Note(t).$delete().then(function(t){swal({title:"Note Deleted.",text:"Note has been deleted.",type:"success",confirmButtonColor:a.COLOURS.brandSecondary}),e.notes.splice(o,1)})},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:a.COLOURS.brandSecondary})})}function p(e){var t=null,o=s.filter(function(t){return t.Id==e})[0];if(o)switch(o.UserType){case"Staff ":var r=o.Claims.filter(function(e){return"StaffId"==e.ClaimType})[0];if(r){var n=u.filter(function(e){return e.Id==r.ClaimValue})[0];t=n?n.Name:null}}return t}e.notes=t,e.displayMode="VIEW",e.addNote=f,e.editNote=d,e.deleteNote=m,e.getUserName=p}var o=e.module("cab9.vehicles");o.controller("VehicleItemNotesController",t),t.$inject=["$scope","rNotes","$state","$modal","$stateParams","$q","Model","$config","$UI","rStaffs","rUsers"]}(angular);;;;
!function(e){function i(i,c,l,s,a,r,o,t,n,h,d){function v(){i.saving=!0;var s=[];e.forEach(i.vehicle.VehicleTags,function(e){s.push(l.$associate("Vehicle","VehicleTags",i.vehicle.Id,e.Id))}),s.push(i.vehicle.$save()),n.all(s).then(function(e){swal({title:"Vehicle Saved.",text:"New Vehicle has been added.",type:"success",confirmButtonColor:t.COLOURS.brandSecondary}),c.go("root.vehicles.viewer.dashboard",{Id:e[0].data.Id})},function(){alert("Error"),console.log(arguments)})}function u(){c.go("root.vehicles.cards")}i.vehicleTypes=s,i.vehicleClasses=r,i.vehicle=new l.Vehicle,i.displayMode="CREATE",i.vehicleTags=a,i.drivers=o,i.vehicle.VehicleTags=[],i.saveEdits=v,i.cancelEditing=u,d.DriverId&&(i.vehicle.DriverId=d.DriverId)}var c=e.module("cab9.vehicles");c.controller("VehicleItemCreateController",i),i.$inject=["$scope","$state","Model","rVehicleTypes","rVehicleTags","rVehicleClasses","rDrivers","$UI","$q","$config","$stateParams"]}(angular);;;;
!function(e){function r(e,r,c,a,t,n,l,i,o,s){function h(e){var r={};r[o]=e.Id,l.go(c,r)}r.clone();e.viewItem=h,e.Schema=a,e.customColumns=n,e.rId=o,e.vehicleTypes=s,e.items=r,e.$watchGroup(["serverSearchTerm.$","chosenVehicleType"],function(c,a){var n=r.clone();e.chosenVehicleType&&n.where("VehicleTypeId eq guid'"+e.chosenVehicleType+"'"),e.serverSearchTerm.$?e.items=t(n.clone(),{$:e.serverSearchTerm.$}):e.serverSearchTerm.$!=a&&(e.items=n.clone()),e.items.clone({filters:!0}).select("Id").raw().execute().then(function(r){e.paging.totalItems=r.length,e.paging.maxPages=Math.ceil(r.length/e.paging.maxPerPage)})}),e.fetchStatus="Fetching",e.paging={currentPage:1,maxPerPage:50,totalItems:null,maxPages:null},e.state=c}var c=e.module("cab9.vehicles");c.controller("VehiclePagedTableController",r),r.$inject=["$scope","rQuery","rNavTo","rSchema","rServerSearch","rColumns","$state","$q","rId","rVehicleTypes"]}(angular);;;;
!function(e){function t(t,r,n,i){if(i.test("clients")){n.when("/clients","/clients/cards"),t.state("root.clients",{url:"/clients","abstract":!0,"default":"root.clients.cards",permission:"Clients",hasHelp:"/webapp/management/clients/all/brands-help.modal.html",resolve:{rData:["Model",function(e){return e.Client.query().include("ClientType").select("Id,Name,AccountNo,ImageUrl,TownCity,ClientType/Name,ScoreOverall,Phone").top(100).orderBy("Name").trackingEnabled().execute().then(function(t){return t.pullMore=e.Client.query().include("ClientType").select("Id,Name,AccountNo,ImageUrl,TownCity,ClientType/Name,ScoreOverall,Phone").trackingEnabled(),t})}],rId:function(){return"Id"},rQuery:["Model",function(e){return e.Client.query().include("ClientType").parseAs(e.Client)}],rServerSearch:function(){return function(e,t){return t.$&&e.where("(substringof('"+t.$+"', Name) or substringof('"+t.$+"', ClientType/Name) or substringof('"+t.$+"', AccountNo) or substringof('"+t.$+"', TownCity) or substringof('"+t.$+"', Phone))"),e.clone()}}},views:{"content-wrapper@root":{templateUrl:"/e9_components/layouts/module/module-base.layout.html",controller:["$scope","rData",function(e,t){e.searchTerm={},e.serverSearchTerm={}}]},"options-area@root.clients":{templateUrl:"/webapp/management/clients/all/clients-module-options.partial.html",controller:"ClientsModuleOptionsController"},"stats-area@root.clients":{templateUrl:"/webapp/management/clients/all/clients-module-stats.partial.html",controller:"ClientsModuleStatsController"}}}),t.state("root.clients.cards",{url:"/cards",resolve:{rAccessors:["$config",function(e){return{Id:function(e){return e&&e.Id},Title:function(e){return e&&e.Name},SubTitle:function(e){return e&&e.AccountNo},LogoUrl:function(e){return e&&e._ImageUrl},Group:function(e){return e&&e.ClientType&&e.ClientType.Name},Score:function(e){return e&&e.ScoreOverall}}}],rNavTo:function(){return"root.clients.viewer.dashboard"}},views:{"view-area@root.clients":{templateUrl:"/e9_components/layouts/module/module-cards.partial.html",controller:"ModuleCardsController"}}}),t.state("root.clients.table",{url:"/table",resolve:{rNavTo:function(){return"root.clients.viewer.dashboard"},rSchema:function(){return"Client"},rColumns:function(){return null}},views:{"options-area@root.clients":{templateUrl:"/webapp/management/clients/all/clients-module-table-options.partial.html",controller:"ClientsModuleOptionsController"},"view-area@root.clients":{templateUrl:"/e9_components/layouts/module/module-paged-table.partial.html",controller:"ModulePagedTableController"}}}),i.test("clients.viewer")&&(t.state("root.clients.viewer",{url:"/{Id:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}}","default":"root.clients.viewer.dashboard",viewerType:"Client",permission:"View Client",resolve:{rData:["Model","$stateParams",function(e,t){return e.Client.query().where("Id","==","guid'"+t.Id+"'").include("ClientType,Tags,DefaultCurrency,BannedDrivers,VehicleTypes,CancellationRule").trackingEnabled().execute()}],rTabs:["$stateParams","rData",function(e,t){var r=[{heading:"Dashboard",route:"root.clients.viewer.dashboard",allow:!0,params:{clientId:e.Id}},{heading:"Info",route:"root.clients.viewer.info",allow:!0,params:{clientId:e.Id}},{heading:"Bookings",route:"root.clients.viewer.bookings",params:{clientId:e.Id}},{heading:"Staff",route:"root.clients.viewer.staff.cards",params:{clientId:e.Id}},{heading:"Documents",route:"root.clients.viewer.documents",params:{clientId:e.Id}},{heading:"Passengers",test:"clients.viewer.passengers",route:"root.clients.viewer.passengers.table",params:{clientId:e.Id}},{heading:"Profiles",route:"root.clients.viewer.profiles",params:{clientId:e.Id}},{heading:"References",route:"root.clients.viewer.references",params:{clientId:e.Id}},{heading:"Notes",route:"root.clients.viewer.notes",params:{clientId:e.Id}},{heading:"Blocked",route:"root.clients.viewer.banneddrivers",params:{clientId:e.Id}},{heading:"Invoices",route:"root.clients.viewer.invoices",params:{clientId:e.Id}},{heading:"Credit Notes",route:"root.clients.viewer.credits",params:{clientId:e.Id}},{heading:"Adjustments",route:"root.clients.viewer.adjustments",params:{clientId:e.Id}},{heading:"Fixed Prices",route:"root.clients.viewer.fixeds",params:{clientId:e.Id}},{heading:"Locations",route:"root.clients.viewer.locations",params:{clientId:e.Id}},{heading:"Web Booker",route:"root.clients.viewer.webbookersettings",params:{clientId:e.Id}},{heading:"History",route:"root.clients.viewer.history",params:{clientId:e.Id}},{heading:"Advanced",route:"root.clients.viewer.advanced",params:{clientId:e.Id}},{heading:"Credit Cards",route:"root.clients.viewer.creditcards.cards",params:{clientId:e.Id}},{heading:"Invite To App",route:"root.clients.viewer.invitetoapp",params:{clientId:e.Id}}];return t[0].AllVehicleTypeAccess||r.push({heading:"Vehicle Types",route:"root.clients.viewer.vehicletypes",params:{clientId:e.Id}}),r=r.filter(function(e){return e.allow||i.test(e.test||e.route.substring(5))})}],rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){return e.AccountNo?"("+e.AccountNo+") "+e.Name:e.Name},SubTitle:function(e){return e.TownCity},LogoUrl:function(e){return e._ImageUrl}}}]},views:{"content-wrapper@root":{controller:"ModuleItemViewController",templateUrl:"/e9_components/layouts/module/module-item.layout.html"}}}),t.state("root.clients.viewer.dashboard",{url:"/dashboard",viewerType:"Client",templateUrl:"/webapp/management/clients/item/client-item-dashboard.partial.html",controller:"ClientItemDashboardController"}),t.state("root.clients.viewer.history",{url:"/history",viewerType:"Client",permission:"Client - History",templateUrl:"/webapp/management/clients/item/client-item-history.partial.html",resolve:{rHistory:["Model","$stateParams",function(e,t){return e.AuditRecord.query().include("Properties").include("User").trackingEnabled().where("EntityId","eq","guid'"+t.Id+"'").where("EntityType","eq","'Client'").orderBy("Timestamp desc").execute()}]},controller:["$scope","rHistory",function(t,r){t.iconsIndex={Modified:"assignment",ImageUpdate:"assignment"},t.coloursIndex={Modified:"orange-bg",ImageUpdate:"orange-bg"},t.noHistory=!1,t.history={},t.getImage=function(e){if(e)return"http"==e.slice(0,4)?e:$config.API_ENDPOINT+e;var t=rData[0].Callsign,r=t.indexOf(" ");return r!=-1&&(t=t.substring(0,r)),$config.API_ENDPOINT+"api/imagegen?text="+t},0==r.length&&(t.noHistory=!0),e.forEach(r,function(e){var r=moment(e.Timestamp).format("DD MMM YYYY");t.history[r]||(t.history[r]=[]),t.history[r].push(e)})}]}),t.state("root.clients.viewer.fixeds",{url:"/fixeds",viewerType:"Client",permission:"Client - Fixed Prices",templateUrl:"/webapp/management/clients/item/fixed/partial.html",controller:"ClientFixedController",resolve:{rFixedCount:["Model","$stateParams",function(e,t){return e.ClientPricingFixed.query().select("Id").parseAs(function(e){this.Id=e.Id}).where("ClientId","eq","guid'"+t.Id+"'").execute()}],rFixeds:["$http","Model","$stateParams",function(e,t,r){return e.get($config.API_ENDPOINT+"api/PricingModels/FetchFixedClientDetails?clientId="+r.Id+"&count=200").then(function(e){if(e.data.length>0)return e.data.map(function(e){return new t.ClientPricingFixed(e)})})}],rVehicleTypes:["Model",function(e){return e.VehicleType.query().trackingEnabled().execute()}],rZones:["Model",function(e){return e.Zone.query().execute()}]}}),t.state("root.clients.viewer.info",{url:"/info",viewerType:"Client",templateUrl:"/webapp/management/clients/item/client-item-info.partial.html",controller:"ClientItemInfoController",resolve:{rClientTypes:["LookupCache","Model",function(e,t){return e.ClientType&&e.ClientType.$updated.isAfter((new moment).subtract(10,"minutes"))?e.ClientType:t.ClientType.query().execute().then(function(t){return e.ClientType=t,e.ClientType.$updated=new moment,e.ClientType})}],rVehicleTypes:["LookupCache","Model",function(e,t){return e.VehicleType&&e.VehicleType.$updated.isAfter((new moment).subtract(10,"minutes"))?e.VehicleType:t.VehicleType.query().execute().then(function(t){return e.VehicleType=t.sort(function(e,t){return(e.Priority||99)-(t.Priority||99)}),e.VehicleType.$updated=new moment,e.VehicleType})}],rPricingModels:["Model",function(e){return e.PricingModel.query().execute()}],rClientTags:["Model",function(e){return e.Tag.query().execute().then(function(e){return e.filter(function(e){return e.EntityType.indexOf("Client")!=-1})})}],rValidations:["Model","$stateParams",function(e,t){return e.ClientReference.query().where("ClientId eq guid'"+t.Id+"'").parseAs(function(e){return{Id:e.ReferenceName,Name:e.ReferenceName}}).execute()}],rStaff:["Model","$stateParams",function(e,t){return e.Staff.query().select("Id,Firstname,Surname").parseAs(function(e){return{Id:e.Id,Name:e.Firstname+" "+e.Surname}}).execute()}],rTaxes:["Model",function(e){return e.Tax.query().select("Id,Name").execute()}]}}),i.test("clients.viewer.bookings")&&t.state("root.clients.viewer.bookings",{url:"/bookings",viewerType:"Client",permission:"Client - Bookings",templateUrl:"/webapp/common/views/bookings/partial.html",controller:"ClientBookingsController"}),i.test("clients.viewer.locations")&&t.state("root.clients.viewer.locations",{url:"/locations",viewerType:"Client",permission:"Client - Locations",templateUrl:"/webapp/management/clients/item/client-item-locations.partial.html",controller:"ClientItemLocationsController",resolve:{rLocations:["Model","$stateParams",function(e,t){return e.Client.query().select("Id,KnownLocations").include("KnownLocations").filter("Id eq guid'"+t.Id+"'").execute()}]}}),i.test("clients.viewer.documents")&&t.state("root.clients.viewer.documents",{url:"/documents",viewerType:"Client",permission:"Client - Documents",controller:"ModuleDocumentsController",templateUrl:"/e9_components/layouts/module/module-documents.layout.html",resolve:{rDocuments:["$stateParams","Model","$q",function(e,t,r){return t.Document.query().where("OwnerType eq 'Client'").where("OwnerId eq guid'"+e.Id+"'").trackingEnabled().include("DocumentType").execute()}],rConfig:["$stateParams",function(e){return{type:"Client",id:e.Id}}]}}),i.test("clients.viewer.passengers")&&(t.state("root.clients.viewer.passengers",{url:"/passengers","abstract":!0,"default":"root.clients.viewer.passengers.table",viewerType:"Client",permission:"Client - Passengers",resolve:{rNavTo:function(){return"root.passengers.viewer.dashboard"},rId:function(){return"Id"},rSchema:function(){return"Passenger"},rQuery:["Model","$stateParams",function(e,t){return e.Passenger.query().filter("ClientId eq guid'"+t.Id+"'").include("Client").include("Addresses").parseAs(e.Passenger)}],rServerSearch:function(){return function(e,t){return t.$&&e.where("(substringof('"+t.$+"', Firstname) or substringof('"+t.$+"', Surname) or substringof('"+t.$+"', Phone))"),e.clone()}}},views:{"":{templateUrl:"/e9_components/layouts/module/module-base-full.layout.html",controller:["$scope","rData",function(e,t){e.searchTerm={},e.serverSearchTerm={}}]},"options-area@root.clients.viewer.passengers":{templateUrl:"/webapp/common/views/clients/passengers/options.partial.html",controller:"ClientPassengersOptionsController"}}}),t.state("root.clients.viewer.passengers.table",{url:"/table",resolve:{rAccessors:["$config",function(e){return{Id:function(e){return e.Id}}}],rColumns:function(){return null}},views:{"view-area@root.clients.viewer.passengers":{templateUrl:"/e9_components/layouts/module/module-paged-table.partial.html",controller:"ModulePagedTableController"}}})),i.test("clients.viewer.profiles")&&t.state("root.clients.viewer.profiles",{url:"/profiles",viewerType:"Client",permission:"Client - Profiles",templateUrl:"/webapp/management/clients/item/client-item-profiles.partial.html",controller:"ClientItemProfilesController",resolve:{rPassengers:["$http","Model","$stateParams",function(e,t,r){return e.get($config.API_ENDPOINT+"api/client/profiles",{params:{clientId:r.Id}}).then(function(e){return e.data.map(function(e){return new t.PassengerProfile(e)})})}]}}),i.test("clients.viewer.invoices")&&t.state("root.clients.viewer.invoices",{url:"/invoices",viewerType:"Invoices",permission:"Client - Invoices",controller:"ClientInvoicesController",templateUrl:"/webapp/common/views/clients/invoices/partial.html"}),i.test("clients.viewer.credits")&&t.state("root.clients.viewer.credits",{url:"/credit-notes",viewerType:"CreditNotes",permission:"Client - Credit Notes",controller:"ClientCreditNotesController",templateUrl:"/webapp/common/views/clients/creditNotes/partial.html"}),i.test("clients.viewer.adjustments")&&t.state("root.clients.viewer.adjustments",{url:"/adjustments",viewerType:"Adjustments",permission:"Client - Adjustments",controller:"ClientItemAdjustmentsController",templateUrl:"/webapp/management/clients/item/client-item-adjustments.partial.html",resolve:{rAdjustments:["$stateParams","Model","$q",function(e,t,r){return t.ClientAdjustment.query().include("Tax").where("ClientId eq guid'"+e.Id+"'").execute()}],rRecurring:function(){return!1}}}),i.test("clients.viewer.notes")&&t.state("root.clients.viewer.notes",{url:"/notes",viewerType:"Notes",permission:"Client - Notes",controller:"ClientItemNotesController",templateUrl:"/webapp/management/clients/item/client-item-notes.partial.html",resolve:{rNotes:["$stateParams","Model","$q",function(e,t,r){return t.Note.query().where("OwnerType eq 'CLIENT'").where("OwnerId eq guid'"+e.Id+"'").execute()}],rStaffs:["Model",function(e){return e.Staff.query().select("Id, Firstname, Surname").parseAs(function(e){this.Name=e.Firstname+" "+e.Surname,this.Id=e.Id}).execute()}],rUsers:["Model",function(e){return e.User.query().include("Claims").execute()}]}}),i.test("clients.viewer.banneddrivers")&&t.state("root.clients.viewer.banneddrivers",{url:"/banneddrivers",viewerType:"BannedDrivers",permission:"Client - Blocked Drivers",controller:"ClientItemBannedDriversController",templateUrl:"/webapp/common/views/clients/bannedDrivers/partial.html"}),i.test("clients.viewer.references")&&t.state("root.clients.viewer.references",{url:"/references",viewerType:"References",permission:"Client - References",controller:"ClientItemReferencesController",templateUrl:"/webapp/common/views/clients/references/partial.html",resolve:{rReferences:["$stateParams","Model","$q",function(e,t,r){return t.ClientReference.query().where("ClientId eq guid'"+e.Id+"'").execute()}]}}),i.test("clients.viewer.webbookersettings")&&t.state("root.clients.viewer.webbookersettings",{url:"/webbookersettings",viewerType:"WebBookerSettings",permission:"Client - Web Booker",controller:"ClientItemWebBookerSettingsController",templateUrl:"/webapp/common/views/clients/webBookerSettings/partial.html",resolve:{rSettings:["$stateParams","Model","$q",function(e,t,r){return t.ClientWebBookerSetting.query().where("ClientId eq guid'"+e.Id+"'").trackingEnabled().execute()}]}}),i.test("clients.viewer.advanced")&&t.state("root.clients.viewer.advanced",{url:"/advanced",viewerType:"Advanced",permission:"Client - Advanced",controller:"ClientItemAdvancedController",templateUrl:"/webapp/management/clients/item/advanced/partial.html",resolve:{rVehicleTypes:["Model","$stateParams",function(e,t){return e.VehicleType.query().execute()}]}}),i.test("clients.viewer.invitetoapp")&&t.state("root.clients.viewer.invitetoapp",{url:"/invite",viewerType:"Client",permission:"Client - Invite",templateUrl:"/webapp/management/clients/item/invite/partial.html",controller:"ClientInviteToAppController"}),i.test("clients.viewer.creditcards")&&(t.state("root.clients.viewer.creditcards",{url:"/creditcards",viewerType:"CreditCard","default":"root.clients.viewer.creditcards.cards",permission:"Client - Credit Cards",templateUrl:"/webapp/management/clients/item/creditcards/partial.html",controller:["$scope","rTabs",function(e,t){e.tabDefs=t}],resolve:{rTabs:[function(){return[{heading:"Credit Cards",route:"root.clients.viewer.creditcards.cards"},{heading:"Transactions",route:"root.clients.viewer.creditcards.transactions"}]}]}}),t.state("root.clients.viewer.creditcards.cards",{url:"/cards",templateUrl:"/webapp/common/views/clients/creditcards/cards/partial.html",controller:"CreditCardsCardsController",resolve:{rCards:["$http","Model","$stateParams",function(e,t,r){return t.PaymentCard.query().where("ClientId eq guid'"+r.Id+"'").where("Active eq true").execute()}],rClientId:["$stateParams",function(e){return e.Id}],rPassengerId:["$stateParams",function(e){return null}],rDriverId:["$stateParams",function(e){return null}]}}),t.state("root.clients.viewer.creditcards.transactions",{url:"/transactions",templateUrl:"/webapp/common/views/clients/creditcards/transactions/partial.html",controller:"CreditCardsTransactionsController",resolve:{rClientId:["$stateParams",function(e){return e.Id}],rPassengerId:["$stateParams",function(e){return null}]}})),i.test("clients.viewer.vehicletypes")&&t.state("root.clients.viewer.vehicletypes",{url:"/vehicletypes",viewerType:"VehicleTypes",permission:"Client - Vehicle Types",controller:"ClientItemVehicleTypesController",templateUrl:"/webapp/common/views/clients/clientVehicleTypes/partial.html",resolve:{rVehicleTypes:["Model","$stateParams",function(e,t){return e.VehicleType.query().execute()}]}}),i.test("clients.viewer.staff","W")&&t.state("root.clients.viewer.staff.create",{url:"/create",resolve:{rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){return e.Firstname+e.Surname},LogoUrl:function(e){return e._ImageUrl}}}],rRoles:["Model",function(e){return e.ClientStaffRole.query().execute()}]},views:{"content-wrapper@root":{controller:"ClientStaffItemCreateController",templateUrl:"/webapp/common/views/clients/staff/details/partial.html"}}}),i.test("clients.viewer.staff")&&(t.state("root.clients.viewer.staff",{url:"/staff","abstract":!0,"default":"root.clients.viewer.staff.cards",viewerType:"Client",permission:"Client - Staff",resolve:{rNavTo:function(){return"root.clients.viewer.staff.viewer.details"},rId:function(){return"sId"},rData:["Model","$stateParams",function(e,t){return e.ClientStaff.query().filter("ClientId eq guid'"+t.Id+"'").select("Id,Active,Firstname, Surname, Phone,ClientStaffRole/Name").include("ClientStaffRole").top(100).orderBy("Firstname").execute().then(function(r){return r.pullMore=e.ClientStaff.query().filter("ClientId eq guid'"+t.Id+"'").select("Id,Active,Firstname, Surname, Phone,ClientStaffRole/Name").include("ClientStaffRole").orderBy("Firstname"),r})}],rCreateState:function(){return"root.clients.viewer.staff.create"},rNavCards:function(){return"root.clients.viewer.staff.cards"},rNavTable:function(){return"root.clients.viewer.staff.table"},rQuery:["Model","$stateParams",function(e,t){return e.ClientStaff.query().filter("ClientId eq guid'"+t.Id+"'").include("ClientStaffRole").select("Id,Firstname,Surname,Phone,Mobile,Email,AllPassengers,ClientStaffRole/Name").parseAs(e.ClientStaff)}],rServerSearch:function(){return function(e,t){return t.$&&e.where("(substringof('"+t.$+"', Firstname) or substringof('"+t.$+"', Surname) or substringof('"+t.$+"', ClientStaffRole/Name) or substringof('"+t.$+"', TownCity) or substringof('"+t.$+"', Phone) or substringof('"+t.$+"', Email))"),e.clone()}}},views:{"":{templateUrl:"/e9_components/layouts/module/module-base.layout.html",controller:["$scope","rData",function(e,t){e.searchTerm={},e.serverSearchTerm={}}]},"options-area@root.clients.viewer.staff":{templateUrl:"/webapp/common/views/clients/staff/options.partial.html",controller:"ClientStaffOptionsController"},"stats-area@root.clients.viewer.staff":{templateUrl:"/webapp/common/views/clients/staff/all/staff-module-stats.partial.html",controller:"ClientStaffModuleStatsController"}}}),t.state("root.clients.viewer.staff.cards",{url:"/cards",resolve:{rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){return e.Firstname+" "+e.Surname},SubTitle:function(e){return e.ClientStaffRole&&e.ClientStaffRole.Name},LogoUrl:function(e){return e._ImageUrl},Group:function(e){return e&&e.Active.toString()}}}]},views:{"view-area@root.clients.viewer.staff":{templateUrl:"/e9_components/layouts/module/module-secondary-cards.partial.html",controller:"ModuleSecondaryCardsController"}}}),t.state("root.clients.viewer.staff.table",{url:"/table",resolve:{rAccessors:["$config",function(e){return{Id:function(e){return e.Id}}}],rSchema:function(){return"ClientStaff"},rColumns:function(){return null}},views:{"view-area@root.clients.viewer.staff":{templateUrl:"/e9_components/layouts/module/module-paged-table.partial.html",controller:"ModulePagedTableController"}}})),t.state("root.clients.viewer.staff.viewer",{url:"/:sId","default":"root.clients.viewer.staff.viewer.details",resolve:{rData:["Model","$stateParams","$rootScope",function(e,t,r){return e.ClientStaff.query().where("Id eq guid'"+t.sId+"'").include("Passengers,ClientStaffRole").trackingEnabled().execute()}],rTabs:["$stateParams","$permissions","rData",function(e,t,r){var n=[{heading:"Details",route:"root.clients.viewer.staff.viewer.details"},{heading:"User",route:"root.clients.viewer.staff.viewer.user"}];return r[0].AllPassengers||n.push({heading:"Passengers",route:"root.clients.viewer.staff.viewer.passengers"}),n}],rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){return e.Firstname+" "+e.Surname},LogoUrl:function(e){return e._ImageUrl}}}]},views:{"content-wrapper@root":{controller:"ModuleItemViewController",templateUrl:"/e9_components/layouts/module/module-item.layout.html"}}}),t.state("root.clients.viewer.staff.viewer.details",{url:"/details",controller:"ClientStaffItemDetailController",templateUrl:"/webapp/common/views/clients/staff/details/partial.html",resolve:{rRoles:["Model",function(e){return e.ClientStaffRole.query().execute()}]}}),t.state("root.clients.viewer.staff.viewer.passengers",{url:"/passengers",controller:"ClientStaffItemPassengerController",templateUrl:"/webapp/common/views/clients/staff/passengers/partial.html"}),t.state("root.clients.viewer.staff.viewer.user",{url:"/user",controller:"ClientStaffItemUserController",templateUrl:"/webapp/common/views/clients/staff/user/partial.html",resolve:{rUser:["$http","$stateParams","$config","$q",function(e,t,r,n){var i=n.defer();return e.get(r.API_ENDPOINT+"api/account/UserForOwner?ownerType=ClientStaffId&OwnerId="+t.sId).then(function(e){i.resolve(e.data)},function(e){i.resolve({Message:"User Not Found"})}),i.promise}]}})),i.test("clients","W")&&t.state("root.clients.create",{url:"/create",views:{"content-wrapper@root":{controller:"ClientItemCreateController",templateUrl:"/webapp/management/clients/item/client-item-info.partial.html",resolve:{rClientTypes:["LookupCache","Model",function(e,t){return e.ClientType&&e.ClientType.$updated.isAfter((new moment).subtract(10,"minutes"))?e.ClientType:t.ClientType.query().execute().then(function(t){return e.ClientType=t,e.ClientType.$updated=new moment,e.ClientType})}],rClientTags:["Model",function(e){return e.Tag.query().execute().then(function(e){return e.filter(function(e){return e.EntityType.indexOf("Client")!=-1})})}],rCurrencies:["Model",function(e){return e.Currency.query().execute()}],rStaff:["Model","$stateParams",function(e,t){return e.Staff.query().select("Id,Firstname,Surname").parseAs(function(e){return{Id:e.Id,Name:e.Firstname+" "+e.Surname}}).execute()}]}}}}),i.test("clients.pricingmodels")&&t.state("root.clients.pricingmodels",{url:"/pricingmodels",viewerType:"Client",permission:"Clients - Pricing Models",resolve:{rPricingModels:["Model",function(e){return e.PricingModel.query().trackingEnabled().execute()}],rData:["Model",function(e){return e.Client.query().include("ClientType").trackingEnabled().execute().then(function(e){return e})}]},views:{"content-wrapper@root":{templateUrl:"/webapp/management/clients/pricingmodels/model-assignments.partial.html",controller:"PricingModelAssignmentsController"}}}),i.test("clients.profitability")&&t.state("root.clients.profitability",{url:"/profitability",viewerType:"Client",permission:"Clients - Profitability",resolve:{},views:{"content-wrapper@root":{templateUrl:"/webapp/management/clients/profitability/profitability.partial.html",controller:"ClientProfitabilityController"}}});var o=[{title:"All",state:"root.clients.cards",icon:"icon-user-tie"}];i.test("clients.pricingmodels")&&o.push({title:"Pricing Assignments",state:"root.clients.pricingmodels",icon:"icon-coins"}),i.test("clients.profitability")&&o.push({title:"Profitability",state:"root.clients.profitability",icon:"icon-coins"}),r.registerMenuItem({icon:"domain",title:"Clients",subMenus:o.filter(function(e){return e.state.substring(5)})})}}function r(){}var n=e.module("cab9.clients",[]);n.config(t),n.run(r),t.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider","$permissions"],r.$inject=[]}(angular);;;;
!function(e){function t(t,o,r,n,l,s,d,c,a,f,u,p,m){function h(){window.open(p.API_ENDPOINT+"api/PricingModels/exportClient?clientId="+l.Id)}function x(o){function i(o){o.FixedPrice=parseFloat(o.FixedPrice),o.ClientId=l.Id,o.VehicleTypes&&0==o.VehicleTypes.length&&(o.VehicleTypes=null),u.post(p.API_ENDPOINT+"api/PricingModels/addNewClientFixed",o).then(function(o){t.addNew=!1,t.disabled=!1,t.fixeds.push(o.data),t.newfixed=null,e.forEach(t.fixeds,function(e){var o=e.VehicleTypes.map(function(e){return new s.VehicleTypeInClientPricingFixed(e)});e.VehicleTypes.length=0,[].push.apply(e.VehicleTypes,o),e["delete"]=!1,null!=e.FromId?e.$SelectedFrom=t.zones.find(function(t){return t.Id==e.FromId}):e.$SelectedFrom=e.FromPostcode,null!=e.ToId?e.$SelectedTo=t.zones.find(function(t){return t.Id==e.ToId}):e.$SelectedTo=e.ToPostcode})},function(){t.disabled=!1,console.log("Error occured")})}return null==o.FromId&&(null==o.FromPostcode||o.FromPostcode.length<2)?void swal("Error","Please select either a From Zone or enter a valid Postcode Prefix","error"):null==o.ToId&&(null==o.ToPostcode||o.ToPostcode.length<2)?void swal("Error","Please select either a To Zone or enter a valid Postcode Prefix","error"):void i(o)}function I(){t.addNew=!1,t.newfixed=null}function g(){for(i=0;i<t.fixeds.length;i++)t.fixeds[i]["delete"]=!1;t.showDeleteCheckbox=!1,t.selectAll=!1}function P(o){t.disabled=!0,null!=o.Id&&void 0!=o.Id&&u.post(p.API_ENDPOINT+"api/PricingModels/updateclientfixed",o).then(function(){t.disabled=!1,e.forEach(t.fixeds,function(e){e["delete"]=!1,null!=e.FromId?e.$SelectedFrom=t.zones.find(function(t){return t.Id==e.FromId}):e.$SelectedFrom=e.FromPostcode,null!=e.ToId?e.$SelectedTo=t.zones.find(function(t){return t.Id==e.ToId}):e.$SelectedTo=e.ToPostcode})},function(){t.disabled=!1,console.log("Error occured")})}function T(){swal({title:"Are you sure?",text:"You will not be able to recover fixed pricing!",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},function(){u.post(p.API_ENDPOINT+"api/PricingModels/deleteAllClientFixed?clientId="+t.item.Id).then(function(){swal("Deleted Successfully","Fixed Prices deleted successfully","success"),location.reload()},function(){swal("Delete Error","An error occured","error")})})}function F(){var e=[];e=t.selectAll?t.fixeds:t.fixeds.filter(function(e){return 1==e["delete"]});var o=e.map(function(e){return e.Id});e.length>0?swal({title:"Are you sure?",text:"You will not be able to recover selected fixed pricing!",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},function(){u.post(p.API_ENDPOINT+"api/PricingModels/deleteSelectedClientFixed",o).then(function(){t.fixeds=t.fixeds.filter(function(e){return 0==e["delete"]}),t.showDeleteCheckbox=!1,t.selectAll=!1,swal("Deleted Successfully","Fixed Prices deleted successfully","success"),location.reload()},function(){t.showDeleteCheckbox=!0,t.selectAll=!1,swal("Delete Error","An error occured","error")})}):t.showDeleteCheckbox=!t.showDeleteCheckbox}function w(){t.addNew=!0,t.newfixed=new s.ClientPricingFixed,t.newfixed.PricingModelId=t.item.Id}function y(){m.open({templateUrl:"/webapp/management/clients/item/fixed/import.modal.html",controller:["$scope","$config","$q","Auth","$http","$state","$modalInstance",function(e,t,o,i,r,n,s){function d(){function t(t){e["import"].status="File Uploaded!",e["import"].filename=t.FileName,e["import"].preview=t.Rows,e["import"].stage="VALIDATE",e["import"].hasErrors=t.Rows.filter(function(e){return e.Errors.length>0}).length>0,e["import"].hasWarnings=t.Rows.filter(function(e){return e.Warnings.length>0}).length>0,e["import"].hasErrors||e["import"].hasWarnings?swal({type:"error",title:"Error validating file",text:"Would you like to view the errors?",showCancelButton:!0,confirmButtonText:"Yes, show me the errors."},function(){s.close(),n.go("root.settings.import.client-prices",{progress:e["import"]})}):c().then(function(){s.close()})}function o(){e["import"].status="Error Uploading",swal("Error","Import Failed.","error")}function i(t){e["import"].percent=t,100==t&&(e["import"].percent=null,e["import"].status="Processing")}if(e["import"].file&&!f){if(!e["import"].file.name.endsWith(".csv"))return void swal("Upload Error","CSV files only, file should end with '.csv'.","error");f=!0,e["import"].status="Uploading "+e["import"].file.name,a(e["import"].file).then(t,o,i)}}function c(){if(!e["import"].pressed)return e["import"].pressed=!0,r.post(t.API_ENDPOINT+"api/Import/ClientFixed/Confirm",{filename:e["import"].filename,clientId:e["import"].clientId}).then(function(){swal("Import Success","rows imported successfully","success"),e["import"]={stage:"UPLOAD",clientId:null,file:null,status:"",percent:0,preview:null}},function(){swal("Import Error","An error occured during import","error")})}function a(r){var n=o.defer(),l=new FormData;l.append("file",r);var s=new XMLHttpRequest;return s.upload.onprogress=function(t){e.$apply(function(){t.lengthComputable&&n.notify(Math.round(t.loaded/t.total*100))})},s.onload=function(e){4==e.target.readyState&&(200==e.target.status?n.resolve(JSON.parse(e.target.response)):n.reject(e.target.responseText))},s.onerror=function(e){n.reject(e)},s.onabort=function(e){n.reject(e)},s.open("POST",t.API_ENDPOINT+"api/Import/ClientFixed/Valdate?clientId="+e["import"].clientId,!0),s.setRequestHeader("Authorization","Bearer "+i.getSession().access_token),s.setRequestHeader("Accept-Type","application/json"),s.send(l),n.promise}e["import"]={stage:"UPLOAD",clientId:l.Id,file:null,status:"",percent:0,preview:null};var f=!1;e.validateFile=d,e.importFile=c}]}).result.then(function(){v()})}function v(){var e=s.ClientPricingFixed.query().select("Id").parseAs(function(e){this.Id=e.Id}).filter("ClientId","eq","guid'"+l.Id+"'");t.filters.fromZone&&""!=t.filters.fromZone&&e.filter("FromId eq guid'"+t.filters.fromZone+"'"),t.filters.toZone&&""!=t.filters.toZone&&e.filter("ToId eq guid'"+t.filters.toZone+"'"),t.filters.fromPostcode&&""!=t.filters.fromPostcode&&e.filter("FromPostcode eq'"+t.filters.fromPostcode+"'"),t.filters.toPostcode&&""!=t.filters.toPostcode&&e.filter("ToPostcode eq '"+t.filters.toPostcode+"'"),e.execute().then(function(e){t.paging.totalResults=e.length,t.paging.maxPages=Math.ceil(t.paging.totalResults/t.paging.resultsPerPage),C(1)},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:o.COLOURS.brandSecondary})})}function C(i){t.paging.currentPage=i;var r="api/PricingModels/FetchFixedClientDetails?clientId="+l.Id+"&count=200&pageNum="+i;t.filters.fromZone&&""!=t.filters.fromZone&&(r=r+"&FromId="+t.filters.fromZone),t.filters.toZone&&""!=t.filters.toZone&&(r=r+"&ToId="+t.filters.toZone),t.filters.fromPostcode&&""!=t.filters.fromPostcode&&(r=r+"&FromPostcode="+t.filters.fromPostcode),t.filters.toPostcode&&""!=t.filters.toPostcode&&(r=r+"&ToPostcode="+t.filters.toPostcode),u.get(p.API_ENDPOINT+r).then(function(o){t.fixeds=o.data,o.data.length>0&&(t.fixeds=o.data.map(function(e){return new s.ClientPricingFixed(e)}),e.forEach(t.fixeds,function(e){var o=e.VehicleTypes.map(function(e){return new s.VehicleTypeInClientPricingFixed(e)});e.VehicleTypes.length=0,[].push.apply(e.VehicleTypes,o),e["delete"]=!1,null!=e.FromId?e.$SelectedFrom=t.zones.find(function(t){return t.Id==e.FromId}):e.$SelectedFrom=e.FromPostcode,null!=e.ToId?e.$SelectedTo=t.zones.find(function(t){return t.Id==e.ToId}):e.$SelectedTo=e.ToPostcode}))},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:o.COLOURS.brandSecondary})})}function V(e){var o=[];o.push(t.fixeds[e]),swal({title:"Are you sure?",text:"You will not be able to recover this fixed pricing!",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},function(){u.post(p.API_ENDPOINT+"api/PricingModels/deleteSelectedClientFixed",o).then(function(){t.fixeds.splice(e,1),swal("Deleted Successfully","Fixed Prices deleted successfully","success")},function(){swal("Delete Error","An error occured","error")})})}function S(e,t){if(void 0!=e&&null!=e.VehicleTypes){var o=e.VehicleTypes.filter(function(e){return e.VehicleTypeId==t.Id})[0];return o?o.FixedPrice.toFixed(2):null}}function N(e,t,o){if(void 0!=e&&null!=e.VehicleTypes&&void 0!=e.Id){e.VehicleTypes=e.VehicleTypes||[];var i=e.VehicleTypes.filter(function(e){return e.VehicleTypeId==t.Id})[0];if(i)i.FixedPrice=parseFloat(o);else if(o){var r=new s.VehicleTypeInClientPricingFixed;r.VehicleTypeId=t.Id,r.PricingFixedId=e.Id,r.FixedPrice=parseFloat(o),e.VehicleTypes.push(r)}P(e)}else{var r=new s.VehicleTypeInClientPricingFixed;r.VehicleTypeId=t.Id,r.PricingFixedId=e.Id,r.FixedPrice=parseFloat(o),void 0==e.VehicleTypes&&(e.VehicleTypes=[]);var n=e.VehicleTypes.find(function(e,o){return e.VehicleTypeId==t.Id});if(void 0==n)e.VehicleTypes.push(r);else{var l=e.VehicleTypes.indexOf(n);e.VehicleTypes[l].FixedPrice=parseFloat(o)}}}for(t.paging={currentPage:1,resultsPerPage:10,totalResults:null,maxPages:null},t.paging.totalResults=d.length,t.paging.maxPages=Math.ceil(t.paging.totalResults/t.paging.resultsPerPage),t.setPage=C,t.filter=v,t.fixeds=c||[],t.vehicleTypes=a,t.zones=f,i=0;i<t.fixeds.length;i++)void 0==t.fixeds[i].FixedPrice&&null==t.fixeds[i].FixedPrice||(t.fixeds[i].FixedPrice=t.fixeds[i].FixedPrice.toFixed(2)),t.fixeds[i]["delete"]=!1,null!=t.fixeds[i].FromId?t.fixeds[i].$SelectedFrom=t.zones.find(function(e){return e.Id==t.fixeds[i].FromId}):t.fixeds[i].$SelectedFrom=t.fixeds[i].FromPostcode,null!=t.fixeds[i].ToId?t.fixeds[i].$SelectedTo=t.zones.find(function(e){return e.Id==t.fixeds[i].ToId}):t.fixeds[i].$SelectedTo=t.fixeds[i].ToPostcode;for(t.saveChanges=P,t.cancelDelete=g,t.deleteSelected=F,t.deleteAll=T,t.cancelNewEdit=I,t.startNew=w,t.saveNew=x,t.remove=V,t.startImport=y,t.getVehicleTypeCost=S,t.setVehicleTypeCost=N,t["export"]=h,t.showDeleteCheckbox=!1,t.addNew=!1,t.selectedDropdownItem=null,t.dropdownItems=t.zones,t.text="Text",i=0;i<t.zones.length;i++){var $=t.zones[i];$.readableName=t.zones[i].Name}t.filterObjectList=function(e){var o=r.defer(),i=e.toLowerCase(),n=t.dropdownItems.filter(function(e){var t=0===e.readableName.toLowerCase().indexOf(i);return t});return o.resolve(n),o.promise},t.prices=[],t._pindex=0,t.filters={fromZone:null,toZone:null,fromPostcode:null,toPostcode:null}}var o=e.module("cab9.clients");o.controller("ClientFixedController",t),t.$inject=["$scope","$UI","$q","$state","$stateParams","Model","rFixedCount","rFixeds","rVehicleTypes","rZones","$http","$config","$modal"]}(angular);;;;
!function(e){function t(e,t,l){function n(){e.showSearch=!e.showSearch,!e.showSearch&&e.searchTerm?e.searchTerm.$="":!e.showSearch&&e.serverSearchTerm?e.serverSearchTerm.$="":setTimeout(function(){$("#searchTerm").focus()},500)}function a(){t.open({template:'<div class="modal-header"><button class="close" type="button" ng-click="$close()"><i class="material-icons">clear</i></button><h3 class="modal-title">Client Stats</h3></div><div class="modal-body"><div ng-include="\'/webapp/management/clients/all/clients-module-stats.partial.html\'"></div></div>',controller:"ClientsModuleStatsController",size:"sm",resolve:{rData:function(){return l}}}).result.then(function(e){})}function o(){t.open({templateUrl:"/webapp/management/clients/modals/client-types-modal.partial.html",controller:"ClientTypesModalController",size:"lg",resolve:{rData:["Model","$stateParams","LookupCache",function(e,t,l){return e.ClientType.query().trackingEnabled().execute().then(function(e){return l.ClientType=e,l.ClientType.$updated=new moment,l.ClientType})}]}}).result.then(function(e){})}e.showStatsModal=a,e.toggleSearch=n,e.openClientTypeModal=o}var l=e.module("cab9.clients");l.controller("ClientsModuleOptionsController",t),t.$inject=["$scope","$modal","rData"]}(angular);;;;
!function(t){function e(t,e,n,i,r,c){t.ApiEndPoint=i.API_ENDPOINT;var l=(new moment).subtract(2,"weeks");n.Client.query().select("Id,Active,CreationTime").execute().then(function(e){t.recentClients=e.filter(function(t){return new moment(t.CreationTime).isAfter(l)}),t.quickStats={total:e.length,active:e.filter(function(t){return t.Active}).length,recent:t.recentClients.length}}),t.recentClients=c.filter(function(t){return new moment(t.CreationTime).isAfter(l)}),t.quickStats={total:c.length,active:c.filter(function(t){return t.Active}).length,recent:t.recentClients.length}}var n=t.module("cab9.clients");n.controller("ClientsModuleStatsController",e),e.$inject=["$scope","$UI","Model","$config","$http","rData"]}(angular);;;;
!function(e){function n(e,n,t,l,c,i){function s(){e.newClientType=new l.ClientType}function u(n){e.selected=n}function o(n){n.$patch().success(function(){swal("Success","Client Type Updated","success"),C()}),e.selected=null}function a(){e.newClientType.Name.length>0&&e.newClientType.$save().success(function(){swal("Success","Client Type Saved.","success"),C(),e.newClientType=null}).error(function(){swal({title:"Error Occured",type:"error"})})}function p(n){n.$rollback(),e.selected=null}function y(){e.newClientType=null}function r(e){e.$delete().success(function(){swal("Success","Client Type Deleted","success"),C()})}function C(){l.ClientType.query().trackingEnabled().execute().then(function(n){i.ClientType=n,i.ClientType.$updated=new moment,e.clientTypes=n})}e.clientTypes=t,e.selected=null,e.newClientType=null,e.selectClientType=u,e.updateClientType=o,e.cancelUpdate=p,e.deleteClientType=r,e.createNewClientType=s,e.cancelSave=y,e.saveClientType=a}var t=e.module("cab9.clients");t.controller("ClientTypesModalController",n),n.$inject=["$scope","$modal","rData","Model","$q","LookupCache"]}(angular);;;;
!function(t){function a(t,a,e,o,n,s,i){t.client=i[0];var r=t.DATETIME_FORMAT.replace(/[.|/|-][y|Y][y|Y]*/g,"");t.quickStats={today:"-",week:"-",month:"-"},t.bookingGraph={options:{series:{lines:{show:!0,lineWidth:2,fill:!0,fillColor:{colors:[{opacity:.4},{opacity:.4}]}},points:{show:!0,lineWidth:2},shadowSize:0},grid:{hoverable:!0,clickable:!0,tickColor:"#eee",borderWidth:0},colors:[a.COLOURS.lighterGrey,a.COLOURS.brandPrimary],xaxis:{mode:"time",tickFormatter:function(t,a){var e=s("date")(moment(t).toDate(),r);return e},minTickSize:[1,"day"]},yaxis:{ticks:3,tickDecimals:0}},data:[]};var l=(o({url:e.API_ENDPOINT+"/api/stats",method:"GET",params:{clientId:t.item.Id,from:(new moment).startOf("isoweek").format(),to:(new moment).startOf("day").format(),totalsOnly:!0}}).success(function(a){t.quickStats.week=a.Totals.CountBookings}),o({url:e.API_ENDPOINT+"/api/stats",method:"GET",params:{clientId:t.item.Id,from:(new moment).startOf("month").format(),to:(new moment).startOf("day").format(),totalsOnly:!0}}).success(function(a){t.quickStats.month=a.Totals.CountBookings}),o({url:e.API_ENDPOINT+"/api/stats",method:"GET",params:{clientId:t.item.Id,from:(new moment).subtract(2,"weeks").startOf("day").format(),to:(new moment).startOf("day").format(),fillNulls:!0}})),m=o({url:e.API_ENDPOINT+"/api/stats",method:"GET",params:{from:(new moment).subtract(2,"weeks").startOf("day").format(),to:(new moment).startOf("day").format(),fillNulls:!0}});n.all([l,m]).then(function(a){var e=a[0].data,o=a[1].data,n={label:"Avg Client",data:[]},s={label:t.item.Name,data:[]};t.bookingGraph.data.push(n),t.bookingGraph.data.push(s);for(var i=0;i<e.Periods.length;i++){var r=e.Periods[i];s.data.push([new moment(r.Date).valueOf(),r.CountBookings])}for(var i=0;i<o.Periods.length;i++){var l=o.Periods[i];n.data.push([new moment(l.Date).valueOf(),l.CountAssignedBookings/l.UniqueClients])}t.lastWeekData=a[0].data.Periods.reverse().slice(0,7),t.quickStats.today=t.lastWeekData[0].CountBookings},function(t){})}var e=t.module("cab9.clients");e.controller("ClientItemDashboardController",a),a.$inject=["$scope","$UI","$config","$http","$q","$filter","rData"]}(angular);;;;
!function(e){function n(n,l,t,i,c,o,a,r,s,u,d,p,g,f,C,h,m){function y(){if(n.client.AllowedPaymentTypes){var e=n.client.AllowedPaymentTypes.replaceAll(" ","").split(",");e.indexOf("Card")>-1&&(n.client.$AllowCard=!0),e.indexOf("Cash")>-1&&(n.client.$AllowCash=!0),e.indexOf("OnAccount")>-1&&(n.client.$AllowAccount=!0)}}function I(){confirm("Are You Sure?")&&i.get(p.API_ENDPOINT+"api/bookings/Reprice",{params:{clientId:n.client.Id}}).then(function(){alert("Scheduled.")})}function $(){c.openPicker({type:"Client",id:n.client.Id,searchTerm:n.client.Name}).then(function(e){n.client.ImageUrl=e,O()},function(e){})}function A(){n.displayMode="EDIT"}function B(){n.client.$rollback(!0),n.displayMode="VIEW"}function T(e){"contact"==e?(n.client.BillingContact=n.client.PrimaryContact,n.client.BillingPhone=n.client.Phone,n.client.BillingMobile=n.client.Mobile,n.client.BillingFax=n.client.Fax,n.client.BillingEmail=n.client.Email):"address"==e&&(n.client.BillingAddress1=n.client.Address1,n.client.BillingAddress2=n.client.Address2,n.client.BillingArea=n.client.Area,n.client.BillingTownCity=n.client.TownCity,n.client.BillingPostcode=n.client.Postcode,n.client.BillingCounty=n.client.County,n.client.BillingCountry=n.client.Country,n.client.BillingLatitude=n.client.Latitude,n.client.BillingLongitude=n.client.Longitude)}function w(){swal({title:"Are you sure?",text:"Cancellation rule will be deleted",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){var e=new t.CancellationRule(n.client.CancellationRule);n.client.CancellationRuleId=null,n.client.CancellationRule=null,n.client.$patch().then(function(){e.$delete().then(function(){swal({title:"Client Saved.",text:"Changes have been updated.",type:"success",confirmButtonColor:d.COLOURS.brandSecondary}),g.go(g.current,{Id:f.Id},{reload:!0})})})},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:d.COLOURS.brandSecondary})})}function O(){var i=[],c=[];n.client.$AllowCard&&c.push("Card"),n.client.$AllowCash&&c.push("Cash"),n.client.$AllowAccount&&c.push("OnAccount"),n.client.AllowedPaymentTypes=c.join(",");var o=new t.CancellationRule(n.client.CancellationRule);if(n.client.CancellationRuleId&&(i.push(o.$update()),n.client.CancellationRule=null),e.isDefined(n.client.$$changedValues.Tags)){var a=x.changes(n.client.$$changedValues.Tags,function(e,n){return e.Id==n.Id});e.forEach(a.removed,function(e){i.push(t.$dissociate("Client","ClientTags",n.client.Id,e.Id))}),e.forEach(a.added,function(e){i.push(t.$associate("Client","ClientTags",n.client.Id,e.Id))})}i.push(n.client.$patch()),l.all(i).then(function(){swal({title:"Client Saved.",text:"Changes have been updated.",type:"success",confirmButtonColor:d.COLOURS.brandSecondary}),g.go(g.current,{Id:f.Id},{reload:!0})},function(){alert("Error"),console.log(arguments)})}function v(e){var l=n.client.Tags.map(function(e){return e.Id});return l.indexOf(e.Id)==-1}n.client=o[0],console.log(n.client.RoutingOption),n.comOptions=[{value:null,text:"Company Default"},{value:!0,text:"Yes"},{value:!1,text:"No"}],n.nullValue=null,n.clientTypes=a,n.vehicleTypes=h.map(function(e){return e.ImageUrl=e._ImageUrl,e}),n.clientTags=r,n.pricingModels=s,n.displayMode="VIEW",n.copyToBilling=T,n.staff=C,n.deleteCancellationRule=w,n.taxes=m,n.alreadySelected=v;var x=e.copy(n.client.Tags);y(),n.chooseImage=$,n.startEditing=A,n.cancelEditing=B,n.saveEdits=O,n.recalcJobs=I,n.groupOptions=[{Id:"",Name:"None"},{Id:"Passenger",Name:"Passenger"},{Id:"Booker",Name:"Booker"},{Id:"Reference",Name:"Reference"}],[].push.apply(n.groupOptions,u)}var l=e.module("cab9.clients");l.controller("ClientItemInfoController",n),n.$inject=["$scope","$q","Model","$http","ImageUpload","rData","rClientTypes","rClientTags","rPricingModels","rValidations","$UI","$config","$state","$stateParams","rStaff","rVehicleTypes","rTaxes"]}(angular),String.prototype.replaceAll=function(e,n){return this.split(e).join(n)};;;;
!function(i){function n(n,e,t,l,c,o,a,s,r){function d(i){"contact"==i?(n.client.BillingContact=n.client.PrimaryContact,n.client.BillingPhone=n.client.Phone,n.client.BillingMobile=n.client.Mobile,n.client.BillingFax=n.client.Fax,n.client.BillingEmail=n.client.Email):"address"==i&&(n.client.BillingAddress1=n.client.Address1,n.client.BillingAddress2=n.client.Address2,n.client.BillingArea=n.client.Area,n.client.BillingTownCity=n.client.TownCity,n.client.BillingPostcode=n.client.Postcode,n.client.BillingCounty=n.client.County,n.client.BillingCountry=n.client.Country,n.client.BillingLatitude=n.client.Latitude,n.client.BillingLongitude=n.client.Longitude)}function g(){n.saving=!0;var l=[];i.forEach(n.client.ClientTags,function(i){l.push(t.$associate("Client","ClientTags",n.client.Id,i.Id))}),l.push(n.client.$save()),a.all(l).then(function(i){swal({title:"Client Saved.",text:"New Client has been added.",type:"success",confirmButtonColor:o.COLOURS.brandSecondary}),e.go("root.clients.viewer.dashboard",{Id:i[0].data.Id})},function(){alert("Error"),console.log(arguments)})}function u(){e.go("root.clients.cards")}n.clientTypes=l,n.client=new t.Client,n.displayMode="CREATE",n.clientTags=c,n.currencies=s,n.copyToBilling=d,n.staff=r,n.client.ClientTags=[],n.saveEdits=g,n.cancelEditing=u}var e=i.module("cab9.clients");e.controller("ClientItemCreateController",n),n.$inject=["$scope","$state","Model","rClientTypes","rClientTags","$UI","$q","rCurrencies","rStaff"]}(angular);;;;
!function(e){function t(e,t,o,r,n,l,c,i,u,a,s){function d(t){var o=e.notes.indexOf(t),n=r.open({templateUrl:"/webapp/common/modals/notes.modal.html",controller:"NoteEditController",size:"lg",resolve:{rNote:function(){return new c.Note(t)}}});n.result.then(function(t){c.Note.query().where("Id","==","guid'"+t.Id+"'").execute().then(function(t){e.notes[o]=t[0]},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:u.COLOURS.brandSecondary})})},function(){})}function f(){var t=r.open({templateUrl:"/webapp/common/modals/notes.modal.html",controller:"NoteCreateController",size:"lg",resolve:{rOwner:function(){return"CLIENT"}}});t.result.then(function(t){c.Note.query().where("Id","==","guid'"+t.Id+"'").execute().then(function(t){e.notes.push(t[0])},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:u.COLOURS.brandSecondary})})})}function m(t){swal({title:"Are you sure?",text:"Note will be deleted",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){var o=e.notes.indexOf(t);new c.Note(t).$delete().then(function(t){swal({title:"Note Deleted.",text:"Note has been deleted.",type:"success",confirmButtonColor:u.COLOURS.brandSecondary}),e.notes.splice(o,1)})},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:u.COLOURS.brandSecondary})})}function C(e){var t=null,o=s.filter(function(t){return t.Id==e})[0];if(o)switch(o.UserType){case"Staff ":var r=o.Claims.filter(function(e){return"StaffId"==e.ClaimType})[0];if(r){var n=a.filter(function(e){return e.Id==r.ClaimValue})[0];t=n?n.Name:null}}return t}e.notes=t,e.displayMode="VIEW",e.addNote=f,e.editNote=d,e.deleteNote=m,e.getUserName=C}var o=e.module("cab9.clients");o.controller("ClientItemNotesController",t),t.$inject=["$scope","rNotes","$state","$modal","$stateParams","$q","Model","$config","$UI","rStaffs","rUsers"]}(angular);;;;
!function(e){function r(r,n,o,s){function t(){r.showSearch=!r.showSearch,r.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):r.searchTerm.$=""}function a(){s.open({templateUrl:"/webapp/common/modals/passenger/create.modal.html",controller:"PassengerItemCreateModalController",resolve:{rClientId:function(){return o.Id},rNavigateAfterSave:function(){return!0}}})}r.passengers=e.copy(n),r.newPassenger=a,r.toggleSearch=t,r.$watch("searchTerm.$",function(o,s){o&&""!=o.trim()?r.passengers=n.filter(function(e){return(e._Fullname+e.Phone+e.Mobile+e.Email+e._Addresses).toLowerCase().indexOf(o.toLowerCase())!=-1}):r.passengers=e.copy(n)})}var n=e.module("cab9.clients");n.controller("ClientItemPassengersController",r),r.$inject=["$scope","rPassengers","$stateParams","$modal"]}(angular);;;;
!function(e){function n(n,s,t,a,r,o){function i(e,s){swal({title:"Are you sure?",text:"This will merge all bookings to target passenger and remove duplicate passenger.",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, merge!",closeOnConfirm:!0},function(t){t&&r.get(o.API_ENDPOINT+"api/client/merge",{params:{targetPassengerId:e.Id,mergePassengerId:s.Id}}).then(function(t){r.get(o.API_ENDPOINT+"api/client/duplicates",{params:{passengerId:e.Id}}).then(function(t){e.dupes=t.data;var a=n.passengers.filter(function(e){return e.Id==s.Id})[0];if(a){e.Bookings+=a.Bookings;var r=n.passengers.indexOf(a);n.passengers.splice(r,1)}})})})}function c(e){e.$expand=!e.$expand,e.$expand?r.get(o.API_ENDPOINT+"api/client/duplicates",{params:{passengerId:e.Id}}).then(function(n){e.dupes=n.data}):e.dupes=null}function l(){n.showSearch=!n.showSearch,n.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):n.searchTerm.$=""}n.passengers=s,n.toggleSearch=l,n.toggleRow=c,n.merge=i,n.$watch("searchTerm.$",function(t,a){t&&""!=t.trim()?n.passengers=s.filter(function(e){return(e._Fullname+e.Phone+e.Mobile+e.Email+e._Addresses).toLowerCase().indexOf(t.toLowerCase())!=-1}):n.passengers=e.copy(s)})}var s=e.module("cab9.clients");s.controller("ClientItemProfilesController",n),n.$inject=["$scope","rPassengers","$stateParams","$modal","$http","$config"]}(angular);;;;
!function(t){function n(t,n,e,i,a,c,l){function r(n){l.open({templateUrl:"/webapp/management/clients/item/client-item-knownlocation.modal.html",controller:"ClientLocationCreateController",resolve:{rClient:function(){return t.client}}}).result.then(function(){i.Client.query().select("KnownLocations").include("KnownLocations").filter("Id eq guid'"+t.client.Id+"'").execute().then(function(n){t.existingLocations=n[0].KnownLocations.map(function(n){return n.$distance=parseFloat(o(t.client.Latitude,t.client.Longitude,n.Latitude,n.Longitude).toFixed(2)),n})})})}function s(n){swal({title:"Are you sure?",text:"Location will be unlinked.",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm Delete!"},function(){i.$dissociate("Client","Location",t.client.Id,n.Id).then(function(){var e=t.existingLocations.indexOf(n);t.existingLocations.splice(e,1),swal({title:"Location removed.",text:"Changes have been updated.",type:"success"})})})}t.displayMode="VIEW",t.client=c[0],t.existingLocations=c[0].KnownLocations.map(function(n){return n.$distance=parseFloat(o(t.client.Latitude,t.client.Longitude,n.Latitude,n.Longitude).toFixed(2)),n}),t.removeLocation=s,t.addLocation=r}function e(t,n,e,o,i){function a(){t.item.StopSummary=window.$utilities.formatAddress(t.item),t.item.$save().then(function(t){e.$associate("Client","Location",i.Id,t.data.Id).then(function(t){swal("Success","The location saved successfully","success"),n.close()},function(t){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:$UI.COLOURS.brandSecondary})})},function(){swal("Error","The location failed to save.","error")})}t.item=new e.KnownLocation,t.save=a}function o(t,n,e,o){var a=6371,c=i(e-t),l=i(o-n),r=Math.sin(c/2)*Math.sin(c/2)+Math.cos(i(t))*Math.cos(i(e))*Math.sin(l/2)*Math.sin(l/2),s=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)),u=a*s;return u}function i(t){return t*(Math.PI/180)}var a=t.module("cab9.clients");a.controller("ClientItemLocationsController",n),n.$inject=["$scope","$filter","$q","Model","rData","rLocations","$modal"],a.controller("ClientLocationCreateController",e),e.$inject=["$scope","$modalInstance","Model","$state","rClient"]}(angular);;;;
!function(){function e(e,t,n,l,u,r,a,s){function d(){e.adjustments=angular.copy(r),e.filters.Approved&&""!=e.filters.Approved&&("Approved"==e.filters.Approved&&(e.adjustments=e.adjustments.filter(function(e){return e.Approved})),"UnApproved"==e.filters.Approved&&(e.adjustments=e.adjustments.filter(function(e){return!e.Approved}))),e.filters.Type&&""!=e.filters.Type&&(e.adjustments=e.adjustments.filter(function(t){return t.Type==e.filters.Type}))}function i(e){swal({title:"Are you sure?",text:"Adjustment will be deleted",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){new a.ClientAdjustment(e).$delete().then(function(e){swal({title:"Adjustment deleted",text:"Changes have been updated.",type:"success",confirmButtonColor:t.COLOURS.brandSecondary}),n.go(n.current,l,{reload:!0})},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:t.COLOURS.brandSecondary})})})}function o(){var e=u.open({templateUrl:"/webapp/management/clients/modals/adjustments.modal.html",controller:"ClientItemAdjustmentCreateController",resolve:{rClientId:function(){return l.Id},rTaxes:function(){return a.Tax.query().execute()},rVehicleTypes:function(){return a.VehicleType.query().select("Id, Name").execute()}}});e.result.then(function(e){n.go(n.current,l,{reload:!0})},function(){})}function c(t){var r=(e.adjustments.indexOf(t),u.open({templateUrl:"/webapp/management/clients/modals/adjustments.modal.html",controller:"ClientItemAdjustmentEditController",size:"lg",resolve:{rAdjustment:function(){return a.ClientAdjustment.query().where("Id eq guid'"+t.Id+"'").trackingEnabled().execute()},rTaxes:function(){return a.Tax.query().execute()},rVehicleTypes:function(){return a.VehicleType.query().select("Id, Name").execute()}}}));r.result.then(function(e){n.go(n.current,l,{reload:!0})},function(){})}e.adjustments=angular.copy(r),e.recurring=!1,e.openAdjustmentCreate=o,e.deleteAdjustment=i,e.recurring=s,e.schema="ClientAdjustment",e.showFilters=!1,e.filters={Approved:null,Type:null,Source:null},e.filterAdjustments=d,e.openAdjustmentEdit=c}var t=angular.module("cab9.clients");t.controller("ClientItemAdjustmentsController",e),e.$inject=["$scope","$UI","$state","$stateParams","$modal","rAdjustments","Model","rRecurring"]}(),function(e){function t(e,t,n,l,u,r,a,s,d,i,o,c,m){function p(t){e.adjustment.$VehicleTypes.push(t);var n=e.unlinkedVehicleTypes.filter(function(e){return e.Id==t.Id});n[0]&&e.unlinkedVehicleTypes.splice(e.unlinkedVehicleTypes.indexOf(n[0]),1),e.selectedVehicleType=null}function f(t){e.unlinkedVehicleTypes.push(t);var n=e.adjustment.$VehicleTypes.filter(function(e){return e.Id==t.Id});n[0]&&e.adjustment.$VehicleTypes.splice(e.adjustment.$VehicleTypes.indexOf(n[0]),1)}function y(e){e.selected=!e.selected}function h(){try{e.adjustment.AppliesToBooking?(e.adjustment.DaysOfWeek=j(e.week),e.adjustment.StartTime=T(e.adjustment.$StartTime),e.adjustment.EndTime=T(e.adjustment.$EndTime),e.adjustment.VehicleTypes=v(e.adjustment.$VehicleTypes)):(e.adjustment.DaysOfWeek=null,e.adjustment.StartTime=null,e.adjustment.EndTime=null,e.adjustment.VehicleTypes=null,e.adjustment.ActivateByCode=null),e.adjustment.AppliesToBooking&&(e.adjustment.Recurring="Recurring"),e.adjustment.$save().then(function(e){swal({title:"Adjustment Model Saved!",text:"Changes have been updated.",type:"success",confirmButtonColor:s.COLOURS.brandSecondary}),n.close(e)},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:s.COLOURS.brandSecondary})})}catch(t){swal({title:"Some Error Occured.",text:t.message,type:"error",confirmButtonColor:s.COLOURS.brandSecondary})}}function j(e){var t=0;return e.map(function(e){1==e.selected&&(t+=e.value)}),t>0?t:null}function T(e){if(e&&e.length>0){if(2==e.split(":").length)return parseFloat(60*e.split(":")[0])+parseFloat(e.split(":")[1]);throw{message:"Time is not in correct format. Please check your input and try again."}}return null}function v(e){if(e.length>0){var t=e.map(function(e){return e.Id});return t.join(",")}return null}e.adjustment=new i.ClientAdjustment,e.adjustment.TaxId=e.COMPANY.DefaultTaxId,e.adjustment.ClientId=o,e.adjustment.Approved=!1,e.viewMode="CREATE",e.save=h,e.taxes=c,e.recurring=!0,e.adjustment.$VehicleTypes=[],e.unlinkedVehicleTypes=m,e.addVehicleType=p,e.removeVehicleType=f,e.toggleDay=y,e.week=[{day:"Su",value:1,selected:!1,full:"Sunday"},{day:"Mo",value:2,selected:!1,full:"Monday"},{day:"Tu",value:4,selected:!1,full:"Tuesday"},{day:"We",value:8,selected:!1,full:"Wednesday"},{day:"Th",value:16,selected:!1,full:"Thursday"},{day:"Fr",value:32,selected:!1,full:"Friday"},{day:"Sa",value:64,selected:!1,full:"Saturday"}]}function n(e,t,n,l,u,r,a,s,d,i,o,c,m){function p(t){e.adjustment.$VehicleTypes.push(t);var n=e.unlinkedVehicleTypes.filter(function(e){return e.Id==t.Id});n[0]&&e.unlinkedVehicleTypes.splice(e.unlinkedVehicleTypes.indexOf(n[0]),1),e.selectedVehicleType=null}function f(t){e.unlinkedVehicleTypes.push(t);var n=e.adjustment.$VehicleTypes.filter(function(e){return e.Id==t.Id});n[0]&&e.adjustment.$VehicleTypes.splice(e.adjustment.$VehicleTypes.indexOf(n[0]),1)}function y(e){e.selected=!e.selected}function h(){try{e.adjustment.AppliesToBooking?(e.adjustment.DaysOfWeek=v(e.week),e.adjustment.StartTime=g(e.adjustment.$StartTime),e.adjustment.EndTime=g(e.adjustment.$EndTime),e.adjustment.VehicleTypes=C(e.adjustment.$VehicleTypes)):(e.adjustment.DaysOfWeek=null,e.adjustment.StartTime=null,e.adjustment.EndTime=null,e.adjustment.VehicleTypes=null,e.adjustment.ActivateByCode=null),e.adjustment.AppliesToBooking&&(e.adjustment.Recurring="Recurring"),e.adjustment.$patch().then(function(e){swal({title:"Adjustment Model Updated!",text:"Changes have been updated.",type:"success",confirmButtonColor:s.COLOURS.brandSecondary}),n.close(e)},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:s.COLOURS.brandSecondary})})}catch(t){swal({title:"Some Error Occured.",text:t.message,type:"error",confirmButtonColor:s.COLOURS.brandSecondary})}}function j(){if(T(),e.adjustment.$StartTime=$(e.adjustment.StartTime),e.adjustment.$EndTime=$(e.adjustment.EndTime),e.adjustment.$VehicleTypes=[],e.adjustment.VehicleTypes){var t=e.adjustment.VehicleTypes.split(",");e.unlinkedVehicleTypes.map(function(n){t.indexOf(n.Id)>-1&&(e.adjustment.$VehicleTypes.push(n),n.$assigned=!0)}),e.unlinkedVehicleTypes=e.unlinkedVehicleTypes.filter(function(e){return!e.$assigned})}}function T(){e.adjustment.DaysOfWeek&&e.adjustment.DaysOfWeek.length>0&&e.week.map(function(t){e.adjustment.DaysOfWeek.indexOf(t.full)>-1&&(t.selected=!0)})}function v(e){var t=0;return e.map(function(e){1==e.selected&&(t+=e.value)}),t>0?t:null}function g(e){if(e&&e.length>0){if(2==e.split(":").length)return parseFloat(60*e.split(":")[0])+parseFloat(e.split(":")[1]);throw{message:"Time is not in correct format. Please check your input and try again."}}return null}function $(e){if(e){if("number"==typeof e){var t=Math.floor(e/60)<10?"0"+Math.floor(e/60):Math.floor(e/60),e=e%60<10?"0"+e%60:e%60;return t+":"+e}throw{message:"Time is not in correct format. Please check your input and try again."}}return null}function C(e){if(e.length>0){var t=e.map(function(e){return e.Id});return t.join(",")}return null}e.taxes=c,e.adjustment=o[0],e.viewMode="EDIT",e.save=h,e.recurring=!1,e.addVehicleType=p,e.removeVehicleType=f,e.toggleDay=y,e.unlinkedVehicleTypes=m,e.week=[{day:"Su",value:1,selected:!1,full:"Sunday"},{day:"Mo",value:2,selected:!1,full:"Monday"},{day:"Tu",value:4,selected:!1,full:"Tuesday"},{day:"We",value:8,selected:!1,full:"Wednesday"},{day:"Th",value:16,selected:!1,full:"Thursday"},{day:"Fr",value:32,selected:!1,full:"Friday"},{day:"Sa",value:64,selected:!1,full:"Saturday"}],j()}var l=e.module("cab9.clients");l.controller("ClientItemAdjustmentCreateController",t),t.$inject=["$scope","$stateParams","$modalInstance","$rootScope","$state","$q","$config","$UI","$http","Model","rClientId","rTaxes","rVehicleTypes"],l.controller("ClientItemAdjustmentEditController",n),n.$inject=["$scope","$stateParams","$modalInstance","$rootScope","$state","$q","$config","$UI","$http","Model","rAdjustment","rTaxes","rVehicleTypes"]}(angular);;;;
!function(e){function t(e,t,n,o,r,s,c,l){function u(){l.download(e.query.results.map(function(e){return{From:e.from,To:e.to,"Distance (Miles)":e.EstimatedDistance,"Cost (�)":e.FinalCost}}),"PriceList")}function m(){a=moment();var n=[];e.query.results=[],t.get("/includes/data/UkLatLng.json").then(function(t){var o=t.data,r=e.query.from.split(" ").join("").split("\n"),s=e.query.to.split(" ").join("").split("\n");for(i=0,len=r.length;i<len;i++){var a=o[r[i]];if(a)for(a.Postcode=r[i],j=0,len=s.length;j<len;j++){var c=o[s[j]];if(c){var l={VehicleTypeId:e.query.vehicleTypeId,BookedDateTime:e.query.bookedDateTime,BookingStops:[a],PricingModelId:e.client.PricingModelId,from:r[i],to:s[j]};l.BookingStops.push({Postcode:s[j],latitude:c.latitude,longitude:c.longitude}),n.push(l)}}}e.query.progress=0,e.query.progressString="Fetching(0/"+o.length+")",totalLength=n.length,count=0,e.query.progressString="Fetching("+count+"/"+totalLength+")",0!=n.length&&d(n)},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:$UI.COLOURS.brandSecondary})})}function d(o){function s(o){for(i=0;i<o.length;i++){o[i].ClientId=e.client.Id;var r=o[i];c.push(t.post(n.API_ENDPOINT+"api/quote",r).then(function(t){count++,e.query.progress=count/totalLength*100,e.query.progressString="Fetching("+count+"/"+totalLength+")",e.query.results.push({from:r.from,to:r.to,EstimatedDistance:t.data.EstimatedDistance,FinalCost:t.data.FinalCost,EstimatedMins:t.data.EstimatedMins})}))}return c}if(0==o.length)return swal({title:"Price List Fetched",text:"Changes have been updated.",type:"success"}),console.log(moment().diff(a,"seconds")),void(e.query.progress=null);var c=[];c=s(o.length>1?o.splice(0,1):o.splice(0,o.length)),r.all(c).then(function(e){d(o)})}function p(t){e.view.current=t}function g(){var i=new moment(e.repricing.fromDate).format("YYYY-MM-DD"),r=new moment(e.repricing.fromTime).format("HH:mm:ss.ssssZ"),s=i+"T"+r,a=new moment(e.repricing.toDate).format("YYYY-MM-DD"),c=new moment(e.repricing.toTime).format("HH:mm:ss.sssZ"),l=a+"T"+c;t.post(n.API_ENDPOINT+"api/client/reprice",{from:s,to:l,email:e.repricing.email,clientId:o.Id}).success(function(){swal("Repricing Queued","Repricing has been queued, you will receive an email when completed","success")})}e.client=c[0],e.view={current:"REPRICE",switchTo:p},e.vehicleTypes=s;var f=(new moment).subtract(7,"days").startOf("day").toDate(),h=(new moment).endOf("day").startOf("second").toDate();e.repricing={period:"Last 7 Days",from:f,fromDate:f,fromTime:f,to:h,toDate:h,toTime:h,email:"dbeech@e9ine.com",send:g},e.query={from:"",to:"",vehicleTypeId:e.vehicleTypes[0].Id,submit:m,download:u,results:null,bookedDateTime:moment().hour(10).minute(0)},e.openCalendar=function(t,n){e.repricing[n]=!0,t.preventDefault(),t.stopPropagation()}}var n=e.module("cab9.clients");n.controller("ClientItemAdvancedController",t),t.$inject=["$scope","$http","$config","$stateParams","$q","rVehicleTypes","rData","CSV"]}(angular);;;;
!function(e){function s(e,s,a,n,i,t,r,g){function c(a,t){e.paging.loading=!0,e.paging.currentPage=a||1,n.get(i.API_ENDPOINT+"api/invite/passengers",{params:{clientId:s.Id,invited:!1,pageNumber:a||1,records:e.paging.resultsPerPage,searchTerm:t||null}}).success(function(s){e.paging.loading=!1,e.paging.totalResults=s.Count,e.paging.maxPages=Math.ceil(e.paging.totalResults/e.paging.resultsPerPage),e.uninvitedPassengers=s.Passengers.map(function(e){return new r.Passenger(e)})}).error(function(s){e.paging.loading=!1,swal("Error",s.Message,"error")})}function o(a,t){e.paging.loading=!0,e.paging.currentPage=a||1,n.get(i.API_ENDPOINT+"api/invite/passengers",{params:{clientId:s.Id,invited:!0,pageNumber:a||1,records:e.paging.resultsPerPage,searchTerm:t||null}}).success(function(s){e.paging.loading=!1,e.paging.totalResults=s.Count,e.paging.maxPages=Math.ceil(e.paging.totalResults/e.paging.resultsPerPage),e.invitedPassengers=s.Passengers.map(function(e){return new r.Passenger(e)})}).error(function(s){e.paging.loading=!1,swal("Error",s.Message,"error")})}function l(a,t){e.paging.loading=!0,e.paging.currentPage=a||1,n.get(i.API_ENDPOINT+"api/invite/FailedPassengers",{params:{clientId:s.Id,pageNumber:a||1,records:e.paging.resultsPerPage,searchTerm:t||null}}).success(function(s){e.paging.loading=!1,e.paging.totalResults=s.Count,e.paging.maxPages=Math.ceil(e.paging.totalResults/e.paging.resultsPerPage),e.failedPassengers=s.Passengers.map(function(e){return new r.PassengerAppInvitationDetail(e)})}).error(function(s){e.paging.loading=!1,swal("Error",s.Message,"error")})}function p(a){swal({title:"Invite Selected Passengers?",text:"Are you sure you want to invite selected passengers?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, Invite them!",cancelButtonText:"Cancel",closeOnConfirm:!1,closeOnCancel:!1},function(t){t?n.post(i.API_ENDPOINT+"api/Invite/selectedPassengers?ClientId="+s.Id,e.selectedRows).then(function(s){a?e.failedPassengers=e.failedPassengers.filter(function(s){return e.selectedRows.indexOf(s.Id)<0}):a||(e.uninvitedPassengers=e.uninvitedPassengers.filter(function(s){return e.selectedRows.indexOf(s.Id)<0})),e.selectedRows=[],swal("Invite Success","Invitation mail with username and password will be sent to selected passengers shortly.","success")},function(){swal("Invite Error","An error occured.","error")}):swal.close()})}function u(a){swal({title:"Invite All Passengers?",text:"Are you sure you want to invite all the passengers?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, Invite them!",cancelButtonText:"Cancel",closeOnConfirm:!1,closeOnCancel:!1},function(t){t?(a?e.selectedRows=e.failedPassengers.map(function(e){return e.Id}):e.selectedRows=e.uninvitedPassengers.map(function(e){return e.Id}),n.post(i.API_ENDPOINT+"api/Invite/selectedPassengers?ClientId="+s.Id,e.selectedRows).then(function(s){a?e.failedPassengers=[]:a||(e.uninvitedPassengers=[]),e.selectedRows=[],swal("Invite Success","Invitation mail with username and password will be sent to selected passengers shortly.","success")},function(s){e.selectedRows=[],swal("Invite Error","An error occured.","error")})):(e.selectedRows=[],swal.close())})}function m(s,a,n){if(a.$selected=!a.$selected,a.$selected)a.$selected&&e.selectedRows.push(a.Id);else{var i=e.selectedRows.indexOf(a.Id);e.selectedRows.splice(i,1)}}function d(){"UNINVITED"==e.tab.current?(e.showSearch=!e.showSearch,e.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):e.searchTerm.$=""):"INVITED"==e.tab.current?(e.showInvitedSearch=!e.showInvitedSearch,e.showInvitedSearch?setTimeout(function(){$("#searchTerm").focus()},500):e.invitedSearchTerm.$=""):"FAILED"==e.tab.current&&(e.showFailedSearch=!e.showFailedSearch,e.showFailedSearch?setTimeout(function(){$("#searchTerm").focus()},500):e.failedSearchTerm.$="")}function f(){var s=t.getSession().Claims.TenantId?t.getSession().Claims.TenantId[0]:null;null!=s&&("50F56597-C049-E611-80C7-14187728D133"==s.toUpperCase()?(e.images=[],e.images.first="/includes/images/customer-app/excel/app-image-1.jpg",e.images.second="/includes/images/customer-app/excel/app-image-2.jpg",e.images.third="/includes/images/customer-app/excel/app-image-3.jpg",e.images.fourth="/includes/images/customer-app/excel/app-image-4.jpg"):"301FD400-A0FC-496F-A630-BCB6A6DD5BE7"==s.toUpperCase()?(e.images=[],e.images.first="/includes/images/customer-app/sherbet/app-image-1.jpg",e.images.second="/includes/images/customer-app/sherbet/app-image-2.jpg",e.images.third="/includes/images/customer-app/sherbet/app-image-3.jpg",e.images.fourth="/includes/images/customer-app/sherbet/app-image-4.jpg"):"05d27dec-e958-44af-a255-530826ea2d9c"==s.toUpperCase()?(e.images=[],e.images.first="/includes/images/customer-app/jgexec/app-image-1.jpg",e.images.second="/includes/images/customer-app/jgexec/app-image-2.jpg",e.images.third="/includes/images/customer-app/jgexec/app-image-3.jpg",e.images.fourth="/includes/images/customer-app/jgexec/app-image-4.jpg"):"47eeb57a-b187-4661-a28e-11adceeb1398"==s.toUpperCase()?(e.images=[],e.images.first="/includes/images/customer-app/laplus/app-image-1.jpg",e.images.second="/includes/images/customer-app/laplus/app-image-2.jpg",e.images.third="/includes/images/customer-app/laplus/app-image-3.jpg",e.images.fourth="/includes/images/customer-app/laplus/app-image-4.jpg"):(e.images=[],e.images.first="/includes/images/customer-app/excel/app-image-1.jpg",e.images.second="/includes/images/customer-app/excel/app-image-2.jpg",e.images.third="/includes/images/customer-app/excel/app-image-3.jpg",e.images.fourth="/includes/images/customer-app/excel/app-image-4.jpg"))}function h(e){P(I+=e)}function P(e){var s,a=document.getElementsByClassName("mySlides");for(e>a.length&&(I=1),e<1&&(I=a.length),s=0;s<a.length;s++)a[s].style.display="none";a[I-1].style.display="block"}e.tab={current:"UNINVITED"},e.selectedRows=[];var I=1;e.paging={currentPage:1,resultsPerPage:20,totalResults:null,maxPages:null,loading:!0},e.inviteSelected=p,e.inviteAll=u,e.plusDivs=h,e.showDivs=P,e.getImages=f,e.getUninvitedPassengers=c,e.getInvitedPassengers=o,e.getFailedPassengers=l,e.toggleSearch=d,e.toggleRowSelection=m,f(),c(1)}var a=e.module("cab9.clients");a.controller("ClientInviteToAppController",s),s.$inject=["$scope","$stateParams","$modal","$http","$config","Auth","Model","$window"]}(angular);;;;
!function(){function e(e,n,t){function l(e){e.$patch(!0).success(function(){e.$selected=!1})}function i(e){e.$selected=!1,e.PricingModelId=e.CommDefaultId}function c(e){e.$selected=!0,e.CommDefaultId=e.PricingModelId}function o(n){var t="Company Default",l="Group Default",i=null;return n.PricingModelId?(i=e.paymentModels.filter(function(e){return e.Id==n.PricingModelId})[0],t=i?i.Name:t):n.ClientType&&n.ClientType.PricingModelId&&(i=e.paymentModels.filter(function(e){return e.Id==n.ClientType.PricingModelId})[0],t=i?l:t),t}e.paymentModels=n,e.clientTypes={},angular.forEach(t,function(n){e.clientTypes[n.ClientType.Name]||(e.clientTypes[n.ClientType.Name]=[],e.clientTypes[n.ClientType.Name].push(n.ClientType)),e.clientTypes[n.ClientType.Name].push(n)}),e.updateCommModel=l,e.cancelUpdate=i,e.EditModel=c,e.getCommModel=o}var n=angular.module("cab9.clients");n.controller("PricingModelAssignmentsController",e),e.$inject=["$scope","rPricingModels","rData"]}();;;;
!function(){function e(e,r,t,a,n,o){function s(r,t){var a="";a=e.searchTerm.ViewMode?t?"Months['"+r+"'].Weeks['"+t+"'].Change || -10000":"Average":t?"Months['"+r+"'].Weeks['"+t+"'].TotalProfit || -10000":"TotalProfit",e.searchTerm.Order==a?e.searchTerm.OrderReverse=!e.searchTerm.OrderReverse:e.searchTerm.OrderReverse=!0,e.searchTerm.Order=a,i()}function c(n){"-"==n?e.offset++:"+"==n&&e.offset--,e.offset<0&&(e.offset=0),u&&(a.cancel(u),u=null),a(function(){e.periods=null,e.clients=null,g=null,r.get(t.API_ENDPOINT+"api/client/profitability",{params:{to:(new moment).subtract(e.offset,"weeks").format("YYYY-MM-DD")}}).then(function(r){e.periods=r.data.Totals,g=r.data.Data,e.paging.totalItems=r.data.Data.length,i()})},500)}function i(){if(g){var r=g;if(e.searchTerm.Account){var t=e.searchTerm.Account.toLowerCase();r=r.filter(function(e){return e.ClientAccount.toLowerCase().indexOf(t)!=-1||e.ClientName.toLowerCase().indexOf(t)!=-1})}e.searchTerm.Bookings&&(r=r.filter(function(r){return r.Bookings>=e.searchTerm.Bookings})),e.paging.totalItems=r.length,e.searchTerm.Order&&(r=n("orderBy")(r,e.searchTerm.Order,e.searchTerm.OrderReverse));var a=(e.paging.currentPage-1)*e.paging.maxPerPage;r=r.slice(a,a+e.paging.maxPerPage),e.clients=r}}function l(){e.showSearch=!e.showSearch,e.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):e.searchTerm.$=""}function f(e,r,t){return null===e?"rgba(0,180,0,1)":void 0===e?"rgba(210,210,210,0.2)":e>0?"rgba(0,180,0,"+e/r/1.5+")":"rgba(180,0,0,"+Math.abs(e)/Math.abs(t)/1.5+")"}e.periods=null;var g=null;e.clients=null,e.getColour=f,e.toggleSearch=l,e.searchTerm={ViewMode:!0,Order:"TotalProfit",OrderReverse:!0},e.move=c,e.offset=0,e.paging={currentPage:1,maxPerPage:20,totalItems:0},e.setOrdering=s,c();var u=null;e.$watchGroup(["searchTerm.Account","searchTerm.Bookings","paging.currentPage"],i)}var r=angular.module("cab9.clients");r.controller("ClientProfitabilityController",e),e.$inject=["$scope","$http","$config","$timeout","$filter","$parse"]}();;;;
!function(){function o(o,n,t,e){function c(o){e.go("root.clients.conversations.selected",{Id:o.Id})}o.bookings=[],n.get(t.API_ENDPOINT+"api/conversations/fetchbyclient",{}).success(function(n){[].push.apply(o.bookings,n)}),o.selectBooking=c}var n=angular.module("cab9.clients");n.controller("ConversationsController",o),o.$inject=["$scope","$http","$config","$state"]}();;;;
!function(){function e(e,n,o,s,i){function g(){e.newMessage.Body.length>0&&e.newMessage.$save().success(function(){e.newMessage=new s.Conversation,e.newMessage.BookingId=e.booking.Id,e.newMessage.SenderId=i.getSession().UserId,e.newMessage.Body=""}).error(function(){})}e.booking=o[0],e.booking.Conversations=n,e.newMessage=new s.Conversation,e.newMessage.BookingId=e.booking.Id,e.newMessage.SenderId=i.getSession().UserId,console.log(i.getSession()),e.newMessage.Type="Client",e.newMessage.Body="",e.sendMessage=g,e.$on("SIGNALR_newMessage",function(n,o){e.booking.Conversations||(e.booking.Conversations=[]),e.booking.Conversations.push(new s.Conversation(o[0])),e.$apply()})}var n=angular.module("cab9.clients");n.controller("ConversationSelectedController",e),e.$inject=["$scope","rConversations","rBooking","Model","Auth"]}();;;;
!function(e){function t(t,r,o,i,n,s,a,l,f,d,c){function u(){o.open({templateUrl:"/webapp/management/bookings/modals/filter.modal.partial.html",controller:["$scope","rFilter","$modalInstance","Model",function(t,r,o,n){function s(e,r){t.filterOptions[r]=e}function a(e){e&&(t.loadingDrivers=!0,i.get($config.API_ENDPOINT+"api/Drivers/Search",{params:{searchText:e,lite:!0}}).then(function(e){t.drivers=[];for(var r=0;r<e.data.length;r++){var o=e.data[r];t.filterOptions.DriverIds.indexOf(o.Id)==-1&&t.drivers.push({Id:o.Id,Name:o.Firstname+" "+o.Surname+" ("+o.Callsign+")",Description:o.DriverType.Name})}t.loadingDrivers=!1}))}function l(e){e&&(t.loadingPassengers=!0,i.get($config.API_ENDPOINT+"api/Passengers/Search",{params:{searchText:e,clientId:t.filterOptions.ClientId,lite:!0}}).then(function(e){t.passengers=[];for(var r=0;r<e.data.length;r++){var o=e.data[r];t.filterOptions.LeadPassengerIds.indexOf(o.Id)==-1&&t.passengers.push({Id:o.Id,Firstname:o.Firstname,Surname:o.Surname})}t.loadingPassengers=!1}))}function f(){o.close(t.filterOptions)}t.filterOptions=e.copy(r),t.vehicleTypes=t.filterOptions.VehicleTypes,t.drivers=t.filterOptions.Drivers,t.passengers=t.filterOptions.Passengers,t.searchDrivers=a,t.searchPassengers=l,t.saveSelected=s,n.VehicleType.query().select("Id,Name,Description").execute().then(function(e){t.vehicleTypes=e}),window.setInterval(function(){var e=document.getElementsByClassName(".select2-choices ");e.scrollTop=e.scrollHeight},5e3),t.status={},t.bookingSources=[{Id:"APP",Name:"Mobile App",Description:""},{Id:"WEB",Name:"Web Application",Description:""},{Id:"PHONE",Name:"Phone",Description:""},{Id:"OTHER",Name:"Other",Description:""},{Id:"ONETRANSPORT",Name:"One Transport",Description:""},{Id:"CLIENT_PORTAL",Name:"Client Portal",Description:""}],setTimeout(function(){t.hideClient=!0,$("#daterangepicker_bookings").daterangepicker({locale:{format:"DD/MM/YYYY"},autoApply:!0,startDate:moment(t.filterOptions.date.from).startOf("day"),endDate:moment(t.filterOptions.date.to).endOf("day"),opens:"right",parentEl:"#time-controls",ranges:{Today:[moment().startOf("day"),moment().endOf("day")],"This Week":[moment().startOf("isoweek"),moment().endOf("isoweek")],"This Month":[moment().startOf("month"),moment().endOf("month")]},alwaysShowCalendars:!0}),$("#daterangepicker_bookings").on("apply.daterangepicker",function(e,r){t.filterOptions.date.selectedPeriod=r.chosenLabel,t.filterOptions.date.from=r.startDate.toISOString(),t.filterOptions.date.to=r.endDate.toISOString(),"Custom Range"==t.filterOptions.date.selectedPeriod&&(t.filterOptions.date.selectedPeriod=" ("+moment(t.filterOptions.date.from).format("DD/MM/YYYY")+" - "+moment(t.filterOptions.date.to).format("DD/MM/YYYY")+")"),t.$apply()})},100),t.datePickers={from:!1,to:!1},t.openDatePicker=function(e,r){t.datePickers[r]=!t.datePickers[r],event.preventDefault(),event.stopPropagation()},t.confirmFilters=f}],resolve:{rFilter:function(){return t.filter}},size:"lg"}).result.then(function(e){t.filter=e,t.filter.$inc++})}function g(e){if(t.bookingGroups=[],t.paging.currentPage=e,t.searchTerm.$.length>0)i.get($config.API_ENDPOINT+"api/search",{params:{searchText:t.searchTerm.$,clientId:t.filter.ClientIds[0],top:50,skip:t.paging.resultsPerPage*(t.paging.currentPage-1)}}).success(function(e){var t=[];[].push.apply(t,e.map(function(e){return new l.Booking(e)})),m(t)});else{var r={From:new moment(t.filter.date.from).startOf("day").format(),To:new moment(t.filter.date.to).endOf("day").format(),Page:t.paging.currentPage};if(t.filter.ClientIds.length>0&&(r.ClientIds=t.filter.ClientIds),t.filter.DriverIds.length>0&&(r.DriverIds=t.filter.DriverIds),t.filter.LeadPassengerIds.length>0&&(r.LeadPassengerIds=t.filter.LeadPassengerIds),t.filter.VehicleTypeIds.length>0&&(r.VehicleTypeIds=t.filter.VehicleTypeIds),t.filter.BookingSource&&(r.BookingSource=t.filter.BookingSource),t.filter.Amount.from&&(r.AmountFrom=t.filter.Amount.from),t.filter.Amount.to&&(r.AmountTo=t.filter.Amount.to),t.filter.ShowClientServicesBookings&&(r.Dispute=!0),t.filter.Status)for(var o=Object.keys(t.filter.Status),n=0;n<o.length;n++)t.filter.Status[o[n]]&&("InProgress"==o[n]&&(r.Arrived=!0),r[o[n]]=!0);i.post($config.API_ENDPOINT+"api/bookings/filtered",r).success(function(e){var t=[];[].push.apply(t,e.map(function(e){return new l.Booking(e)})),m(t),p()}).error(function(e){swal("Error","Please try again or contact admin","error")})}}function m(e){if(e.length>0){t.bookingGroups.length=0;for(var r={date:e[0].BookedDateTime,bookings:[]},o=0;o<e.length;o++){var i=e[o];i.BookingStops=s("orderBy")(i.BookingStops,"StopOrder"),new moment(i.BookedDateTime).format("DD/MM/YYYY")==new moment(r.date).format("DD/MM/YYYY")?r.bookings.push(i):(t.bookingGroups.push(r),r={date:i.BookedDateTime,bookings:[]},r.bookings.push(i))}t.bookingGroups.push(r)}}function p(){var e=new moment(t.filter.date.from),r=new moment(t.filter.date.to);t.filterSummary=t.fetchStatus,e.format("DD/MM/YYYY")==r.format("DD/MM/YYYY")?t.filterSummary+=" Bookings for "+s("date")(e.toDate(),"shortDate"):t.filterSummary+=" Bookings from "+s("date")(e.toDate(),"shortDate")+" to "+s("date")(r.toDate(),"shortDate")}function h(){t.showSearch=!t.showSearch,t.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):t.searchTerm.$=""}function I(){if(!t.filter.date.from||!t.filter.date.to)return void swal({title:"Date Range not selected.",text:"Please select date range in filters to export.",type:"warning",confirmButtonColor:f.COLOURS.brandSecondary});var r="from="+moment(t.filter.date.from).startOf("day").format().replace("+","%2B")+"&to="+moment(t.filter.date.to).endOf("day").format().replace("+","%2B");r+="&ClientIds=''"+a.Id+"''",t.filter.DriverIds.length>0&&(r+="&driverIds="+t.filter.DriverIds.reduce(function(e,t){return e?e+", ''"+t+"''":"''"+t+"''"},null)),t.filter.VehicleTypeIds.length>0&&(r+="&vehicleTypeIds="+t.filter.VehicleTypeIds.reduce(function(e,t){return e?e+", ''"+t+"''":"''"+t+"''"},null)),t.filter.LeadPassengerIds.length>0&&(r+="&leadPassengerIds="+t.filter.LeadPassengerIds.reduce(function(e,t){return e?e+", ''"+t+"''":"''"+t+"''"},null)),t.filter.Amount&&t.filter.Amount.from>=0&&(r+="&actualCostFrom="+t.filter.Amount.from),t.filter.Amount&&t.filter.Amount.to>=0&&(r+="&actualCostTo="+t.filter.Amount.to),t.filter.ClientServices&&(r+="&clientServices=1"),t.filter.BookingSource&&(r+="&bookingSource="+t.filter.BookingSource);var o=[];e.forEach(t.filter.Status,function(e,t){if(e)switch(t){case"Cancelled":o.push("-1");break;case"COA":o.push("0");break;case"Incoming":o.push("1");break;case"PreAllocated":o.push("5");break;case"Allocated":o.push("10");break;case"OnRoute":o.push("20");break;case"Arrived":o.push("30,40");break;case"InProgress":o.push("30,40");break;case"Clearing":o.push("80");break;case"Completed":o.push("100")}});var i=c.getSession().Claims.TenantId[0];r+="&tenantId="+i+"&BookingStatuses="+o.join(","),window.open($config.API_ENDPOINT+"api/bookings/export?"+r,"_blank")}t.toggleSearch=h,t.searchTerm={$:""},t.paging={currentPage:1,resultsPerPage:50,totalResults:null,maxPages:null},t.setPage=g,t.selectedPeriod="Today",t.filter={date:{from:moment().startOf("day"),to:moment().endOf("day"),span:"day",selectedPeriod:"Today"},Amount:{from:null,to:null},Drivers:[],VehicleTypes:[],Passengers:[],ClientId:a.Id,ClientIds:[a.Id],DriverIds:[],VehicleTypeIds:[],LeadPassengerIds:[],ShowCompletedBookings:!1,ShowClientServicesBookings:!1,Status:null,$inc:0},t.onCompleted=function(e,r){1==t.bookingGroups[e].bookings.length?t.bookingGroups.splice(e,1):t.bookingGroups[e].bookings.splice(r,1)},t.bookingGroups=[],t.showFilterModal=u,t.exportBookings=I,t.$watchGroup(["filter.$inc","filter.date.from.valueOf()","filter.date.to.valueOf()","searchTerm.$","filter.ClientIds","filter.LeadPassengerIds","filter.VehicleTypeIds","filter.DriverIds","filter.ShowCompletedBookings","filter.ShowClientServicesBookings","filter.Status.Incoming","filter.Status.PreAllocated","filter.Status.Allocated","filter.Status.OnRoute","filter.Status.InProgress","filter.Status.Completed","filter.Status.Cancelled","filter.Status.COA","filter.Amount.from","filter.Amount.to","filter.BookingSource"],function(e,r){if(t.bookingGroups.length=0,t.fetchStatus="Fetching",e[3])t.filterSummary="Searching Bookings for : '"+e[3]+"'",i.get($config.API_ENDPOINT+"api/search/Count",{params:{searchText:e[3],clientId:t.filter.ClientIds[0]}}).success(function(r){t.paging.totalResults=r.length,t.filterSummary="Showing Bookings for : '"+e[3]+"'",t.paging.maxPages=Math.ceil(t.paging.totalResults/t.paging.resultsPerPage),g(1)});else{p();var o={From:new moment(t.filter.date.from).startOf("day").format(),To:new moment(t.filter.date.to).endOf("day").format(),Page:t.paging.currentPage};if(t.filter.ClientIds.length>0&&(o.ClientIds=t.filter.ClientIds),t.filter.DriverIds.length>0&&(o.DriverIds=t.filter.DriverIds),t.filter.LeadPassengerIds.length>0&&(o.LeadPassengerIds=t.filter.LeadPassengerIds),t.filter.VehicleTypeIds.length>0&&(o.VehicleTypeIds=t.filter.VehicleTypeIds),t.filter.BookingSource&&(o.BookingSource=t.filter.BookingSource),t.filter.Amount.from&&(o.AmountFrom=t.filter.Amount.from),t.filter.Amount.to&&(o.AmountTo=t.filter.Amount.to),t.filter.ShowClientServicesBookings&&(o.Dispute=!0),t.filter.Status)for(var n=Object.keys(t.filter.Status),s=0;s<n.length;s++)t.filter.Status[n[s]]&&("InProgress"==n[s]&&(o.Arrived=!0),o[n[s]]=!0);i.post($config.API_ENDPOINT+"api/bookings/FilteredCount",o).success(function(e){t.paging.totalResults=e,t.fetchStatus="Showing "+e,p(),t.paging.maxPages=Math.ceil(t.paging.totalResults/t.paging.resultsPerPage),g(1)}).error(function(e){swal("Error","Please try again or contact admin","error")})}})}var r=e.module("cab9.clients");r.controller("ClientBookingsController",t),t.$inject=["$scope","CSV","$modal","$http","$state","$filter","$stateParams","Model","$UI","$q","Auth"]}(angular);;;;
!function(e){function r(e,r,a,t,d,n,c,s,o,l,u,p){function f(r){e.view.current=r}function m(r,d){e.showLoader=!0,r.DefaultCard=d;var c=r.ExpirationMonth;e.cardList.some(function(e){return e.CardNumber.split(" ")[3]==r.CardNumber.split(" ")[3]})?(e.card.ExpirationMonth=c,e.showLoader=!1,e.card=null,swal("Error","Card details entered already exists. Please check saved cards.","error")):(r.ExpirationYear=r.ExpirationMonth.split("/")[1].trim().slice(-2),r.ExpirationMonth=r.ExpirationMonth.split("/")[0].trim(),r.Type=j(r.CardNumber),void 0!=u?r.ClientId=n.Id:void 0!=l&&(r.PassengerId=n.Id),a.post(t.API_ENDPOINT+"api/Payments/addcard",r).then(function(r){if(swal("Success","Card added successfully","success"),d)for(i=0;i<e.cardList.length;i++)e.cardList[i].DefaultCard=!1;e.cardList.push(r.data.Card),e.showLoader=!1,e.card=null},function(r){void 0!=r.data&&void 0!=r.data.Message?swal("Error",r.data.Message,"error"):swal("Error","Something didn't work, please try again","error"),e.card.ExpirationMonth=c,e.showLoader=!1}))}function h(r){swal({title:"Confirm Delete",text:"Are you sure you want to delete this card?",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm Delete!"},function(){a["delete"](t.API_ENDPOINT+"api/Payments/deletecard?cardId="+r).then(function(a){swal("Success","Card deleted successfully","success"),e.cardList=e.cardList.filter(function(e){return e.Id!=r})},function(e){void 0!=e.ExceptionMessage?swal("Error",e.ExceptionMessage,"error"):swal("Error","Something didn't work, please try again","error")})})}function w(r){swal({title:"Are you sure?",text:"Are you sure you want to make this card as default card?",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm!"},function(){a.patch(t.API_ENDPOINT+"api/Payments/makedefault",r).then(function(a){for(swal("Success","Card made as your default card successfully","success"),i=0;i<e.cardList.length;i++)e.cardList[i].Id==r.Id?e.cardList[i].DefaultCard=!0:e.cardList[i].DefaultCard=!1},function(e){swal("Error","Something didn't work, please try again","error")})})}function j(e){var r=new RegExp("^4");return null!=e.match(r)?"visa":/^(5[1-5][0-9]{14}|2(22[1-9][0-9]{12}|2[3-9][0-9]{13}|[3-6][0-9]{14}|7[0-1][0-9]{13}|720[0-9]{12}))$/.test(e)?"mastercard":/^(5[1-5]\d{2})[\s\-]?(\d{4})[\s\-]?(\d{4})[\s\-]?(\d{4})$/.test(e)?"mastercard":(r=new RegExp("^3[47]"),null!=e.match(r)?"amex":(r=new RegExp("^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)"),null!=e.match(r)?"discover":(r=new RegExp("^36"),null!=e.match(r)?"diners":(r=new RegExp("^30[0-5]"),null!=e.match(r)?"diners-carteblanche":(r=new RegExp("^35(2[89]|[3-8][0-9])"),null!=e.match(r)?"jcb":(r=new RegExp("^(4026|417500|4508|4844|491(3|7))"),null!=e.match(r)?"visaelectron":(r=new RegExp("^(40117[8-9]|431274|438935|451416|457393|45763[1-2]|506(699|7[0-6][0-9]|77[0-8])|509d{3}|504175|627780|636297|636368|65003[1-3]|6500(3[5-9]|4[0-9]|5[0-1])|6504(0[5-9]|[1-3][0-9])|650(4[8-9][0-9]|5[0-2][0-9]|53[0-8])|6505(4[1-9]|[5-8][0-9]|9[0-8])|6507(0[0-9]|1[0-8])|65072[0-7]|6509(0[1-9]|1[0-9]|20)|6516(5[2-9]|[6-7][0-9])|6550([0-1][0-9]|2[1-9]|[3-4][0-9]|5[0-8]))"),null!=e.match(r)?"elo":(r=new RegExp("^(5018|5020|5038|6304|6759|6761|6763)[0-9]{8,15}$"),null!=e.match(r)?"maestro":""))))))))}function C(e){var r=e.toLowerCase().replace(/\s/g,"");return"mastercard"==r?"jp-card jp-card-identified jp-card-mastercard":"visa"==r?"jp-card jp-card-identified jp-card-visa":"visaelectron"==r?"jp-card jp-card-identified jp-card-visaelectron":"discover"==r?"jp-card jp-card-identified jp-card-discover":"amex"==r?"jp-card jp-card-identified jp-card-amex":"diners"==r||"diners-carteblanche"==r?"jp-card jp-card-identified jp-card-dinersclub":"jcb"==r?"jp-card jp-card-identified jp-card-jcb":"elo"==r?"jp-card jp-card-identified jp-card-elo":"maestro"==r?"jp-card jp-card-identified jp-card-maestro":"jp-card jp-card-identified"}e.showLoader=!1,e.cardList=s,e.view={current:"SAVED",switchTo:f},e.addCard=m,e.deleteCard=h,e.makeDefault=w,e.getCardTypeClass=C}var a=e.module("cab9.common");a.controller("ClientItemCreditCardController",r),r.$inject=["$scope","$state","$http","$config","Model","$stateParams","$q","rSavedCards","rData","rPassenger","rClient","CSV"]}(angular);;;;
!function(e){function r(e,r,s,t){t.test("passengers")&&(s.when("/passengers","/passengers/cards"),e.state("root.passengers",{url:"/passengers","abstract":!0,"default":"root.passengers.cards",hasHelp:"/webapp/management/passengers/all/brands-help.modal.html",permission:"Passengers",resolve:{rQuery:["Model",function(e){return e.Passenger.query().include("Client").include("Addresses").parseAs(e.Passenger)}],rServerSearch:function(){return function(e,r){return r.$&&e.where("substringof('"+r.$+"', Mobile) or substringof('"+r.$+"', Email) or substringof('"+r.$+"', Surname) or substringof('"+r.$+"', Firstname) or substringof('"+r.$+"', concat(concat(Firstname, ' '), Surname)) or substringof('"+r.$+"', Client/Name)"),e.clone()}},rId:function(){return"Id"},rStatsData:function(){return null},rNavTo:function(){return"root.passengers.viewer.dashboard"},rSchema:function(){return"Passenger"},rColumns:function(){return null}},views:{"content-wrapper@root":{templateUrl:"/webapp/management/passengers/all/layout.partial.html",controller:["$scope",function(e){e.searchTerm={},e.serverSearchTerm={}}]},"options-area@root.passengers":{templateUrl:"/webapp/management/passengers/all/passengers-module-options.partial.html",controller:"PassengersModuleOptionsController"},"stats-area@root.passengers":{templateUrl:"/webapp/management/passengers/all/passengers-module-stats.partial.html",controller:"PassengersModuleStatsController"}}}),e.state("root.passengers.table",{url:"/table",views:{"options-area@root.passengers":{templateUrl:"/webapp/management/passengers/all/passengers-module-table-options.partial.html",controller:"PassengersModuleOptionsController"},"view-area@root.passengers":{templateUrl:"/e9_components/layouts/module/module-paged-table.partial.html",controller:"ModulePagedTableController"}}}),t.test("passengers.viewer")&&(e.state("root.passengers.viewer",{url:"/{Id:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}}","default":"root.passengers.viewer.dashboard",viewerType:"Passenger",permission:"View Passenger",resolve:{rTabs:["$stateParams",function(e){var r=[{heading:"Dashboard",route:"root.passengers.viewer.dashboard",params:{passengerId:e.Id}}];return r.push({heading:"Info",route:"root.passengers.viewer.info",params:{passengerId:e.Id}}),t.test("passengers.viewer.notes")&&r.push({heading:"Notes",route:"root.passengers.viewer.notes",params:{passengerId:e.Id}}),t.test("passengers.viewer.addresses")&&r.push({heading:"Addresses",route:"root.passengers.viewer.addresses",params:{passengerId:e.Id}}),t.test("passengers.viewer.creditcards")&&r.push({heading:"Credit cards",route:"root.passengers.viewer.creditcards.cards",params:{passengerId:e.Id}}),t.test("passengers.viewer.banneddrivers")&&r.push({heading:"Restrict Drivers",route:"root.passengers.viewer.banneddrivers",params:{passengerId:e.Id}}),r}],rData:["Model","$stateParams",function(e,r){return e.Passenger.query().include("Client,BannedDrivers,Tags").where("Id","==","guid'"+r.Id+"'").trackingEnabled().execute()}],rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){return e.Firstname+" "+e.Surname},SubTitle:function(e){return e.HomeAddress?e.HomeAddress.Area:null},LogoUrl:function(e){return e._ImageUrl}}}]},views:{"content-wrapper@root":{controller:"ModuleItemViewController",templateUrl:"/e9_components/layouts/module/module-item.layout.html"}}}),e.state("root.passengers.viewer.dashboard",{url:"/dashboard",viewerType:"Passenger",templateUrl:"/webapp/management/passengers/item/passenger-item-dashboard.partial.html",controller:"PassengerItemDashboardController"}),e.state("root.passengers.viewer.info",{url:"/info",viewerType:"Passenger",templateUrl:"/webapp/management/passengers/item/passenger-item-info.partial.html",controller:"PassengerItemInfoController",resolve:{rClients:["Model",function(e){return e.Client.query().select("Id,Name,ImageUrl,ClientType/Name").include("ClientType").parseAs(function(e){this.Id=e.Id,this.Name=e.Name,this.Description=e.ClientType.Name,this.ImageUrl=window.formatImage(e.ImageUrl,e.Name)}).execute()}],rVehicleTypes:["Model",function(e){return e.VehicleType.query().select("Id, Name, ImageUrl").execute()}],rPassengerTags:["Model",function(e){return e.Tag.query().execute().then(function(e){return e.filter(function(e){return e.EntityType.indexOf("Passenger")!=-1})})}]}}),t.test("passengers.viewer.notes")&&e.state("root.passengers.viewer.notes",{url:"/notes",viewerType:"Notes",permission:"Passenger - Notes",controller:"PassengerItemNotesController",templateUrl:"/webapp/management/passengers/item/passenger-item-notes.partial.html",resolve:{rNotes:["$stateParams","Model","$q",function(e,r,s){return r.Note.query().where("OwnerType eq 'PASSENGER'").where("OwnerId eq guid'"+e.Id+"'").execute()}],rStaffs:["Model",function(e){return e.Staff.query().select("Id, Firstname, Surname").parseAs(function(e){this.Name=e.Firstname+" "+e.Surname,this.Id=e.Id}).execute()}],rUsers:["Model",function(e){return e.User.query().include("Claims").execute()}]}}),t.test("passengers.viewer.addresses")&&e.state("root.passengers.viewer.addresses",{url:"/addresses",viewerType:"Addresses",permission:"Passenger - Addresses",controller:"PassengerItemAddressesController",templateUrl:"/webapp/common/views/passenger-address/partial.html",resolve:{rAddresses:["Model","$stateParams",function(e,r){return e.PassengerAddress.query().filter().where("PassengerId","==","guid'"+r.Id+"'").trackingEnabled().execute()}]}}),t.test("passengers.viewer.creditcards")&&(e.state("root.passengers.viewer.creditcards",{url:"/creditcards",viewerType:"CreditCard","default":"root.passengers.viewer.creditcards.cards",permission:"Passengers - Credit Cards",templateUrl:"/webapp/management/passengers/item/creditcards/partial.html",controller:["$scope","rTabs",function(e,r){e.tabDefs=r}],resolve:{rTabs:[function(){return[{heading:"Credit Cards",route:"root.passengers.viewer.creditcards.cards"},{heading:"Transactions",route:"root.passengers.viewer.creditcards.transactions"}]}]}}),e.state("root.passengers.viewer.creditcards.cards",{url:"/cards",templateUrl:"/webapp/common/views/clients/creditcards/cards/partial.html",controller:"CreditCardsCardsController",resolve:{rCards:["$http","Model","$stateParams",function(e,r,s){return r.PaymentCard.query().where("PassengerId eq guid'"+s.Id+"'").where("Active eq true").execute()}],rClientId:["$stateParams",function(e){return null}],rPassengerId:["$stateParams",function(e){return e.Id}],rDriverId:["$stateParams",function(e){return null}]}}),e.state("root.passengers.viewer.creditcards.transactions",{url:"/transactions",templateUrl:"/webapp/common/views/clients/creditcards/transactions/partial.html",controller:"CreditCardsTransactionsController",resolve:{rClientId:["$stateParams",function(e){return null}],rPassengerId:["$stateParams",function(e){return e.Id}]}})),t.test("passengers.viewer.banneddrivers")&&e.state("root.passengers.viewer.banneddrivers",{url:"/restrictdrivers",viewerType:"BannedDrivers",permission:"Passenger - Blocked Drivers",controller:"PassengerItemBannedDriversController",templateUrl:"/webapp/management/passengers/item/bannedDrivers/partial.html"})),r.registerMenuItem({state:"root.passengers.table",icon:"people_outline",title:"Passengers"}))}function s(){}var t=e.module("cab9.passengers",[]);t.config(r),t.run(s),r.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider","$permissions"],s.$inject=[]}(angular);;;;
!function(e){function t(e,t,a){function s(){t.open({templateUrl:"/webapp/common/modals/passenger/create.modal.html",controller:"PassengerItemCreateModalController",resolve:{rClientId:function(){return null},rNavigateAfterSave:function(){return!0}}})}function r(){e.showSearch=!e.showSearch,!e.showSearch&&e.searchTerm?e.searchTerm.$="":!e.showSearch&&e.serverSearchTerm?e.serverSearchTerm.$="":setTimeout(function(){$("#searchTerm").focus()},500)}function o(){t.open({template:'<div class="modal-header"><button class="close" type="button" ng-click="$close()"><i class="material-icons">close</i></button><h3 class="modal-title">Client Stats</h3></div><div class="modal-body"><div ng-include="\'/webapp/management/passengers/all/passengers-module-stats.partial.html\'"></div></div>',controller:"PassengersModuleStatsController",size:"sm",resolve:{rStatsData:function(){return a}}}).result.then(function(e){})}e.showStatsModal=o,e.toggleSearch=r,e.newPassenger=s}var a=e.module("cab9.passengers");a.controller("PassengersModuleOptionsController",t),t.$inject=["$scope","$modal","rStatsData"]}(angular);;;;
!function(t){function e(t,e,n,o,a,r){}var n=t.module("cab9.passengers");n.controller("PassengersModuleStatsController",e),e.$inject=["$scope","$UI","Model","$config","$http","rStatsData"]}(angular);;;;
!function(e){function t(t,r,i,n,o,l){function s(r){t.items=e.copy(l),t.searchTerm&&t.searchTerm.$&&""!=t.searchTerm.$.trim()?t.items=l.filter(function(e){var r=t.searchTerm.$.toLowerCase(),i=(e.Id+e.Firstname+e.Surname+e.Mobile+e.Fax+e.Email+e.Phone).toLowerCase();return i.indexOf(r)!=-1}):t.items=e.copy(l),"All"!=r.Name&&(t.items=t.items.filter(function(e){return e.ClientId==r.Id}))}t.accessors=i,t.filterOptions={ClientId:"All"},t.rNavTo=n,t.chosenGroup=null,t.items=e.copy(l),t.filterItems=s,t.$parent.displayLimit=20,t.clients=[{Id:"All",Name:"All"}],r.Client.query().select("Id,Name").execute().then(function(e){Array.prototype.push.apply(t.clients,e)},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:$UI.COLOURS.brandSecondary})}),t.$watchCollection("searchTerm",function(r){return r&&r.$&&""!=r.$.trim()?(t.items=l.filter(function(e){var t=r.$.toLowerCase(),i=(e.Id+e.Firstname+e.Surname+e.Mobile+e.Fax+e.Email+e.Phone).toLowerCase();return i.indexOf(t)!=-1}),void(t.filterOptions.ClientId&&"All"!=t.filterOptions.ClientId&&(t.items=t.items.filter(function(e){return e.ClientId==t.filterOptions.ClientId})))):(t.items=e.copy(l),void(t.filterOptions.ClientId&&"All"!=t.filterOptions.ClientId&&(t.items=t.items.filter(function(e){return e.ClientId==t.filterOptions.ClientId}))))})}var r=e.module("cab9.passengers");r.controller("PassengersCardsController",t),t.$inject=["$scope","Model","rAccessors","rNavTo","$rootScope","rData"]}(angular);;;;
!function(t){function a(t,a,e,o,s,r,n){t.passenger=n[0];var i=t.DATETIME_FORMAT.replace(/[.|/|-][y|Y][y|Y]*/g,"");t.quickStats={today:"-",week:"-",month:"-"},t.bookingGraph={options:{series:{lines:{show:!0,lineWidth:2,fill:!0,fillColor:{colors:[{opacity:.4},{opacity:.4}]}},points:{show:!0,lineWidth:2},shadowSize:0},grid:{hoverable:!0,clickable:!0,tickColor:"#eee",borderWidth:0},colors:[a.COLOURS.lighterGrey,a.COLOURS.brandPrimary],xaxis:{mode:"time",tickFormatter:function(t,a){var e=r("date")(moment(t).toDate(),i);return e},minTickSize:[1,"day"]},yaxis:{ticks:3,tickDecimals:0}},data:[]};var m=(o({url:e.API_ENDPOINT+"/api/stats",method:"GET",params:{passengerId:t.item.Id,from:(new moment).startOf("isoweek").format(),to:(new moment).startOf("day").format(),totalsOnly:!0}}).success(function(a){t.quickStats.week=a.Totals.CountBookings}),o({url:e.API_ENDPOINT+"/api/stats",method:"GET",params:{passengerId:t.item.Id,from:(new moment).startOf("month").format(),to:(new moment).startOf("day").format(),totalsOnly:!0}}).success(function(a){t.quickStats.month=a.Totals.CountBookings}),o({url:e.API_ENDPOINT+"/api/stats",method:"GET",params:{passengerId:t.item.Id,from:(new moment).subtract(2,"weeks").startOf("day").format(),to:(new moment).startOf("day").format(),fillNulls:!0}})),l=o({url:e.API_ENDPOINT+"/api/stats",method:"GET",params:{from:(new moment).subtract(2,"weeks").startOf("day").format(),to:(new moment).startOf("day").format(),fillNulls:!0}});s.all([m,l]).then(function(a){var e=a[0].data,o=a[1].data,s={label:"Avg Passenger",data:[]},r={label:t.item.Firstname+" "+t.item.Surname,data:[]};t.bookingGraph.data.push(s),t.bookingGraph.data.push(r);for(var n=0;n<e.Periods.length;n++){var i=e.Periods[n];r.data.push([new moment(i.Date).valueOf(),i.CountBookings])}for(var n=0;n<o.Periods.length;n++){var m=o.Periods[n];s.data.push([new moment(m.Date).valueOf(),m.CountAssignedBookings/m.UniquePassengers])}t.lastWeekData=a[0].data.Periods.reverse().slice(0,7),t.quickStats.today=t.lastWeekData[0].CountBookings},function(t){})}var e=t.module("cab9.passengers");e.controller("PassengerItemDashboardController",a),a.$inject=["$scope","$UI","$config","$http","$q","$filter","rData"]}(angular);;;;
!function(e){function n(n,s,a,r,o,t,c,g,i,d,u){function l(){o.openPicker({type:"Passenger",id:n.passenger.Id,searchTerm:n.passenger._Fullname}).then(function(e){n.passenger.ImageUrl=e,I()},function(e){})}function p(){n.viewMode="EDIT"}function f(){n.passenger.$rollback(!0),n.viewMode="VIEW"}function I(){var o=[];if(e.isDefined(n.passenger.$$changedValues.Tags)){var t=m.changes(n.passenger.$$changedValues.Tags,function(e,n){return e.Id==n.Id});e.forEach(t.removed,function(e){o.push(r.$dissociate("Passenger","PassengerTags",n.passenger.Id,e.Id))}),e.forEach(t.added,function(e){o.push(r.$associate("Passenger","PassengerTags",n.passenger.Id,e.Id))})}o.push(n.passenger.$patch()),a.all(o).then(function(e){s.go(s.current,{Id:n.passenger.Id},{reload:!0}),swal({title:"Passenger Saved.",text:"Changes have been updated.",type:"success",confirmButtonColor:i.COLOURS.brandSecondary})},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:i.COLOURS.brandSecondary})})}function h(e){var s=n.passenger.Tags.map(function(e){return e.Id});return s.indexOf(e.Id)==-1}n.passenger=t[0],n.clients=c,n.passengerTags=g,n.viewMode="VIEW",n.vehicleTypes=u.map(function(e){return e.ImageUrl=e._ImageUrl,e});var m=e.copy(n.passenger.Tags);n.chooseImage=l,n.startEditing=p,n.cancelEditing=f,n.saveEdits=I,n.alreadySelected=h}var s=e.module("cab9.passengers");s.controller("PassengerItemInfoController",n),n.$inject=["$scope","$state","$q","Model","ImageUpload","rData","rClients","rPassengerTags","$UI","$config","rVehicleTypes"]}(angular);;;;
!function(e){function t(e,t,o,r,n,l,c,u,s,a,i){function d(t){var o=e.notes.indexOf(t),n=r.open({templateUrl:"/webapp/common/modals/notes.modal.html",controller:"NoteEditController",size:"lg",resolve:{rNote:function(){return new c.Note(t)}}});n.result.then(function(t){c.Note.query().where("Id","==","guid'"+t.Id+"'").execute().then(function(t){e.notes[o]=t[0]},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:s.COLOURS.brandSecondary})})},function(){})}function f(){var t=r.open({templateUrl:"/webapp/common/modals/notes.modal.html",controller:"NoteCreateController",size:"lg",resolve:{rOwner:function(){return"PASSENGER"}}});t.result.then(function(t){c.Note.query().where("Id","==","guid'"+t.Id+"'").execute().then(function(t){e.notes.push(t[0])},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:s.COLOURS.brandSecondary})})})}function m(t){swal({title:"Are you sure?",text:"Note will be deleted",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){var o=e.notes.indexOf(t);new c.Note(t).$delete().then(function(t){swal({title:"Note Deleted.",text:"Note has been deleted.",type:"success",confirmButtonColor:s.COLOURS.brandSecondary}),e.notes.splice(o,1)})},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:s.COLOURS.brandSecondary})})}function p(e){var t=null,o=i.filter(function(t){return t.Id==e})[0];return o?o.Name:t}e.notes=t,e.displayMode="VIEW",e.addNote=f,e.editNote=d,e.deleteNote=m,e.getUserName=p}var o=e.module("cab9.passengers");o.controller("PassengerItemNotesController",t),t.$inject=["$scope","rNotes","$state","$modal","$stateParams","$q","Model","$config","$UI","rStaffs","rUsers"]}(angular);;;;
!function(e){function r(r,n,s,a,t,s,d,n,o,c){function l(e){e&&(r.loadingDrivers=!0,n.get(s.API_ENDPOINT+"api/Drivers/Search",{params:{searchText:e,lite:!0}}).then(function(e){r.drivers=e.data,r.drivers=r.drivers.map(function(e){return new o.Driver(e)}),r.driverIds=r.passenger.BannedDrivers.map(function(e){return e.Id}),r.unlinkedDrivers=r.drivers.filter(function(e){return r.driverIds.indexOf(e.Id)==-1}),r.loadingDrivers=!1}))}function v(){r.viewMode="VIEW",r.passenger=e.copy(c[0]),r.passenger.BannedDrivers=r.passenger.BannedDrivers.map(function(e){return new o.Driver(e)}),r.selected={Driver:null}}function u(e){for(r.passenger.BannedDrivers.push(e),i=0,len=r.unlinkedDrivers.length;i<len;i++)if(r.unlinkedDrivers[i].Id==e.Id){r.unlinkedDrivers.splice(i,1);break}r.selected.Driver=null}function p(e){for(i=0,len=r.passenger.BannedDrivers.length;i<len;i++)if(r.passenger.BannedDrivers[i].Id==e.Id){r.passenger.BannedDrivers.splice(i,1);break}}function D(){n.post(s.API_ENDPOINT+"api/passenger/manage-banned-drivers?passengerId="+r.passenger.Id,r.passenger.BannedDrivers).then(function(e){swal({title:"Passenger Restricted Drivers",text:"Restricted Drivers has been updated.",type:"success",confirmButtonColor:d.COLOURS.brandSecondary}),t.go(t.current,{Id:a.Id},{reload:!0})},function(e){swal({title:"Some Error Occured.",text:null==e.Message?"error occured":e.Message,type:"error",confirmButtonColor:d.COLOURS.brandSecondary})})}function g(){v()}function f(){r.viewMode="EDIT"}v(),r.startEdit=f,r.cancelEdit=g,r.addDriver=u,r.removeDriver=p,r.saveChanges=D,r.searchDrivers=l,r.drivers=[],r.unlinkedDrivers=[]}var n=e.module("cab9.passengers");n.controller("PassengerItemBannedDriversController",r),r.$inject=["$scope","$http","$config","$stateParams","$state","$config","$UI","$http","Model","rData"]}(angular);;;;
!function(e){function t(t,n,o,r){if(r.test("settings")){t.state("root.settings",{url:"/settings",permission:"Settings",resolve:{rMenu:[function(){return[]}]},views:{"content-wrapper@root":{templateUrl:"/webapp/management/settings/settings.layout.html",controller:"SettingsController"}}}),o.when("/settings","/settings/pricingmodels"),r.test("settings.users")&&t.state("root.settings.users",{url:"/users",permission:"Settings - Users",searchText:"users",searchName:"Users",searchIcon:"supervisor_account",views:{"settings-content@root.settings":{templateUrl:"/webapp/management/settings/users/users-config.partial.html",controller:"SettingsUsersController"}}}),r.test("settings.roles")&&t.state("root.settings.roles",{url:"/roles",permission:"Settings - Roles",views:{"settings-content@root.settings":{templateUrl:"/webapp/management/settings/roles/roles-config.partial.html",controller:"SettingsRolesController"}},resolve:{rRoles:["Model",function(e){return e.StaffRole.query().parseAs(function(e){e.$permissions=e.Permissions;try{e.Permissions=JSON.parse(e.$permissions||"[]")}catch(t){e.Permissions=[]}return e}).execute()}],rPermissions:["$state",function(e){var t=[];return e.get().forEach(function(e){e.permission&&t.push({Name:e.name.replace("root.",""),DisplayName:e.permission,Rights:["R","W","D"]})}),t}]}}),t.state("root.settings.profile",{url:"/password",views:{"settings-content@root.settings":{templateUrl:"/webapp/management/settings/profile/profile.partial.html",controller:"SettingsProfileController"},"profile-staff@root.settings.profile":{templateUrl:"/webapp/management/staff/item/staff-item-profile.partial.html",controller:"StaffItemInfoController",resolve:{rCustomRoles:["Model",function(e){return e.StaffRole.query().trackingEnabled().execute()}],rData:["Model","$stateParams","Auth","$q",function(e,t,n,o){var r=o.defer();return e.User.query().where("Id","==","'"+n.getSession().UserId+"'").include("Claims").trackingEnabled().execute().then(function(t){var n=t[0].Claims.filter(function(e){return"StaffId"==e.ClaimType})[0];n&&e.Staff.query().where("Id","==","guid'"+n.ClaimValue+"'").trackingEnabled().execute().then(function(e){r.resolve(e)})}),r.promise}],rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){return e._Fullname},SubTitle:function(e){return e.TownCity},LogoUrl:function(e){return e._ImageUrl}}}]}}}}),r.test("settings.company")&&(t.state("root.settings.company",{url:"/company",permission:"Settings - Company","default":"root.settings.company.basic",searchText:"settings company",searchName:"Company Settings",searchIcon:"settings",resolve:{rTabs:[function(){return[{heading:"Basic Settings",route:"root.settings.company.basic"},{heading:"Invoicing and Driver Payment",route:"root.settings.company.invoicing"},{heading:"Dispatch",route:"root.settings.company.dispatch"},{heading:"Company Setup",route:"root.settings.company.localisation"},{heading:"SMS Integration",route:"root.settings.company.sms"},{heading:"App Setup",route:"root.settings.company.app"},{heading:"Portal Setup",route:"root.settings.company.portal"},{heading:"Credit Card Settings",route:"root.settings.company.creditcards"},{heading:"Masked Number",route:"root.settings.company.maskednumber"},{heading:"FTP Details",route:"root.settings.company.ftpdetails"},{heading:"Web Booker Settings",route:"root.settings.company.webbooker"},{heading:"Auction Settings",route:"root.settings.company.auction-config"},{heading:"Auto Allocation Settings",route:"root.settings.company.auto-allocation"},{heading:"Flagdown Configuration",route:"root.settings.company.flagdown-config"}]}],rCompany:["Model","Auth",function(e,t){return e.Company.query().filter("Id eq guid'"+t.getSession().TenantId+"'").include("PricingModel").trackingEnabled().execute()}],rCardProviderDetails:["Model","Auth",function(e,t){return e.CardPaymentProviderDetail.query().filter("TenantId eq guid'"+t.getSession().TenantId+"'").trackingEnabled().execute()}],rPricingModels:["Model",function(e){return e.PricingModel.query().execute()}],rCurrencies:["Model",function(e){return e.Currency.query().execute()}],rPaymentModels:["Model",function(e){return e.DriverPaymentModel.query().select("Id, Name").parseAs(function(e){this.Id=e.Id,this.Name=e.Name}).execute()}]},views:{"settings-content@root.settings":{templateUrl:"/webapp/management/settings/company/company-settings.partial.html",controller:["$scope","rTabs",function(e,t){e.tabDefs=t}]}}}),t.state("root.settings.company.basic",{url:"/basic",templateUrl:"/webapp/management/settings/company/basic/partial.html",controller:"SettingsCompanyBasicController",resolve:{}}),t.state("root.settings.company.portal",{url:"/portal",templateUrl:"/webapp/management/settings/company/portal/partial.html",controller:"SettingsCompanyPortalController",resolve:{rSettings:["Model",function(e){return e.ClientWebBookerSetting.query().where("ClientId eq null").trackingEnabled().execute()}]}}),t.state("root.settings.company.sms",{url:"/sms",templateUrl:"/webapp/management/settings/company/sms/partial.html",controller:["$scope","rData","Model",function(e,t,n){function o(){e.viewMode="EDIT"}function r(){e.item.$rollback(!1),e.viewMode="VIEW"}function i(){e.item.Id?e.item.$patch().success(function(){e.viewMode="VIEW"}):e.item.$save().success(function(){e.viewMode="VIEW"})}e.item=t[0]||new n.SmsDetail,e.viewMode="VIEW",e.startEdit=o,e.cancelEdit=r,e.saveEdits=i}],resolve:{rData:["Model",function(e){return e.SmsDetail.query().trackingEnabled().execute()}]}}),t.state("root.settings.company.invoicing",{url:"/invoicing",templateUrl:"/webapp/management/settings/company/invoicing/partial.html",controller:"SettingsCompanyInvoicingController",searchText:"invoice settings invoice",searchName:"Invoice Settings",searchIcon:"settings",resolve:{rTaxes:["Model",function(e){return e.Tax.query().execute()}],rCompanyPaymentSettings:["Model",function(e){return e.CompanyPaymentSettings.query().trackingEnabled().execute()}]}}),t.state("root.settings.company.localisation",{url:"/localisation",templateUrl:"/webapp/management/settings/company/localisation/partial.html",controller:"SettingsCompanyLocalisationController",resolve:{}}),t.state("root.settings.company.auction-config",{url:"/auctionsettings",templateUrl:"/webapp/management/settings/company/auction-config/partial.html",controller:"SettingsAuctionConfigController",resolve:{rCompanyBiddingConfig:["Model",function(e){return e.CompanyBiddingConfig.query().trackingEnabled().execute()}],rBiddingAutomationRules:["$http","$config",function(e,t){return e({method:"GET",url:t.API_ENDPOINT+"/api/Bid/automation-rules"}).then(function(e){return e.data},function(e){swal("Error","There was some error trying to fetch the automation rules.","error")})}],rClients:["Model",function(e){return e.Client.query().where("Active eq true").select("Id, Name, AccountNo").orderBy("AccountNo").execute()}],rVehicleTypes:["Model",function(e){return e.VehicleType.query().select("Id, Name").execute()}],rDriverTypes:["Model",function(e){return e.DriverType.query().select("Id, TenantId, Name").execute()}],rExclusionRules:["Model",function(e){return e.BiddingExclusionRule.query().trackingEnabled().execute()}]}}),t.state("root.settings.company.auto-allocation",{url:"/autoallocation",templateUrl:"/webapp/management/settings/company/auto-allocation/partial.html",controller:"SettingsAutoAllocationController",resolve:{rAutoAllocationRules:["$http","$config",function(e,t){return e({method:"GET",url:t.API_ENDPOINT+"/api/allocation-rules/get-rules"}).then(function(e){return e.data},function(e){swal("Error","There was some error trying to fetch the auto allocation rules.","error")})}],rClients:["Model",function(e){return e.Client.query().where("Active eq true").select("Id, Name, AccountNo").orderBy("AccountNo").execute()}],rVehicleTypes:["Model",function(e){return e.VehicleType.query().select("Id, Name").execute()}],rDriverTypes:["Model",function(e){return e.DriverType.query().select("Id, TenantId, Name").execute()}],rExclusionRules:["Model",function(e){return e.BiddingExclusionRule.query().trackingEnabled().execute()}]}}),t.state("root.settings.company.flagdown-config",{url:"/flagdownsettings",templateUrl:"/webapp/management/settings/company/flagdown-config/partial.html",controller:"FlagDownConfigurationController",resolve:{rCompanyFlagDownConfig:["Model",function(e){return e.FlagDownConfiguration.query().trackingEnabled().execute()}],rClients:["Model",function(e){return e.Client.query().where("Active eq true").select("Id, Name, AccountNo").orderBy("AccountNo").execute()}]}}),t.state("root.settings.company.creditcards",{url:"/creditcards",templateUrl:"/webapp/management/settings/company/creditcards/partial.html",controller:"SettingsCompanyCreditCardsController",resolve:{}}),t.state("root.settings.company.maskednumber",{url:"/maskednumber",templateUrl:"/webapp/management/settings/company/maskednumber/partial.html",controller:"SettingsMaskedNumberController",resolve:{rMaskedNumberProviderDetail:["Model","Auth",function(e,t){return e.MaskedNumberProviderDetail.query().filter("TenantId eq guid'"+t.getSession().TenantId+"'").trackingEnabled().execute()}]}}),t.state("root.settings.company.ftpdetails",{url:"/ftp-details",templateUrl:"/webapp/management/settings/company/ftpdetails/partial.html",controller:"SettingsFTPDetailsController"}),t.state("root.settings.company.webbooker",{url:"/webbooker",templateUrl:"/webapp/management/settings/company/webbooker/partial.html",controller:"SettingsWebBookerController",resolve:{rAppConfigs:["$http","Model","$stateParams","Auth",function(e,t,n,o){return e.get($config.API_ENDPOINT+"api/appconfig?TenantId="+o.getSession().TenantId).then(function(e){if(e.data.length>0)return e.data.map(function(e){return new t.AppConfig(e)})})}]}}),t.state("root.settings.company.app",{url:"/app",templateUrl:"/webapp/management/settings/company/app/partial.html",controller:"SettingsMobileAppController",resolve:{}}),t.state("root.settings.company.dispatch",{url:"/dispatch",templateUrl:"/webapp/management/settings/company/dispatch/partial.html",controller:"SettingsCompanyDispatchController",resolve:{}})),r.test("settings.booking")&&(t.state("root.settings.booking",{url:"/booking","default":"root.settings.booking.expenses",permission:"Settings - Booking",resolve:{rTabs:[function(){return[{heading:"Expenses",route:"root.settings.booking.expenses"},{heading:"Booking Form",route:"root.settings.booking.form"}]}],rCompany:["Model","Auth",function(e,t){return e.Company.query().filter("Id eq guid'"+t.getSession().TenantId+"'").trackingEnabled().execute()}]},views:{"settings-content@root.settings":{templateUrl:"/webapp/management/settings/booking/partial.html",controller:["$scope","rTabs",function(e,t){e.tabDefs=t}]}}}),t.state("root.settings.booking.expenses",{url:"/expenses",templateUrl:"/webapp/management/settings/booking/expenses/partial.html",controller:"SettingsBookingExpensesController",resolve:{rExpenses:["Model",function(e){return e.BookingExpenseType.query().include("Tax").execute()}]}}),t.state("root.settings.booking.form",{url:"/booking-form",templateUrl:"/webapp/management/settings/booking/booking-form/partial.html",controller:"SettingsBookingFormController"})),r.test("settings.telephony")&&t.state("root.settings.telephony",{url:"/telephony",permission:"Settings - Telephony",views:{"settings-content@root.settings":{templateUrl:"/webapp/management/settings/telephony/partial.html",controller:"SettingsTelephonyController"}},resolve:{rIntegration:["Model",function(e){return e.TelephonyIntegration.query().execute()}]}}),r.test("settings.googlemapsconfig")&&t.state("root.settings.googlemapsconfig",{url:"/googlemapsconfig",permission:"Settings - Google Config",views:{"settings-content@root.settings":{templateUrl:"/webapp/common/views/googlemapsconfig/partial.html",controller:"GoogleMapsConfigController"}},resolve:{rIntegration:["Model",function(e){return e.GoogleMapsConfig.query().execute()}]}}),o.when("/settings/knownlocations","/settings/knownlocations/cards"),r.test("settings.knownlocations")&&(t.state("root.settings.knownlocations",{url:"/knownlocations","default":"root.settings.knownlocations.cards",permission:"Settings - Known Locations",resolve:{rData:["Model",function(e){return e.KnownLocation.query().include("KnownPickupPoints").execute()}]},views:{"settings-content@root.settings":{templateUrl:"/webapp/management/settings/known-locations/known-locations.partial.html",controller:["$scope",function(e){e.searchTerm={},e.serverSearchTerm={}}]},"options-area@root.settings.knownlocations":{templateUrl:"/webapp/management/settings/known-locations/known-locations-options.partial.html",controller:["$scope",function(e){function t(){e.showSearch=!e.showSearch,e.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):e.searchTerm.$=""}e.toggleSearch=t}]}}}),t.state("root.settings.knownlocations.create",{url:"/create",resolve:{},views:{"settings-content@root.settings":{templateUrl:"/webapp/common/views/locations/create.partial.html",controller:"KnownLocationCreateController"}}}),t.state("root.settings.knownlocations.cards",{url:"/cards",resolve:{rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){return e.Name},SubTitle:function(e){return e.LocationType},LogoUrl:function(e){return e._ImageUrl},Group:function(e){return e.LocationType}}}],rNavTo:function(){return"root.settings.knownlocations.viewer.details"}},views:{"view-area@root.settings.knownlocations":{templateUrl:"/e9_components/layouts/module/module-cards.partial.html",controller:"ModuleCardsController"}}}),t.state("root.settings.knownlocations.table",{url:"/table",resolve:{rNavTo:function(){return"root.settings.knownlocations.viewer.details"},rSchema:function(){return"KnownLocation"},rId:function(){return"Id"},rQuery:["Model",function(e){return e.KnownLocation.query().include("KnownPickupPoints").parseAs(e.KnownLocation)}],rServerSearch:function(){return function(e,t){return t.$&&e.where("(substringof('"+t.$+"', Name) or substringof('"+t.$+"', StopSummary) or substringof('"+t.$+"', TownCity) or substringof('"+t.$+"', Area) or substringof('"+t.$+"', Address1) or substringof('"+t.$+"', Postcode))"),e.clone()}}},views:{"options-area@root.settings.knownlocations":{templateUrl:"/webapp/management/settings/known-locations/known-locations-table-options.partial.html",controller:["$scope",function(e){function t(){e.showSearch=!e.showSearch,e.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):e.serverSearchTerm.$=""}e.toggleSearch=t}]},"view-area@root.settings.knownlocations":{templateUrl:"/e9_components/layouts/module/module-paged-table.partial.html",controller:"ModulePagedTableController"}}}),t.state("root.settings.knownlocations.viewer",{url:"/{Id:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}}","default":"root.settings.knownlocations.viewer.details",viewerType:"KnownLocation",resolve:{rTabs:["$stateParams",function(e){var t=[{heading:"Details",route:"root.settings.knownlocations.viewer.details",params:{locationId:e.Id}}];return t.push({heading:"Points",route:"root.settings.knownlocations.viewer.points",params:{locationId:e.Id}}),t}],rData:["Model","$stateParams",function(e,t){return e.KnownLocation.query().include("KnownPickupPoints").trackingEnabled().where("Id","==","guid'"+t.Id+"'").execute()}],rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){return e.Name},SubTitle:function(e){return e.StopSummary},LogoUrl:function(e){return e._ImageUrl}}}]},views:{"content-wrapper@root":{controller:"ModuleItemViewController",templateUrl:"/e9_components/layouts/module/module-item.layout.html"}}}),t.state("root.settings.knownlocations.viewer.details",{url:"/details",viewerType:"KnownLocation",templateUrl:"/webapp/management/settings/known-locations/item/knownlocation-item-details.partial.html",controller:"KnownLocationDetailsController"}),t.state("root.settings.knownlocations.viewer.points",{url:"/points",viewerType:"KnownLocation",templateUrl:"/webapp/management/settings/known-locations/item/knownlocation-item-points.partial.html",controller:"KnownLocationPointsController"})),r.test("settings.email")&&(t.state("root.settings.email",{url:"/email",permission:"Settings - Email",resolve:{rTabs:["$stateParams",function(e){return[{heading:"Configuration",route:"root.settings.email.config"},{heading:"Templates",route:"root.settings.email.templates"}]}],rCompany:["Model","Auth",function(e,t){return e.Company.query().filter("Id eq guid'"+t.getSession().TenantId+"'").trackingEnabled().execute()}],rConfig:["Model","Auth",function(e,t){return e.EmailConfig.query().filter("TenantId eq guid'"+t.getSession().TenantId+"'").trackingEnabled().execute()}],rAccessors:["$config",function(e){return{Title:function(e){return"Email"}}}]},views:{"content-wrapper@root":{templateUrl:"/e9_components/layouts/module/module-item.layout.html",controller:"SettingsEmailController"}}}),t.state("root.settings.email.config",{url:"/config",templateUrl:"/webapp/management/settings/email/email-config.partial.html",controller:"SettingsEmailConfigController"}),t.state("root.settings.email.templates",{url:"/templates",templateUrl:"/webapp/management/settings/email/email-template.partial.html",controller:"SettingsEmailTemplateController"})),r.test("settings.pricingmodels")&&(t.state("root.settings.pricingmodels",{url:"/pricingmodels",permission:"Settings - Pricing Models",resolve:{rData:["Model",function(e){return e.PricingModel.query().include("Zones").include("VehicleTypePricings").trackingEnabled().execute()}]},views:{"settings-content@root.settings":{templateUrl:"/webapp/management/settings/pricingmodels/pricing-models.partial.html",controller:"SettingsPricingModelsController"}}}),t.state("root.settings.pricingmodels.viewer",{url:"/{Id}",resolve:{rTabs:["$stateParams",function(e){return[{heading:"Details",route:"root.settings.pricingmodels.viewer.details"},{heading:"Zones",route:"root.settings.pricingmodels.viewer.zones"},{heading:"Fixed",route:"root.settings.pricingmodels.viewer.fixed"},{heading:"Vehicles",route:"root.settings.pricingmodels.viewer.vehicles"},{heading:"Testing",route:"root.settings.pricingmodels.viewer.tester"},{heading:"Price List",route:"root.settings.pricingmodels.viewer.pricelist"},{heading:"Adjustments",route:"root.settings.pricingmodels.viewer.adjustments"},{heading:"History",route:"root.settings.pricingmodels.viewer.history"}]}],rData:["Model","$stateParams",function(e,t){return e.PricingModel.query().include("Zones/Zone").include("CancellationRule").where("Id eq guid'"+t.Id+"'").trackingEnabled().execute()}],rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){return e.Name}}}]},views:{"content-wrapper@root":{templateUrl:"/e9_components/layouts/module/module-item.layout.html",controller:"SettingsPricingModelsViewerController"}}}),t.state("root.settings.pricingmodels.viewer.details",{url:"/details",templateUrl:"/webapp/management/settings/pricingmodels/pricing-models-details.partial.html"}),t.state("root.settings.pricingmodels.viewer.zones",{url:"/zones",templateUrl:"/webapp/management/settings/pricingmodels/pricing-models-zones.partial.html",controller:"SettingsPricingModelsZonesController",resolve:{rZones:["Model","$stateParams",function(e,t){return e.ZoneInPricingModel.query().where("PricingModelId","eq","guid'"+t.Id+"'").trackingEnabled().execute()}],rAllZones:["Model",function(e){return e.Zone.query().execute()}]}}),t.state("root.settings.pricingmodels.viewer.history",{url:"/history",templateUrl:"/webapp/management/settings/pricingmodels/pricing-models-history.partial.html",resolve:{rHistory:["Model","$stateParams",function(e,t){return e.AuditRecord.query().include("Properties").include("User").trackingEnabled().where("PricingModelId","eq","guid'"+t.Id+"'").orderBy("Timestamp desc").execute()}]},controller:["$scope","rHistory","rData",function(t,n,o){t.iconsIndex={Modified:"assignment"},t.coloursIndex={Modified:"orange-bg"},t.noHistory=!1,t.history={},0==n.length&&(t.noHistory=!0),e.forEach(n,function(e){var n=moment(e.Timestamp).format("DD MMM YYYY");t.history[n]||(t.history[n]=[]),t.history[n].push(e)})}]}),t.state("root.settings.pricingmodels.viewer.fixed",{url:"/fixed",templateUrl:"/webapp/management/settings/pricingmodels/fixed/partial.html",controller:"SettingsPricingModelsFixedController",resolve:{rFixedCount:["Model","$stateParams",function(e,t){return e.PricingFixed.query().select("Id").parseAs(function(e){this.Id=e.Id}).where("PricingModelId","eq","guid'"+t.Id+"'").execute()}],rFixeds:["$http","Model","$stateParams",function(e,t,n){return e.get($config.API_ENDPOINT+"api/PricingModels/FetchFixedDetails?pricingModelId="+n.Id+"&count=50")}],rZones:["Model",function(e){return e.Zone.query().execute()}],rVehicleTypes:["Model",function(e){return e.VehicleType.query().execute()}]}}),t.state("root.settings.pricingmodels.viewer.vehicles",{url:"/vehicles",templateUrl:"/webapp/management/settings/pricingmodels/pricing-models-vehicles.partial.html",controller:"SettingsPricingModelsVehiclesController",resolve:{rVehiclePricings:["Model","$stateParams",function(e,t){return e.PricingModelVehicleTypePricing.query().where("PricingModelId","eq","guid'"+t.Id+"'").trackingEnabled().execute()}],rVehicleTypes:["Model",function(e){return e.VehicleType.query().execute()}]}}),t.state("root.settings.pricingmodels.viewer.tester",{url:"/tester",templateUrl:"/webapp/management/settings/pricingmodels/pricing-models-tester.partial.html",controller:"SettingsPricingModelsTesterController",resolve:{rVehicleTypes:["Model",function(e){return e.VehicleType.query().execute()}],rZones:["Model","$stateParams",function(e,t){return e.ZoneInPricingModel.query().include("Zone").where("PricingModelId","eq","guid'"+t.Id+"'").execute()}]}}),t.state("root.settings.pricingmodels.viewer.pricelist",{url:"/pricelist",templateUrl:"/webapp/management/settings/pricingmodels/price-list/partial.html",controller:"SettingsPriceListController"}),t.state("root.settings.pricingmodels.viewer.adjustments",{url:"/adjustments",controller:"ClientPricingModelAdjustmentController",templateUrl:"/webapp/management/settings/pricingmodels/adjustments/partial.html",resolve:{rAdjustments:["Model","$stateParams",function(e,t){return e.ClientPricingModelAdjustment.query().where("PricingModelId eq guid'"+t.Id+"'").include("Tax").execute()}],rRecurring:function(){return!0}}})),r.test("settings.dispatch")&&(t.state("root.settings.dispatch",{url:"/dispatch",permission:"Settings - AutoDispatch",resolve:{rTabs:["$stateParams",function(e){return[{heading:"Details",route:"root.settings.dispatch.details"},{heading:"Testing",route:"root.settings.dispatch.testing"},{heading:"Live",route:"root.settings.dispatch.live"}]}],rData:["Model","Auth",function(e,t){return e.DispatchSettings.query().filter("TenantId eq guid'"+t.getSession().TenantId+"'").trackingEnabled().execute()}],rCompany:["Model","Auth",function(e,t){return e.Company.query().select("Id,BaseLatitude,BaseLongitude,BaseZoom").filter("Id eq guid'"+t.getSession().TenantId+"'").execute()}],rAccessors:["$config",function(e){return{Title:function(e){return"Dispatch"}}}],rClients:["Model",function(e){return e.Client.query().select("Id,Name,ImageUrl").execute()}],rZones:["Model",function(e){return e.Zone.query().execute()}],rOverrides:["Model",function(e){return e.DispatchOverrides.query().include("Client").include("Zone").trackingEnabled().execute()}]},views:{"content-wrapper@root":{templateUrl:"/e9_components/layouts/module/module-item.layout.html",controller:"SettingsDispatchController"}}}),t.state("root.settings.dispatch.details",{url:"/details",templateUrl:"/webapp/management/settings/dispatch/dispatch-details.partial.html",controller:"SettingsDispatchDetailsController",resolve:{}}),t.state("root.settings.dispatch.testing",{url:"/testing",templateUrl:"/webapp/management/settings/dispatch/dispatch-tester.partial.html",controller:"SettingsDispatchTesterController"}),t.state("root.settings.dispatch.live",{url:"/live",templateUrl:"/webapp/management/settings/dispatch/dispatch-live.partial.html",controller:"SettingsDispatchLiveController"})),r.test("settings.taxes")&&t.state("root.settings.taxes",{url:"/taxes",permission:"Settings - Taxes",views:{"settings-content@root.settings":{templateUrl:"/webapp/management/settings/taxes/table.partial.html",controller:"SettingsTaxesController"}},resolve:{rTaxes:["Model",function(e){return e.Tax.query().include("TaxType").include("TaxComponents").execute()}]}}),r.test("settings.taxes","W")&&t.state("root.settings.taxes.create",{url:"/create",views:{"settings-content@root.settings":{templateUrl:"/webapp/management/settings/taxes/viewer.partial.html",controller:"SettingsTaxCreateController"}},resolve:{rTaxTypes:["Model",function(e){return e.TaxType.query().execute()}]}}),r.test("settings.payments")&&(t.state("root.settings.payments",{url:"/payments",permission:"Settings - Payment Models",views:{"settings-content@root.settings":{templateUrl:"/webapp/common/views/driverpayments/partial.html",controller:"DriverPaymentModelsController"}},resolve:{rPaymentModels:["Model",function(e){return e.DriverPaymentModel.query().execute()}]}}),t.state("root.settings.payments.viewer",{url:"/{Id}","default":"root.settings.payments.viewer.details",resolve:{rTabs:["$stateParams",function(e){return[{heading:"Details",route:"root.settings.payments.viewer.details"},{heading:"Bonus",route:"root.settings.payments.viewer.bonus"},{heading:"Adjustments",route:"root.settings.payments.viewer.adjustments"},{heading:"Fixed Rates",route:"root.settings.payments.viewer.fixed"}]}],rData:["Model","$stateParams",function(e,t){return e.DriverPaymentModel.query().include("Overrides,Overrides/Client,Overrides/VehicleType").where("Id eq guid'"+t.Id+"'").trackingEnabled().execute()}],rVehicleTypes:["Model",function(e){return e.VehicleType.query().execute()}],rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){return e.Name}}}]},views:{"content-wrapper@root":{controller:"ModuleItemViewController",templateUrl:"/e9_components/layouts/module/module-item.layout.html"}}}),t.state("root.settings.payments.viewer.details",{url:"/details",controller:"DriverPaymentModelDetailsController",templateUrl:"/webapp/common/views/driverpayments/details/partial.html"}),t.state("root.settings.payments.viewer.adjustments",{url:"/adjustments",controller:"DriverPaymentModelAdjustmentController",templateUrl:"/webapp/common/views/drivers/adjustments/partial.html",resolve:{rAdjustments:["Model","$stateParams",function(e,t){return e.DriverPaymentModelAdjustment.query().where("DriverPaymentModelId eq guid'"+t.Id+"'").include("Tax").execute()}],rRecurring:function(){return!0}}}),t.state("root.settings.payments.viewer.fixed",{url:"/fixed",controller:"SettingsDriverPaymentFixedController",templateUrl:"/webapp/management/settings/driverpayments/fixed/partial.html",resolve:{rFixeds:["$http","Model","$stateParams",function(e,t,n){return e.get($config.API_ENDPOINT+"api/DriverPayments/FetchDriverFixedDetails?driverPaymentModelId="+n.Id+"&count=50").then(function(e){return e.data.length>0?e.data.map(function(e){return new t.DriverPaymentModelFixed(e)}):[]})}],rFixedCount:["Model","$stateParams",function(e,t){return e.DriverPaymentModelFixed.query().select("Id").parseAs(function(e){this.Id=e.Id}).where("DriverPaymentModelId","eq","guid'"+t.Id+"'").execute()}],rZones:["Model",function(e){return e.Zone.query().execute()}],rVehicleTypes:["Model",function(e){return e.VehicleType.query().trackingEnabled().execute()}]}}),t.state("root.settings.payments.viewer.bonus",{url:"/bonus",controller:"DriverPaymentModelBonusController",templateUrl:"/webapp/common/views/driverpayments/bonus/partial.html"})),r.test("settings.specialrequirements")&&t.state("root.settings.specialrequirements",{url:"/specialrequirements",permission:"Settings - Special Requirements",views:{"settings-content@root.settings":{templateUrl:"/webapp/management/settings/specialrequirements/partial.html",controller:"SpecialRequirementsController"}},resolve:{rBRequirements:["Model",function(e){return e.BookingRequirement.query().include("Bookings").trackingEnabled().execute()}]}}),r.test("settings.appsettings")&&t.state("root.settings.appsettings",{url:"/appsettings",permission:"Settings - App Settings",views:{"settings-content@root.settings":{templateUrl:"/webapp/management/settings/app-settings/partial.html",controller:"AppSettingsController"}},resolve:{rAppConfigs:["$http","Model","$stateParams","Auth",function(e,t,n,o){return e.get($config.API_ENDPOINT+"api/appconfig?TenantId="+o.getSession().TenantId).then(function(e){if(e.data.length>0)return e.data.map(function(e){return new t.AppConfig(e)})})}]}}),r.test("settings.zones")&&t.state("root.settings.zones",{url:"/zones",permission:"Settings - Zone Management",views:{"content-wrapper@root":{templateUrl:"/webapp/management/settings/zones/zone-management.partial.html",controller:"ZoneManagementController"}},resolve:{rZones:["Model",function(e){return e.Zone.query().trackingEnabled().execute()}]}}),r.test("settings.tags")&&t.state("root.settings.tags",{url:"/tags",permission:"Settings - Tag Management",views:{"content-wrapper@root":{templateUrl:"/webapp/management/settings/tags/partial.html",controller:"TagManagementController"}},resolve:{rTags:["Model",function(e){return e.Tag.query().trackingEnabled().execute()}]}});var i=[{title:"Company",state:"root.settings.company.basic",icon:"icon-equalizer22"},{title:"Booking",state:"root.settings.booking.expenses",icon:"icon-equalizer22"},{title:"Telephony",state:"root.settings.telephony",icon:"icon-phone"},{title:"Zones",state:"root.settings.zones",icon:"icon-equalizer22"},{title:"Pricing",state:"root.settings.pricingmodels",icon:"icon-coins"},{title:"Driver Payment",state:"root.settings.payments",icon:"icon-coins"},{title:"VAT/Taxes",state:"root.settings.taxes",icon:"icon-coins"},{title:"Email Config",state:"root.settings.email.config",icon:"icon-envelope"},{title:"Profile Settings",allow:!0,state:"root.settings.profile",icon:"icon-lock"},{title:"Users",state:"root.settings.users",icon:"icon-users"},{title:"System Roles",state:"root.settings.roles",icon:"icon-lock"},{title:"Known Locations",state:"root.settings.knownlocations",icon:"icon-lock"},{title:"Auto Dispatch",state:"root.settings.dispatch.details",icon:"icon-lock"},{title:"Tags",state:"root.settings.tags",icon:"icon-lock"},{title:"Special Requirements",state:"root.settings.specialrequirements",icon:"icon-lock"},{title:"Import",state:"root.settings.import",icon:"icon-lock"},{title:"Export",state:"root.settings.exports",icon:"icon-lock"},{title:"App Settings",state:"root.settings.appsettings",icon:"icon-equalizer22"},{title:"Google Config",state:"root.settings.googlemapsconfig",icon:"icon-map"}];i=i.filter(function(e){return e.allow||r.test(e.state.substring(5))}),n.registerMenuItem({state:i.length>0?null:"root.settings.profile",icon:"settings",title:"Settings",subMenus:i})}}function n(t,n){function o(e){var t='<a ui-sref="'+e.state+'" ui-sref-opts="{reload: true}" style="color:white;width:100%;display:inline-block;"><i class="'+e.icon+'"></i>'+e.title+"</a>";return t}t.menu=n,e.forEach(n,function(e){e.$html=o(e)})}var o=e.module("cab9.settings",[]);o.config(t),o.controller("SettingsController",n),t.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider","$permissions"],n.$inject=["$scope","rMenu"]}(angular);;;;
!function(e){function t(t,r,o,i,s){i.test("settings.exports")&&(t.state("root.settings.exports",{url:"/exports",permission:"Settings - Export",resolve:{rTabs:[function(){return[{heading:"SAGE - Drivers",route:"root.settings.exports.sagedriver"},{heading:"SAGE - Invoices",route:"root.settings.exports.sageinvoice"},{heading:"Invoice - Bookings",route:"root.settings.exports.invoicebookings"},{heading:"Payments - BACS",route:"root.settings.exports.bacs"},{heading:"Documents Export",route:"root.settings.exports.driverdocuments"},{heading:"Client Spend",route:"root.settings.exports.clientspend"},{heading:"FTP Invoice Generation",route:"root.settings.exports.invoicegen"},{heading:"PCO Driver Export",route:"root.settings.exports.drivers"},{heading:"PCO Vehicle Export",route:"root.settings.exports.vehicles"},{heading:"Capita - FASTER Export",route:"root.settings.exports.faster"},{heading:"XERO - Invoices",route:"root.settings.exports.xeroinvoice"},{heading:"XERO - Drivers",route:"root.settings.exports.xerodriver"}]}]},views:{"settings-content@root.settings":{templateUrl:"/webapp/management/settings/exports/partial.html",controller:"ExportSettingsController"}}}),t.state("root.settings.exports.sagedriver",{url:"/sagedriver",templateUrl:"/webapp/management/settings/exports/sagedriver/partial.html",controller:["$scope",function(e){e.report.preview=null,e.report.schema="SageDriverResults",e.report.params={SP:"Sage_Driver_Export",From:(new moment).subtract(7,"days").startOf("isoweek").toDate(),To:(new moment).subtract(7,"days").endOf("isoweek").toDate()}}],resolve:{}}),t.state("root.settings.exports.invoicebookings",{url:"/invoicebookings",templateUrl:"/webapp/management/settings/exports/invoicebookings/partial.html",controller:["$scope",function(e){e.report.preview=null,e.report.schema="WilliamLeaResults",e.report.params={SP:"Client_Invoice_Bookings",InvoiceRef:""}}],resolve:{}}),t.state("root.settings.exports.invoicegen",{url:"/invoicegen",templateUrl:"/webapp/management/settings/exports/invoicegen/partial.html",controller:["$scope","$http",function(t,r){t.report.params={SP:"Invoice_Generation",From:(new moment).subtract(7,"days").startOf("isoweek").toDate(),To:(new moment).subtract(7,"days").endOf("isoweek").toDate()},t.showConfirm=function(){var o=[];e.forEach(t.report.params,function(e,t){"From"==t||"To"==t?o.push(t+"="+new moment(e).format("YYYY-MM-DDTHH:mm:ss")+"Z"):o.push(t+"="+e)}),r.get($config.API_ENDPOINT+"api/export/preview?"+o.join("&")).then(function(){swal("Success","Invoice Generation started, files will be available shortly.","success")})}}],resolve:{}}),t.state("root.settings.exports.clientspend",{url:"/clientspend",templateUrl:"/webapp/management/settings/exports/clientspend/partial.html",controller:["$scope",function(e){e.report.preview=null,e.report.schema="ClientSpendReport",e.report.params={SP:"Client_Spend_Report",From:(new moment).subtract(7,"days").startOf("isoweek").toDate(),To:(new moment).subtract(7,"days").endOf("isoweek").toDate()}}]}),t.state("root.settings.exports.sageinvoice",{url:"/sageinvoice",templateUrl:"/webapp/management/settings/exports/sageinvoice/partial.html",controller:["$scope",function(e){e.report.preview=null,e.report.schema="SageInvoiceResults",e.report.params={SP:"Sage_Invoice_Export",From:(new moment).subtract(7,"days").startOf("isoweek").toDate(),To:(new moment).subtract(7,"days").endOf("isoweek").toDate()}}],resolve:{}}),t.state("root.settings.exports.xeroinvoice",{url:"/xeroinvoice",templateUrl:"/webapp/management/settings/exports/xeroinvoice/partial.html",controller:["$scope",function(e){e.report.preview=null,e.report.schema="XeroInvoiceResults",e.report.params={SP:"Xero_Invoice_Export",From:(new moment).subtract(7,"days").startOf("isoweek").toDate(),To:(new moment).subtract(7,"days").endOf("isoweek").toDate()}}],resolve:{}}),t.state("root.settings.exports.xerodriver",{url:"/xerodriver",templateUrl:"/webapp/management/settings/exports/xerodriver/partial.html",controller:["$scope",function(e){e.report.preview=null,e.report.schema="XeroDriverResults",e.report.params={SP:"Xero_Driver_Export",From:(new moment).subtract(7,"days").startOf("isoweek").toDate(),To:(new moment).subtract(7,"days").endOf("isoweek").toDate()}}],resolve:{}}),t.state("root.settings.exports.bacs",{url:"/bacs",templateUrl:"/webapp/management/settings/exports/bacs/partial.html",controller:["$scope",function(e){e.report.preview=null,e.report.schema="BacsResults",e.report.params={SP:"Bacs_Export",From:(new moment).startOf("isoweek").toDate(),To:(new moment).endOf("isoweek").toDate()}}],resolve:{}}),t.state("root.settings.exports.capita",{url:"/capita",templateUrl:"/webapp/management/settings/exports/capita_bacs/partial.html",controller:["$scope",function(e){e.report.preview=null,e.report.schema="CapitaResults",e.report.params={SP:"Capita_Bacs_Export",From:(new moment).startOf("isoweek").toDate(),To:(new moment).endOf("isoweek").toDate()}}],resolve:{}}),t.state("root.settings.exports.faster",{url:"/faster",templateUrl:"/webapp/management/settings/exports/capita_faster/partial.html",controller:["$scope",function(e){e.report.preview=null,e.report.schema="CapitaResults",e.report.params={SP:"Capita_Faster_Export",From:(new moment).startOf("isoweek").toDate(),To:(new moment).endOf("isoweek").toDate()}}],resolve:{}}),t.state("root.settings.exports.driverdocuments",{url:"/driverdocuments",templateUrl:"/webapp/management/settings/exports/driverdocuments/partial.html",controller:["$scope",function(e){e.report.preview=null,e.report.schema="DriverDocumentResults",e.report.params={SP:"Driver_Exp_Report",From:(new moment).startOf("isoweek").toDate(),To:(new moment).endOf("isoweek").toDate(),AllDrivers:!1}}],resolve:{}}),t.state("root.settings.exports.drivers",{url:"/drivers",templateUrl:"/webapp/management/settings/exports/drivers/partial.html",controller:["$scope",function(e){e.report.preview=null,e.report.schema="DriverPcoExport",e.report.params={SP:"Driver_PCO_Report",From:(new moment).startOf("isoweek").toDate(),To:(new moment).endOf("isoweek").toDate(),AllDrivers:!1}}],resolve:{}}),t.state("root.settings.exports.vehicles",{url:"/vehicles",templateUrl:"/webapp/management/settings/exports/vehicles/partial.html",controller:["$scope",function(e){e.report.preview=null,e.report.schema="VehiclePcoExport",e.report.params={SP:"Vehicle_PCO_Report",From:(new moment).startOf("isoweek").toDate(),To:(new moment).endOf("isoweek").toDate(),AllDrivers:!1}}],resolve:{}}),s.registerSchema("ReportParams","",{From:{type:moment,required:!0},To:{type:moment,required:!0},InvoiceRef:{type:String,required:!0,placeholder:"INV000000"},AccountName:{type:String,display:"Sending Account Name",required:!0,placeholder:"Account Name"},AllDrivers:{type:Boolean,helpText:"All drivers or only those who worked during this time?"}}),s.registerSchema("WilliamLeaResults","",{OB10Number:{type:String},Cost_Centre:{type:String},PO_Number:{type:String},Tax_Point:{type:String},Inv_No:{type:Number},Qty:{type:Number},Each:{type:String},Docket:{type:String},Date:{type:String},Time:{type:String},Bookers_name:{type:String},Ref1:{type:String},Ref2:{type:String},Ref3:{type:String},From:{type:String},To:{type:String},Tariff:{type:String},Net:{type:Number},Wait:{type:String},WT_Cost:{type:Number},Extras:{type:String},SubTotal:{type:Number},VAT:{type:Number},Total:{type:Number}}),s.registerSchema("SageDriverResults","",{TypeCode:{type:String},SupplierNo:{type:String},NominalCode:{type:String},Code:{type:String},TaxDate:{type:String},Callsign:{type:String},Type:{type:String},NetAmount:{type:Number},TaxCode:{type:String},TaxAmount:{type:Number}}),s.registerSchema("ClientSpendReport","",{AccountNo:{type:String},Name:{type:String},Count:{type:Number},Total:{type:Number,binding:function(e){return n+e.Total.toFixed(2)}}}),s.registerSchema("SageInvoiceResults","",{TypeCode:{type:String},AccountNo:{type:String},NominalCode:{type:String},Code:{type:String},TaxDate:{type:String},Reference:{type:String},Type:{type:String},NetAmount:{type:Number},TaxCode:{type:String},TaxAmount:{type:Number}}),s.registerSchema("XeroInvoiceResults","",{ContactName:{type:String},EmailAddress:{type:String},POAddressLine1:{type:String},POAddressLine2:{type:String},POAddressLine3:{type:String},POAddressLine4:{type:String},POCity:{type:String},PORegion:{type:String},POPostalCode:{type:String},POCountry:{type:String},InvoiceNumber:{type:String},Reference:{type:String},InvoiceDate:{type:String},DueDate:{type:String},Total:{type:Number},InventoryItemCode:{type:String},Description:{type:String},Quantity:{type:Number},UnitAmount:{type:Number},Discount:{type:Number},AccountCode:{type:String},TaxType:{type:String},TaxAmount:{type:Number},TrackingName1:{type:String},TrackingOption1:{type:String},TrackingName2:{type:String},TrackingOption2:{type:String},Currency:{type:String},BrandingTheme:{type:String}}),s.registerSchema("XeroDriverResults","",{ContactName:{type:String},EmailAddress:{type:String},POAddressLine1:{type:String},POAddressLine2:{type:String},POAddressLine3:{type:String},POAddressLine4:{type:String},POCity:{type:String},PORegion:{type:String},POPostalCode:{type:String},POCountry:{type:String},InvoiceNumber:{type:String},Reference:{type:String},InvoiceDate:{type:String},DueDate:{type:String},Total:{type:Number},InventoryItemCode:{type:String},Description:{type:String},Quantity:{type:Number},UnitAmount:{type:Number},Discount:{type:Number},AccountCode:{type:String},TaxType:{type:String},TaxAmount:{type:Number},TrackingName1:{type:String},TrackingOption1:{type:String},TrackingName2:{type:String},TrackingOption2:{type:String},Currency:{type:String},BrandingTheme:{type:String}}),s.registerSchema("BacsResults","",{BankSortCode:{type:String},BankName:{type:String},BankAC:{type:String},Amount:{type:Number},Code:{type:String},SubCode:{type:String}}),s.registerSchema("DriverDocumentResults","",{Callsign:{type:String},Firstname:{type:String},Surname:{type:String},DrivingLicenseNumber:{type:String},DrivingLicenseExpiry:{type:String},DriverPCONumber:{type:String},DriverPCOExpiry:{type:String},DriverNationalInsuranceNumber:{type:String},VehicleDescription:{type:String},Registration:{type:String},VehicleV5Expiry:{type:String},VehiclePCOExpiry:{type:String},VehicleMOTExpiry:{type:String},VehicleInsuranceExpiry:{type:String}}),s.registerSchema("DriverPcoExport","",{PrivateHireLicenceNumber:{type:String},Firstname:{type:String},Surname:{type:String}}),s.registerSchema("VehiclePcoExport","",{PrivateHireLicenceNumber:{type:String},Make:{type:String},Registration:{type:String}}),s.registerSchema("CapitaResults","",{Value:{type:String}}))}function r(t,r,o,n,i){t.tabDefs=r,t.report={schema:"",params:null,preview:null},t.runReport=function(){o.get(n.API_ENDPOINT+"api/export/preview",{params:t.report.params}).success(function(e){var r=1;t.report.preview=e.map(function(e){return e.Id=r++,e})})},t.downloadReport=function(){var r=i.getSession(),o=[];e.forEach(t.report.params,function(e,t){"From"==t||"To"==t?o.push(t+"="+new moment(e).format("YYYY-MM-DDTHH:mm:ss")+"Z"):o.push(t+"="+e)}),window.open(n.API_ENDPOINT+"api/export/download?TenantId="+r.TenantId+"&"+o.join("&"))}}var o=e.module("cab9.settings.exports",["cab9.settings"]),n="£";o.config(t),o.controller("ExportSettingsController",r),t.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider","$permissions","ModelProvider"],r.$inject=["$scope","rTabs","$http","$config","Auth"]}(angular);;;;
!function(e){function t(e,t,o,n){function i(){e.showSearch=!e.showSearch,e.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):e.searchTerm.$=""}function s(){n.open({templateUrl:"/webapp/management/settings/pricingmodels/pricing-models-create.modal.html",backdrop:"static",controller:["$scope","$modalInstance","$http","$config","Model","rPrevious",function(e,t,o,n,i,s){e.item=new i.PricingModel,e.lockSave=!1,e.previous=s,e.save=function(){e.saving=!0,e.item.$previous?o.post(n.API_ENDPOINT+"api/pricing",e.item,{params:{cloneFrom:e.item.$previous}}).success(function(e){t.close(e)}).error(function(t){swal("Error","An error occured.","error"),e.saving=!1}):e.item.$save().success(function(e){t.close(e)})}}],resolve:{rPrevious:["Model",function(e){return e.PricingModel.query().select("Id,Name,Description").execute()}]}}).result.then(function(e){t.go("root.settings.pricingmodels.viewer.details",{Id:e.Id})},function(){})}e.pricingModels=o,e.openPricingModelCreator=s,e.toggleSearch=i,e.searchTerm={},e.metricText="Price/Mile",e.COMPANY.UseMetric&&(e.metricText="Price/Km")}function o(e,t,o,n){e.item=o[0],e.accessors=n,e.tabDefs=t,e.viewMode="CREATE"}function n(e,t,o,n,i,s,l,r,c){function a(){e.viewMode="EDIT"}function d(){var t=[],o=new l.CancellationRule(e.item.CancellationRule);e.item.CancellationRuleId&&(t.push(o.$update()),e.item.CancellationRule=null),t.push(e.item.$patch()),r.all(t).then(function(){i.go(i.current,{Id:c.Id},{reload:!0})},function(){alert("Error"),console.log(arguments)})}function u(){swal({title:"Are you sure?",text:"Cancellation rule will be deleted",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},function(){var t=new l.CancellationRule(e.item.CancellationRule);e.item.CancellationRuleId=null,e.item.CancellationRule=null,e.item.$patch().then(function(){t.$delete().then(function(){i.go(i.current,{Id:c.Id},{reload:!0})})})},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:$UI.COLOURS.brandSecondary})})}function g(){e.item.$rollback(!0),e.viewMode="VIEW"}function p(e){swal({title:"Are you sure?",text:"This Pricing model will be deleted permanentaly",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},function(){e.$delete().then(function(){swal("Success","Pricing Model deleted.","success"),i.go("root.settings.pricingmodels",null,{reload:!0})},function(e){409==e.status?swal("Error","Error on deleting pricing model as some clients might be associated with it. Please disassociate all clients and try again.","error"):swal("Error","Error on deleting pricing model.","error")})})}if(e.item=o[0],e.accessors=n,e.viewMode="VIEW",e.startEditing=a,e.saveEdits=d,e.cancelEditing=g,e.deleteModel=p,e.deleteCancellationRule=u,e.tabDefs=[],t.length>4){for(var m=0;m<3;m++)e.tabDefs.push(t[m]);setTimeout(function(){$(".module-item .module-item-nav-bar .tab-container ul.nav-tabs").append('<li class="has-dropdown"><a><span id="selected">More</span><i class="material-icons">arrow_drop_down</i></a><ul class="subnav"></ul></li>');for(var o=3;o<t.length;o++)if(t[o].params){Object.keys(t[o].params)[0]}else $(".subnav").append(s('<li><a ui-sref="'+t[o].route+'()">'+t[o].heading+"</a></li>")(e));$(".subnav a").click(function(){$("#selected").text($(this).text())})},0)}else e.tabDefs=t}function s(t,o,n,i,s){function l(){t.map=new google.maps.Map(document.getElementById("zone-map"),{center:{lat:t.COMPANY.BaseLatitude,lng:t.COMPANY.BaseLongitude},zoom:10,styles:m});for(var e=(new google.maps.Marker({map:t.map,position:{lat:t.COMPANY.BaseLatitude,lng:t.COMPANY.BaseLongitude},animation:google.maps.Animation.DROP,icon:{url:"../../includes/images/marker.png",scaledSize:new google.maps.Size(48,48)}}),0);e<t.allZones.length;e++)t.allZones[e].$poly.setMap(t.map);t.mapSetup=!0,t.$apply()}function r(){var e=new n.ZoneInPricingModel;e.PricingModelId=t.item.Id,t.selected.pricing=e,t.viewMode="CREATE"}function c(){t.selected.pricing.$save().success(function(){var e=t.allZones.find(function(e){return e.Id==t.selected.pricing.ZoneId});e&&(e.$inUse=!0,t.selected.pricing.$zoneName=e.Name,t.selected.pricing.$zoneDescription=e.Description),t.zones.push(t.selected.pricing),t.selected.pricing=null,t.viewMode="VIEW",swal("Saved","New zone pricing settings saved.","success")},function(){swal("Error!","Error saving new zone pricing settings.","error")})}function a(){t.selected.pricing=null,t.viewMode="VIEW"}function d(e){t.selected.pricing=e,t.viewMode="EDIT"}function u(){t.selected.pricing.$patch().then(function(){t.selected.pricing=null,t.viewMode="VIEW",swal("Saved","Pricing zone settings updated.","success")},function(){swal("Error!","Error updating pricing zone settings.","error")})}function g(){t.selected.pricing.$rollback(!0),t.selected.pricing=null,t.viewMode="VIEW"}function p(){t.selected.pricing.$delete().success(function(){var e=t.zones.indexOf(t.selected.pricing);t.zones.splice(e,1);var o=t.allZones.find(function(e){return e.Id==t.selected.pricing.ZoneId});o&&(o.$inUse=!1),t.selected.pricing=null,t.viewMode="VIEW",swal("Deleted","Pricing zone settings removed.","success")}).error(function(){swal("Error!","Error deleting pricing zone settings.","error")})}t.allZones=s,t.zones=i,t.zonePolygons=[],t.viewMode="VIEW",t.selected={pricing:null};var m=[{featureType:"water",elementType:"geometry",stylers:[{color:"#e9e9e9"},{lightness:17}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#f5f5f5"},{lightness:20}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffffff"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#ffffff"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:18}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:16}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#f5f5f5"},{lightness:21}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#dedede"},{lightness:21}]},{elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#ffffff"},{lightness:16}]},{elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#333333"},{lightness:40}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#f2f2f2"},{lightness:19}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#fefefe"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#fefefe"},{lightness:17},{weight:1.2}]}];t.metricText="Price/Mile",t.COMPANY.UseMetric&&(t.metricText="Price/Km"),e.forEach(t.allZones,function(e){var o=t.zones.find(function(t){return t.ZoneId==e.Id});o&&(o.$zoneName=e.Name,o.$zoneDescription=e.Description),e.$inUse=!!o;var n=Math.floor(16777215*Math.random()).toString(16),i=google.maps.geometry.encoding.decodePath(e.OverviewPolyline),s=google.maps.geometry.spherical.computeArea(i),l=new google.maps.Polygon({id:e.Id,paths:i,editable:!1,draggable:!1,clickable:!0,fillColor:"#"+n,fillOpacity:o?.25:.05,strokeColor:"#"+n,strokeOpacity:o?.5:.1,stokeWeight:3,zIndex:1e6-s});l.addListener("click",function(e){}),e.$poly=l,t.zonePolygons.push(l)}),t.map={center:{latitude:t.COMPANY.BaseLatitude,longitude:t.COMPANY.BaseLongitude},zoom:10,contol:{}},t.mapBounds=new google.maps.LatLngBounds,setTimeout(function(){t.zonePolygons.length>0?l():(t.mapSetup=!0,t.$apply())},1e3),t.startNewZone=r,t.saveNewZone=c,t.cancelNewZone=a,t.startEditZone=d,t.saveEditZone=u,t.cancelEditZone=g,t.deleteEditZone=p,t.$watch("selected.pricing.ZoneId",function(o){o?e.forEach(t.allZones,function(e){if(e.Id==o){e.$poly.setMap(t.map),e.$poly.setOptions({fillOpacity:.5,strokeOpacity:.7});var n=e.MinLatitude+(e.MaxLatitude-e.MinLatitude)/2,i=e.MinLongitude+(e.MaxLongitude-e.MinLongitude)/2;t.map.panTo(new google.maps.LatLng(n,i)),t.map.setZoom(12)}else e.$inUse?(e.$poly.setMap(t.map),e.$poly.setOptions({fillOpacity:.05,strokeOpacity:.2})):e.$poly.setMap(null)}):t.mapSetup&&(e.forEach(t.allZones,function(e){e.$poly.setMap(t.map),e.$poly.setOptions({fillOpacity:e.$inUse?.25:.05,strokeOpacity:e.$inUse?.5:.1})}),t.map.panTo(new google.maps.LatLng(t.COMPANY.BaseLatitude,t.COMPANY.BaseLongitude)),t.map.setZoom(10))})}function l(t,o,n,i,s,l,r,c){function a(e){e.$pricing=new i.PricingModelVehicleTypePricing,e.$pricing.VehicleTypeId=e.Id,e.$pricing.PricingModelId=t.item.Id,t.editing=e}function d(e){t.editing&&p(e),t.editing=e}function u(e){swal({title:"Are you sure?",text:"This Vehicle Override will be deleted permanentaly",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){e.$pricing.$delete().then(function(){delete e.$pricing,swal("Success","Vehicle Override Deleted.","success")},function(e){swal("Error","Error while deleting vehicle override.","error")})})}function g(e){e.$pricing.Id?action=e.$pricing.$patch().then(function(){swal("Success","Vehicle Override Updated.","success"),t.editing=null}):action=e.$pricing.$save().then(function(){swal("Success","Vehicle Override Added.","success"),t.editing=null,c.go("root.settings.pricingmodels.viewer.vehicles",null,{reload:!0})})}function p(e){e.$pricing.Id?e.$pricing.$rollback(!0):delete e.$pricing,t.editing=null}t.vehicleTypes=r,t.vehiclePricings=l,t.editing=null,t.currency=s.currency().getCurrent(),t.AddOverride=a,t.EditOverride=d,t.DeleteOverride=u,t.SaveOverride=g,t.CancelOverride=p,e.forEach(r,function(e){var t=l.filter(function(t){return t.VehicleTypeId==e.Id})[0];t&&(e.$pricing=t)})}function r(t,o,n,s,l,r,c,a,d){function u(){var e=new google.maps.LatLngBounds;for(i=0;i<t.zonePolygons.length;i++){var o=t.zonePolygons[i];for(j=0;j<o.path.length;j++)e.extend(new google.maps.LatLng(o.path[j].latitude,o.path[j].longitude))}t.mapBounds={northeast:{latitude:e.getNorthEast().lat(),longitude:e.getNorthEast().lng()},southwest:{latitude:e.getSouthWest().lat(),longitude:e.getSouthWest().lng()}},t.mapSetup=!0,t.$apply()}function g(){t.selectedBooking.PricingModelId=t.item.Id,t.selectedBooking.Status="Incoming",t.selectedBooking.BookedDateTime=new moment.tz(t.selectedBooking.Time,c.timeZone().getTimeZone()).format(),n.post(s.API_ENDPOINT+"/api/quote?debug=true",t.selectedBooking).success(function(o){t.quote=o,null==o.Segments?t.directions.renderer?(t.directions.renderer.setDirections(t.directions.current),t.directions.renderer.setMap(t.map.getGMap())):(t.directions.options.map=t.map.getGMap(),t.directions.renderer=new google.maps.DirectionsRenderer(t.directions.options)):t.directions.renderer&&t.directions.renderer.setMap(null),t.segments.length=0;var n=new google.maps.LatLngBounds;t.quote.EstimatedDistance=0,e.forEach(o.Segments,function(e,o){t.quote.EstimatedDistance+=e.length,e.id=h++,e.step=o+1,e.stroke={weight:5,opacity:.8,color:"#63C4E1"},e.events={mouseover:function(t,n,i,s){i.stroke.color="red",f.open(t.getMap()),f.setPosition(new google.maps.LatLng(s[0].latLng.lat()+1e-4,s[0].latLng.lng())),f.setContent("<b>Segment: "+o+"</b><br/><b>Mileage: "+e.length.toFixed(1)+" Miles</b><br/><b>Cost: £"+(e.fare+e.entry+e.pickup+e.dropoff).toFixed(2)+"</b><br/>Entry: £"+e.entry.toFixed(2)+"<br/>Pickup: £"+e.pickup.toFixed(2)+"<br/>Dropoff: £"+e.dropoff.toFixed(2)+"<br/>Fare: £"+e.fare.toFixed(2)+"<br/>")},mouseout:function(e,t,o,n){o.stroke.color="#63C4E1",f.close()},mousemove:function(e,t,o,n){f.setPosition(new google.maps.LatLng(n[0].latLng.lat()+1e-4,n[0].latLng.lng()))}},e.path=e.points.map(function(e){var t=new google.maps.LatLng(e.lat,e.lng);return n.extend(t),t}),t.segments.push(e)}),t.map.getGMap().fitBounds(n),console.log(t.quote),console.log(t.segments),o.FinalCost=Number(o.FinalCost.toFixed(2)),t.selectedBooking.EstimatedDistance=Number(t.quote.EstimatedDistance.toFixed(1)),t.selectedBooking.EstimatedMins=Number(t.quote.EstimatedMins.toFixed(0)),t.selectedBooking.CurrencyId!=t.COMPANY.DefaultCurrencyId?(t.selectedBooking.EstimatedCost=o.FinalCost,t.selectedBooking.ActualCost=o.FinalCost,t.EstimatedCost=o.FinalCost,t.ActualCost=o.FinalCost):(t.selectedBooking.EstimatedCost=o.FinalCost,t.selectedBooking.ActualCost=o.FinalCost,t.EstimatedCost=o.FinalCost,t.ActualCost=o.FinalCost)}).error(function(e){console.log(e)})}function p(e){return r.Maps.Directions.route(e).then(function(e){t.directions.setDirections(e)})}function m(){var e=new l.BookingStop;t.selectedBooking.BookingStops.push(e)}t.vehicleTypes=a,t.zonePolygons=[],t.viewMode="EDIT",t.bookingStops=[];var f=new google.maps.InfoWindow({disableAutoPan:!0,pixelOffset:new google.maps.Size(0,(-10))});e.forEach(d,function(e){var o={id:e.Id,path:google.maps.geometry.encoding.decodePath(e.Zone.OverviewPolyline).map(function(e){return{latitude:e.lat(),longitude:e.lng()}}),stroke:{color:"black",weight:5,opacity:.8},$zone:e};e.$poly=o,t.zonePolygons.push(o)}),setTimeout(function(){t.zonePolygons.length>0?u():t.mapSetup=!0},1e3);var h=1,y=null;t.quote=null,t.segments=[],t.selectedBooking=new l.Booking,t.selectedBooking.BookingStops.length=0,t.selectedBooking.BookingStops.push(new l.BookingStop),t.selectedBooking.BookingStops.push(new l.BookingStop),t.selectedBooking.TaxId=t.COMPANY.DefaultTaxId,1==t.COMPANY.ChauffeurModeActive,t.selectedBooking.VehicleTypeId=o.defaultVehicleType,t.selectedBooking.VehicleClassId=o.defaultVehicleClass;var v=new moment.tz(c.timeZone().getTimeZone());t.selectedBooking.BookedDateTime=v.toDate(),t.selectedBooking.Time=v.startOf("minute").add(15,"minutes").toDate(),t.directions={renderer:null,current:null,currentRoute:null,currentStep:null,setRoute:function(e){e!=this.currentRoute&&(this.currentRoute=e,this.currentStep=null,this.renderer.setRouteIndex(this.current.routes.indexOf(e)))},viewStep:function(e){this.currentStep=e,t.map.center.latitude=e.start_point.lat(),t.map.center.longitude=e.start_point.lng()},setDirections:function(e){this.current=e,this.currentStep=null,this.currentRoute=e?e.routes[0]:null,this.options.directions=e,this.renderer&&this.renderer.setMap(null),e?t.selectedBooking.EncodedRoute=this.currentRoute.overview_polyline:(this.current=null,this.options.directions=null),this.currentRoute&&this.currentRoute.legs&&this.currentRoute.legs[0]&&(t.selectedBooking.EstimatedDuration=10*Math.ceil(this.currentRoute.legs[0].duration.value/600),t.selectedBooking.EstimatedDistance=this.currentRoute.legs[0].distance.value)},options:{suppressInfoWindows:!0,suppressMarkers:!1,directions:null,panel:document.getElementById("google-directions")}},t.map={center:{latitude:t.COMPANY.BaseLatitude||51.471507,longitude:t.COMPANY.BaseLongitude||-.487904},disableDefaultUI:!0,styles:s.GMAPS_STYLE,zoom:t.COMPANY.BaseZoom||7,traffic:{show:!1,options:{}}},t.addStop=m,t.getQuote=g,t.$watch("selectedBooking.BookingStops",function(){for(t.bookingStops=[],i=0;i<t.selectedBooking.BookingStops.length;i++){var o=t.selectedBooking.BookingStops[i];o.id=i,o.Latitude&&o.Longitude&&(o.coords={latitude:o.Latitude,longitude:o.Longitude},t.bookingStops.push(o))}if(t.selectedBooking.AsDirected);else if(t.selectedBooking.BookingStops.length<2)return t.selectedBooking.EstimatedCost=0,void(t.selectedBooking.validStops=!1);var n=!0;e.forEach(t.selectedBooking.BookingStops,function(e){e.Latitude&&e.Longitude||(n=!1)}),n?(t.selectedBooking.validStops=!0,p(t.selectedBooking.BookingStops.map(function(e){return new google.maps.LatLng(e.Latitude,e.Longitude)})).then(g)):(t.directions.setDirections(null),t.selectedBooking.EstimatedCost=0,t.selectedBooking.EstimatedDistance=0,t.selectedBooking.ActualCost=0,t.selectedBooking.Discount=0,t.selectedBooking.validStops=!1,t.selectedBooking.BookingStops[0].Latitude&&t.selectedBooking.BookingStops[0].Longitude&&(t.map.center.latitude=t.selectedBooking.BookingStops[0].Latitude,t.map.center.longitude=t.selectedBooking.BookingStops[0].Longitude,t.map.zoom=15))},!0),t.$watchGroup(["selectedBooking.BookingStops.length","selectedBooking.VehicleTypeId","selectedBooking.ChauffeurMode","selectedBooking.EstimatedMins"],function(){y&&($timeout.cancel(y),y=null),1==t.setupComplete&&(y=$timeout(g,500))})}function c(){return{restrict:"E",template:'<div class="form-group"><input type="text" class="form-control google-address-text" /></div>',scope:{object:"="},link:function(e,t,o){function n(){var t=i.getPlace();e.object.latitude=t.geometry.location.lat(),e.object.longitude=t.geometry.location.lng(),e.$apply(),e.$emit("address_changed",{latitude:t.geometry.location.lat(),longitude:t.geometry.location.lng()})}var i=new google.maps.places.Autocomplete(t.find("input")[0],{types:["geocode"]});i.addListener("place_changed",n)}}}var a=e.module("cab9.settings");a.controller("SettingsPricingModelsController",t),a.controller("SettingsPricingModelsCreateController",o),a.controller("SettingsPricingModelsViewerController",n),a.controller("SettingsPricingModelsZonesController",s),a.controller("SettingsPricingModelsVehiclesController",l),a.controller("SettingsPricingModelsTesterController",r),t.$inject=["$scope","$state","rData","$modal"],o.$inject=["$scope","rTabs","rData","rAccessors"],n.$inject=["$scope","rTabs","rData","rAccessors","$state","$compile","Model","$q","$stateParams"],s.$inject=["$scope","$q","Model","rZones","rAllZones"],l.$inject=["$scope","$q","$stateParams","Model","Localisation","rVehiclePricings","rVehicleTypes","$state"],r.$inject=["$scope","$tenantConfig","$http","$config","Model","Google","Localisation","rVehicleTypes","rZones"],a.directive("addressMapSearch",[c])}(angular);;;;
!function(){function e(e,t,n,r,o,l,u){function i(e){swal({title:"Are you sure?",text:"Adjustment will be deleted",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){new l.ClientPricingModelAdjustment(e).$delete().then(function(e){swal({title:"Adjustment deleted",text:"Changes have been updated.",type:"success",confirmButtonColor:u.COLOURS.brandSecondary}),t.go(t.current,{Id:n.Id},{reload:!0})},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:u.COLOURS.brandSecondary})})})}function d(){var e=r.open({templateUrl:"/webapp/management/settings/pricingmodels/adjustments/modal/modal.html",controller:"ClientPricingModelAdjustmentCreateController",resolve:{rClientId:function(){return n.Id},rTaxes:function(){return l.Tax.query().execute()},rVehicleTypes:["Model","$stateParams",function(e,t){return e.VehicleType.query().select("Id, Name").execute()}]}});e.result.then(function(e){t.go(t.current,n,{reload:!0})},function(){})}function c(o){var u=(e.adjustments.indexOf(o),r.open({templateUrl:"/webapp/management/settings/pricingmodels/adjustments/modal/modal.html",controller:"ClientPricingModelAdjustmentEditController",resolve:{rAdjustment:function(){return l.ClientPricingModelAdjustment.query().where("Id eq guid'"+o.Id+"'").trackingEnabled().execute()},rTaxes:function(){return l.Tax.query().execute()},rVehicleTypes:["Model","$stateParams",function(e,t){return e.VehicleType.query().select("Id, Name").execute()}]}}));u.result.then(function(e){t.go(t.current,n,{reload:!0})},function(){})}e.adjustments=o,e.openAdjustmentCreate=d,e.deleteAdjustment=i,e.recurring=!0,e.schema="ClientPricingModelAdjustment",e.openAdjustmentEdit=c}var t=angular.module("cab9.settings");t.controller("ClientPricingModelAdjustmentController",e),e.$inject=["$scope","$state","$stateParams","$modal","rAdjustments","Model","$UI"]}();;;;
!function(e){function t(e,t,n,l,a,u,s,d,i,r,c,o){function m(t){e.adjustment.$VehicleTypes.push(t);var n=e.unlinkedVehicleTypes.filter(function(e){return e.Id==t.Id});n[0]&&e.unlinkedVehicleTypes.splice(e.unlinkedVehicleTypes.indexOf(n[0]),1),e.selectedVehicleType=null}function y(t){e.unlinkedVehicleTypes.push(t);var n=e.adjustment.$VehicleTypes.filter(function(e){return e.Id==t.Id});n[0]&&e.adjustment.$VehicleTypes.splice(e.adjustment.$VehicleTypes.indexOf(n[0]),1)}function p(e){e.selected=!e.selected}function f(){try{e.adjustment.AppliesToBooking?(e.adjustment.DaysOfWeek=h(e.week),e.adjustment.StartTime=T(e.adjustment.$StartTime),e.adjustment.EndTime=T(e.adjustment.$EndTime),e.adjustment.VehicleTypes=j(e.adjustment.$VehicleTypes)):(e.adjustment.DaysOfWeek=null,e.adjustment.StartTime=null,e.adjustment.EndTime=null,e.adjustment.VehicleTypes=null,e.adjustment.ActivateByCode=null),e.adjustment.AppliesToBooking&&(e.adjustment.Recurring="Recurring"),e.adjustment.$save().then(function(e){swal({title:"Adjustment Model Saved!",text:"Changes have been updated.",type:"success",confirmButtonColor:d.COLOURS.brandSecondary}),n.close(e)},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:d.COLOURS.brandSecondary})})}catch(t){swal({title:"Some Error Occured.",text:t.message,type:"error",confirmButtonColor:d.COLOURS.brandSecondary})}}function h(e){var t=0;return e.map(function(e){1==e.selected&&(t+=e.value)}),t>0?t:null}function T(e){if(e&&e.length>0){if(2==e.split(":").length)return parseFloat(60*e.split(":")[0])+parseFloat(e.split(":")[1]);throw{message:"Time is not in correct format. Please check your input and try again."}}return null}function j(e){if(e.length>0){var t=e.map(function(e){return e.Id});return t.join(",")}return null}e.adjustment=new r.ClientPricingModelAdjustment,e.adjustment.TaxId=e.COMPANY.DefaultTaxId,e.adjustment.PricingModelId=t.Id,e.viewMode="CREATE",e.save=f,e.taxes=c,e.adjustment.$VehicleTypes=[],e.unlinkedVehicleTypes=o,e.addVehicleType=m,e.removeVehicleType=y,e.toggleDay=p,e.week=[{day:"Su",value:1,selected:!1,full:"Sunday"},{day:"Mo",value:2,selected:!1,full:"Monday"},{day:"Tu",value:4,selected:!1,full:"Tuesday"},{day:"We",value:8,selected:!1,full:"Wednesday"},{day:"Th",value:16,selected:!1,full:"Thursday"},{day:"Fr",value:32,selected:!1,full:"Friday"},{day:"Sa",value:64,selected:!1,full:"Saturday"}]}function n(e,t,n,l,a,u,s,d,i,r,c,o,m){function y(t){e.adjustment.$VehicleTypes.push(t);var n=e.unlinkedVehicleTypes.filter(function(e){return e.Id==t.Id});n[0]&&e.unlinkedVehicleTypes.splice(e.unlinkedVehicleTypes.indexOf(n[0]),1),e.selectedVehicleType=null}function p(t){e.unlinkedVehicleTypes.push(t);var n=e.adjustment.$VehicleTypes.filter(function(e){return e.Id==t.Id});n[0]&&e.adjustment.$VehicleTypes.splice(e.adjustment.$VehicleTypes.indexOf(n[0]),1)}function f(e){e.selected=!e.selected}function h(){try{e.adjustment.AppliesToBooking?(e.adjustment.DaysOfWeek=$(e.week),e.adjustment.StartTime=g(e.adjustment.$StartTime),e.adjustment.EndTime=g(e.adjustment.$EndTime),e.adjustment.VehicleTypes=v(e.adjustment.$VehicleTypes)):(e.adjustment.DaysOfWeek=null,e.adjustment.StartTime=null,e.adjustment.EndTime=null,e.adjustment.VehicleTypes=null,e.adjustment.ActivateByCode=null),e.adjustment.AppliesToBooking&&(e.adjustment.Recurring="Recurring"),e.adjustment.$patch().then(function(e){swal({title:"Adjustment Model Updated!",text:"Changes have been updated.",type:"success",confirmButtonColor:d.COLOURS.brandSecondary}),n.close(e)},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:d.COLOURS.brandSecondary})})}catch(t){swal({title:"Some Error Occured.",text:t.message,type:"error",confirmButtonColor:d.COLOURS.brandSecondary})}}function T(){if(j(),e.adjustment.$StartTime=V(e.adjustment.StartTime),e.adjustment.$EndTime=V(e.adjustment.EndTime),e.adjustment.$VehicleTypes=[],e.adjustment.VehicleTypes){var t=e.adjustment.VehicleTypes.split(",");e.unlinkedVehicleTypes.map(function(n){t.indexOf(n.Id)>-1&&(e.adjustment.$VehicleTypes.push(n),n.$assigned=!0)}),e.unlinkedVehicleTypes=e.unlinkedVehicleTypes.filter(function(e){return!e.$assigned})}}function j(){e.adjustment.DaysOfWeek&&e.adjustment.DaysOfWeek.length>0&&e.week.map(function(t){e.adjustment.DaysOfWeek.indexOf(t.full)>-1&&(t.selected=!0)})}function $(e){var t=0;return e.map(function(e){1==e.selected&&(t+=e.value)}),t>0?t:null}function g(e){if(e&&e.length>0){if(2==e.split(":").length)return parseFloat(60*e.split(":")[0])+parseFloat(e.split(":")[1]);throw{message:"Time is not in correct format. Please check your input and try again."}}return null}function V(e){if(e){if("number"==typeof e){var t=Math.floor(e/60)<10?"0"+Math.floor(e/60):Math.floor(e/60),e=e%60<10?"0"+e%60:e%60;return t+":"+e}throw{message:"Time is not in correct format. Please check your input and try again."}}return null}function v(e){if(e.length>0){var t=e.map(function(e){return e.Id});return t.join(",")}return null}e.taxes=o,e.adjustment=c[0],e.viewMode="EDIT",e.save=h,e.recurring=!0,e.addVehicleType=y,e.removeVehicleType=p,e.toggleDay=f,e.unlinkedVehicleTypes=m,e.week=[{day:"Su",value:1,selected:!1,full:"Sunday"},{day:"Mo",value:2,selected:!1,full:"Monday"},{day:"Tu",value:4,selected:!1,full:"Tuesday"},{day:"We",value:8,selected:!1,full:"Wednesday"},{day:"Th",value:16,selected:!1,full:"Thursday"},{day:"Fr",value:32,selected:!1,full:"Friday"},{day:"Sa",value:64,selected:!1,full:"Saturday"}],T()}var l=e.module("cab9.settings");l.controller("ClientPricingModelAdjustmentCreateController",t),t.$inject=["$scope","$stateParams","$modalInstance","$rootScope","$state","$q","$config","$UI","$http","Model","rTaxes","rVehicleTypes"],l.controller("ClientPricingModelAdjustmentEditController",n),n.$inject=["$scope","$stateParams","$modalInstance","$rootScope","$state","$q","$config","$UI","$http","Model","rAdjustment","rTaxes","rVehicleTypes"]}(angular);;;;
!function(e){function o(o,t,r,n,l,s,d,c,a,f,u,p,m){function g(){for(i=0;i<o.fixeds.length;i++)o.fixeds[i]["delete"]=!1;o.showDeleteCheckbox=!1,o.selectAll=!1}function h(){window.open(p.API_ENDPOINT+"api/PricingModels/export?id="+l.Id)}function x(t){o.disabled=!0,t.Id&&u.post(p.API_ENDPOINT+"api/PricingModels/updatefixed",t).then(function(){o.disabled=!1,e.forEach(o.fixeds,function(e){e["delete"]=!1,null!=e.FromId?e.$SelectedFrom=o.zones.find(function(o){return o.Id==e.FromId}):e.$SelectedFrom=e.FromPostcode,null!=e.ToId?e.$SelectedTo=o.zones.find(function(o){return o.Id==e.ToId}):e.$SelectedTo=e.ToPostcode})},function(){o.disabled=!1,console.log("Error occured")})}function P(){swal({title:"Are you sure?",text:"You will not be able to recover fixed pricing!",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},function(){u.post(p.API_ENDPOINT+"api/PricingModels/deleteAllfixed?pricingModelId="+o.item.Id).then(function(){swal("Deleted Successfully","Fixed Prices deleted successfully","success"),location.reload()},function(){swal("Delete Error","An error occured","error")})})}function I(){var e=[];e=o.selectAll?o.fixeds:o.fixeds.filter(function(e){return 1==e["delete"]});var t=e.map(function(e){return e.Id});o.showDeleteCheckbox=!o.showDeleteCheckbox,e.length>0&&swal({title:"Are you sure?",text:"You will not be able to recover selected fixed pricing!",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},function(){u.post(p.API_ENDPOINT+"api/PricingModels/deleteselectedfixed",t).then(function(){o.fixeds=o.fixeds.filter(function(e){return 0==e["delete"]}),o.showDeleteCheckbox=!1,o.selectAll=!1,swal("Deleted Successfully","Fixed Prices deleted successfully","success"),location.reload()},function(){o.showDeleteCheckbox=!0,o.selectAll=!1,swal("Delete Error","An error occured","error")})})}function T(){m.open({templateUrl:"/webapp/management/clients/item/fixed/import.modal.html",controller:["$scope","$config","$q","Auth","$http","$state","$modalInstance",function(e,o,t,i,r,n,s){function d(){function o(o){e["import"].status="File Uploaded!",e["import"].filename=o.FileName,e["import"].preview=o.Rows,e["import"].stage="VALIDATE",e["import"].hasErrors=o.Rows.filter(function(e){return e.Errors.length>0}).length>0,e["import"].hasWarnings=o.Rows.filter(function(e){return e.Warnings.length>0}).length>0,e["import"].hasErrors||e["import"].hasWarnings?swal({type:"error",title:"Error validating file",text:"Would you like to view the errors?",showCancelButton:!0,confirmButtonText:"Yes, show me the errors."},function(){s.close(),n.go("root.settings.import.model-prices",{progress:e["import"]})}):c().then(function(){s.close()})}function t(){e["import"].status="Error Uploading",swal("Error","Import Failed.","error")}function i(o){e["import"].percent=o,100==o&&(e["import"].percent=null,e["import"].status="Processing")}if(e["import"].file&&!f){if(!e["import"].file.name.endsWith(".csv"))return void swal("Upload Error","CSV files only, file should end with '.csv'.","error");f=!0,e["import"].status="Uploading "+e["import"].file.name,a(e["import"].file).then(o,t,i)}}function c(){if(!e["import"].pressed)return e["import"].pressed=!0,r.post(o.API_ENDPOINT+"api/Import/ModelFixed/Confirm",{filename:e["import"].filename,modelId:e["import"].modelId}).then(function(){swal("Import Success","rows imported successfully","success"),e["import"]={stage:"UPLOAD",clientId:null,file:null,status:"",percent:0,preview:null}},function(){swal("Import Error","An error occured during import","error")})}function a(r){var n=t.defer(),l=new FormData;l.append("file",r);var s=new XMLHttpRequest;return s.upload.onprogress=function(o){e.$apply(function(){o.lengthComputable&&n.notify(Math.round(o.loaded/o.total*100))})},s.onload=function(e){4==e.target.readyState&&(200==e.target.status?n.resolve(JSON.parse(e.target.response)):n.reject(e.target.responseText))},s.onerror=function(e){n.reject(e)},s.onabort=function(e){n.reject(e)},s.open("POST",o.API_ENDPOINT+"api/Import/ModelFixed/Valdate?modelId="+e["import"].modelId,!0),s.setRequestHeader("Authorization","Bearer "+i.getSession().access_token),s.setRequestHeader("Accept-Type","application/json"),s.send(l),n.promise}e["import"]={stage:"UPLOAD",modelId:l.Id,file:null,status:"",percent:0,preview:null};var f=!1;e.validateFile=d,e.importFile=c,e.decrement=function(){console.log("Hey!")}}]}).result.then(function(){V()})}function w(e){o.selectedIndexForDeletion=e}function F(){o.addNew=!1,o.newfixed=null}function y(){o.addNew=!0,o.newfixed=new s.PricingFixed,o.newfixed.PricingModelId=o.item.Id}function v(t){function i(t){t.FixedPrice=parseFloat(t.FixedPrice),t.VehicleTypes&&0==t.VehicleTypes.length&&(t.VehicleTypes=null),u.post(p.API_ENDPOINT+"api/PricingModels/addNewFixed",t).then(function(t){o.addNew=!1,o.disabled=!1,o.fixeds.push(t.data),o.newfixed=null,e.forEach(o.fixeds,function(e){var t=e.VehicleTypes.map(function(e){return new s.VehicleTypeInPricingFixed(e)});e.VehicleTypes.length=0,[].push.apply(e.VehicleTypes,t),e["delete"]=!1,null!=e.FromId?e.$SelectedFrom=o.zones.find(function(o){return o.Id==e.FromId}):e.$SelectedFrom=e.FromPostcode,null!=e.ToId?e.$SelectedTo=o.zones.find(function(o){return o.Id==e.ToId}):e.$SelectedTo=e.ToPostcode})},function(){o.disabled=!1,console.log("Error occured")})}return null==t.FromId&&(null==t.FromPostcode||t.FromPostcode.length<2)?void swal("Error","Please select either a From Zone or enter a valid Postcode Prefix","error"):null==t.ToId&&(null==t.ToPostcode||t.ToPostcode.length<2)?void swal("Error","Please select either a To Zone or enter a valid Postcode Prefix","error"):void i(t)}function V(){var e=s.PricingFixed.query().select("Id").parseAs(function(e){this.Id=e.Id}).filter("PricingModelId","eq","guid'"+l.Id+"'");o.filters.fromZone&&""!=o.filters.fromZone&&e.filter("FromId eq guid'"+o.filters.fromZone+"'"),o.filters.toZone&&""!=o.filters.toZone&&e.filter("ToId eq guid'"+o.filters.toZone+"'"),o.filters.fromPostcode&&""!=o.filters.fromPostcode&&e.filter("FromPostcode eq'"+o.filters.fromPostcode+"'"),o.filters.toPostcode&&""!=o.filters.toPostcode&&e.filter("ToPostcode eq '"+o.filters.toPostcode+"'"),e.execute().then(function(e){o.paging.totalResults=e.length,o.paging.maxPages=Math.ceil(o.paging.totalResults/o.paging.resultsPerPage),S(1)},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:t.COLOURS.brandSecondary})})}function S(i){o.paging.currentPage=i;var r="api/PricingModels/FetchFixedDetails?PricingModelId="+l.Id+"&count="+o.paging.resultsPerPage+"&pageNum="+i;o.filters.fromZone&&""!=o.filters.fromZone&&(r=r+"&FromId="+o.filters.fromZone),o.filters.toZone&&""!=o.filters.toZone&&(r=r+"&ToId="+o.filters.toZone),o.filters.fromPostcode&&""!=o.filters.fromPostcode&&(r=r+"&FromPostcode="+o.filters.fromPostcode),o.filters.toPostcode&&""!=o.filters.toPostcode&&(r=r+"&ToPostcode="+o.filters.toPostcode),u.get(p.API_ENDPOINT+r).then(function(t){o.fixeds=t.data,t.data.length>0&&(o.fixeds=t.data.map(function(e){return new s.PricingFixed(e)}),e.forEach(o.fixeds,function(e){var t=e.VehicleTypes.map(function(e){return new s.VehicleTypeInPricingFixed(e)});e.VehicleTypes.length=0,[].push.apply(e.VehicleTypes,t),e["delete"]=!1,null!=e.FromId?e.$SelectedFrom=o.zones.find(function(o){return o.Id==e.FromId}):e.$SelectedFrom=e.FromPostcode,null!=e.ToId?e.$SelectedTo=o.zones.find(function(o){return o.Id==e.ToId}):e.$SelectedTo=e.ToPostcode}))},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:t.COLOURS.brandSecondary})})}function $(e){swal({title:"Are you sure?",text:"You will not be able to recover this fixed pricing!",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},function(){o.fixeds[e].$delete().success(function(){o.fixeds.splice(e,1)}).error(function(){})})}function N(e,o){if(void 0!=e&&null!=e.VehicleTypes){var t=e.VehicleTypes.filter(function(e){return e.VehicleTypeId==o.Id})[0];return t?t.FixedPrice.toFixed(2):null}}function E(e,o,t){if(void 0!=e&&null!=e.VehicleTypes&&void 0!=e.Id){e.VehicleTypes=e.VehicleTypes||[];var i=e.VehicleTypes.filter(function(e){return e.VehicleTypeId==o.Id})[0];if(i)i.FixedPrice=parseFloat(t);else if(t){var r=new s.VehicleTypeInPricingFixed;r.VehicleTypeId=o.Id,r.PricingFixedId=e.Id,r.FixedPrice=parseFloat(t),e.VehicleTypes.push(r)}x(e)}else if(void 0==e.Id){var r=new s.VehicleTypeInPricingFixed;r.VehicleTypeId=o.Id,r.PricingFixedId=e.Id,r.FixedPrice=parseFloat(t),void 0==e.VehicleTypes&&(e.VehicleTypes=[]);var n=e.VehicleTypes.find(function(e,t){return e.VehicleTypeId==o.Id});if(void 0==n)e.VehicleTypes.push(r);else{var l=e.VehicleTypes.indexOf(n);e.VehicleTypes[l].FixedPrice=parseFloat(t)}}}for(console.log(Date.now()),o.paging={currentPage:1,resultsPerPage:50,totalResults:null,maxPages:null},o.disabled=!1,o.paging.totalResults=d.length,o.paging.maxPages=Math.ceil(o.paging.totalResults/o.paging.resultsPerPage),o.setPage=S,o.filter=V,o.fixeds=c.data?c.data:[],o.zones=f,setTimeout(function(){console.log(Date.now())},0),i=0;i<o.fixeds.length;i++)void 0==o.fixeds[i].FixedPrice&&null==o.fixeds[i].FixedPrice||(o.fixeds[i].FixedPrice=o.fixeds[i].FixedPrice.toFixed(2)),o.fixeds[i]["delete"]=!1,null!=o.fixeds[i].FromId?o.fixeds[i].$SelectedFrom=o.zones.find(function(e){return e.Id==o.fixeds[i].FromId}):o.fixeds[i].$SelectedFrom=o.fixeds[i].FromPostcode,null!=o.fixeds[i].ToId?o.fixeds[i].$SelectedTo=o.zones.find(function(e){return e.Id==o.fixeds[i].ToId}):o.fixeds[i].$SelectedTo=o.fixeds[i].ToPostcode;for(o.vehicleTypes=a,o.startNew=y,o.saveNew=v,o.remove=$,o.getVehicleTypeCost=N,o.setVehicleTypeCost=E,o.startImport=T,o.deleteSelected=I,o.deleteAll=P,o.cancelDelete=g,o.saveChanges=x,o.cancelNewEdit=F,o.getSelectedRow=w,o["export"]=h,o.showDeleteCheckbox=!1,o.addNew=!1,o.selectedDropdownItem=null,i=0;i<o.zones.length;i++){var A=o.zones[i];A.readableName=o.zones[i].Name}o.dropdownItems=o.zones,o.text="Text",o.filterObjectList=function(e){var t=r.defer(),i=e.toLowerCase(),n=o.dropdownItems.filter(function(e){var o=0===e.Name.toLowerCase().indexOf(i);return o});return t.resolve(n),t.promise},o.prices=[],o._pindex=0,o.filters={fromZone:null,toZone:null,fromPostcode:null,toPostcode:null}}var t=e.module("cab9.settings");t.controller("SettingsPricingModelsFixedController",o),o.$inject=["$scope","$UI","$q","$state","$stateParams","Model","rFixedCount","rFixeds","rVehicleTypes","rZones","$http","$config","$modal"]}(angular);;;;
!function(e){function t(e,t,o,n,r,s,a){function c(){r.VehicleType.query().execute().then(function(t){e.vehicleTypes=t,e.query.vehicleTypeId=t[0].Id})}function l(){a.download(e.priceList.map(function(e){return{From:e.from,To:e.to,"Distance(Miles)":e.EstimatedDistance,"Cost(£)":e.FinalCost}}),"PriceList")}function d(){h=moment();var o=[];e.priceList=[],e.showTable=!0,s.get("/includes/data/UkLatLng.json").then(function(t){var n=t.data,r=e.query.from.split(" ").join("").split("\n"),s=e.query.to.split(" ").join("").split("\n");for(i=0,len=r.length;i<len;i++){var a=n[r[i]];if(a)for(a.Postcode=r[i],j=0,len=s.length;j<len;j++){var c=n[s[j]];if(c){var l={VehicleTypeId:e.query.vehicleTypeId,BookedDateTime:e.query.bookedDateTime,BookingStops:[a],PricingModelId:e.item.Id,from:r[i],to:s[j]};l.BookingStops.push({Postcode:s[j],latitude:c.latitude,longitude:c.longitude}),o.push(l)}}}e.progress=0,e.progressString="Fetching(0/"+n.length+")",p=o.length,g=0,e.progressString="Fetching("+g+"/"+p+")",0!=o.length&&u(o)},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:t.COLOURS.brandSecondary})})}function u(n){function r(o){for(i=0;i<o.length;i++){var n=o[i];a.push(s.post($config.API_ENDPOINT+"api/quote",n).then(function(t){g++,e.progress=g/p*100,e.progressString="Fetching("+g+"/"+p+")",e.priceList.push({from:n.from,to:n.to,EstimatedDistance:t.data.EstimatedDistance,FinalCost:t.data.FinalCost,EstimatedMins:t.data.EstimatedMins})},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:t.COLOURS.brandSecondary})}))}return a}if(0==n.length)return swal({title:"Price List Fetched",text:"Changes have been updated.",type:"success",confirmButtonColor:t.COLOURS.brandSecondary}),console.log(moment().diff(h,"seconds")),void(e.progress=null);var a=[];a=r(n.length>1?n.splice(0,1):n.splice(0,n.length)),o.all(a).then(function(e){u(n)})}e.generate=d,e.download=l,e.showTable=!1;var p=0,g=0;e.query={from:"",to:"",vehicleTypeId:"",bookedDateTime:moment().hour(10).minute(0)},e.progress=null,e.progressString="",e.priceList=[],c();var h}var o=e.module("cab9.settings");o.controller("SettingsPriceListController",t),t.$inject=["$scope","$UI","$q","$stateParams","Model","$http","CSV"]}(angular);;;;
;;;
!function(e){function t(e,t,r,o,i){o.test("settings.import")&&(e.state("root.settings.import",{url:"/import",permission:"Settings - Import",resolve:{rTabs:[function(){return[{heading:"Bookings",route:"root.settings.import.bookings"},{heading:"Client Fixed Prices",route:"root.settings.import.client-prices"},{heading:"Driver Fixed Prices",route:"root.settings.import.driver-prices"},{heading:"Pricing Model Fixed Prices",route:"root.settings.import.model-prices"}]}]},views:{"settings-content@root.settings":{templateUrl:"/webapp/management/settings/import/partial.html",controller:"ImportSettingsController"}}}),e.state("root.settings.import.bookings",{url:"/bookings",views:{"import-view@root.settings.import":{templateUrl:"/webapp/management/settings/import/bookings/partial.html",controller:["$scope","$config","$q","Auth","$http",function(e,t,r,o,i){function n(){e["import"].pressed||(e["import"].pressed=!0,i.post(t.API_ENDPOINT+"api/Import/Bookings/Confirm",{filename:e["import"].filename}).then(function(){swal("Import Success","rows imported successfully","success"),e["import"]={stage:"UPLOAD",file:null,status:"",percent:0,preview:null}},function(){swal("Import Error","An error occured during import","error")}))}function s(){function t(t){e["import"].status="Bookings Imported!",e["import"].filename=t.FileName,e["import"].preview=t.Rows,e["import"].stage="VALIDATE",e["import"].hasErrors=t.Rows.filter(function(e){return e.Errors.length>0}).length>0,swal("Imported","Bookings imported","success")}function r(){e["import"].status="Error Uploading",swal("Error","Bookings import failed.","error")}function o(t){e["import"].percent=t,100==t&&(e["import"].percent=null,e["import"].status="Processing")}if(e["import"].file&&!a){if(!e["import"].file.name.endsWith(".csv"))return void swal("Upload Error","CSV files only, file should end with '.csv'.","error");a=!0,e["import"].status="Uploading "+e["import"].file.name,l(e["import"].file).then(t,r,o)}}function l(i){var n=r.defer(),s=new FormData;s.append("file",i);var l=new XMLHttpRequest;return l.upload.onprogress=function(t){e.$apply(function(){t.lengthComputable&&n.notify(Math.round(t.loaded/t.total*100))})},l.onload=function(e){4==e.target.readyState&&(200==e.target.status?n.resolve(JSON.parse(e.target.response)):n.reject(e.target.responseText))},l.onerror=function(e){n.reject(e)},l.onabort=function(e){n.reject(e)},l.open("POST",t.API_ENDPOINT+"api/Import/Bookings/Valdate",!0),l.setRequestHeader("Authorization","Bearer "+o.getSession().access_token),l.setRequestHeader("Accept-Type","application/json"),l.send(s),n.promise}e["import"]={stage:"UPLOAD",file:null,status:"",percent:0,preview:null};var a=!1;e.validateFile=s,e.importFile=n,e.hasErrors=function(e,t){return e.Errors.filter(function(e){return e.Field==t}).length>0},e.hasWarnings=function(e,t){return e.Warnings.filter(function(e){return e.Field==t}).length>0}}]}}}),e.state("root.settings.import.client-prices",{url:"/client-prices",params:{progress:null},views:{"import-view@root.settings.import":{templateUrl:"/webapp/management/settings/import/clientFixed/partial.html",controller:["$scope","$config","$q","Auth","$http","$stateParams",function(e,t,r,o,i,n){function s(e,t){return e.Errors.filter(function(e){return e.Field==t}).length>0}function l(e,t){return e.Warnings.filter(function(e){return e.Field==t}).length>0}function a(r){r&&(e.loadingClients=!0,i.get(t.API_ENDPOINT+"api/Clients/Search",{params:{searchText:r,lite:!0}}).then(function(t){e.clients=[];for(var r=0;r<t.data.length;r++){var o=t.data[r];e.clients.push({Id:o.Id,Name:"("+o.AccountNo+") "+o.Name,Description:o.ClientType&&o.ClientType.Name?o.ClientType.Name:""})}e.loadingClients=!1}))}function p(){e["import"].pressed||(e["import"].pressed=!0,i.post(t.API_ENDPOINT+"api/Import/ClientFixed/Confirm",{filename:e["import"].filename,clientId:e["import"].clientId}).then(function(){swal("Import Success","rows imported successfully","success"),e["import"]={stage:"UPLOAD",clientId:null,file:null,status:"",percent:0,preview:null}},function(){swal("Import Error","An error occured during import","error")}))}function u(){function t(t){e["import"].status="File Uploaded!",e["import"].filename=t.FileName,e["import"].preview=t.Rows,e["import"].stage="VALIDATE",e["import"].hasErrors=t.Rows.filter(function(e){return e.Errors.length>0}).length>0,swal("Uploaded","Upload Successful.","success")}function r(){e["import"].status="Error Uploading",swal("Error","Import Failed.","error")}function o(t){e["import"].percent=t,100==t&&(e["import"].percent=null,e["import"].status="Processing")}if(e["import"].file&&!m){if(!e["import"].file.name.endsWith(".csv"))return void swal("Upload Error","CSV files only, file should end with '.csv'.","error");m=!0,e["import"].status="Uploading "+e["import"].file.name,c(e["import"].file).then(t,r,o)}}function c(i){var n=r.defer(),s=new FormData;s.append("file",i);var l=new XMLHttpRequest;return l.upload.onprogress=function(t){e.$apply(function(){t.lengthComputable&&n.notify(Math.round(t.loaded/t.total*100))})},l.onload=function(e){4==e.target.readyState&&(200==e.target.status?n.resolve(JSON.parse(e.target.response)):n.reject(e.target.responseText))},l.onerror=function(e){n.reject(e)},l.onabort=function(e){n.reject(e)},l.open("POST",t.API_ENDPOINT+"api/Import/ClientFixed/Valdate?clientId="+e["import"].clientId,!0),l.setRequestHeader("Authorization","Bearer "+o.getSession().access_token),l.setRequestHeader("Accept-Type","application/json"),l.send(s),n.promise}e["import"]=n.progress||{stage:"UPLOAD",clientId:null,file:null,status:"",percent:0,preview:null},e.clients=[];var m=!1;e.validateFile=u,e.importFile=p,e.hasErrors=s,e.hasWarnings=l,e.searchClients=a}]}}}),e.state("root.settings.import.model-prices",{url:"/model-prices",params:{progress:null},views:{"import-view@root.settings.import":{templateUrl:"/webapp/management/settings/import/modelFixed/partial.html",controller:["$scope","$config","$q","Auth","$http","$stateParams","Model",function(e,t,r,o,i,n,s){function l(e,t){return e.Errors.filter(function(e){return e.Field==t}).length>0}function a(e,t){return e.Warnings.filter(function(e){return e.Field==t}).length>0}function p(){e["import"].pressed||(e["import"].pressed=!0,i.post(t.API_ENDPOINT+"api/Import/ModelFixed/Confirm",{filename:e["import"].filename,modelId:e["import"].modelId}).then(function(){swal("Import Success","rows imported successfully","success"),e["import"]={stage:"UPLOAD",clientId:null,file:null,status:"",percent:0,preview:null}},function(){swal("Import Error","An error occured during import","error")}))}function u(){function t(t){e["import"].status="File Uploaded!",e["import"].filename=t.FileName,e["import"].preview=t.Rows,e["import"].stage="VALIDATE",e["import"].hasErrors=t.Rows.filter(function(e){return e.Errors.length>0}).length>0,swal("Uploaded","Upload Successful.","success")}function r(){e["import"].status="Error Uploading",swal("Error","Import Failed.","error")}function o(t){e["import"].percent=t,100==t&&(e["import"].percent=null,e["import"].status="Processing")}if(e["import"].file&&!m){if(!e["import"].file.name.endsWith(".csv"))return void swal("Upload Error","CSV files only, file should end with '.csv'.","error");m=!0,e["import"].status="Uploading "+e["import"].file.name,c(e["import"].file).then(t,r,o)}}function c(i){var n=r.defer(),s=new FormData;s.append("file",i);var l=new XMLHttpRequest;return l.upload.onprogress=function(t){e.$apply(function(){t.lengthComputable&&n.notify(Math.round(t.loaded/t.total*100))})},l.onload=function(e){4==e.target.readyState&&(200==e.target.status?n.resolve(JSON.parse(e.target.response)):n.reject(e.target.responseText))},l.onerror=function(e){n.reject(e)},l.onabort=function(e){n.reject(e)},l.open("POST",t.API_ENDPOINT+"api/Import/ModelFixed/Valdate?modelId="+e["import"].modelId,!0),l.setRequestHeader("Authorization","Bearer "+o.getSession().access_token),l.setRequestHeader("Accept-Type","application/json"),l.send(s),n.promise}e["import"]=n.progress||{stage:"UPLOAD",modelId:null,file:null,status:"",percent:0,preview:null},e.models=[],s.PricingModel.query().select("Id,Name,Description").parseAs(function(e){return{Id:e.Id,Name:e.Name,Description:e.Description}}).execute().then(function(t){e.models=t});var m=!1;e.validateFile=u,e.importFile=p,e.hasErrors=l,e.hasWarnings=a}]}}}),e.state("root.settings.import.driver-prices",{url:"/driver-prices",params:{progress:null},views:{"import-view@root.settings.import":{templateUrl:"/webapp/management/settings/import/driverFixed/partial.html",controller:["$scope","$config","$q","Auth","$http","$stateParams","Model",function(e,t,r,o,i,n,s){function l(e,t){return e.Errors.filter(function(e){return e.Field==t}).length>0}function a(e,t){return e.Warnings.filter(function(e){return e.Field==t}).length>0}function p(){e["import"].pressed||(e["import"].pressed=!0,i.post(t.API_ENDPOINT+"api/Import/DriverFixed/Confirm",{filename:e["import"].filename,modelId:e["import"].modelId}).then(function(){swal("Import Success","rows imported successfully","success"),e["import"]={stage:"UPLOAD",clientId:null,file:null,status:"",percent:0,preview:null}},function(){swal("Import Error","An error occured during import","error")}))}function u(){function t(t){e["import"].status="File Uploaded!",e["import"].filename=t.FileName,e["import"].preview=t.Rows,e["import"].stage="VALIDATE",e["import"].hasErrors=t.Rows.filter(function(e){return e.Errors.length>0}).length>0,swal("Uploaded","Upload Successful.","success")}function r(){e["import"].status="Error Uploading",swal("Error","Import Failed.","error")}function o(t){e["import"].percent=t,100==t&&(e["import"].percent=null,e["import"].status="Processing")}if(e["import"].file&&!m){if(!e["import"].file.name.endsWith(".csv"))return void swal("Upload Error","CSV files only, file should end with '.csv'.","error");m=!0,e["import"].status="Uploading "+e["import"].file.name,c(e["import"].file).then(t,r,o)}}function c(i){var n=r.defer(),s=new FormData;s.append("file",i);var l=new XMLHttpRequest;return l.upload.onprogress=function(t){e.$apply(function(){t.lengthComputable&&n.notify(Math.round(t.loaded/t.total*100))})},l.onload=function(e){4==e.target.readyState&&(200==e.target.status?n.resolve(JSON.parse(e.target.response)):n.reject(e.target.responseText))},l.onerror=function(e){n.reject(e)},l.onabort=function(e){n.reject(e)},l.open("POST",t.API_ENDPOINT+"api/Import/DriverFixed/Valdate?modelId="+e["import"].modelId,!0),l.setRequestHeader("Authorization","Bearer "+o.getSession().access_token),l.setRequestHeader("Accept-Type","application/json"),l.send(s),n.promise}e["import"]=n.progress||{stage:"UPLOAD",modelId:null,file:null,status:"",percent:0,preview:null},e.models=[],s.DriverPaymentModel.query().select("Id,Name,Description").parseAs(function(e){return{Id:e.Id,Name:e.Name,Description:e.Description}}).execute().then(function(t){e.models=t});var m=!1;e.validateFile=u,e.importFile=p,e.hasErrors=l,e.hasWarnings=a}]}}}))}function r(e,t,r,o,i){e.tabDefs=t}var o=e.module("cab9.settings.import",["cab9.settings"]);o.config(t),o.controller("ImportSettingsController",r),t.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider","$permissions","ModelProvider"],r.$inject=["$scope","rTabs","$http","$config","Auth"]}(angular);;;;
!function(){function n(n,e){n.taxes=e}function e(n,e,t,o){function c(){n.tax=new t.Tax,n.tax.TaxComponents=[],n.displayMode="CREATE",n.newComponent=null,n.selected=null}function l(){n.newComponent=new t.TaxComponent}function a(){n.tax.TaxComponents.push(n.newComponent),n.newComponent=null}function s(){n.newComponent=null}function u(e){n.selected=e}function i(e){var t=n.tax.TaxComponents.indexOf(e);n.tax.TaxComponents.splice(t,1)}function r(e){n.selected=null}function p(e){n.selected=null}function d(){n.tax.$save().success(function(e){n.newComponent=null,swal("Success","Tax Details Saved.","success"),o.go("root.taxes",null,{reload:!0})}).error(function(){swal({title:"Error Occured",type:"error"})})}function x(){c()}n.taxTypes=e,c(),n.createNewComponent=l,n.addComponent=a,n.cancelAdd=s,n.selectComponent=u,n.deleteComponent=i,n.updateComponent=r,n.cancelUpdate=p,n.saveEdits=d,n.cancelEditing=x}var t=angular.module("cab9.settings");t.controller("SettingsTaxesController",n),t.controller("SettingsTaxCreateController",e),n.$inject=["$scope","rTaxes"],e.$inject=["$scope","rTaxTypes","Model","$state"]}();;;;
!function(e){function t(e,t,o,n,a,r){function s(o,i,r){var s=n.defer(),l=new FormData;l.append("file",o);var c=new XMLHttpRequest;return c.upload.onprogress=function(t){e.$apply(function(){t.lengthComputable&&s.notify(Math.round(t.loaded/t.total*100))})},c.onload=function(e){4==e.target.readyState&&(200==e.target.status?s.resolve(JSON.parse(e.target.response)):s.reject(e.target.responseText))},c.onerror=function(e){s.reject(e)},c.onabort=function(e){s.reject(e)},c.open("POST",t.API_ENDPOINT+"api/ApnDetail?password="+i+"&isPassengerCertificate="+r),c.setRequestHeader("Authorization","Bearer "+a.getSession().access_token),c.setRequestHeader("Accept-Type","application/json"),c.send(l),s.promise}function l(){e.displayMode="EDIT"}function c(){e.notificationTemplates.$rollback(),e.displayMode="VIEW"}function d(){e.notificationTemplates.Id?e.notificationTemplates.$patch().then(function(){swal("Saved!","Changes saved successfully.","success"),e.displayMode="VIEW"},function(){swal("Error!","Error saving changes.","error")}):e.notificationTemplates.$save().then(function(){swal("Saved!","Changes saved successfully.","success"),e.displayMode="VIEW"},function(){swal("Error!","Error saving changes.","error")})}e.state={editing:!1,validApn:!1},e.customerstate={editing:!1,validApn:!1},e.notificationTemplates=null,e.displayMode="VIEW",e.startEditing=l,e.cancelEditing=c,e.saveEdits=d;var p=!1,u=!1;e["import"]={file:null,password:null},e.Customerappimport={file:null,password:null},o.get(t.API_ENDPOINT+"api/ApnDetail").success(function(t){if(null!=t||void 0!=t)for(i=0;i<t.length;i++)"Driver"==t[i].DeviceType?e.state.validApn=!!t:"Passenger"==t[i].DeviceType&&(e.customerstate.validApn=!!t)}),r.NotificationTemplates.query().execute().then(function(t){t[0]?e.notificationTemplates=new r.NotificationTemplates(t[0]):e.notificationTemplates=new r.NotificationTemplates({NewBookingOfferTitle:"New Booking Offer",NewBookingOfferText:"You have a new booking offer, return to app to accept",ShiftTimeoutAlertTitle:"Location Required",ShiftTimeoutAlertText:"We need your location to keep you online, please return to the Driver App.",ShiftTimeoutFinalAlertTitle:"Location Required - Final Warning",ShiftTimeoutFinalAlertText:"You are about to be made offline, please return to the Driver App to stay online.",ShiftClosedAlertTitle:"Shift Closed",ShiftClosedAlertText:"We have not received a location in over an hour and your shift has been closed.",NewBookingTitle:"New Booking",NewBookingText:"You have been assigned a new booking, return to app to view",BookingChangedTitle:"Booking Modified",BookingChangedText:"Your Booking has been updated",BookingUnallocatedTitle:"Booking Unallocated",BookingUnallocatedText:"You have been unassigned from a booking",BookingOnRouteTitle:"Enroute",BookingOnRouteText:"Your driver is On Route to your location.",BookingCancelledTitle:"Cancelled",BookingCancelledText:"Sorry! Your booking has been cancelled.",BookingArrivedTitle:"Arrived",BookingArrivedText:"Your driver has arrived at the location.",BookingInProgressTitle:"In Progress",BookingInProgressText:"We have started your journey! have a great experience.",BookingCOATitle:"Cancelled On Arrival",BookingCOAText:"Sorry! Your booking has been cancelled after driver arrived at the location.",BookingCompletedTitle:"Completed",BookingCompletedText:"Booking completed. Thank you for choosing us! have a great day",BookingAllocatedForPassengerTitle:"Booking Allocated",BookingAllocatedForPassengerText:"Driver has been assigned to your booking.",BookingUnallocatedForPassengerTitle:"Booking Unallocated",BookingUnallocatedForPassengerText:"Driver has been removed from your booking, we will shortly assign a new driver.",BookingNextStopForPassengerTitle:"En Route to Next stop",BookingNextStopForPassengerText:"Driver is on route to next stop."})},function(e){}),e.save=function(t){function o(t){e.Customerappimport.status="Certificate Imported!",u=!1,e.customerstate.validApn=!0,e.customerstate.editing=!1,swal("Imported","Certificate imported","success")}function n(){e.Customerappimport.status="Error Uploading",u=!1,swal("Error","Certificate import failed.","error")}function a(t){e.Customerappimport.percent=t,100==t&&(e.Customerappimport.percent=null,e.Customerappimport.status="Processing")}function o(t){e["import"].status="Certificate Imported!",p=!1,e.state.validApn=!0,e.state.editing=!1,swal("Imported","Certificate imported","success")}function n(){e["import"].status="Error Uploading",p=!1,swal("Error","Certificate import failed.","error")}function a(t){e["import"].percent=t,100==t&&(e["import"].percent=null,e["import"].status="Processing")}if(t){if(!e.Customerappimport.file||u)return;if(!e.Customerappimport.file.name.endsWith(".p12"))return void swal("Upload Error","Apple certificates files only, file should end with '.p12'.","error");u=!0,e.Customerappimport.status="Uploading "+e.Customerappimport.file.name,s(e.Customerappimport.file,e.Customerappimport.password,!0).then(o,n,a)}else{if(!e["import"].file||p)return;if(!e["import"].file.name.endsWith(".p12"))return void swal("Upload Error","Apple certificates files only, file should end with '.p12'.","error");p=!0,e["import"].status="Uploading "+e["import"].file.name,s(e["import"].file,e["import"].password,!1).then(o,n,a)}}}function o(e,t,o){function n(){t.openPicker({type:"Company",id:e.company.Id,searchTerm:e.company.Name}).then(function(t){e.company.LogoUrl=t,r()},function(e){})}function a(){e.viewMode="EDIT"}function i(){e.company.$rollback(!1),e.viewMode="VIEW"}function r(){e.company.$patch().success(function(){e.viewMode="VIEW",location.reload()})}e.company=o[0],e.viewMode="VIEW",e.chooseImage=n,e.startEdit=a,e.cancelEdit=i,e.saveEdits=r;var s=!1;e.map={center:{latitude:e.company.BaseLatitude||51.49638419822335,longitude:e.company.BaseLongitude||-.12875142186092203},zoom:e.company.BaseZoom||11},e.markerOptions={animation:google.maps.Animation.DROP,coords:{latitude:e.company.BaseLatitude||51.49638419822335,longitude:e.company.BaseLongitude||-.12875142186092203},icon:{url:"/includes/images/marker.png",scaledSize:new google.maps.Size(48,48)}},e.$watch(function(){return""+e.map.center.latitude+e.map.center.longitude+e.map.zoom},function(){return s?void(s=!1):void("EDIT"==e.viewMode&&(e.company.BaseLatitude=e.map.center.latitude,e.company.BaseLongitude=e.map.center.longitude,e.company.BaseZoom=e.map.zoom))}),e.$on("address_changed:Base",function(t,o){"EDIT"==e.viewMode&&(e.map.center.latitude=e.company.BaseLatitude.toFixed(6),e.map.center.longitude=e.company.BaseLongitude.toFixed(6),e.map.zoom=18,s=!0,setTimeout(function(){e.$apply()},0))}),e.accessors={LogoUrl:function(t){return e.company._ImageUrl}}}function n(t,o,n,a,i,r,s){function l(){t.iDviewMode="EDIT"}function c(){t.company.$rollback(!1),t.iDviewMode="VIEW"}function d(){t.company.$patch().success(function(){t.iDviewMode="VIEW",location.reload()})}function p(){t.cPviewMode="EDIT",m=e.copy(t.cpSettings)}function u(){t.cpSettings=m,t.cPviewMode="VIEW"}function g(){1==t.newCpConfig?t.cpSettings.$save().success(function(){t.cPviewMode="VIEW",location.reload()}):t.cpSettings.$patch().success(function(){t.cPviewMode="VIEW",location.reload()})}t.company=n[0],t.cpSettings=s[0],t.paymentModels=i,t.pricingModels=a,t.taxes=r,t.iDviewMode="VIEW",t.cPviewMode="VIEW",t.tax=t.taxes.find(function(e){return"VAT"===e.Name}),t.startIdEdit=l,t.cancelIdEdit=c,t.saveIdEdits=d,t.startCpEdit=p,t.cancelCpEdit=u,t.saveCpEdits=g,t.cpSettings?t.newCpConfig=!1:(t.cpSettings=new o.CompanyPaymentSettings,t.newCpConfig=!0);var m=null}function a(e,t,o){function n(){e.viewMode="EDIT"}function a(){e.company.$rollback(!1),e.viewMode="VIEW"}function i(){e.company.$patch().success(function(){e.viewMode="VIEW",location.reload()})}e.company=t[0],e.currencies=o,e.availableLocales=[{Id:"en-us",Name:"English (US)"},{Id:"en-gb",Name:"English (UK)"},{Id:"de",Name:"German"},{Id:"fr",Name:"French"},{Id:"ar",Name:"Arabic"},{Id:"ja",Name:"Japanese"},{Id:"ko",Name:"Korean"},{Id:"zh",Name:"Chinese"}],e.zones=[];var r=moment.tz.names();r.forEach(function(t){e.zones.push({Id:t,Name:t})}),e.viewMode="VIEW",e.startEdit=n,e.cancelEdit=a,e.saveEdits=i}function r(e,t,o,n,a){function r(){e.$viewMode="EDIT"}function s(t){e.company.$rollback(!1),e.stripeData.$rollback(!1),e.judopayData.$rollback(!1),e.$viewMode="VIEW"}function l(t){e.company.$patch().success(function(){function t(){swal("Error","There was an issue while trying to save the information. Please try again.","error"),e.$viewMode="VIEW"}function o(){swal({title:"Settings Saved",text:"CAB9 will need to reload to pull new configuration.",type:"success",showCancelButton:!1,confirmButtonColor:"#DD6B55",confirmButtonText:"Reload"},function(){location.reload()})}switch(e.company.CurrentCardPaymentProvider){case"Judopay":e.judopayData.IsActive=!0,a.post($config.API_ENDPOINT+"api/Payments/CardPaymentConfiguration",e.judopayData).then(function(){o()},function(){t()});break;case"Stripe":e.stripeData.IsActive=!0,a.post($config.API_ENDPOINT+"api/Payments/CardPaymentConfiguration",e.stripeData).then(function(){o()},function(){t()})}})}for(e.cardProviderDetails=t,e.company=o[0],e.startEdit=r,e.cancelEdit=s,e.saveEdits=l,e.$viewMode="VIEW",e.stripeData=new n.CardPaymentProviderDetail,e.stripeData.Provider="Stripe",e.stripeData.$new=!0,e.judopayData=new n.CardPaymentProviderDetail,e.judopayData.Provider="Judopay",e.judopayData.$new=!0,i=0;i<e.cardProviderDetails.length;i++){var c=e.cardProviderDetails[i];"Stripe"==c.Provider?(e.stripeData=c,e.stripeData.$new=!1):"Judopay"==c.Provider&&(e.judopayData=c,e.judopayData.$new=!1)}}function s(e,t){function o(){e.viewMode="EDIT"}function n(){e.company.$rollback(!1),e.viewMode="VIEW"}function a(){e.company.$patch().success(function(){e.viewMode="VIEW",location.reload()})}e.company=t[0],e.viewMode="VIEW",e.startEdit=o,e.cancelEdit=n,e.saveEdits=a;var i=!1;e.map={center:{latitude:e.company.DispatchLatitude||51.49638419822335,longitude:e.company.DispatchLongitude||-.12875142186092203},zoom:e.company.DispatchZoom||11},e.markerOptions={animation:google.maps.Animation.DROP,coords:{latitude:e.company.DispatchLatitude||51.49638419822335,longitude:e.company.DispatchLongitude||-.12875142186092203},icon:{url:"/includes/images/marker.png",scaledSize:new google.maps.Size(48,48)}},e.$watch(function(){return""+e.map.center.latitude+e.map.center.longitude+e.map.zoom},function(){return i?void(i=!1):void("EDIT"==e.viewMode&&(e.company.DispatchLatitude=e.map.center.latitude,e.company.DispatchLongitude=e.map.center.longitude,e.company.DispatchZoom=e.map.zoom))}),e.$on("address_changed:Dispatch",function(t,o){"EDIT"==e.viewMode&&(e.map.center.latitude=e.company.DispatchLatitude.toFixed(6),e.map.center.longitude=e.company.DispatchLongitude.toFixed(6),e.company.DispatchZoom=e.map.zoom=18,i=!0,setTimeout(function(){e.$apply()},0))})}function l(e,t,o,n,a,i,r){function s(){t.openPicker({type:"Company",id:e.company.Id,searchTerm:e.company.Name}).then(function(t){e.company.LogoUrl=t,d()},function(e){})}function l(){e.viewMode="EDIT"}function c(){e.company.$rollback(!1),e.viewMode="VIEW"}function d(){e.company.$patch().success(function(){e.viewMode="VIEW",location.reload()})}e.company=o[0],e.pricingModels=a,e.currencies=n,e.viewMode="VIEW",e.paymentModels=i,e.users=r;var p=!1;e.map={center:{latitude:e.company.BaseLatitude||51.49638419822335,longitude:e.company.BaseLongitude||-.12875142186092203},zoom:e.company.BaseZoom||13},e.markerOptions={animation:google.maps.Animation.DROP,coords:{latitude:e.company.BaseLatitude||51.49638419822335,longitude:e.company.BaseLongitude||-.12875142186092203},icon:{url:"/includes/images/marker.png",scaledSize:new google.maps.Size(48,48)}},e.availableLocales=[{Id:"en-us",Name:"English (US)"},{Id:"en-gb",Name:"English (UK)"},{Id:"de",Name:"German"},{Id:"fr",Name:"French"},{Id:"ar",Name:"Arabic"},{Id:"ja",Name:"Japanese"},{Id:"ko",Name:"Korean"},{Id:"zh",Name:"Chinese"}],e.zones=[];var u=moment.tz.names();u.forEach(function(t){e.zones.push({Id:t,Name:t})}),e.$watch(function(){return""+e.map.center.latitude+e.map.center.longitude+e.map.zoom},function(){return p?void(p=!1):void("EDIT"==e.viewMode&&(e.company.BaseLatitude=e.map.center.latitude,e.company.BaseLongitude=e.map.center.longitude,e.company.BaseZoom=e.map.zoom))}),e.$on("address_changed:Base",function(t,o){"EDIT"==e.viewMode&&(e.map.center.latitude=e.company.BaseLatitude.toFixed(6),e.map.center.longitude=e.company.BaseLongitude.toFixed(6),e.map.zoom=18,p=!0,setTimeout(function(){e.$apply()},0))}),e.chooseImage=s,e.startEdit=l,e.cancelEdit=c,e.saveEdits=d,e.accessors={LogoUrl:function(t){return e.company._ImageUrl}}}function c(e,t,o,n,a,i,r,s){function l(){return s.open({templateUrl:"/webapp/common/views/clients/webBookerSettings/modal/modal.html",controller:"ImageModalController",backdrop:"static",resolve:{rSetting:function(){return e.setting}}}).result.then(function(t){e.setting.WelcomeHeroImage=t,e.counter++},function(e){})}function c(){e.displayMode="EDIT"}function d(){e.setting.$rollback(!1),e.displayMode="VIEW"}function p(){e.setting&&!e.setting.Id?e.setting.$save().success(function(){swal({title:"Portal Settings Saved.",text:"Changes have been saved.",type:"success",confirmButtonColor:a.COLOURS.brandSecondary}),t.go("root.settings.company.portal",null,{reload:!0})}):e.setting.$patch().success(function(){swal({title:"Portal Settings Saved.",text:"Changes have been updated.",type:"success",confirmButtonColor:a.COLOURS.brandSecondary}),e.displayMode="VIEW"})}e.setting=r[0]?r[0]:new i.ClientWebBookerSetting,e.chooseImage=l,e.startEdit=c,e.cancelEdit=d,e.saveEdits=p,e.displayMode="VIEW",e.counter=1}function d(t,o,n,a,r,s,l,c,d,p){function u(e){var o=n.open({templateUrl:"/webapp/common/modals/webbooker/address/partial.html",controller:"WebBookerAddressCreateController",resolve:{rAddress:function(){var e=new l.WebBookerStops;return e}}});o.result.then(function(o){"pickup"==e?t.setting.DefaultPickup=o:t.setting.NearbyDropOffs.push(o)})}function g(e,o,a){var i=n.open({templateUrl:"/webapp/common/modals/webbooker/address/partial.html",controller:"WebBookerAddressEditController",resolve:{rAddress:{address:e,editIndex:a}}});i.result.then(function(e){"pickup"==o?t.setting.DefaultPickup=e.address:t.setting.NearbyDropOffs[e.index]=e})}function m(e,o){"dropoff"==e?t.setting.NearbyDropOffs.splice(o,1):t.setting.DefaultPickup={}}function f(){return n.open({templateUrl:"/webapp/common/modals/webbooker/new/partial.html",controller:"CreateWebBookerController",backdrop:"static",resolve:{}}).result.then(function(e){p.go(p.current,{},{reload:!0})},function(e){})}function v(){swal({title:"Are you sure?",text:"Are you sure you want to delete this setting?",type:"warning",showCancelButton:!0,confirmButtonColor:r.COLOURS.brandPrimary,confirmButtonText:"Confirm Delete!",closeOnConfirm:!0},function(){o["delete"](a.WEBBOOKER_ENDPOINT+"api/tenant?tenantid="+t.setting._id).then(function(e){p.go(p.current,{},{reload:!0})},function(e){swal("Error!","Some Issue while deleting.","error")})},function(){swal("Error!","Some Issue while deleting.","error")})}function y(){o.get(a.WEBBOOKER_ENDPOINT+"api/tenant?tenantid="+s.getSession().TenantId.toUpperCase()).then(function(o){t.settings=o.data,o&&o.data[0]&&(t.setting=t.settings[0],t.selected.setting=new l.WebBookerDetails(t.settings[0]),b=e.copy(t.setting),t.mapBounds=new google.maps.LatLngBounds,t.companyMarker={coords:{latitude:t.COMPANY.BaseLatitude,longitude:t.COMPANY.BaseLongitude},options:{animation:google.maps.Animation.DROP,icon:{url:"../../includes/images/marker.png",scaledSize:new google.maps.Size(48,48)}}},setTimeout(function(){h()}))},function(e){swal({title:"Error",text:"Error occurred while fetching WebBooker Data",type:"error",confirmButtonColor:r.COLOURS.brandSecondary})})}function h(){var e=new google.maps.LatLngBounds;if(t.configPolygons.length>0){for(i=0;i<t.configPolygons.length;i++){var o=t.configPolygons[i];for(j=0;j<o.path.length;j++)e.extend(new google.maps.LatLng(o.path[j].latitude,o.path[j].longitude))}t.mapBounds={northeast:{latitude:e.getNorthEast().lat(),longitude:e.getNorthEast().lng()},southwest:{latitude:e.getSouthWest().lat(),longitude:e.getSouthWest().lng()}}}t.map={center:{latitude:t.COMPANY.BaseLatitude,longitude:t.COMPANY.BaseLongitude},zoom:10,contol:{}},t.mapSetup=!0,t.$apply()}function w(){t.viewMode="EDIT"}function C(){swal({title:"Are you sure?",text:"Web Booker Settings will be saved",type:"warning",showCancelButton:!0,confirmButtonColor:r.COLOURS.brandPrimary,confirmButtonText:"Confirm",closeOnConfirm:!0},function(){d.loading=!0,o.put(a.WEBBOOKER_ENDPOINT+"api/tenant",t.setting).then(function(e){e&&e.data&&(t.setting=new l.WebBookerDetails(e.data),d.loading=!1,t.viewMode="VIEW",swal({title:"Updated",text:"Web Booker Settings have been saved",type:"success",confirmButtonColor:r.COLOURS.brandSecondary}),p.go(p.current,{},{reload:!0}))},function(e){d.loading=!1,swal({title:"Error",text:"Some error has occurred while saving WebBooker Data",type:"error",confirmButtonColor:r.COLOURS.brandSecondary})})})}function E(){t.viewMode="VIEW",t.setting=e.copy(t.selected.setting)}function D(e){t.selectedCoverageArea=t.configPolygons[e];var o=new google.maps.LatLngBounds;for(j=0;j<t.selectedCoverageArea.path.length;j++)o.extend(new google.maps.LatLng(t.selectedCoverageArea.path[j].latitude,t.selectedCoverageArea.path[j].longitude));t.mapBounds={northeast:{latitude:o.getNorthEast().lat(),longitude:o.getNorthEast().lng()},southwest:{latitude:o.getSouthWest().lat(),longitude:o.getSouthWest().lng()}},t.map={center:{latitude:t.COMPANY.BaseLatitude,longitude:t.COMPANY.BaseLongitude},zoom:10,contol:{}},t.mapSetup=!0,t.$apply(),t.selectedCoverageAreaMode="EDIT",T("green",!0,!0,e),t.showList=!1}function T(e,o,n,a){t.selectedCoverageArea.stroke.color=e,t.selectedCoverageArea.fit=o,t.selectedCoverageArea.editable=n,t.selectedCoverageArea.index=a}function I(){t.selectedCoverageAreaMode="VIEW",T("black",!1,!1)}function P(){t.setting.CoverageAreas[t.selectedCoverageArea.index]=google.maps.geometry.encoding.encodePath(t.selectedCoverageArea.path.map(function(e){return new google.maps.LatLng(e.latitude,e.longitude)})),console.log(t.setting.CoverageAreas),t.selectedCoverageAreaMode="VIEW",T("black",!1,!1)}function B(e){swal({title:"Are you sure?",text:"Coverage Area will be deleted",type:"warning",showCancelButton:!0,confirmButtonColor:r.COLOURS.brandPrimary,confirmButtonText:"Confirm.",closeOnConfirm:!0},function(){t.setting.CoverageAreas.splice(e,1),t.configPolygons.splice(e,1),h()})}function k(){t.selectedCoverageAreaMode="CREATE",t.drawingManager.options.drawingMode=google.maps.drawing.OverlayType.POLYGON,t.drawingManager.instance.setDrawingMode(google.maps.drawing.OverlayType.POLYGON),t.currentCompleteHandler=google.maps.event.addListener(t.drawingManager.instance,"overlaycomplete",function(e){if(e.type==google.maps.drawing.OverlayType.POLYGON){e.overlay.setMap(null);var o=google.maps.geometry.encoding.encodePath(e.overlay.getPath());console.log(o);var n={id:A++,path:google.maps.geometry.encoding.decodePath(o).map(function(e){return{latitude:e.lat(),longitude:e.lng()}}),editable:!0,draggable:!0,stroke:{color:"black",weight:5,opacity:.8},$CoverageArea:t.selectedCoverageArea};t.selectedCoverageArea=n,t.configPolygons.push(n),t.drawingManager.options.drawingMode=null,t.drawingManager.instance.setDrawingMode(null),t.currentCompleteHandler.remove(),t.setting.CoverageAreas.push(o),t.selectedCoverageAreaMode="VIEW",t.$apply()}})}t.viewMode="VIEW",t.AppConfigs=c||[],t.configPolygons=[],t.annotations={firstname:"{{booking_passenger_firstname}}",lastname:"{{booking_passenger_Surname}}",mobile:"{{booking_passenger_mobile}}",email:"{{booking_passenger_email}}",bookingid:"{{booking_id}}",leadtime:"{{booking_lead_time}}",maxmileage:"{{booking_max_mileage}}",pickup:"{{booking_pickup}}",drop:"{{booking_drop}}"},t.drawingManager={control:{},instance:null,options:{drawingMode:null,drawingControl:!1,drawingControlOptions:{drawingModes:[google.maps.drawing.OverlayType.RECTANGLE,google.maps.drawing.OverlayType.CIRCLE,google.maps.drawing.OverlayType.POLYGON]}}},t.templates=[],o.get(a.WEBBOOKER_ENDPOINT+"getTemplates").then(function(e){t.templates=e.data},function(){swal({title:"Error",text:"Error occurred while fetching WebBooker Templates",type:"error",confirmButtonColor:r.COLOURS.brandSecondary})});var b,A=1e5;t.selected={setting:{}},t.showLabel=!0,t.startEdit=w,t.saveEdits=C,t.cancelEdit=E,t.startEditCoverageArea=D,t.cancelEditCoverageArea=I,t.updateCoverageArea=P,t.deleteCoverageArea=B,t.addNewCoverageArea=k,t.addNew=f,t.remove=v,t.removeAddress=m,t.newAddress=u,t.editAddress=g,t.$watchCollection("selected",function(e,o){if(Object.keys(e.setting).length>0&&(t.setting=new l.WebBookerDetails(e.setting),t.configPolygons&&t.configPolygons.length&&(t.configPolygons=[],t.configPolygons.length=0,h()),t.setting.CoverageAreas&&t.setting.CoverageAreas.length>0))for(i=0;i<t.setting.CoverageAreas.length;i++){var n={id:A++,path:google.maps.geometry.encoding.decodePath(t.setting.CoverageAreas[i]).map(function(e){return{latitude:e.lat(),longitude:e.lng()}}),editable:!1,draggable:!1,stroke:{color:"black",weight:5,opacity:.8,zIndex:1e5},zIndex:1e5,fit:!1};t.configPolygons.push(n)}}),y(),t.$watch(function(){return!!t.drawingManager.control.getDrawingManager},function(e){e&&(t.drawingManager.instance=t.drawingManager.control.getDrawingManager())})}function p(e,t,o,n,a,i){function r(){e.ftpDetails={},e.viewMode="ADD"}function s(){e.viewMode="EDIT"}function l(){e.fetchingFTPDetails=!0,t({method:"GET",url:n.API_ENDPOINT+"/api/ftpdetails"}).then(function(t){e.ftpDetails=t.data,e.fetchingFTPDetails=!1},function(t){swal("Error Occurred",t.data.Message,"error"),e.fetchingFTPDetails=!1})}function c(){e.savingFTPDetails=!0,"ADD"==e.viewMode?t({method:"POST",url:n.API_ENDPOINT+"/api/ftpdetails/add",data:e.ftpDetails}).then(function(t){swal("FTP Details Added","The FTP details have been added.","success"),e.viewMode="VIEW",e.ftpDetails=t.data,e.savingFTPDetails=!1},function(t){swal("Error Occurred",t.data.Message,"error"),e.savingFTPDetails=!1}):t({method:"PUT",url:n.API_ENDPOINT+"/api/ftpdetails/update",data:e.ftpDetails}).then(function(t){swal("FTP Details Updated","The FTP details have been updated.","success"),e.viewMode="VIEW",e.ftpDetails=t.data,e.savingFTPDetails=!1},function(t){swal("Error Occurred",t.data.Message,"error"),e.savingFTPDetails=!1})}function d(){e.deletingFTPDetails=!0,swal({title:"Are you sure?",text:"Are you sure you want to delete the FTP Details",type:"warning",showCancelButton:!0,confirmButtonColor:a.COLOURS.brandPrimary,confirmButtonText:"Confirm Delete",closeOnConfirm:!0},function(){t({method:"DELETE",url:n.API_ENDPOINT+"/api/ftpdetails?ftpDetailsId="+e.ftpDetails.Id}).then(function(t){swal("FTP Details Deleted","The FTP details have been deleted.","success"),e.ftpDetails=null,e.deletingFTPDetails=!1},function(t){swal("Error Occurred",t.data.Message,"error"),e.deletingFTPDetails=!1})},function(){swal("Error!","Some Issue while deleting.","error")})}function p(){l(),e.viewMode="VIEW"}e.ftpDetails={},e.viewMode="VIEW",e.deleteFTPDetails=d,e.addFTPDetails=r,e.saveFTPDetails=c,e.editFTPDetails=s,e.cancelFTPEditing=p,l()}var u=e.module("cab9.settings");u.controller("SettingsCompanyController",l),u.controller("SettingsCompanyBasicController",o),u.controller("SettingsCompanyInvoicingController",n),u.controller("SettingsCompanyLocalisationController",a),u.controller("SettingsCompanyCreditCardsController",r),u.controller("SettingsCompanyDispatchController",s),u.controller("SettingsMobileAppController",t),u.controller("SettingsWebBookerController",d),u.controller("SettingsFTPDetailsController",p),t.$inject=["$scope","$config","$http","$q","Auth","Model"],o.$inject=["$scope","ImageUpload","rCompany"],n.$inject=["$scope","Model","rCompany","rPricingModels","rPaymentModels","rTaxes","rCompanyPaymentSettings"],a.$inject=["$scope","rCompany","rCurrencies"],r.$inject=["$scope","rCardProviderDetails","rCompany","Model","$http"],s.$inject=["$scope","rCompany"],l.$inject=["$scope","ImageUpload","rCompany","rCurrencies","rPricingModels","rPaymentModels","rUsers"],u.controller("SettingsCompanyPortalController",c),c.$inject=["$scope","$state","$q","$config","$UI","Model","rSettings","$modal"],d.$inject=["$scope","$http","$modal","$config","$UI","Auth","Model","rAppConfigs","$rootScope","$state"],p.$inject=["$scope","$http","$modal","$config","$UI","Model"]}(angular);;;;
!function(e){function r(e,r,i,t,a){function o(){e.viewMode="EDIT"}function n(){e.maskedNumberProviderDetail.$rollback(!1),e.viewMode="VIEW"}function s(){swal({title:"Are you sure?",text:"Masked number functionality will be removed for your account. ",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm",closeOnConfirm:!1},function(){e.maskedNumberProviderDetail.$delete().success(function(){swal("Masked Number Deleted","Masked number functionality has been removed for your account","success"),e.maskedNumberProviderDetail=new t.MaskedNumberProviderDetail,e.existing=!1})})}function d(){e.existing?e.maskedNumberProviderDetail.$update().success(function(){e.viewMode="VIEW",swal("Masked Number Details Updated","Masked number details have been updated.","success")}):a.post($config.API_ENDPOINT+"api/MaskedNumberProviderDetails",e.maskedNumberProviderDetail).success(function(r){swal("Masked Number Details Added","Masked number details have been added for your account.","success"),e.viewMode="VIEW",e.existing=!0}).error(function(){alert("Some Error Occurred.")})}e.company=i[0],void 0!=r&&r.length>0?(e.maskedNumberProviderDetail=r[0],e.existing=!0):(e.maskedNumberProviderDetail=new t.MaskedNumberProviderDetail,e.existing=!1),e.viewMode="VIEW",e.startEdit=o,e.cancelEdit=n,e.saveEdits=d,e["delete"]=s}var i=e.module("cab9.settings");i.controller("SettingsMaskedNumberController",r),r.$inject=["$scope","rMaskedNumberProviderDetail","rCompany","Model","$http"]}(angular);;;;
!function(n){function o(n,o,c){n.tabDefs=o,n.accessors=c}function c(n,o,c,i){function e(){n.viewMode="EDIT"}function t(){n.config=new i.EmailConfig,n.viewMode="EDIT"}function s(){n.config.Id?n.config.$rollback(!1):n.config=null,n.viewMode="VIEW"}function f(){n.config.Id?n.config.$patch().success(function(){n.viewMode="VIEW"}):n.config.$save().success(function(){n.viewMode="VIEW"})}n.company=o[0],n.config=c[0],!n.config,n.viewMode="VIEW",n.startEdit=e,n.cancelEdit=s,n.saveEdits=f,n.addNew=t,n.accessors={LogoUrl:function(o){return n.company._ImageUrl}}}var i=n.module("cab9.settings");i.controller("SettingsEmailController",o),i.controller("SettingsEmailConfigController",c),o.$inject=["$scope","rTabs","rAccessors"],c.$inject=["$scope","rCompany","rConfig","Model"]}(angular);;;;
!function(e){function a(e,a,t,n,o,l,i){function r(a){e.selectedTemplate=a,m(a)}function s(){m(e.selectedTemplate)}function m(a){t.get(n.API_ENDPOINT+"api/Email/GetTemplate?template="+a.Name,{}).success(function(a){e.selectedTemplate.data=a})}function p(){t.post(n.API_ENDPOINT+"api/Email/SaveTemplate",{Template:e.selectedTemplate.Name,Content:e.selectedTemplate.data}).success(function(e){swal({title:"Template Saved.",text:"Changes have been updated.",type:"success",confirmButtonColor:o.COLOURS.brandSecondary})}).error(function(){alert("Error")})}function d(){var a=i.open({templateUrl:"/webapp/management/settings/email/email-preview-modal.partial.html",controller:"EmailTemplatePreviewController",size:"lg",resolve:{BookingId:function(){return e.data.selectedOption?e.data.selectedOption.Id:null},SelectedTemplate:function(){return e.selectedTemplate}}});a.result.then(function(e){})}function c(){t.post(n.API_ENDPOINT+"api/Email/UploadTemplate",{template:e.selectedTemplate.Name}).success(function(e){swal({title:"Template Uploaded.",text:"Changes have been updated.",type:"success",confirmButtonColor:o.COLOURS.brandSecondary})}).error(function(e){e.Message?swal({title:"Save the Template",text:"Save the template before upload.",type:"error",confirmButtonColor:o.COLOURS.brandSecondary}):alert("Error")})}function u(){t.get(n.API_ENDPOINT+"api/Email/ClearTemplates",{}).success(function(e){}).error(function(){alert("Error")})}e.company=a[0],e.bookings=[],e.selectedTemplate=null,e.data={selectedOption:null},e.templates=[{Id:1,Display:"Account Created",Name:"AccountCreatedConfirmation",data:null,params:"none"},{Id:3,Display:"Client Credit Note Email",Name:"ClientCreditNoteConfirmation",data:null,params:"none"},{Id:4,Display:"Client Invoice Email",Name:"ClientInvoiceConfirmation",data:null,params:"none"},{Id:6,Display:"Driver Payment Email",Name:"DriverPaymentConfirmation",data:null,params:"none"},{Id:7,Display:"Booking Cancellation",Name:"GeneralBookingCancellation",data:null,params:"Booking"},{Id:8,Display:"Booking Confirmation",Name:"GeneralBookingConfirmation",data:null,params:"Booking"},{Id:15,Display:"Booking Assigned Confirmation",Name:"GeneralBookingAssigned",data:null,params:"Booking"},{Id:9,Display:"Passenger App Invite",Name:"PassengerAppInvitationCreatedVerification",data:null,params:"none"},{Id:17,Display:"Booking Payment Link",Name:"GeneralBookingPaymentLink",data:null,params:"Booking"},{Id:11,Display:"Card Payment Failed",Name:"PassengerBookingPaymentFailed",data:null,params:"Booking"},{Id:12,Display:"Card Payment Receipt",Name:"PassengerBookingPaymentReceipt",data:null,params:"Booking"},{Id:13,Display:"Card Pre-Auth Failed",Name:"PassengerBookingPreauthFailed",data:null,params:"Booking"},{Id:14,Display:"Password Reset Email",Name:"ResetPassword",data:null,params:"none"},{Id:16,Display:"Passenger Verification",Name:"PassengerCreatedVerification",data:null,params:"none"}],e.selectTemplate=r,e.reset=s,e.fetchTemplate=m,e.saveEdits=p,e.preview=d,e.upload=c,t.get(n.API_ENDPOINT+"api/bookings",{params:{$select:"Id,LocalId",$top:10,$orderby:"BookedDateTime desc"}}).success(function(a){[].push.apply(e.bookings,a.map(function(e){return new l.Booking(e)}))}),r(e.templates[0]),e.$on("$destroy",function(){u()})}function t(e,a,t,n,o,l){function i(){return o.trustAsResourceUrl(l.API_ENDPOINT+"/api/email/GetTemplateHtml?template="+a.Name+"&bookingId="+t+"&token="+n.getSession().access_token)}e.getTemplate=i,e.template=a}var n=e.module("cab9.settings");n.controller("SettingsEmailTemplateController",a),n.controller("EmailTemplatePreviewController",t),a.$inject=["$scope","rCompany","$http","$config","$UI","Model","$modal"],t.$inject=["$scope","SelectedTemplate","BookingId","Auth","$sce","$config"]}(angular);;;;
!function(e){function r(e,r,s,t,n,o,a,c,u){function l(e,r,n,o,a){var c=u.defer();return s.get(t.API_ENDPOINT+"api/account/formatted",{params:{pageNumber:o.currentPage,recordsPerPage:o.maxPerPage,searchTerm:e.$,sortBy:"undefined"==typeof r[0]?null:r[0]}}).success(function(e){c.notify(e.Count),e.Users.map(function(e){null!=e.LockoutEndDateUtc&&moment(e.LockoutEndDateUtc)>new moment?e.$Locked=!0:e.$Locked=!1}),c.resolve({undefined:e.Users})}).error(function(e){swal("Error",e.Message,"error")}),c.promise}function i(){e.showSearch=!e.showSearch,e.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):e.searchTerm.$=""}function d(e){r.open({templateUrl:"/webapp/management/settings/users/user-change-password.modal.html",controller:["$scope","$modalInstance",function(r,n){r.setNewPassword=function(r){r.Id=e,s.post(t.API_ENDPOINT+"api/account/SetPassword",r).success(function(){swal("Success","Password changed successfully.","success"),n.close()}).error(function(e){swal("Error","Please ensure passwords match and contain at least 1 uppercase and 1 number character.","error")})}}]})}function m(e){swal({title:"Lockout Date",text:"Please enter a date until which the user will be locked out. Please format the date as DD/MM/YYYY HH:mm as any other format will not be accepted.",type:"input",inputPlaceholder:"DD/MM/YYYY HH:mm",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!0},function(r){if(r){var n=moment(r,"DD/MM/YYYY HH:mm");"Invalid Date"==n._d?setTimeout(function(){swal("Incorrect Date Format","Please enter a date until which the user will be locked out. Please format the date as DD/MM/YYYY HH:mm as any other format will not be accepted.","warning")},500):s({method:"POST",url:t.API_ENDPOINT+"api/account/LockUser?userId="+e.Id+"&lockedUntil="+n.format("YYYY-MM-DDTHH:mm")}).success(function(r){swal("User Locked","This user is now locked and will not be able to log into Cab9.","success"),e.$Locked=!0}).error(function(e){swal("Error",e.Message?e.Message:"Some error has occured.","error")})}})}function f(e){swal({title:"Are you sure?",text:"The user will be unlocked and will be able to use Cab9. ",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!1,showLoaderOnConfirm:!0,closeOnCancel:!1},function(){s({method:"POST",url:t.API_ENDPOINT+"api/account/UnlockUser",params:{UserId:e.Id}}).success(function(r){swal("User Unlocked","This user is now ulocked and will be able to log into Cab9.","success"),e.$Locked=!1}).error(function(e){swal("Error",e.Message?e.Message:"Some error has occured.","error")})})}function h(e){swal({title:"Are you sure?",text:"The email address of the user will be verified manually.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!1,showLoaderOnConfirm:!0,closeOnCancel:!1},function(){s({method:"POST",url:t.API_ENDPOINT+"api/account/VerifyEmail",params:{UserId:e.Id}}).success(function(r){swal("Email Verified","The user email has been verified.","success"),e.EmailConfirmed=!0}).error(function(e){swal("Error",e.Message?e.Message:"Some error has occured.","error")})})}function p(){w()}function w(e){r.open({templateUrl:"/webapp/management/settings/users/user-create.modal.html",controller:"SettingsUserModalController"}).result.then(function(){o.go("root.settings.users",null,{reload:!0})},function(){})}e.Users,e.Schema="UserInfo",e.currentUserId=n.getSession().UserId,e.toggleSearch=i,e.showSearch=!1,e.changePassword=d,e.lockAccount=m,e.unblockAccount=f,e.fetchUsers=l,e.addnewUser=p,e.verifyEmail=h,e.searchTerm={},e.paging={currentPage:1,maxPerPage:20,totalItems:null,maxPages:null}}function s(e,r,s){function t(r,s){e.stage++,e.type=r.Name,e.user=null,e.nUsers=[],e.user||(e.user={Email:null})}function n(){return!!(e.user.UserName&&e.user.Password&&e.user.PasswordRepeat&&e.user.Email)&&e.user.Password==e.user.PasswordRepeat}function o(r){switch(e.user=r,e.user.Name=(r.Firstname+" "+r.Surname).replace(" null",""),e.data.selectedOption.id){case 1:e.user.DriverId=r.Id;break;case 2:e.user.ClientStaffId=r.Id;break;case 3:e.user.PassengerId=r.Id;break;case 4:e.user.StaffId=r.Id}}function a(){e.nUsers=[],e.user={},e.stage--}function c(r){r.length>2&&s.get($config.API_ENDPOINT+"api/Account/entities-without-users",{params:{type:e.type,searchTerm:r}}).success(function(r){e.nUsers=r}).error(function(e){swal("Error",e.Message,"error")})}e.nUsers=[],e.user={},e.setUser=o,e.newUsers=c,e.formCheck=n,e.back=a,e.reset=t,e.data={selectedOption:null},e.type,e.userTypes=[{id:1,Name:"Driver"},{id:2,Name:"ClientStaff"},{id:3,Name:"Passenger"},{id:4,Name:"Staff"}],e.stage=1,e.filters={searchTerm:"",Type:null,pageNumber:1,recordsPerPage:10},e.save=function(){s.post($config.API_ENDPOINT+"api/account",e.user).success(function(){e.stage++,swal("User Created","User has been created.","success"),r.close()}).error(function(e){swal("An error has occurred.",e.ExceptionMessage?e.ExceptionMessage:"There was an error creating the user. Please check your field values and try again.","error")})}}function t(){return function(r,s){return e.forEach(r,function(t,n){e.forEach(s,function(e){t.Id.toUpperCase()==e.ClaimValue.toUpperCase()&&r.splice(n,1)})}),r}}var n=e.module("cab9.settings");n.controller("SettingsUsersController",r),n.controller("SettingsUserModalController",s),n.filter("ExistingAccounts",t),r.$inject=["$scope","$modal","$http","$config","Auth","$state","CSV","$filter","$q"],s.$inject=["$scope","$modalInstance","$http"]}(angular);;;;
!function(e){function n(n,s,r,i,o,t,a){function m(e){var n=e.split(".");return 25+10*(n.length-1)+"px"}function c(n){var s=n.Name.split(".").length;e.forEach(n.$childs,function(e){var n=e.Name.split(".");e.$show=!(n.length>s+1)}),n.$expand=!0}function f(n){e.forEach(n.$childs,function(e){e.$show=!1}),n.$expand=!1}function l(e){e.$expand?f(e):c(e)}function u(){swal({title:"New Role",text:"Enter the name of the role below.",type:"input",showCancelButton:!0,closeOnConfirm:!1,inputPlaceholder:"Role Name"},function(e){if(e===!1)return!1;if(""===e)return swal.showInputError("Enter role name!"),!1;if(e){var n=new a.StaffRole;return n.Name=e,n.Description=e,n.Permissions="[]",n.$save().then(function(){swal("New Role Added","New role has been added, please configure the new role after the refresh.","success"),location.reload()}),!0}})}function h(e,n,s){if("Super Admin"==n.Name||1==n.Id)return"glyphicon-ok text-success";var r=!1,i=null;if(n.Permissions&&n.Permissions.forEach(function(n,o){if(n.hasOwnProperty(e.Name))return i=n[e.Name][s],void(r=!0)}),r){if(i){var o=e.$childs.every(function(e){return 1==n.Permissions.filter(function(n){if(n.hasOwnProperty(e.Name))return n[e.Name][s]}).length});return o?"glyphicon-ok text-success":"glyphicon-ok text-warning"}return"glyphicon-remove text-danger"}return"glyphicon-remove text-danger"}function p(e,n,s){if("Super Admin"!=n.Name&&n.TenantId){var r=!1,i=null,o=-1;if(n.Permissions||(n.Permissions=[]),n.Permissions.forEach(function(n,t){n.hasOwnProperty(e.Name)&&(i=n[e.Name][s],r=!0,o=t)}),r){var t=h(e,n,s);n.Permissions[o][e.Name][s]=!i,"R"==s?"glyphicon-remove text-danger"!=t?(n.Permissions[o][e.Name].W=!1,n.Permissions[o][e.Name].D=!1,e.$childs.forEach(function(e){var r=n.Permissions.filter(function(n){return n.hasOwnProperty(e.Name)})[0],i=n.Permissions.indexOf(r);i!=-1&&(n.Permissions[i][e.Name][s]=!1,n.Permissions[i][e.Name].W=!1,n.Permissions[i][e.Name].D=!1)})):N(e).forEach(function(e){var r=n.Permissions.filter(function(n){return n.hasOwnProperty(e.Name)})[0],o=n.Permissions.indexOf(r);o!=-1&&(n.Permissions[o][e.Name][s]=!i)}):i||(n.Permissions[o][e.Name].R||(n.Permissions[o][e.Name].R=!i),"D"==s&&(n.Permissions[o][e.Name].W=!i),N(e).forEach(function(e){var s=n.Permissions.filter(function(n){return n.hasOwnProperty(e.Name)})[0],r=n.Permissions.indexOf(s);r!=-1&&(n.Permissions[r][e.Name].R=!i)}))}else{var a={},m=e.Name;switch(s){case"R":a[m]={R:!0,W:!1,D:!1};break;case"W":a[m]={R:!0,W:!0,D:!1};break;case"D":a[m]={R:!0,W:!0,D:!0}}n.Permissions.push(a),a={},N(e).forEach(function(e){var s=n.Permissions.filter(function(n){return n.hasOwnProperty(e.Name)})[0],r=n.Permissions.indexOf(s);r==-1?(m=e.Name,a[m]={R:!0,W:!1,D:!1},n.Permissions.push(a)):n.Permissions[r][e.Name].R=!0})}}}function N(e){for(var s=[],r=e.Name.split("."),i="",o=0;o<r.length;o++){i.length>0&&(i+="."),i+=r[o];var t=n.permissions.filter(function(e){return e.Name==i});t[0]&&s.push(t[0])}return s}function P(){var s=e.copy(n.roles);e.forEach(s,function(e){e.Permissions=JSON.stringify(e.Permissions)}),i.post(r.API_ENDPOINT+"api/CurrentPermissions",s).success(function(e){swal("Updated","Roles have been updated","success")})}n.roles=o,n.permissions=s("orderBy")(t,"Name"),n.calcLeft=m,n.expand=c,n.retract=f,n.toggle=l,n.getPermissionClassForRole=h,n.togglePermissionForRole=p,n.saveChanges=P,n.addNewRole=u,e.forEach(n.permissions,function(e){var s=e.Name.split(".");e.$show=!(s.length>1),e.$childs=n.permissions.filter(function(n){return 0==n.Name.indexOf(e.Name)&&n.Name!=e.Name})})}var s=e.module("cab9.settings");s.controller("SettingsRolesController",n),n.$inject=["$scope","$filter","$config","$http","rRoles","rPermissions","Model"]}(angular);;;;
!function(e){function s(e,s,t,r,o,n,a){function c(){e.viewMode="EDIT"}function i(){e.user={UserName:a.getSession().UserName},e.viewMode="VIEW"}function u(){s.put(t.API_ENDPOINT+"api/account",e.user).success(function(e){swal({title:"Password updated",text:"Try login using new password!",type:"success"},function(e){o.$broadcast(n.LOGOUT)})}).error(function(e){swal("An error has occurred.",e.ExceptionMessage?e.ExceptionMessage:"There was an error processing your request. Please check your field values and try again.","error")})}e.viewMode="VIEW",e.startEdit=c,e.cancelEdit=i,e.saveEdits=u,e.user={UserName:a.getSession().UserName}}var t=e.module("cab9.settings");t.controller("SettingsProfileController",s),s.$inject=["$scope","$http","$config","$state","$rootScope","AUTH_EVENTS","Auth"]}(angular);;;;
!function(e){function t(e,t,n,l){return{scope:{slot:"=",vehicleTypes:"="},templateUrl:"/webapp/management/settings/integrations/filter-directive/partial.html",link:function(e,l,o){function s(t){e.slot.BypassVehicleTypes.push(t);var n=e._vehicleTypes.filter(function(e){return e.Id==t.Id});n[0]&&e._vehicleTypes.splice(e._vehicleTypes.indexOf(n[0]),1),e.selectedVehicleType=null}function r(t){e._vehicleTypes.push(t);var n=e.slot.BypassVehicleTypes.filter(function(e){return e.Id==t.Id});n[0]&&e.slot.BypassVehicleTypes.splice(e.slot.BypassVehicleTypes.indexOf(n[0]),1)}function a(e){e.selected=!e.selected}function i(e){var t=0;return e.map(function(e){1==e.selected&&(t+=e.value)}),t>0?t:null}function u(){c(),d()}function c(){e.slot.DaysOfWeek&&e.slot.DaysOfWeek.length>0&&e.week.map(function(t){e.slot.DaysOfWeek.indexOf(t.full)>-1&&(t.selected=!0)})}function d(){var t=[];e.slot.BypassVehicleTypes&&(e._vehicleTypes.map(function(n){e.slot.BypassVehicleTypes.map(function(l){n.Id==l.Id&&t.push(e._vehicleTypes.indexOf(n))})}),t.map(function(t,n){e._vehicleTypes.splice(t-n,1)}))}function f(){swal({title:"Are you sure?",text:"Are you sure you want to update this slot?",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm",showLoaderOnConfirm:!0,closeOnConfirm:!1},function(){e.slot.DaysOfWeek=i(e.week),t({method:"POST",url:n.API_ENDPOINT+"api/ot-integration/update-slot",data:e.slot}).then(function(e){swal("Slot Updated","Slot has been updated.","success")},function(e){swal("Error","There was an error updating the slot.","error")})},function(){swal("Error","There was an error updating the slot.","error")})}function h(){swal({title:"Are you sure?",text:"Are you sure you want to save this slot?",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm",showLoaderOnConfirm:!0,closeOnConfirm:!1},function(){e.slot.DaysOfWeek=i(e.week),t({method:"POST",url:n.API_ENDPOINT+"api/ot-integration/add-slot",data:e.slot}).then(function(t){swal("Slot Saved","Slot has been saved.","success"),e.slot.Id=t.data.Id},function(e){swal("Error","There was an error saving the slot.","error")})},function(){swal("Error","There was an error saving the slot.","error")})}function p(){swal({title:"Are you sure?",text:"Are you sure you want to delete this slot?",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm",showLoaderOnConfirm:!0,closeOnConfirm:!1},function(){t({method:"POST",url:n.API_ENDPOINT+"api/ot-integration/delete-slot",data:e.slot}).then(function(t){swal("Slot Deleted","Slot has been deleted.","success"),e.$emit("SlotDeleted",e.slot)},function(e){swal("Error","There was an error deleting the slot.","error")})},function(){swal("Error","There was an error deleting the slot.","error")})}function i(e){var t=0;return e.map(function(e){1==e.selected&&(t+=e.value)}),t>0?t:null}e.toggleDay=a,e.addVehicleType=s,e.removeVehicleType=r,e.saveSlot=h,e.updateSlot=f,e.deleteSlot=p,e._vehicleTypes=e.vehicleTypes.slice(),e.timePattern=/^(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]$/,e.week=[{day:"Su",value:1,selected:!1,full:"Sunday"},{day:"Mo",value:2,selected:!1,full:"Monday"},{day:"Tu",value:4,selected:!1,full:"Tuesday"},{day:"We",value:8,selected:!1,full:"Wednesday"},{day:"Th",value:16,selected:!1,full:"Thursday"},{day:"Fr",value:32,selected:!1,full:"Friday"},{day:"Sa",value:64,selected:!1,full:"Saturday"}],u()}}}var n=e.module("cab9.settings");n.directive("bookingsFilter",t),t.$inject=["$parse","$http","$config","$filter"]}(angular);;;;
!function(e){function t(e,t,n,a,o){function s(){e.savingDetails=!0,e.telephonyData.Id?swal({title:"Are you sure?",text:"Are you sure you want to update the Integration Details?",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm",closeOnConfirm:!1},function(){e.telephonyData.$patch().success(function(){e.savingDetails=!1,swal("Details Saved","The integration details have been saved to the database.","success"),c()})},function(){}):e.telephonyData.$save().success(function(){e.savingDetails=!1,c(),swal("Details Saved","The integration details have been saved to the database.","success")})}function i(){swal({title:"Are you sure?",text:"Are you sure you want to delete the Integration Details",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm Delete",closeOnConfirm:!1},function(){e.deletingDetails=!0,e.telephonyData.$delete().success(function(){e.deletingDetails=!1,e.telephonyData=new n.TelephonyIntegration,e.telephonyData.TelephonyProvider="Aircall",e.staffExtensions=null,swal("Integration Details Deleted","The integration details have been deleted.","success")})},function(){})}function l(){e.testingDetails=!0;var t=window.btoa(e.telephonyData.AuthDetails1+":"+e.telephonyData.AuthDetails2);a({method:"GET",url:"https://api.aircall.io/v1/ping",headers:{Authorization:"Basic "+t}}).then(function(t){e.testingDetails=!1,swal("Connection Successful","The connection details were verified successfully.","success")},function(t){swal("Connection Not Successful",t.data.error,"error"),e.testingDetails=!1})}function r(){swal({title:"Are you sure?",text:"Are you sure you want to create the Webhook?",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm",closeOnConfirm:!1},function(){e.creatingWebhook=!0,a({method:"POST",url:o.API_ENDPOINT+"api/telephony/create-webhook"}).then(function(t){e.creatingWebhook=!1,swal("Webhook Created","The Webhook was created successfully.","success")},function(){swal("Webhook Creation Failed","There was an error while creating the Webhook.","error"),e.creatingWebhook=!1})},function(){})}function c(){e.fetchingStaffExtensions=!0,a({method:"GET",url:o.API_ENDPOINT+"/api/telephony/staff-extension"}).then(function(t){n.Staff.query().select("Id, Firstname, Surname").filter("Active eq true").execute().then(function(n){e.listOfStaff=n,e.fetchingStaffExtensions=!1,e.staffExtensions=t.data,e.staffExtensions.map(function(e){e.Staff&&(e.Staff._Fullname=e.Staff.Firstname+" "+e.Staff.Surname)})})},function(t){e.fetchingStaffExtensions=!1,swal("Error Fetching Staff Extensions",t.data.Message,"error")})}function f(e,t){console.log(e+" is now selected on "+t),a({method:"POST",url:o.API_ENDPOINT+"/api/telephony/staff-extension",params:{staffId:e,extension:t}}).then(function(e){swal("Extension Set","The extension has been set for the staff.","success")},function(e){swal("Error Fetching Staff Extensions",e.data.Message,"error")})}e.telephonyData=new n.TelephonyIntegration(t[0]),e.telephonyData.TelephonyProvider="Aircall",null==e.telephonyData&&(e.telephonyData=new n.TelephonyIntegration,e.telephonyData.TelephonyProvider="Aircall"),e.saveDetails=s,e.deleteDetails=i,e.testDetails=l,e.createWebhook=r,e.staffSelectedOnExtension=f,e.listOfStaff=[],null!=e.telephonyData.Id&&c()}var n=e.module("cab9.settings");n.controller("SettingsTelephonyController",t),t.$inject=["$scope","rIntegration","Model","$http","$config"]}(angular);;;;
!function(){function e(e,t,n,r,o,u){function l(e){swal({title:"Are you sure?",text:"Adjustment will be deleted",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){new u.DriverPaymentModelAdjustment(e).$delete().then(function(e){swal({title:"Adjustment deleted",text:"Changes have been updated.",type:"success",confirmButtonColor:$UI.COLOURS.brandSecondary}),t.go(t.current,{Id:n.Id},{reload:!0})},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:$UI.COLOURS.brandSecondary})})})}function d(){var e=r.open({templateUrl:"/webapp/management/settings/driverpayments/adjustments/modal/modal.html",controller:"DriverPaymentModelAdjustmentCreateController",resolve:{rDriverId:function(){return n.Id},rTaxes:function(){return u.Tax.query().execute()},rVehicleTypes:function(){return u.VehicleType.query().select("Id, Name").execute()}}});e.result.then(function(e){t.go(t.current,n,{reload:!0})},function(){})}function a(o){var l=(e.adjustments.indexOf(o),r.open({templateUrl:"/webapp/management/settings/driverpayments/adjustments/modal/modal.html",controller:"DriverPaymentModelAdjustmentEditController",resolve:{rAdjustment:function(){return u.DriverPaymentModelAdjustment.query().where("Id eq guid'"+o.Id+"'").trackingEnabled().execute()},rTaxes:function(){return u.Tax.query().execute()},rVehicleTypes:function(){return u.VehicleType.query().select("Id, Name").execute()}}}));l.result.then(function(e){t.go(t.current,n,{reload:!0})},function(){})}e.adjustments=o,e.openAdjustmentCreate=d,e.deleteAdjustment=l,e.recurring=!0,e.schema="DriverPaymentModelAdjustment",e.openAdjustmentEdit=a}var t=angular.module("cab9.settings");t.controller("DriverPaymentModelAdjustmentController",e),e.$inject=["$scope","$state","$stateParams","$modal","rAdjustments","Model"]}();;;;
!function(e){function t(e,t,n,l,a,u,s,d,r,i,c,o){function m(t){e.adjustment.$VehicleTypes.push(t);var n=e.unlinkedVehicleTypes.filter(function(e){return e.Id==t.Id});n[0]&&e.unlinkedVehicleTypes.splice(e.unlinkedVehicleTypes.indexOf(n[0]),1),e.selectedVehicleType=null}function y(t){e.unlinkedVehicleTypes.push(t);var n=e.adjustment.$VehicleTypes.filter(function(e){return e.Id==t.Id});n[0]&&e.adjustment.$VehicleTypes.splice(e.adjustment.$VehicleTypes.indexOf(n[0]),1)}function f(e){e.selected=!e.selected}function p(){try{e.adjustment.AppliesToBooking?(e.adjustment.DaysOfWeek=h(e.week),e.adjustment.StartTime=T(e.adjustment.$StartTime),e.adjustment.EndTime=T(e.adjustment.$EndTime),e.adjustment.VehicleTypes=j(e.adjustment.$VehicleTypes)):(e.adjustment.DaysOfWeek=null,e.adjustment.StartTime=null,e.adjustment.EndTime=null,e.adjustment.VehicleTypes=null),e.adjustment.$save().then(function(e){swal({title:"Adjustment Model Saved!",text:"Changes have been updated.",type:"success",confirmButtonColor:d.COLOURS.brandSecondary}),n.close(e)},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:d.COLOURS.brandSecondary})})}catch(t){swal({title:"Some Error Occured.",text:t.message,type:"error",confirmButtonColor:d.COLOURS.brandSecondary})}}function h(e){var t=0;return e.map(function(e){1==e.selected&&(t+=e.value)}),t>0?t:null}function T(e){if(e&&e.length>0){if(2==e.split(":").length)return parseFloat(60*e.split(":")[0])+parseFloat(e.split(":")[1]);throw{message:"Time is not in correct format. Please check your input and try again."}}return null}function j(e){if(e.length>0){var t=e.map(function(e){return e.Id});return t.join(",")}return null}e.adjustment=new i.DriverPaymentModelAdjustment,e.adjustment.TaxId=e.COMPANY.DefaultTaxId,e.adjustment.DriverPaymentModelId=t.Id,e.viewMode="CREATE",e.save=p,e.taxes=c,e.recurring=!0,e.adjustment.Approved=!0,e.adjustment.Recurring="Recurring",e.adjustment.AmountType="Fixed",e.adjustment.$VehicleTypes=[],e.unlinkedVehicleTypes=o,e.addVehicleType=m,e.removeVehicleType=y,e.toggleDay=f,e.week=[{day:"Su",value:1,selected:!1,full:"Sunday"},{day:"Mo",value:2,selected:!1,full:"Monday"},{day:"Tu",value:4,selected:!1,full:"Tuesday"},{day:"We",value:8,selected:!1,full:"Wednesday"},{day:"Th",value:16,selected:!1,full:"Thursday"},{day:"Fr",value:32,selected:!1,full:"Friday"},{day:"Sa",value:64,selected:!1,full:"Saturday"}]}function n(e,t,n,l,a,u,s,d,r,i,c,o,m){function y(t){e.adjustment.$VehicleTypes.push(t);var n=e.unlinkedVehicleTypes.filter(function(e){return e.Id==t.Id});n[0]&&e.unlinkedVehicleTypes.splice(e.unlinkedVehicleTypes.indexOf(n[0]),1),e.selectedVehicleType=null}function f(t){e.unlinkedVehicleTypes.push(t);var n=e.adjustment.$VehicleTypes.filter(function(e){return e.Id==t.Id});n[0]&&e.adjustment.$VehicleTypes.splice(e.adjustment.$VehicleTypes.indexOf(n[0]),1)}function p(e){e.selected=!e.selected}function h(){try{e.adjustment.AppliesToBooking?(e.adjustment.DaysOfWeek=$(e.week),e.adjustment.StartTime=v(e.adjustment.$StartTime),e.adjustment.EndTime=v(e.adjustment.$EndTime),e.adjustment.VehicleTypes=S(e.adjustment.$VehicleTypes)):(e.adjustment.DaysOfWeek=null,e.adjustment.StartTime=null,e.adjustment.EndTime=null,e.adjustment.VehicleTypes=null),e.adjustment.$patch().then(function(e){swal({title:"Adjustment Model Updated!",text:"Changes have been updated.",type:"success",confirmButtonColor:d.COLOURS.brandSecondary}),n.close(e)},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:d.COLOURS.brandSecondary})})}catch(t){swal({title:"Some Error Occured.",text:t.message,type:"error",confirmButtonColor:d.COLOURS.brandSecondary})}}function T(){if(j(),e.adjustment.$StartTime=V(e.adjustment.StartTime),e.adjustment.$EndTime=V(e.adjustment.EndTime),e.adjustment.$VehicleTypes=[],e.adjustment.VehicleTypes){var t=e.adjustment.VehicleTypes.split(",");e.unlinkedVehicleTypes.map(function(n){t.indexOf(n.Id)>-1&&(e.adjustment.$VehicleTypes.push(n),n.$assigned=!0)}),e.unlinkedVehicleTypes=e.unlinkedVehicleTypes.filter(function(e){return!e.$assigned})}}function j(){e.adjustment.DaysOfWeek&&e.adjustment.DaysOfWeek.length>0&&e.week.map(function(t){e.adjustment.DaysOfWeek.indexOf(t.full)>-1&&(t.selected=!0)})}function $(e){var t=0;return e.map(function(e){1==e.selected&&(t+=e.value)}),t>0?t:null}function v(e){if(e&&e.length>0){if(2==e.split(":").length)return parseFloat(60*e.split(":")[0])+parseFloat(e.split(":")[1]);throw{message:"Time is not in correct format. Please check your input and try again."}}return null}function V(e){if(e){if("number"==typeof e){var t=Math.floor(e/60)<10?"0"+Math.floor(e/60):Math.floor(e/60),e=e%60<10?"0"+e%60:e%60;return t+":"+e}throw{message:"Time is not in correct format. Please check your input and try again."}}return null}function S(e){if(e.length>0){var t=e.map(function(e){return e.Id});return t.join(",")}return null}e.taxes=o,e.adjustment=c[0],e.viewMode="EDIT",e.save=h,e.addVehicleType=y,e.removeVehicleType=f,e.toggleDay=p,e.unlinkedVehicleTypes=m,e.week=[{day:"Su",value:1,selected:!1,full:"Sunday"},{day:"Mo",value:2,selected:!1,full:"Monday"},{day:"Tu",value:4,selected:!1,full:"Tuesday"},{day:"We",value:8,selected:!1,full:"Wednesday"},{day:"Th",value:16,selected:!1,full:"Thursday"},{day:"Fr",value:32,selected:!1,full:"Friday"},{day:"Sa",value:64,selected:!1,full:"Saturday"}],T()}var l=e.module("cab9.settings");l.controller("DriverPaymentModelAdjustmentCreateController",t),t.$inject=["$scope","$stateParams","$modalInstance","$rootScope","$state","$q","$config","$UI","$http","Model","rTaxes","rVehicleTypes"],l.controller("DriverPaymentModelAdjustmentEditController",n),n.$inject=["$scope","$stateParams","$modalInstance","$rootScope","$state","$q","$config","$UI","$http","Model","rAdjustment","rTaxes","rVehicleTypes"]}(angular);;;;
!function(t){function o(t,o,n){function e(){t.item.StopSummary=window.$utilities.formatAddress(t.item),t.item.$save().then(function(t){swal("Success","The location saved successfully","success"),n.go("root.settings.knownlocations.viewer.details",{Id:t.data.Id})},function(){swal("Error","The location failed to save.","error")})}function i(){n.go("root.settings.knownlocations.cards")}t.item=new o.KnownLocation,t.displayMode="CREATE",t.saveEdits=e,t.cancelEditing=i}function n(t,o,n){function e(){t.displayMode="EDIT"}function i(){t.item.$patch().then(function(o){swal("Success","The location saved successfully","success"),t.item.Latitude=o.data.Latitude,t.item.Longitude=o.data.Longitude,t.displayMode="VIEW"},function(){swal("Error","The location failed to save.","error")})}function a(){t.item.$rollback(),t.displayMode="VIEW"}t.displayMode="VIEW",t.startEditing=e,t.saveEdits=i,t.cancelEditing=a}function e(t,o,n,e){function i(){n.open({templateUrl:"/webapp/management/settings/known-locations/item/knownlocation-point-edit.partial.html",controller:"KnownLocationPointEditController",size:"lg",background:"static",backdrop:"static",resolve:{rMode:function(){return"CREATE"},rPickUpPoint:function(){var n=new o.KnownPickupPoint;return n.Latitude=t.item.Latitude,n.Longitude=t.item.Longitude,n.KnownLocationId=t.item.Id,n}}}).result.then(function(){o.KnownPickupPoint.query().filter("KnownLocationId","eq","guid'"+t.item.Id+"'").execute().then(function(o){t.item.KnownPickupPoints=o})})}function a(e){n.open({templateUrl:"/webapp/management/settings/known-locations/item/knownlocation-point-edit.partial.html",controller:"KnownLocationPointEditController",size:"lg",background:"static",backdrop:"static",resolve:{rMode:function(){return"EDIT"},rPickUpPoint:function(){return new o.KnownPickupPoint(e)}}}).result.then(function(){o.KnownPickupPoint.query().filter("KnownLocationId","eq","guid'"+t.item.Id+"'").execute().then(function(o){t.item.KnownPickupPoints=o})})}t.newPoint=i,t.openPoint=a,t.pointAccessors={Id:function(t){return t.Id},Title:function(t){return t.Name},LogoUrl:function(t){if(t.ImageUrl)return"http"==t.ImageUrl.slice(0,4)?t.ImageUrl:e.RESOURCE_ENDPOINT+t.ImageUrl;var o="AIzaSyAtRDZdVGx8r7tFPZR7h2D95VwsSyGqz-0";return"https://maps.googleapis.com/maps/api/streetview?size=400x400&location="+t.Latitude+","+t.Longitude+"&fov=90&heading="+t.Bearing+"&pitch="+t.Pitch+"&key="+o}}}function i(t,o,n,e,i){function a(){t.map=new google.maps.Map(document.getElementById("map-div"),{center:new google.maps.LatLng(t.pickUpPoint.Latitude,t.pickUpPoint.Longitude),zoom:17,zoomControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},styles:[{featureType:"all",stylers:[{saturation:0},{hue:"#e7ecf0"}]},{featureType:"road",stylers:[{saturation:-70}]},{featureType:"water",stylers:[{visibility:"simplified"},{saturation:-60}]}]}),setTimeout(function(){function o(){t.pickUpPoint.Latitude=t.panorama.getPosition().lat(),t.pickUpPoint.Longitude=t.panorama.getPosition().lng(),t.pickUpPoint.Bearing=t.panorama.getPov().heading,t.pickUpPoint.Pitch=t.panorama.getPov().pitch}google.maps.event.trigger(t.map,"resize"),google.maps.event.addListener(t.map,"dragend",function(){t.pickUpPoint.Latitude=t.map.getCenter().lat(),t.pickUpPoint.Longitude=t.map.getCenter().lng(),t.panorama.setPosition(t.map.getCenter()),t.map.setStreetView(t.panorama),t.$apply()}),t.panorama=new google.maps.StreetViewPanorama(document.getElementById("pano-div"),{position:t.map.getCenter(),pov:{heading:t.pickUpPoint.Bearing||34,pitch:t.pickUpPoint.Pitch||10}}),t.map.setStreetView(t.panorama),t.panorama.addListener("position_changed",function(){t.map.setCenter(t.panorama.getPosition()),t.pickUpPoint.Latitude=t.panorama.getPosition().lat(),t.pickUpPoint.Longitude=t.panorama.getPosition().lng(),o(),t.$apply()}),t.panorama.addListener("pov_changed",function(){o(),t.$apply()})},1e3)}function c(){"EDIT"==n?t.pickUpPoint.$image?i.upload(t.pickUpPoint.$image,{type:"PickupPoint",id:t.pickUpPoint.Id}).then(function(n){t.pickUpPoint.ImageUrl=n.data[0],t.pickUpPoint.$patch().then(function(t){swal("Success","The point saved successfully","success"),o.close()},function(){swal("Error","The point failed to save.","error")})},function(){swal("Error","Image upload failed","error")},function(o){t.progress=o}):t.pickUpPoint.$patch().then(function(t){swal("Success","The point saved successfully","success"),o.close()},function(){swal("Error","The point failed to save.","error")}):t.pickUpPoint.$save().then(function(n){t.pickUpPoint.$image?i.upload(t.pickUpPoint.$image,{type:"PickupPoint",id:n.data.Id}).then(function(n){t.pickUpPoint.ImageUrl=response.data[0],t.pickUpPoint.$patch().then(function(t){swal("Success","The point saved successfully","success"),o.close()},function(){swal("Error","The point failed to save.","error")})},function(){swal("Error","Image upload failed","error")},function(o){t.progress=o}):(swal("Success","The point saved successfully","success"),o.close())},function(){swal("Error","The point failed to save.","error")})}function s(){o.close()}function r(){t.pickUpPoint.$delete().then(function(t){swal("Success","The point has been removed successfully","success"),o.close()},function(){swal("Error","The point failed to delete.","error")})}t.displayMode=n,t.save=c,t.pickUpPoint=e,t.cancelEdit=s,t.removePoint=r,setTimeout(function(){a()},1e3)}var a=t.module("cab9.settings");a.controller("KnownLocationCreateController",o),a.controller("KnownLocationDetailsController",n),a.controller("KnownLocationPointsController",e),a.controller("KnownLocationPointEditController",i),o.$inject=["$scope","Model","$state"],n.$inject=["$scope","Model","$state"],e.$inject=["$scope","Model","$modal","$config"],i.$inject=["$scope","$modalInstance","rMode","rPickUpPoint","ImageUpload"]}(angular);;;;
!function(){function e(e,i,t,n,o,r){e.accessors=t,e.tabDefs=n}function i(e,i,t,n,o,r,a,l){function s(){e.settings.Id?e.settings.$patch().success(function(e){swal("Saved!","Dispatch Settings Saved","success")}).error(function(){swal("Error!","Dispatch Settings could not be Saved","error")}):e.settings.$save().success(function(i){e.settings.Id=i.Id,swal("Saved!","Dispatch Settings Created","success")}).error(function(){swal("Error!","Dispatch Settings could not be Saved","error")})}function d(){e.settings.$rollback()}function c(i,t){i&&(i.options.labelStyle.color="white",i.options.labelStyle["background-color"]="black",e.selected.B=i.lines,i.$driver&&(i.$driver.options.labelStyle.color="white",i.$driver.options.labelStyle["background-color"]="black")),t&&(t.options.labelStyle.color="white",t.options.labelStyle["background-color"]="black",t.$booking&&(t.$booking.options.labelStyle.color="white",t.$booking.options.labelStyle["background-color"]="black"))}function g(i,t){i&&(i.options.labelStyle.color="black",i.options.labelStyle["background-color"]="white",e.selected.B=e.pairedLines,i.$driver&&(i.$driver.options.labelStyle.color="black",i.$driver.options.labelStyle["background-color"]="white")),t&&(t.options.labelStyle.color="black",t.options.labelStyle["background-color"]="white",t.$booking&&(t.$booking.options.labelStyle.color="black",t.$booking.options.labelStyle["background-color"]="white"))}function u(i,t,n){"DRIVERS"==e.adding&&e.drivers.push({id:e.drivers.length+1,coords:{latitude:n[0].latLng.lat(),longitude:n[0].latLng.lng()},options:{labelContent:e.drivers.length+1,labelAnchor:"11 35",labelClass:"marker-label",labelInBackground:!0,labelStyle:{"font-size":"12px",color:"black",width:"22px",height:"22px","background-color":"rgba(255,255,255,1)","text-align":"center","border-top-left-radius":"11px","border-top-right-radius":"11px","border-bottom-left-radius":"11px","border-bottom-right-radius":"11px","line-height":"22px"},icon:{url:"/includes/images/car1.png",scaledSize:new google.maps.Size(30,41)}},pax:4,corating:100,bookings:100,hours:1,rating:3}),"BOOKINGS"==e.adding&&e.bookings.push({id:e.bookings.length+1,coords:{latitude:n[0].latLng.lat(),longitude:n[0].latLng.lng()},options:{labelContent:e.bookings.length+1,labelAnchor:"11 37",labelClass:"marker-label",labelInBackground:!0,labelStyle:{"font-size":"12px",color:"black",width:"22px",height:"22px","background-color":"rgba(255,255,255,1)","text-align":"center","border-top-left-radius":"11px","border-top-right-radius":"11px","border-bottom-left-radius":"11px","border-bottom-right-radius":"11px","line-height":"22px"},icon:"/includes/images/user.png"},dispatchInfo:null,pax:1,priority:1,clientId:null}),e.$apply()}function m(){e.dispatchStarted=!0;var i=e.drivers.map(function(e){return{id:e.id,latitude:e.coords.latitude,longitude:e.coords.longitude,pax:e.pax,corating:e.corating,bookings:e.bookings,hours:e.hours,rating:e.rating}}),t=e.bookings.map(function(e){return{id:e.id,latitude:e.coords.latitude,longitude:e.coords.longitude,pax:e.pax,priority:e.priority,clientId:e.clientId}});angular.forEach(e.bookings,function(e){e.dispatchInfo=null,e.$driver=null,e.$details=!1}),angular.forEach(e.drivers,function(e){e.dispatchInfo=null,e.$booking=null,e.$details=!1}),e.pairedLines=[],r.post(a.API_ENDPOINT+"api/dispatch",{Drivers:i,Bookings:t,Settings:e.settings}).success(function(i){console.log(i),i.results||(i.results=i.Bookings),e.idToDriverMapping=i.idToDriverMapping,e.idToBookingMapping=i.idToBookingMapping;var t=1;angular.forEach(i.results,function(n){var o=i.idToBookingMapping[n.BookingId],r=e.bookings.filter(function(e){return e.id==o})[0];if(r&&(r.dispatchInfo=n,r.lines=[],angular.forEach(n.Pairings,function(e){e.Eligable=!0,r.lines.push({id:t++,"static":!1,path:[new google.maps.LatLng(r.coords.latitude,r.coords.longitude),new google.maps.LatLng(e.Driver.LastKnownLatitude,e.Driver.LastKnownLongitude)],stroke:{color:e.TotalScore>.8?"#008800":.5==e.TotalScore?"#FFFF00":.25==e.TotalScore?"#DD0000":"#000000",weight:3,opacity:.8}})}),n.ChoosenPairing)){e.pairedLines.push({id:t++,"static":!1,path:[new google.maps.LatLng(r.coords.latitude,r.coords.longitude),new google.maps.LatLng(n.ChoosenPairing.Driver.LastKnownLatitude,n.ChoosenPairing.Driver.LastKnownLongitude)],stroke:{color:n.ChoosenPairing.TotalScore>.8?"#008800":.5==n.ChoosenPairing.TotalScore?"#FFFF00":.25==n.ChoosenPairing.TotalScore?"#DD0000":"#000000",weight:3,opacity:.8}});var a=i.idToDriverMapping[n.ChoosenPairing.DriverId],l=e.drivers.filter(function(e){return e.id==a})[0];l&&(l.dispatchInfo=n,r.$driver=l,l.$booking=r)}e.dispatchStarted=!1}),e.selected.B=e.pairedLines}).error(function(i){console.log(i),e.dispatchStarted=!1})}e.company=o[0],e.clients=l,e.map={center:{latitude:e.company.BaseLatitude||52,longitude:e.company.BaseLongitude||0},zoom:12,events:{click:u}},e.show={advanced:!1,settings:!0,bookings:!0,drivers:!0},e.selected={B:null},e.settings=i[0]||new t.DispatchSettings,e.adding=null,e.markerOptions={animation:google.maps.Animation.DROP,coords:{latitude:e.company.BaseLatitude||52,longitude:e.company.BaseLongitude||0},icon:{url:"/includes/images/marker.png",scaledSize:new google.maps.Size(48,48)}},e.pairedLines=[],e.drivers=[],e.bookings=[],e.runDispatch=m,e.onMouseEnter=c,e.onMouseLeave=g,e.saveSetup=s,e.revertSetup=d}function t(e,i,t,n,o,r,a,l){function s(){e.pairedLines.length=0,r.get(a.API_ENDPOINT+"/api/test/result").then(function(i){e.data=i.data;for(var t=i.data,n=0;n<t.Drivers.length;n++)t.Drivers[n].id="D:"+n,t.Drivers[n].coords={latitude:t.Drivers[n].LastKnownLatitude,longitude:t.Drivers[n].LastKnownLongitude},t.Drivers[n].options={labelContent:t.Drivers[n].DriverCallsign,labelAnchor:"11 35",labelClass:"marker-label",labelInBackground:!0,labelStyle:{"font-size":"12px",color:"black",width:"22px",height:"22px","background-color":"rgba(255,255,255,1)","text-align":"center","border-top-left-radius":"11px","border-top-right-radius":"11px","border-bottom-left-radius":"11px","border-bottom-right-radius":"11px","line-height":"22px"},icon:{url:"/includes/images/car1.png",scaledSize:new google.maps.Size(30,41)}};for(var n=0;n<t.Bookings.length;n++)t.Bookings[n].id="B:"+n,t.Bookings[n].coords={latitude:t.Bookings[n].PickupLatitude,longitude:t.Bookings[n].PickupLongitude},t.Bookings[n].options={labelAnchor:"11 37",labelClass:"marker-label",labelInBackground:!0,labelStyle:{"font-size":"12px",color:"black",width:"22px",height:"22px","background-color":"rgba(255,255,255,1)","text-align":"center","border-top-left-radius":"11px","border-top-right-radius":"11px","border-bottom-left-radius":"11px","border-bottom-right-radius":"11px","line-height":"22px"},icon:"/includes/images/user.png"},t.Bookings[n].lines=[],angular.forEach(t.Bookings[n].Pairings,function(e){t.Bookings[n].lines.push({id:u++,"static":!1,path:[new google.maps.LatLng(t.Bookings[n].PickupLatitude,t.Bookings[n].PickupLongitude),new google.maps.LatLng(e.Driver.LastKnownLatitude,e.Driver.LastKnownLongitude)],stroke:{color:e.TotalScore>=.8?"#008800":e.TotalScore>=.5?"#FFFF00":e.TotalScore>=.25?"#DD0000":"#000000",weight:3,opacity:.8}})}),t.Bookings[n].ChoosenPairing&&e.pairedLines.push({id:u++,"static":!1,path:[new google.maps.LatLng(t.Bookings[n].PickupLatitude,t.Bookings[n].PickupLongitude),new google.maps.LatLng(t.Bookings[n].ChoosenPairing.Driver.LastKnownLatitude,t.Bookings[n].ChoosenPairing.Driver.LastKnownLongitude)],stroke:{color:t.Bookings[n].ChoosenPairing.TotalScore>.8?"#008800":t.Bookings[n].ChoosenPairing.TotalScore>=.5?"#FFFF00":t.Bookings[n].ChoosenPairing.TotalScore>=.25?"#DD0000":"#000000",weight:3,opacity:.8}})})}function d(i,t){i&&(i.options.labelStyle.color="white",i.options.labelStyle["background-color"]="black",e.selected.B=i.lines,i.$driver&&(i.$driver.options.labelStyle.color="white",i.$driver.options.labelStyle["background-color"]="black")),t&&(t.options.labelStyle.color="white",t.options.labelStyle["background-color"]="black",t.$booking&&(t.$booking.options.labelStyle.color="white",t.$booking.options.labelStyle["background-color"]="black"))}function c(i,t){i&&(i.options.labelStyle.color="black",i.options.labelStyle["background-color"]="white",e.selected.B=e.pairedLines,i.$driver&&(i.$driver.options.labelStyle.color="black",i.$driver.options.labelStyle["background-color"]="white")),t&&(t.options.labelStyle.color="black",t.options.labelStyle["background-color"]="white",t.$booking&&(t.$booking.options.labelStyle.color="black",t.$booking.options.labelStyle["background-color"]="white"))}function g(i,t,n){"DRIVERS"==e.adding&&e.drivers.push({id:e.drivers.length+1,coords:{latitude:n[0].latLng.lat(),longitude:n[0].latLng.lng()},options:{labelContent:e.drivers.length+1,labelAnchor:"11 35",labelClass:"marker-label",labelInBackground:!0,labelStyle:{"font-size":"12px",color:"black",width:"22px",height:"22px","background-color":"rgba(255,255,255,1)","text-align":"center","border-top-left-radius":"11px","border-top-right-radius":"11px","border-bottom-left-radius":"11px","border-bottom-right-radius":"11px","line-height":"22px"},icon:{url:"/includes/images/car1.png",scaledSize:new google.maps.Size(30,41)}},pax:4,corating:100,bookings:100,hours:1,rating:3}),"BOOKINGS"==e.adding&&e.bookings.push({id:e.bookings.length+1,coords:{latitude:n[0].latLng.lat(),longitude:n[0].latLng.lng()},options:{labelContent:e.bookings.length+1,labelAnchor:"11 37",labelClass:"marker-label",labelInBackground:!0,labelStyle:{"font-size":"12px",color:"black",width:"22px",height:"22px","background-color":"rgba(255,255,255,1)","text-align":"center","border-top-left-radius":"11px","border-top-right-radius":"11px","border-bottom-left-radius":"11px","border-bottom-right-radius":"11px","line-height":"22px"},icon:"/includes/images/user.png"},dispatchInfo:null,pax:1,priority:1,clientId:null}),e.$apply()}e.company=o[0],e.clients=l,e.map={center:{latitude:e.company.BaseLatitude||52,longitude:e.company.BaseLongitude||0},zoom:12,events:{click:g}},e.show={advanced:!1,settings:!0,bookings:!0,drivers:!0},e.selected={B:null},e.pairedLines=[],s(),e.markerOptions={animation:google.maps.Animation.DROP,coords:{latitude:e.company.BaseLatitude||52,longitude:e.company.BaseLongitude||0},icon:{url:"/includes/images/marker.png",scaledSize:new google.maps.Size(48,48)}},e.paused=!1,e.pause=function(){e.paused=!0},e.unpause=function(){e.paused=!1},n(function(){e.paused||s()},1e4);var u=0;e.onMouseEnter=d,e.onMouseLeave=c}function n(e,i,t,n,o,r,a,l){function s(i,t){var n=i;return{options:{id:n,floor:0,step:.1,precision:1,ceil:1,translate:function(e){return e},onEnd:function(i){e.item.$profile="Custom";var n=t.TimeWeighting+t.RatingWeighting+t.FairnessWeighting+t.GreenWeighting+t.EmptyWeighting;n>1&&(t[i]=Math.max(t[i]-(n-1),0))}}}}function d(i){var t="Custom";for(var n in e.profiles){var o=e.profiles[n];o[0]==i.TimeWeighting&&o[1]==i.GreenWeighting&&o[2]==i.FairnessWeighting&&o[3]==i.RatingWeighting&&o[4]==i.EmptyWeighting&&(t=n)}return t}function c(){e.viewMode="EDIT"}function g(){var i=e.overrides,t=e.item.OverrideMode,n=e.profiles;o.open({size:"lg",templateUrl:"/webapp/management/settings/dispatch/override.modal.html",controller:["$scope","$modalInstance","rOverride","rClients","$filter",function(e,o,r,a,l){function d(){e.week.filter(function(e){return 1==e.selected}).length>0?e.item.DaysOfWeek=e.week.reduce(function(e,i){return i.selected?e+i.value:e},0):e.item.DaysOfWeek=null,"All"==e.item.PaymentType&&(e.item.PaymentType=null);moment.utc().startOf("day");if(e.item.$startTime&&e.item.$endTime){var t=moment.utc(e.item.$startTime),n=moment.utc(e.item.$endTime);e.item.StartTime=0+60*t.hours()+t.minutes(),e.item.EndTime=0+60*n.hours()+n.minutes(),0===e.item.EndTime&&(e.item.EndTime=1440),e.item.EndTime<e.item.StartTime&&(e.item.EndTime=e.item.EndTime+1440)}e.item.$save().then(function(t){swal("Success","Dispatch Override Saved","success"),i.push(e.item),e.item.ClientId&&(e.item.Client=e.clients.find(function(i){return i.Id==e.item.ClientId})),e.item.DaysOfWeek=t.data.DaysOfWeek,o.dismiss()})}function c(){o.dismiss()}function g(i){i&&i.length>2?e.fetchedClients=l("filter")(e.clients,{Name:i}):e.fetchedClients=[]}e.item=r,e.item.$profile="NearestFirst",e.clients=a,e.fetchedClients=[],e.overrideMode=t,e.profiles=n,e.week=[{day:"Mo",value:2,selected:!1,full:"Monday"},{day:"Tu",value:4,selected:!1,full:"Tuesday"},{day:"We",value:8,selected:!1,full:"Wednesday"},{day:"Th",value:16,selected:!1,full:"Thursday"},{day:"Fr",value:32,selected:!1,full:"Friday"},{day:"Sa",value:64,selected:!1,full:"Saturday"},{day:"Su",value:1,selected:!1,full:"Sunday"}],e.verticalSlider={TimeWeighting:s("TimeWeighting",e.item),GreenWeighting:s("GreenWeighting",e.item),FairnessWeighting:s("FairnessWeighting",e.item),EmptyWeighting:s("EmptyWeighting",e.item),RatingWeighting:s("RatingWeighting",e.item)},e.save=d,e.cancel=c,e.searchClients=g,e.$watch("item.$profile",function(i){if(i&&"Custom"!=i){var t=e.profiles[i];e.item.TimeWeighting=t[0],e.item.GreenWeighting=t[1],e.item.FairnessWeighting=t[2],e.item.RatingWeighting=t[3],e.item.EmptyWeighting=t[4]}})}],resolve:{rOverride:function(){return new a.DispatchOverrides({Strength:10,PaymentType:"All",TimeWeighting:1,GreenWeighting:0,FairnessWeighting:0,RatingWeighting:0,EmptyWeighting:0})},rClients:["Model",function(e){return e.Client.query().select("Id,Name").execute()}]}})}function u(i){var t=e.overrides,n=e.item.OverrideMode,r=e.profiles;o.open({size:"lg",templateUrl:"/webapp/management/settings/dispatch/override.modal.html",controller:["$scope","$modalInstance","rOverride","rClients","$filter",function(e,i,o,a,l){function d(){if(e.week.filter(function(e){return 1==e.selected}).length>0?e.item.DaysOfWeek=e.week.reduce(function(e,i){return i.selected?e+i.value:e},0):e.item.DaysOfWeek=null,"All"==e.item.PaymentType&&(e.item.PaymentType=null),e.item.$startTime&&e.item.$endTime){var t=moment.utc(e.item.$startTime),n=moment.utc(e.item.$endTime);e.item.StartTime=0+60*t.hours()+t.minutes(),e.item.EndTime=0+60*n.hours()+n.minutes(),0===e.item.EndTime&&(e.item.EndTime=1440),e.item.EndTime<e.item.StartTime&&(e.item.EndTime=e.item.EndTime+1440)}e.item.$patch().then(function(t){swal("Success","Dispatch Override Saved","success"),e.item.ClientId&&(e.item.Client=e.clients.find(function(i){return i.Id==e.item.ClientId})),e.item.DaysOfWeek=t.data.DaysOfWeek,i.dismiss()})}function c(){e.item.$rollback(),i.dismiss()}function g(i){i&&i.length>2?e.fetchedClients=l("filter")(e.clients,{Name:i}):e.fetchedClients=[]}function u(){e.item.$delete().then(function(){swal("Success","Dispatch Override Deleted","success");var n=t.indexOf(e.item);t.splice(n,1),i.dismiss()})}e.item=o,e.item.PaymentType||(e.item.PaymentType="All"),e.item.StartTime&&(e.item.$startTime=moment.utc().startOf("day").add(e.item.StartTime,"minutes").toDate()),e.item.EndTime&&(e.item.$endTime=moment.utc().startOf("day").add(e.item.EndTime,"minutes").toDate()),e.clients=a,e.fetchedClients=a,e.overrideMode=n,e.profiles=r,e.verticalSlider={TimeWeighting:s("TimeWeighting",e.item),GreenWeighting:s("GreenWeighting",e.item),FairnessWeighting:s("FairnessWeighting",e.item),EmptyWeighting:s("EmptyWeighting",e.item),RatingWeighting:s("RatingWeighting",e.item)},e.week=[{day:"Mo",value:2,selected:e.item.DaysOfWeek&&e.item.DaysOfWeek.indexOf("Monday")!=-1,full:"Monday"},{day:"Tu",value:4,selected:e.item.DaysOfWeek&&e.item.DaysOfWeek.indexOf("Tuesday")!=-1,full:"Tuesday"},{day:"We",value:8,selected:e.item.DaysOfWeek&&e.item.DaysOfWeek.indexOf("Wednesday")!=-1,full:"Wednesday"},{day:"Th",value:16,selected:e.item.DaysOfWeek&&e.item.DaysOfWeek.indexOf("Thursday")!=-1,full:"Thursday"},{day:"Fr",value:32,selected:e.item.DaysOfWeek&&e.item.DaysOfWeek.indexOf("Friday")!=-1,full:"Friday"},{day:"Sa",value:64,selected:e.item.DaysOfWeek&&e.item.DaysOfWeek.indexOf("Saturday")!=-1,full:"Saturday"},{day:"Su",value:1,selected:e.item.DaysOfWeek&&e.item.DaysOfWeek.indexOf("Sunday")!=-1,full:"Sunday"}],e.save=d,e.cancel=c,e.deleteOverride=u,e.searchClients=g,e.$watch("item.$profile",function(i){if(i&&"Custom"!=i){var t=e.profiles[i];e.item.TimeWeighting=t[0],e.item.GreenWeighting=t[1],e.item.FairnessWeighting=t[2],e.item.RatingWeighting=t[3],e.item.EmptyWeighting=t[4]}})}],resolve:{rOverride:function(){return i},rClients:["Model",function(e){return e.Client.query().select("Id,Name").execute()}]}})}function m(){var i=e.ranks;o.open({size:"lg",templateUrl:"/webapp/management/settings/dispatch/rank.modal.html",controller:["$scope","$modalInstance","rOverride","rZones",function(e,t,n,o){function r(){if(e.week.filter(function(e){return 1==e.selected}).length>0?e.item.DaysOfWeek=e.week.reduce(function(e,i){return i.selected?e+i.value:e},0):e.item.DaysOfWeek=null,e.item.$startTime&&e.item.$endTime){var n=moment.utc(e.item.$startTime),o=moment.utc(e.item.$endTime);e.item.StartTime=0+60*n.hours()+n.minutes(),e.item.EndTime=0+60*o.hours()+o.minutes(),0===e.item.EndTime&&(e.item.EndTime=1440),e.item.EndTime<e.item.StartTime&&(e.item.EndTime=e.item.EndTime+1440)}e.item.$save().then(function(n){swal("Success","Rank Saved","success"),e.item.Zone=e.zones.find(function(i){return i.Id==e.item.ZoneId}),i.push(e.item),e.item.DaysOfWeek=n.data.DaysOfWeek,t.dismiss()})}function a(){t.dismiss()}e.item=n,e.zones=o,e.save=r,e.cancel=a,e.week=[{day:"Mo",value:2,selected:!1,full:"Monday"},{day:"Tu",value:4,selected:!1,full:"Tuesday"},{day:"We",value:8,selected:!1,full:"Wednesday"},{day:"Th",value:16,selected:!1,full:"Thursday"},{day:"Fr",value:32,selected:!1,full:"Friday"},{day:"Sa",value:64,selected:!1,full:"Saturday"},{day:"Su",value:1,selected:!1,full:"Sunday"}]}],resolve:{rOverride:function(){return new a.DispatchOverrides({IsRank:!0})},rZones:["Model",function(e){return e.Zone.query().select("Id,Name,Description").execute()}]}})}function p(i){i.$delete().then(function(){swal("Deleted","Rank removed","success");var t=e.ranks.indexOf(i);e.ranks.splice(t,1)})}function h(i){i.Id?i.$patch().success(function(i){swal("Saved!","Dispatch Settings Saved","success"),e.viewMode="VIEW"}).error(function(){swal("Error!","Dispatch Settings could not be Saved","error")}):i.$save().success(function(t){i.Id=t.Id,swal("Saved!","Dispatch Settings Created","success"),e.viewMode="VIEW"}).error(function(){swal("Error!","Dispatch Settings could not be Saved","error")})}function f(i){i.$rollback(),e.viewMode="VIEW"}e.item=r[0]||new a.DispatchSettings,e.overrides=l.filter(function(e){return!e.IsRank}),e.ranks=l.filter(function(e){return e.IsRank}),e.item.$profile=d(e.item),e.show={advanced:!1},e.verticalSlider={TimeWeighting:s("TimeWeighting",e.item),GreenWeighting:s("GreenWeighting",e.item),FairnessWeighting:s("FairnessWeighting",e.item),EmptyWeighting:s("EmptyWeighting",e.item),RatingWeighting:s("RatingWeighting",e.item)},e.profiles={NearestFirst:[1,0,0,0,0],EmptyLongest:[.3,0,0,0,.7],BalanceEarnings:[.3,0,.5,0,.2],Balanced:[.5,0,.2,.1,.2],BestDriver:[.3,0,.1,.4,.2],LowEmissions:[.6,.4,0,0,0],Custom:[0,0,0,0,0]};for(var b=0;b<e.overrides.length;b++)e.overrides[b].$profile=d(e.overrides[b]);e.viewMode="VIEW",e.reset=f,e.startEdit=c,e.saveEdits=h,e.addOverride=g,e.editOverride=u,e.addRank=m,e.removeRank=p,e.$watch("item.$profile",function(i){if(i&&"Custom"!=i){var t=e.profiles[i];e.item.TimeWeighting=t[0],e.item.GreenWeighting=t[1],e.item.FairnessWeighting=t[2],e.item.RatingWeighting=t[3],e.item.EmptyWeighting=t[4]}})}var o=angular.module("cab9.settings");o.controller("SettingsDispatchController",e),o.controller("SettingsDispatchTesterController",i),o.controller("SettingsDispatchLiveController",t),o.controller("SettingsDispatchDetailsController",n),e.$inject=["$scope","rData","rAccessors","rTabs","$http","$config"],i.$inject=["$scope","rData","Model","$timeout","rCompany","$http","$config","rClients"],t.$inject=["$scope","rData","Model","$interval","rCompany","$http","$config","rClients"],n.$inject=["$scope","$state","$q","$UI","$modal","rData","Model","rOverrides"]}();;;;
!function(e){function n(e,n,t,r){e.requirements=n,e.viewItem=function(e){t.open({templateUrl:"/webapp/management/settings/specialrequirements/modal.html",resolve:{rBReq:function(){return e}},controller:["$scope","$modalInstance","rBReq",function(e,n,t){e.requirement=t,e.save=function(){e.requirement.$patch().then(function(e){swal("Success","Requirement changed successfully.","success"),n.close()},function(e){swal("Error","Something didn't work, please check input and try again","error")})}}]})},e.deleteItem=function(e){swal({title:"Are you sure?",text:"This req. will be deleted permanentaly",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},function(){e.$delete().success(function(){r.go("root.settings.specialrequirements",null,{reload:!0})})})}}var t=e.module("cab9.settings");t.controller("SpecialRequirementsController",n),n.$inject=["$scope","rBRequirements","$modal","$state"]}(angular);;;;
!function(n){function o(n,o){function c(){n.viewMode="EDIT"}function t(){n.company.$rollback(!1),n.viewMode="VIEW"}function e(){n.company.$patch().success(function(){n.viewMode="VIEW"})}n.company=o[0],n.viewMode="VIEW",n.startEdit=c,n.cancelEdit=t,n.saveEdits=e}var c=n.module("cab9.settings");c.controller("SettingsBookingFormController",o),o.$inject=["$scope","rCompany"]}(angular);;;;
!function(e){function n(e,n,t,o,r,i,s,p){function l(){var e=s.open({templateUrl:"/webapp/management/settings/booking/expenses/modal/partial.html",controller:"BookingExpenseTypeCreateController",resolve:{rbookingExpenseType:function(){var e=new r.BookingExpenseType;return e},rTaxes:["Model",function(e){return e.Tax.query().where("TenantId","eq","guid'"+p.getSession().TenantId+"'").execute()}]}});e.result.then(function(e){x()})}function a(e){var n=s.open({templateUrl:"/webapp/management/settings/booking/expenses/modal/partial.html",controller:"BookingExpenseTypeEditController",resolve:{rbookingExpenseType:function(){var n=new r.BookingExpenseType(e);return n},rTaxes:["Model",function(e){return e.Tax.query().where("TenantId","eq","guid'"+p.getSession().TenantId+"'").execute()}]}});n.result.then(function(e){x()})}function u(e){swal({title:"Are you sure?",text:"This expense type will bepermanentely deleted.",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm",closeOnConfirm:!1},function(){var n=new r.BookingExpenseType(e);n.$delete().then(function(e){swal("Expense Type Deleted","This expense type has been permanentely deleted.","info"),x()},function(e){swal("Delete Error","There was an error with deleting this expense type. This might already be used on one or more bookings.","error")})})}function x(){r.BookingExpenseType.query().include("Tax").execute().then(function(n){e.bookingExpenses=n,e.$apply()})}e.bookingExpenses=i,e.addExpenseType=l,e.editExpenseType=a,e.deleteExpenseType=u}var t=e.module("cab9.settings");t.controller("SettingsBookingExpensesController",n),n.$inject=["$scope","$http","$config","$q","Model","rExpenses","$modal","Auth"]}(angular);;;;
!function(e){function o(e,o,n,r,t,s,c,a,p){function i(){e.bookingExpenseType.$patch().then(function(e){swal("Expense Type Updated","This expense type has been updated.","success"),n.close()},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:o.COLOURS.brandSecondary})})}e.bookingExpenseType=c,e.Taxes=a,e.save=i,e.edit=!0}function n(e,o,n,r,t,s,c,a){function p(){e.bookingExpenseType.$save().then(function(e){swal("Expense Type Saved","This expense type has been saved.","success"),n.close()},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:o.COLOURS.brandSecondary})})}e.bookingExpenseType=c,e.Taxes=a,e.save=p}var r=e.module("cab9.settings");r.controller("BookingExpenseTypeCreateController",n),r.controller("BookingExpenseTypeEditController",o),n.$inject=["$scope","$UI","$modalInstance","$config","$q","Model","rbookingExpenseType","rTaxes","Auth"],o.$inject=["$scope","$UI","$modalInstance","$config","$q","Model","rbookingExpenseType","rTaxes","Auth"]}(angular);;;;
!function(e){function n(e,n,t,o,i,r,a,u,l,c,s,d,f){function m(e,n){var t=1,o=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),"-"===n[0]&&(o=-1,n=n.substr(1)),function(i,r){var a=i[e]<r[e]?-1:i[e]>r[e]?1:0;return a*=t,0==a&&(a=i[n]<r[n]?-1:i[n]>r[n]?1:0,a*=o),a}}function g(){e.viewMode="EDIT"}function p(){e.companyBiddingConfig.$rollback(!1),e.viewMode="VIEW"}function y(){void 0!=e.companyBiddingConfig&&void 0!=e.companyBiddingConfig.Id?e.companyBiddingConfig.$patch().success(function(){e.viewMode="VIEW",location.reload()}):(e.companyBiddingConfig.TenantId=u.getSession().TenantId,l.post($config.API_ENDPOINT+"api/companyBiddingConfigs",e.companyBiddingConfig).success(function(){e.viewMode="VIEW",location.reload()}).error(function(n){e.viewMode="VIEW",swal("Error","Please try again or contact admin","error")}))}function C(e){swal({title:"Are you sure?",text:"Are you sure you want to delete the Automation rule?",type:"warning",showCancelButton:!0,confirmButtonColor:s.COLOURS.brandPrimary,confirmButtonText:"Confirm Delete",closeOnConfirm:!0},function(){l({method:"DELETE",url:$config.API_ENDPOINT+"api/Bid/automation-rules?automationRuleId="+e}).then(function(e){swal("Automation Rule Deleted","The automation rule has been deleted.","success"),location.reload()},function(e){swal("An Error Occurred.",e.ExceptionMessage?e.ExceptionMessage:"There was an error. Please try again.","error")})},function(){swal("Error!","Some Issue while deleting.","error")})}function v(e){swal({title:"Are you sure?",text:"Are you sure you want to deactivate the Automation rule?",type:"warning",showCancelButton:!0,confirmButtonColor:s.COLOURS.brandPrimary,confirmButtonText:"Confirm Deactivate",closeOnConfirm:!0},function(){l({method:"POST",url:$config.API_ENDPOINT+"api/Bid/deactivate-rule?ruleId="+e}).then(function(e){swal("Automation Rule Deactivated","The automation rule has been Deactivated.","success"),location.reload()},function(e){swal("An Error Occurred.",e.Message?e.Message:"There was an error. Please try again.","error")})},function(){swal("Error!","Some Issue while deactivating rule.","error")})}function h(e){swal({title:"Are you sure?",text:"Are you sure you want to activate the Automation rule?",type:"warning",showCancelButton:!0,confirmButtonColor:s.COLOURS.brandPrimary,confirmButtonText:"Confirm Activate",closeOnConfirm:!0},function(){l({method:"POST",url:$config.API_ENDPOINT+"api/Bid/activate-rule?ruleId="+e}).then(function(e){swal("Automation Rule activated","The automation rule has been Activated.","success"),location.reload()},function(e){swal("An Error Occurred.",e.Message?e.Message:"There was an error. Please try again.","error")})},function(){swal("Error!","Some Issue while activating rule.","error")})}function w(){var n=new c.BiddingFilter;n.$StartPeriodType="HOURS",n.$EndPeriodType="DAYS",d.open({templateUrl:"/webapp/management/settings/company/auction-config/modals/create-edit.partial.html",controller:"CreateEditAutomationRuleModalController",size:"lg",resolve:{rAutomationRule:function(){return n},rClients:function(){return e.clients},rVehicleTypes:function(){return e.vehicleTypes},rDriverTypes:function(){return e.driverTypes},rMode:function(){return"CREATE"},rLinkedDriverTypes:function(){return null}}})}function E(n){n.exclusionRules=e.exclusionRules.filter(function(e){return e.BiddingFilterId==n.Id}),d.open({templateUrl:"/webapp/management/settings/company/auction-config/modals/create-edit-exclusion.partial.html",controller:"CreateEditExclusionRuleModalController",size:"lg",resolve:{rAutomationRule:function(){return n}}})}function A(n){d.open({templateUrl:"/webapp/management/settings/company/auction-config/modals/create-edit.partial.html",controller:"CreateEditAutomationRuleModalController",size:"lg",resolve:{rAutomationRule:function(){return n},rAutoAllocationRule:function(){return null},rClients:function(){return e.clients},rVehicleTypes:function(){return e.vehicleTypes},rDriverTypes:function(){return e.driverTypes},rMode:function(){return"EDIT"},rLinkedDriverTypes:["$http","$config",function(e,t){return e({method:"GET",url:t.API_ENDPOINT+"/api/Bid/rule-linked-driverTypes?ruleId="+n.Id}).then(function(e){return e.data},function(e){swal("Error","There was some error trying to fetch the driver types.","error")})}]}})}function T(){e.companyBiddingConfig.EnableBidding||(e.companyBiddingConfig.EnableAuctionBidding=!1)}e.company=n[0],e.companyBiddingConfig=t[0],e.automationRules=o.sort(m("-Active","ClientName")),e.clients=i,e.driverTypes=a,e.vehicleTypes=r,e.exclusionRules=f,void 0==e.companyBiddingConfig&&(e.companyBiddingConfig=new c.CompanyBiddingConfig),e.viewMode="VIEW",e.ruleViewMode="VIEW",e.startEdit=g,e.startRuleEdit=w,e.cancelEdit=p,e.saveEdits=y,e.deleteAutomationRule=C,e.ChangeAuctionBiddingSetting=T,e.deactivateAutomationRule=v,e.activateAutomationRule=h,e.editAutomationRule=A,e.openExclusionsModal=E}var t=e.module("cab9.settings");t.controller("SettingsAuctionConfigController",n),n.$inject=["$scope","rCompany","rCompanyBiddingConfig","rBiddingAutomationRules","rClients","rVehicleTypes","rDriverTypes","Auth","$http","Model","$UI","$modal","rExclusionRules"]}(angular);;;;
!function(e){function t(e,t,r,o,n,l,i,a,u,c,s){function d(){e.ruleViewMode="EDIT";var t=new a.BiddingFilter;t.$StartPeriodType="HOURS",t.$EndPeriodType="DAYS",c.open({templateUrl:"/webapp/management/settings/company/auto-allocation/modals/create-edit.partial.html",controller:"CreateEditAllocationRuleModalController",size:"lg",resolve:{rAllocationRule:function(){return t},rClients:function(){return e.clients},rVehicleTypes:function(){return e.vehicleTypes},rDriverTypes:function(){return e.driverTypes},rMode:function(){return"CREATE"},rLinkedDriverTypes:function(){return null}}})}function f(){e.newRule=new a.BiddingFilter,e.ruleViewMode="VIEW"}function p(e){var t=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),function(r,o){var n=r[e]<o[e]?-1:r[e]>o[e]?1:0;return n*t}}function A(e){swal({title:"Are you sure?",text:"Are you sure you want to delete the Auto Allocation rule?",type:"warning",showCancelButton:!0,confirmButtonColor:u.COLOURS.brandPrimary,confirmButtonText:"Confirm Delete",closeOnConfirm:!0},function(){i({method:"DELETE",url:$config.API_ENDPOINT+"api/allocation-rules/delete-rule?ruleId="+e}).then(function(e){swal("Auto Allocation Rule Deleted","The auto allocation rule has been deleted.","success"),location.reload()},function(e){swal("An Error Occurred.",e.ExceptionMessage?e.ExceptionMessage:"There was an error. Please try again.","error")})},function(){swal("Error!","Some Issue while deleting.","error")})}function m(e){swal({title:"Are you sure?",text:"Are you sure you want to deactivate the Allocation rule?",type:"warning",showCancelButton:!0,confirmButtonColor:u.COLOURS.brandPrimary,confirmButtonText:"Confirm Deactivate",closeOnConfirm:!0},function(){i({method:"POST",url:$config.API_ENDPOINT+"api/allocation-rules/deactivate-rule?ruleId="+e}).then(function(e){swal("Allocation Rule Deactivated","The allocation rule has been Deactivated.","success"),location.reload()},function(e){swal("An Error Occurred.",e.Message?e.Message:"There was an error. Please try again.","error")})},function(){swal("Error!","Some Issue while deactivating rule.","error")})}function h(t){t.exclusionRules=e.exclusionRules.filter(function(e){return e.AutoAllocationRuleId==t.Id}),c.open({templateUrl:"/webapp/management/settings/company/auto-allocation/modals/create-edit-exclusion.partial.html",controller:"CreateEditAllocationExclusionRuleModalController",size:"lg",resolve:{rAllocationRule:function(){return t}}})}function y(e){swal({title:"Are you sure?",text:"Are you sure you want to activate the Allocation rule?",type:"warning",showCancelButton:!0,confirmButtonColor:u.COLOURS.brandPrimary,confirmButtonText:"Confirm Activate",closeOnConfirm:!0},function(){i({method:"POST",url:$config.API_ENDPOINT+"api/allocation-rules/activate-rule?ruleId="+e}).then(function(e){swal("Allocation Rule activated","The allocation rule has been Activated.","success"),location.reload()},function(e){swal("An Error Occurred.",e.Message?e.Message:"There was an error. Please try again.","error")})},function(){swal("Error!","Some Issue while activating rule.","error")})}function w(t){c.open({templateUrl:"/webapp/management/settings/company/auto-allocation/modals/create-edit.partial.html",controller:"CreateEditAllocationRuleModalController",size:"lg",resolve:{rAllocationRule:function(){return t},rClients:function(){return e.clients},rVehicleTypes:function(){return e.vehicleTypes},rDriverTypes:function(){return e.driverTypes},rMode:function(){return"EDIT"},rLinkedDriverTypes:["$http","$config",function(e,r){return e({method:"GET",url:r.API_ENDPOINT+"/api/allocation-rules/linked-driverTypes?ruleId="+t.Id}).then(function(e){return e.data},function(e){swal("Error","There was some error trying to fetch the driver types.","error")})}]}})}e.autoAllocationRules=t.sort(p("-Active")),e.clients=r,e.driverTypes=n,e.vehicleTypes=o,e.exclusionRules=s,e.ruleViewMode="VIEW",e.startRuleEdit=d,e.cancelRuleEdit=f,e.deleteAutoAllocationRule=A,e.editAutoAllocationRule=w,e.activateAllocationRule=y,e.deactivateAllocationRule=m,e.openExclusionsModal=h}var r=e.module("cab9.settings");r.controller("SettingsAutoAllocationController",t),t.$inject=["$scope","rAutoAllocationRules","rClients","rVehicleTypes","rDriverTypes","Auth","$http","Model","$UI","$modal","rExclusionRules"]}(angular);;;;
!function(n){function o(n,o,e,a,i,t,l){function c(){n.viewMode="EDIT"}function g(){n.companyFlagdownConfig.$rollback(!1),n.viewMode="VIEW"}function d(o){o&&t.ClientStaff.query().where("ClientId eq Guid'"+o+"'").select("Id, Firstname, Surname").parseAs(function(n){return{Id:n.Id,Name:n.Firstname+" "+n.Surname}}).execute().then(function(o){n.clientStaffs.length=0,[].push.apply(n.clientStaffs,o)})}function s(o){o&&t.Passenger.query().where("ClientId eq Guid'"+o+"'").select("Id, Firstname, Surname").parseAs(function(n){return{Id:n.Id,Name:n.Firstname+" "+n.Surname}}).execute().then(function(o){n.passengers.length=0,[].push.apply(n.passengers,o)})}function f(){n.companyFlagdownConfig.FlagDown===!1&&(n.companyFlagdownConfig.ClientId=null,n.companyFlagdownConfig.ClientStaffId=null,n.companyFlagdownConfig.PassengerId=null),void 0!=n.companyFlagdownConfig&&void 0!=n.companyFlagdownConfig.Id?n.companyFlagdownConfig.$patch().success(function(){n.viewMode="VIEW",location.reload()}):(n.companyFlagdownConfig.TenantId=a.getSession().TenantId,i.post($config.API_ENDPOINT+"api/FlagDownConfigurations",n.companyFlagdownConfig).success(function(){n.viewMode="VIEW",location.reload()}).error(function(o){n.viewMode="VIEW",swal("Error","Please try again or contact admin","error")}))}n.clients=e,n.companyFlagdownConfig=o[0],n.clientStaffs=[],n.passengers=[],n.viewMode="VIEW",n.startEdit=c,n.cancelEdit=g,n.saveEdits=f,n.fetchBookers=d,n.fetchPassengers=s,void 0==n.companyFlagdownConfig?(n.companyFlagdownConfig=new t.FlagDownConfiguration,n.companyFlagdownConfig.FlagDown=!1):(d(n.companyFlagdownConfig.ClientId),s(n.companyFlagdownConfig.ClientId)),n.$watch("companyFlagdownConfig.ClientId",function(o,e){e!==o&&(n.companyFlagdownConfig.ClientStaffId=null,n.companyFlagdownConfig.PassengerId=null,d(o),s(o))})}var e=n.module("cab9.settings");e.controller("FlagDownConfigurationController",o),o.$inject=["$scope","rCompanyFlagDownConfig","rClients","Auth","$http","Model","$UI"]}(angular);;;;
!function(e){function t(e,t,o,a,i,u,r,n,l,d,s,m){function c(){e.$ruleSaving=!0,"Callsign"===e.automationRule.$DriverMode?(e.automationRule.DriverTypes=[],e.automationRule.$selectedDriverTypes=[]):(e.automationRule.DriverIdentifier=null,e.automationRule.DriverTypes=e.driverTypes.filter(function(t){return e.automationRule.$selectedDriverTypes.includes(t.Id)})),e.automationRule.StartPeriod=e.automationRule.$StartPeriodValue*("HOURS"==e.automationRule.$StartPeriodType?1:24),e.automationRule.EndPeriod=e.automationRule.$EndPeriodValue*("HOURS"==e.automationRule.$EndPeriodType?1:24),l.put($config.API_ENDPOINT+"api/Bid/automation-rules?ruleId="+e.automationRule.Id,e.automationRule).success(function(){e.$ruleSaving=!1,swal("Automation Rule Updated","The automation rule has been updated. It will be active effective immediately.","success"),location.reload()}).error(function(t){e.$ruleSaving=!1,swal("An Error Occurred.",t.ExceptionMessage?t.ExceptionMessage:"There was an error. Please try again.","error")})}function R(){e.$automationRuleSaving=!0,e.automationRule.$$changedValues.DriverTypes=e.driverTypes.filter(function(t){return e.automationRule.$selectedDriverTypes.includes(t.Id)}),e.automationRule.StartPeriod=e.automationRule.$StartPeriodValue*("HOURS"==e.automationRule.$StartPeriodType?1:24),e.automationRule.EndPeriod=e.automationRule.$EndPeriodValue*("HOURS"==e.automationRule.$EndPeriodType?1:24),l.post($config.API_ENDPOINT+"api/Bid/automation-rules",e.automationRule.$$changedValues).success(function(){e.$newRuleSaving=!1,e.ruleViewMode="VIEW",swal("Automation Rule Added","The automation rule has been added. It will be active effective immediately.","success"),location.reload()}).error(function(t){e.$newRuleSaving=!1,swal("An Error Occurred.",t.ExceptionMessage?t.ExceptionMessage:"There was an error. Please try again.","error")})}if(e.automationRule=t,e.clients=a,e.driverTypes=u,e.vehicleTypes=i,e.mode=o,"EDIT"==e.mode){e.automationRule.$StartPeriodType="HOURS",e.automationRule.$EndPeriodType="HOURS",e.automationRule.$StartPeriodValue=e.automationRule.StartPeriod,e.automationRule.$EndPeriodValue=e.automationRule.EndPeriod;var p=r.map(function(e){return e.Id});e.automationRule.$selectedDriverTypes=e.driverTypes.filter(function(e){return p.includes(e.Id)})}else e.automationRule.$selectedDriverTypes=[];e.updateAutomationRule=c,e.saveAutomationRule=R,null!=e.automationRule&&(e.automationRule.DriverIdentifier?e.automationRule.$DriverMode="Callsign":e.automationRule.$DriverMode="DriverType")}var o=e.module("cab9.settings");o.controller("CreateEditAutomationRuleModalController",t),t.$inject=["$scope","rAutomationRule","rMode","rClients","rVehicleTypes","rDriverTypes","rLinkedDriverTypes","Auth","$http","Model","$UI","$modal"]}(angular);;;;
!function(e){function u(e,u,l,n,s,i,c){function a(){e.ruleViewMode="VIEW"}function d(u){u.$delete().then(function(){swal("Success","Exclusion rule Deleted","success");var l=e.exclusionRules.indexOf(u);e.exclusionRules.splice(l,1),location.reload()})}function o(){e.ruleViewMode="CREATE",e.week=[{day:"Mo",value:2,selected:!1,full:"Monday"},{day:"Tu",value:4,selected:!1,full:"Tuesday"},{day:"We",value:8,selected:!1,full:"Wednesday"},{day:"Th",value:16,selected:!1,full:"Thursday"},{day:"Fr",value:32,selected:!1,full:"Friday"},{day:"Sa",value:64,selected:!1,full:"Saturday"},{day:"Su",value:1,selected:!1,full:"Sunday"}]}function t(u){e.ruleViewMode="EDIT",e.exclusionRule=u,e.exclusionRule.StartTime&&(e.exclusionRule.$startTime=moment.utc().startOf("day").add(e.exclusionRule.StartTime,"minutes").toDate()),e.exclusionRule.EndTime&&(e.exclusionRule.$endTime=moment.utc().startOf("day").add(e.exclusionRule.EndTime,"minutes").toDate()),e.week=[{day:"Mo",value:2,selected:e.exclusionRule.DaysOfWeek&&e.exclusionRule.DaysOfWeek.indexOf("Monday")!=-1,full:"Monday"},{day:"Tu",value:4,selected:e.exclusionRule.DaysOfWeek&&e.exclusionRule.DaysOfWeek.indexOf("Tuesday")!=-1,full:"Tuesday"},{day:"We",value:8,selected:e.exclusionRule.DaysOfWeek&&e.exclusionRule.DaysOfWeek.indexOf("Wednesday")!=-1,full:"Wednesday"},{day:"Th",value:16,selected:e.exclusionRule.DaysOfWeek&&e.exclusionRule.DaysOfWeek.indexOf("Thursday")!=-1,full:"Thursday"},{day:"Fr",value:32,selected:e.exclusionRule.DaysOfWeek&&e.exclusionRule.DaysOfWeek.indexOf("Friday")!=-1,full:"Friday"},{day:"Sa",value:64,selected:e.exclusionRule.DaysOfWeek&&e.exclusionRule.DaysOfWeek.indexOf("Saturday")!=-1,full:"Saturday"},{day:"Su",value:1,selected:e.exclusionRule.DaysOfWeek&&e.exclusionRule.DaysOfWeek.indexOf("Sunday")!=-1,full:"Sunday"}]}function x(){if(e.week.filter(function(e){return 1==e.selected}).length>0?e.exclusionRule.DaysOfWeek=e.week.reduce(function(e,u){return u.selected?e+u.value:e},0):e.exclusionRule.DaysOfWeek=null,e.exclusionRule.$startTime&&e.exclusionRule.$endTime){var u=moment.utc(e.exclusionRule.$startTime),l=moment.utc(e.exclusionRule.$endTime);e.exclusionRule.StartTime=0+60*u.hours()+u.minutes(),e.exclusionRule.EndTime=0+60*l.hours()+l.minutes(),0===e.exclusionRule.EndTime&&(e.exclusionRule.EndTime=1440),e.exclusionRule.EndTime<e.exclusionRule.StartTime&&(e.exclusionRule.EndTime=e.exclusionRule.EndTime+1440)}e.exclusionRule.BiddingFilterId=e.rule.Id,e.exclusionRule.$save().then(function(u){swal("Success","Exclusion Rule Saved","success"),e.ruleViewMode="VIEW",location.reload()})}function R(){if(e.week.filter(function(e){return 1==e.selected}).length>0?e.exclusionRule.DaysOfWeek=e.week.reduce(function(e,u){return u.selected?e+u.value:e},0):e.exclusionRule.DaysOfWeek=null,e.exclusionRule.$startTime&&e.exclusionRule.$endTime){var u=moment.utc(e.exclusionRule.$startTime),l=moment.utc(e.exclusionRule.$endTime);e.exclusionRule.StartTime=0+60*u.hours()+u.minutes(),e.exclusionRule.EndTime=0+60*l.hours()+l.minutes(),0===e.exclusionRule.EndTime&&(e.exclusionRule.EndTime=1440),e.exclusionRule.EndTime<e.exclusionRule.StartTime&&(e.exclusionRule.EndTime=e.exclusionRule.EndTime+1440)}e.exclusionRule.$save().then(function(u){swal("Success","Exclusion Rule Updated","success"),e.ruleViewMode="VIEW",location.reload()})}e.rule=u,e.exclusionRules=0!=e.rule.exclusionRules.length?e.rule.exclusionRules:[],e.ruleViewMode="VIEW",e.exclusionRule=new s.BiddingExclusionRule,e.addRule=o,e.saveRule=x,e.editRule=t,e.deleteRule=d,e.updateRule=R,e.cancel=a}var l=e.module("cab9.settings");l.controller("CreateEditExclusionRuleModalController",u),u.$inject=["$scope","rAutomationRule","Auth","$http","Model","$UI","$modal"]}(angular);;;;
!function(e){function l(e,l,o,a,i,r,t,n,u,c,d,s){function R(){e.$ruleSaving=!0,"Callsign"===e.allocationRule.$DriverMode?(e.allocationRule.DriverTypes=[],e.allocationRule.$selectedDriverTypes=[]):(e.allocationRule.DriverIdentifier=null,e.allocationRule.DriverTypes=e.driverTypes.filter(function(l){return e.allocationRule.$selectedDriverTypes.includes(l.Id)})),e.allocationRule.StartPeriod=e.allocationRule.$StartPeriodValue*("HOURS"==e.allocationRule.$StartPeriodType?1:24),e.allocationRule.EndPeriod=e.allocationRule.$EndPeriodValue*("HOURS"==e.allocationRule.$EndPeriodType?1:24),u.put($config.API_ENDPOINT+"api/allocation-rules/update-rule?ruleId="+e.allocationRule.Id,e.allocationRule).success(function(){e.$ruleSaving=!1,swal("Allocation Rule Updated","The automation rule has been updated. It will be active effective immediately.","success"),location.reload()}).error(function(l){e.$ruleSaving=!1,swal("An Error Occurred.",l.ExceptionMessage?l.ExceptionMessage:"There was an error. Please try again.","error")})}function p(){e.$allocationRuleSaving=!0,e.allocationRule.StartPeriod=e.allocationRule.$StartPeriodValue*("HOURS"==e.allocationRule.$StartPeriodType?1:24),e.allocationRule.EndPeriod=e.allocationRule.$EndPeriodValue*("HOURS"==e.allocationRule.$EndPeriodType?1:24),e.allocationRule.$$changedValues.DriverTypes=e.driverTypes.filter(function(l){return e.allocationRule.$selectedDriverTypes.includes(l.Id)}),u.post($config.API_ENDPOINT+"api/allocation-rules/add-rule",e.allocationRule.$$changedValues).success(function(){e.$allocationRuleSaving=!1,e.ruleViewMode="VIEW",swal("Auto Allocation Rule Added","The auto allocation rule has been added. It will be active effective immediately.","success"),location.reload()}).error(function(l){e.$newRuleSaving=!1,swal("An Error Occurred.",l.ExceptionMessage?l.ExceptionMessage:"There was an error. Please try again.","error")})}if(e.allocationRule=l,e.clients=a,e.driverTypes=r,e.vehicleTypes=i,e.mode=o,"EDIT"==e.mode){e.allocationRule.$StartPeriodType="HOURS",e.allocationRule.$EndPeriodType="HOURS",e.allocationRule.$StartPeriodValue=e.allocationRule.StartPeriod,e.allocationRule.$EndPeriodValue=e.allocationRule.EndPeriod;var $=t.map(function(e){return e.Id});e.allocationRule.$selectedDriverTypes=e.driverTypes.filter(function(e){return $.includes(e.Id)})}else e.allocationRule.$selectedDriverTypes=[];e.updateAllocationRule=R,e.saveAllocationRule=p,null!=e.allocationRule&&(e.allocationRule.DriverIdentifier?e.allocationRule.$DriverMode="Callsign":e.allocationRule.$DriverMode="DriverType")}var o=e.module("cab9.settings");o.controller("CreateEditAllocationRuleModalController",l),l.$inject=["$scope","rAllocationRule","rMode","rClients","rVehicleTypes","rDriverTypes","rLinkedDriverTypes","Auth","$http","Model","$UI","$modal"]}(angular);;;;
!function(e){function l(e,l,u,n,s,i,c){function o(){e.ruleViewMode="VIEW"}function a(l){l.$delete().then(function(){swal("Success","Exclusion rule Deleted","success");var u=e.exclusionRules.indexOf(l);e.exclusionRules.splice(u,1),location.reload()})}function d(){e.ruleViewMode="CREATE",e.week=[{day:"Mo",value:2,selected:!1,full:"Monday"},{day:"Tu",value:4,selected:!1,full:"Tuesday"},{day:"We",value:8,selected:!1,full:"Wednesday"},{day:"Th",value:16,selected:!1,full:"Thursday"},{day:"Fr",value:32,selected:!1,full:"Friday"},{day:"Sa",value:64,selected:!1,full:"Saturday"},{day:"Su",value:1,selected:!1,full:"Sunday"}]}function t(l){e.ruleViewMode="EDIT",e.exclusionRule=l,e.exclusionRule.StartTime&&(e.exclusionRule.$startTime=moment.utc().startOf("day").add(e.exclusionRule.StartTime,"minutes").toDate()),e.exclusionRule.EndTime&&(e.exclusionRule.$endTime=moment.utc().startOf("day").add(e.exclusionRule.EndTime,"minutes").toDate()),e.week=[{day:"Mo",value:2,selected:e.exclusionRule.DaysOfWeek&&e.exclusionRule.DaysOfWeek.indexOf("Monday")!=-1,full:"Monday"},{day:"Tu",value:4,selected:e.exclusionRule.DaysOfWeek&&e.exclusionRule.DaysOfWeek.indexOf("Tuesday")!=-1,full:"Tuesday"},{day:"We",value:8,selected:e.exclusionRule.DaysOfWeek&&e.exclusionRule.DaysOfWeek.indexOf("Wednesday")!=-1,full:"Wednesday"},{day:"Th",value:16,selected:e.exclusionRule.DaysOfWeek&&e.exclusionRule.DaysOfWeek.indexOf("Thursday")!=-1,full:"Thursday"},{day:"Fr",value:32,selected:e.exclusionRule.DaysOfWeek&&e.exclusionRule.DaysOfWeek.indexOf("Friday")!=-1,full:"Friday"},{day:"Sa",value:64,selected:e.exclusionRule.DaysOfWeek&&e.exclusionRule.DaysOfWeek.indexOf("Saturday")!=-1,full:"Saturday"},{day:"Su",value:1,selected:e.exclusionRule.DaysOfWeek&&e.exclusionRule.DaysOfWeek.indexOf("Sunday")!=-1,full:"Sunday"}]}function x(){if(e.week.filter(function(e){return 1==e.selected}).length>0?e.exclusionRule.DaysOfWeek=e.week.reduce(function(e,l){return l.selected?e+l.value:e},0):e.exclusionRule.DaysOfWeek=null,e.exclusionRule.$startTime&&e.exclusionRule.$endTime){var l=moment.utc(e.exclusionRule.$startTime),u=moment.utc(e.exclusionRule.$endTime);e.exclusionRule.StartTime=0+60*l.hours()+l.minutes(),e.exclusionRule.EndTime=0+60*u.hours()+u.minutes(),0===e.exclusionRule.EndTime&&(e.exclusionRule.EndTime=1440),e.exclusionRule.EndTime<e.exclusionRule.StartTime&&(e.exclusionRule.EndTime=e.exclusionRule.EndTime+1440)}e.exclusionRule.AutoAllocationRuleId=e.rule.Id,e.exclusionRule.$save().then(function(l){swal("Success","Exclusion Rule Saved","success"),e.ruleViewMode="VIEW",location.reload()})}function R(){if(e.week.filter(function(e){return 1==e.selected}).length>0?e.exclusionRule.DaysOfWeek=e.week.reduce(function(e,l){return l.selected?e+l.value:e},0):e.exclusionRule.DaysOfWeek=null,e.exclusionRule.$startTime&&e.exclusionRule.$endTime){var l=moment.utc(e.exclusionRule.$startTime),u=moment.utc(e.exclusionRule.$endTime);e.exclusionRule.StartTime=0+60*l.hours()+l.minutes(),e.exclusionRule.EndTime=0+60*u.hours()+u.minutes(),0===e.exclusionRule.EndTime&&(e.exclusionRule.EndTime=1440),e.exclusionRule.EndTime<e.exclusionRule.StartTime&&(e.exclusionRule.EndTime=e.exclusionRule.EndTime+1440)}e.exclusionRule.$save().then(function(l){swal("Success","Exclusion Rule Updated","success"),e.ruleViewMode="VIEW",location.reload()})}e.rule=l,e.exclusionRules=0!=e.rule.exclusionRules.length?e.rule.exclusionRules:[],e.ruleViewMode="VIEW",e.exclusionRule=new s.BiddingExclusionRule,e.addRule=d,e.saveRule=x,e.editRule=t,e.deleteRule=a,e.updateRule=R,e.cancel=o}var u=e.module("cab9.settings");u.controller("CreateEditAllocationExclusionRuleModalController",l),l.$inject=["$scope","rAllocationRule","Auth","$http","Model","$UI","$modal"]}(angular);;;;
!function(e){function t(t,o,n,l,s,r,a){function i(){t.selected.merge={mode:"nochange"},t.selected.mode="MERGE";for(var e=0;e<t.zonePolygons.length;e++)t.zonePolygons[e]===t.selected.current.$poly?t.zonePolygons[e].setOptions({fillOpacity:.25,strokeOpacity:.5}):(t.zonePolygons[e].setOptions({fillOpacity:.05,strokeOpacity:.2}),t.zonePolygons[e].setMap(null))}function c(e){return e.Id!=t.selected.current.Id}function g(){t.selected.current.$delete().success(function(){var e=t.zonePolygons.indexOf(t.selected.current.$poly);t.zones.splice(e,1);var o=t.zones.indexOf(t.selected.current);t.zones.splice(o,1),t.selected.current.$poly.setMap(null),t.selected.current.$poly=null,t.selected.current=null,t.selected.mode="VIEW";for(var n=0;n<t.zones.length;n++)t.zones[n].$poly.setOptions({fillOpacity:.25,strokeOpacity:.5});t.map.panTo(new google.maps.LatLng(t.COMPANY.BaseLatitude,t.COMPANY.BaseLongitude)),t.map.setZoom(10),swal("Deleted","Zone settings removed.","success")}).error(function(){swal("Error!","Error deleting zone settings.","error")})}function d(){t.selected.mode="VIEW",t.selected.merge=null;for(var e=0;e<t.zonePolygons.length;e++)t.zonePolygons[e].setOptions({fillOpacity:.25,strokeOpacity:.5}),t.zonePolygons[e].setMap(t.map);M&&(M.setMap(null),M=null),t.map.panTo(new google.maps.LatLng(t.COMPANY.BaseLatitude,t.COMPANY.BaseLongitude)),t.map.setZoom(10)}function p(){s.post(r.API_ENDPOINT+"api/PricingModels/Zones/PerformMerge",{MasterId:t.selected.current.Id,MasterPolygon:t.selected.current.OverviewPolyline,ChildId:t.selected.merge.zone.Id,ChildPolygon:t.selected.merge.zone.OverviewPolyline,Mode:t.selected.merge.type}).then(function(e){M&&(M.setMap(null),M=null),a.go(a.current,{},{reload:!0})})}function y(e){if("VIEW"==t.selected.mode)if(t.selected.current=e,null!=e){var o=e.MinLatitude+(e.MaxLatitude-e.MinLatitude)/2,n=e.MinLongitude+(e.MaxLongitude-e.MinLongitude)/2;t.map.panTo(new google.maps.LatLng(o,n)),t.map.setZoom(12);for(var l=0;l<t.zonePolygons.length;l++)t.zonePolygons[l]===t.selected.current.$poly?t.zonePolygons[l].setOptions({fillOpacity:.25,strokeOpacity:.5}):t.zonePolygons[l].setOptions({fillOpacity:.05,strokeOpacity:.2})}else{for(var l=0;l<t.zonePolygons.length;l++)t.zonePolygons[l].setOptions({fillOpacity:.25,strokeOpacity:.5});t.map.panTo(new google.maps.LatLng(t.COMPANY.BaseLatitude,t.COMPANY.BaseLongitude)),t.map.setZoom(10)}}function u(){t.selected.mode="EDIT";for(var e=0;e<t.zonePolygons.length;e++)t.zonePolygons[e]===t.selected.current.$poly?t.zonePolygons[e].setOptions({editable:!0}):t.zonePolygons[e].setOptions({fillOpacity:.05,strokeOpacity:.2})}function m(){if("NEW"==t.selected.mode){for(var e=0;e<t.zones.length;e++)t.zones[e].$poly.setOptions({fillOpacity:.25,strokeOpacity:.5});t.selected.current.$poly&&t.selected.current.$poly.setMap(null),t.selected.current=null,t.drawingManager.setDrawingMode(null)}else for(var e=0;e<t.zones.length;e++)if(t.zones[e]===t.selected.current){t.zones[e].$poly.setOptions({editable:!1});var o=google.maps.geometry.encoding.decodePath(t.zones[e].OverviewPolyline);t.zones[e].$poly.setPaths(o)}else t.zones[e].$poly.setOptions({fillOpacity:.25,strokeOpacity:.5});t.selected.mode="VIEW"}function f(){var e=t.selected.current.$poly;if(t.selected.current.$poly=null,e){for(var o=e.getPath().getArray(),n=o[0].lat(),l=o[0].lat(),s=o[0].lng(),r=o[0].lng(),a=1;a<o.length;a++){var i=o[a];i.lat()>l&&(l=i.lat()),i.lat()<n&&(n=i.lat()),i.lng()>r&&(r=i.lng()),i.lng()<s&&(s=i.lng())}t.selected.current.MinLatitude=n,t.selected.current.MaxLatitude=l,t.selected.current.MinLongitude=s,t.selected.current.MaxLongitude=r;var c=google.maps.geometry.spherical.computeArea(o);t.selected.current.Size=c,t.selected.current.OverviewPolyline=google.maps.geometry.encoding.encodePath(o);var g=null;"CREATE"==t.selected.mode?(g=t.selected.current.$save(),g.then(function(){t.zones.push(t.selected.current),t.zonePolygons.push(t.selected.current.$poly)})):g=t.selected.current.$patch(),g.then(function(){swal("Zone Saved","Changes to zone definition have been saved","success"),t.selected.mode="VIEW",t.selected.current.$poly=e;for(var o=0;o<t.zones.length;o++)t.zones[o]===t.selected.current&&t.zones[o].$poly.setOptions({editable:!1})})}}function h(){t.selected.current=new l.Zone,t.selected.mode="CREATE";for(var e=0;e<t.zones.length;e++)t.zones[e].$poly.setOptions({fillOpacity:.1,strokeOpacity:.2});t.drawingManager.setDrawingMode(google.maps.drawing.OverlayType.POLYGON)}function O(){t.map=new google.maps.Map(document.getElementById("zone-map"),{center:{lat:t.COMPANY.BaseLatitude,lng:t.COMPANY.BaseLongitude},zoom:10,styles:P}),t.drawingManager=new google.maps.drawing.DrawingManager({drawingMode:null,map:t.map,drawingControlOptions:{drawingModes:[],position:"BOTTOM_LEFT"}}),t.drawingManager.addListener("polygoncomplete",function(e){t.drawingManager.setDrawingMode(null),t.selected.current?(t.selected.current.$poly=e,e.setOptions({editable:!0,clickable:!0})):e.setMap(null),t.$apply()});for(var e=(new google.maps.Marker({map:t.map,position:{lat:t.COMPANY.BaseLatitude,lng:t.COMPANY.BaseLongitude},animation:google.maps.Animation.DROP,icon:{url:"../../includes/images/marker.png",scaledSize:new google.maps.Size(48,48)}}),0);e<t.zonePolygons.length;e++)t.zonePolygons[e].setMap(t.map);var o=document.getElementById("myInput"),n=new google.maps.places.SearchBox(o);t.map.addListener("bounds_changed",function(){n.setBounds(t.map.getBounds())});var l=[];n.addListener("places_changed",function(){var e=n.getPlaces();if(0!=e.length){l.forEach(function(e){e.setMap(null)}),l=[];var o=new google.maps.LatLngBounds;e.forEach(function(e){if(!e.geometry)return void console.log("Returned place contains no geometry");var n={url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};l.push(new google.maps.Marker({map:t.map,icon:n,title:e.name,position:e.geometry.location})),e.geometry.viewport?o.union(e.geometry.viewport):o.extend(e.geometry.location)}),t.map.fitBounds(o)}}),t.mapSetup=!0,t.$apply()}t.zones=o,t.zonePolygons=[],t.map=null,t.selected={current:null,mode:"VIEW",merge:null};var P=[{featureType:"water",elementType:"geometry",stylers:[{color:"#e9e9e9"},{lightness:17}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#f5f5f5"},{lightness:20}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffffff"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#ffffff"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:18}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:16}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#f5f5f5"},{lightness:21}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#dedede"},{lightness:21}]},{elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#ffffff"},{lightness:16}]},{elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#333333"},{lightness:40}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#f2f2f2"},{lightness:19}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#fefefe"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#fefefe"},{lightness:17},{weight:1.2}]}],M=null;t.startEditingZone=u,t.cancelEditingZone=m,t.finishEditingZone=f,t.startAddingNewZone=h,t.selectZone=y,t.startMerge=i,t.cancelMerge=d,t.performMerge=p,t.notSelectedFilter=c,t.deleteZone=g,t.$watch("selected.merge.zone",function(e,o){e&&(e.$poly.setMap(t.map),s.post(r.API_ENDPOINT+"api/PricingModels/Zones/CheckForMerge",{MasterId:t.selected.current.Id,MasterPolygon:t.selected.current.OverviewPolyline,ChildId:e.Id,ChildPolygon:e.OverviewPolyline,Mode:t.selected.merge.type}).then(function(e){t.selected.merge.check=e.data,t.selected.merge.check.overlaps||"nochange"==t.selected.merge.type||(t.selected.merge.type="nochange")}),o&&o.$poly.setMap(null))}),t.$watchGroup(["selected.merge.type","selected.merge.check"],function(){if(t.selected.merge&&t.selected.merge.check)if(t.selected.merge.type&&"nochange"!=t.selected.merge.type){var e=t.selected.merge.check[t.selected.merge.type],o=google.maps.geometry.encoding.decodePath(e);null!=M?M.setPaths(o):M=new google.maps.Polygon({id:0,paths:o,editable:!1,draggable:!1,clickable:!1,fillColor:"black",fillOpacity:.4,strokeColor:"black",strokeOpacity:.5,stokeWeight:3,zIndex:1e6,map:t.map})}else null!=M&&(M.setMap(null),M=null)}),e.forEach(t.zones,function(e){var o=Math.floor(16777215*Math.random()).toString(16),n=google.maps.geometry.encoding.decodePath(e.OverviewPolyline),l=google.maps.geometry.spherical.computeArea(n);e._size=l;var s=new google.maps.Polygon({id:e.Id,paths:n,editable:!1,draggable:!1,clickable:!0,fillColor:"#"+o,fillOpacity:.25,strokeColor:"#"+o,strokeOpacity:.5,stokeWeight:3,zIndex:1e6-l});s.addListener("click",function(e){"EDIT"==t.selected.mode||(y(t.zones.find(function(e){return e.$poly===s})),t.$apply())}),e.$poly=s,t.zonePolygons.push(s)}),setTimeout(function(){O()},1e3)}var o=e.module("cab9.settings");o.controller("ZoneManagementController",t),t.$inject=["$scope","rZones","$modal","Model","$http","$config","$state"]}(angular);;;;
!function(e){function n(e,n,o,t,a,l,g,p){function s(){var n=new google.maps.LatLngBounds;if(e.configPolygons.length>0){for(i=0;i<e.configPolygons.length;i++){var o=e.configPolygons[i];for(j=0;j<o.path.length;j++)n.extend(new google.maps.LatLng(o.path[j].latitude,o.path[j].longitude))}e.mapBounds={northeast:{latitude:n.getNorthEast().lat(),longitude:n.getNorthEast().lng()},southwest:{latitude:n.getSouthWest().lat(),longitude:n.getSouthWest().lng()}}}e.map={center:{latitude:e.COMPANY.BaseLatitude,longitude:e.COMPANY.BaseLongitude},zoom:10,contol:{}},e.mapSetup=!0,e.$apply()}function d(){e.selectedAppConfig.EncodedPath=google.maps.geometry.encoding.encodePath(e.selectedAppConfig.$poly.path.map(function(e){return new google.maps.LatLng(e.latitude,e.longitude)})),e.selectedAppConfig.$commit(),n.post(o.API_ENDPOINT+"api/appconfig",e.selectedAppConfig.$$originalValues).then(function(n){var o=new p.AppConfig(n.data);o.$poly=e.selectedAppConfig.$poly,e.showList=!0,e.AppConfigs.push(o),A("black",!1,!1),e.selectedAppConfig=null,e.selectedAppConfigMode=null,swal("Success","The App Config saved successfully","success")},function(){swal("Error","The App Config failed to save.","error")})}function c(){var n=e.configPolygons.indexOf(e.selectedAppConfig.$poly);n!=-1&&e.configPolygons.splice(n,1),e.selectedAppConfig=null,e.selectedAppConfigMode=null,e.drawingManager.options.drawingMode=null,e.drawingManager.instance.setDrawingMode(null),e.currentCompleteHandler.remove(),e.showList=!0}function r(){var n=new p.AppConfig;e.selectedAppConfig=n,e.selectedAppConfigMode="CREATE",e.drawingManager.options.drawingMode=google.maps.drawing.OverlayType.POLYGON,e.drawingManager.instance.setDrawingMode(google.maps.drawing.OverlayType.POLYGON),e.currentCompleteHandler=google.maps.event.addListener(e.drawingManager.instance,"overlaycomplete",function(n){if(n.type==google.maps.drawing.OverlayType.POLYGON){n.overlay.setMap(null),e.selectedAppConfig.EncodedPath=google.maps.geometry.encoding.encodePath(n.overlay.getPath()),console.log(e.selectedAppConfig.EncodedPath);var o={id:h++,path:google.maps.geometry.encoding.decodePath(e.selectedAppConfig.EncodedPath).map(function(e){return{latitude:e.lat(),longitude:e.lng()}}),editable:!0,draggable:!0,stroke:{color:"#63C4E1",weight:5,opacity:.8},$CoverageArea:e.selectedAppConfig};e.selectedAppConfig.$poly=o,e.configPolygons.push(o),e.drawingManager.options.drawingMode=null,e.drawingManager.instance.setDrawingMode(null),e.currentCompleteHandler.remove(),e.$apply()}})}function f(){e.selectedAppConfig.EncodedPath=google.maps.geometry.encoding.encodePath(e.selectedAppConfig.$poly.path.map(function(e){return new google.maps.LatLng(e.latitude,e.longitude)})),e.selectedAppConfig.$commit(),n.patch(o.API_ENDPOINT+"api/appconfig",e.selectedAppConfig.$$originalValues).then(function(n){e.showList=!0,A("black",!1,!1),e.selectedAppConfig=null,e.selectedAppConfigMode=null,swal("Success","The App Config saved successfully","success")},function(){A("black",!1,!1),swal("Error","The App Config failed to save.","error")})}function u(){e.selectedAppConfig.$rollback(!0),e.selectedAppConfig.$poly.path.length=0,[].push.apply(e.selectedAppConfig.$poly.path,google.maps.geometry.encoding.decodePath(e.selectedAppConfig.EncodedPath).map(function(e){return{latitude:e.lat(),longitude:e.lng()}})),A("black",!0,!1),e.selectedAppConfig=null}function C(n){e.selectedAppConfig=n,e.selectedAppConfigMode="EDIT",A("green",!0,!0),e.showList=!1}function A(n,o,t){e.selectedAppConfig.$poly.stroke.color=n,e.selectedAppConfig.$poly.fit=o,e.selectedAppConfig.$poly.editable=t}function w(){swal({title:"Are you sure?",text:"You want to delete this App Config section.",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete!",closeOnConfirm:!0},function(t){t&&n["delete"](o.API_ENDPOINT+"api/appconfig?AppConfigId="+e.selectedAppConfig.Id).then(function(n){var o=e.AppConfigs.indexOf(e.selectedAppConfig);e.AppConfigs.splice(o,1),o=e.configPolygons.indexOf(e.selectedAppConfig.$poly),e.configPolygons.splice(o,1),e.selectedAppConfig=null,e.selectedAppConfigMode=null,e.showList=!0,swal("Success","The App Config deleted successfully","success")},function(){swal("Error","The App Config failed to delete.","error")})})}e.AppConfigs=t||[],e.showList=!0,e.viewMode="EDIT",e.configPolygons=[];var h=1e5;for(e.addNewAppConfig=r,e.saveNewAppConfig=d,e.cancelNewAppConfig=c,e.startEditAppConfig=C,e.editAppConfig=f,e.cancelEditAppConfigs=u,e.deleteEditAppConfig=w,e.drawingManager={control:{},instance:null,options:{drawingMode:null,drawingControl:!1,drawingControlOptions:{drawingModes:[google.maps.drawing.OverlayType.RECTANGLE,google.maps.drawing.OverlayType.CIRCLE,google.maps.drawing.OverlayType.POLYGON]}}},e.mapBounds=new google.maps.LatLngBounds,setTimeout(function(){s()}),e.companyMarker={coords:{latitude:e.COMPANY.BaseLatitude,longitude:e.COMPANY.BaseLongitude},options:{animation:google.maps.Animation.DROP,icon:{url:"../../includes/images/marker.png",scaledSize:new google.maps.Size(48,48)}}},i=0;i<e.AppConfigs.length;i++){var m={id:e.AppConfigs[i].Id,path:google.maps.geometry.encoding.decodePath(e.AppConfigs[i].EncodedPath).map(function(e){return{latitude:e.lat(),longitude:e.lng()}}),editable:!1,draggable:!1,stroke:{color:"black",weight:5,opacity:.8,zIndex:1e5},zIndex:1e5,fit:!1,$zone:e.AppConfigs[i]};e.AppConfigs[i].$poly=m,e.configPolygons.push(m)}e.$watch(function(){return!!e.drawingManager.control.getDrawingManager},function(n){n&&(e.drawingManager.instance=e.drawingManager.control.getDrawingManager())})}var o=e.module("cab9.settings");o.controller("AppSettingsController",n),n.$inject=["$scope","$http","$config","rAppConfigs","$modal","$state","$q","Model"]}(angular);;;;
!function(e){function t(e,t,n,i,l,s,a){function c(){var t=e.tags;n.open({size:"lg",templateUrl:"/webapp/management/settings/tags/create-edit.modal.html",controller:["$scope","$modalInstance","rTag",function(e,n,i){function l(){e.entity.filter(function(e){return 1==e.selected}).length>0?e.item.EntityType=e.entity.reduce(function(e,t){return t.selected?e+t.value:e},0):e.item.EntityType=null,e.item.$save().then(function(i){swal("Success","Tag has been Saved","success"),t.push(e.item),e.item.EntityType=i.data.EntityType,n.dismiss()})}function s(){n.dismiss()}e.item=i,e.entity=[{value:1,selected:!1,full:"Driver"},{value:2,selected:!1,full:"Passenger"},{value:4,selected:!1,full:"Vehicle"},{value:8,selected:!1,full:"Client"}],e.save=l,e.cancel=s}],resolve:{rTag:function(){return new i.Tag({Type:"Mandatory"})}}})}function r(t){var i=e.tags;n.open({size:"lg",templateUrl:"/webapp/management/settings/tags/create-edit.modal.html",controller:["$scope","$modalInstance","rTag",function(e,t,n){function l(){e.entity.filter(function(e){return 1==e.selected}).length>0?e.item.EntityType=e.entity.reduce(function(e,t){return t.selected?e+t.value:e},0):e.item.EntityType=null,e.item.$save().then(function(n){swal("Success","Tag has been Saved","success"),i.push(e.item),e.item.EntityType=n.data.EntityType,t.dismiss()})}function s(){t.dismiss()}e.item=n,e.entity=[{value:1,selected:e.item.EntityType&&e.item.EntityType.indexOf("Driver")!=-1,full:"Driver"},{value:2,selected:e.item.EntityType&&e.item.EntityType.indexOf("Passenger")!=-1,full:"Passenger"},{value:4,selected:e.item.EntityType&&e.item.EntityType.indexOf("Vehicle")!=-1,full:"Vehicle"},{value:8,selected:e.item.EntityType&&e.item.EntityType.indexOf("Client")!=-1,full:"Client"}],e.save=l,e.cancel=s}],resolve:{rTag:function(){return t}}})}function u(t){t.$delete().success(function(){var n=e.tags.indexOf(t);e.tags.splice(n,1),swal("Deleted","Tag has been removed.","success")}).error(function(){swal("Error!","Error deleting tag as it is being used on some entity.","error")})}e.tags=t,e.addTag=c,e.editTag=r,e.removeTag=u}var n=e.module("cab9.settings");n.controller("TagManagementController",t),t.$inject=["$scope","rTags","$modal","Model","$http","$config","$state"]}(angular);;;;
!function(e,t){function r(e,t,r,o){o.test("staff")&&(r.when("/staff","/staff/cards"),e.state("root.staff",{url:"/staff","abstract":!0,"default":"root.staff.cards",permission:"Staff",resolve:{rData:["Model",function(e){return e.Staff.query().include("StaffRole").execute()}],rQuery:["Model",function(e){return e.Staff.query().include("StaffRole").parseAs(e.Staff)}],rServerSearch:function(){return function(e,t){return t.$&&e.where("substringof('"+t.$+"', Firstname) or substringof('"+t.$+"', Surname) or substringof('"+t.$+"', Email) or substringof('"+t.$+"', TownCity) or substringof('"+t.$+"', Phone)"),e.clone()}},rId:function(){return"Id"}},views:{"content-wrapper@root":{templateUrl:"/e9_components/layouts/module/module-base.layout.html",controller:["$scope","rData",function(e,t){e.searchTerm={},e.serverSearchTerm={}}]},"options-area@root.staff":{templateUrl:"/webapp/management/staff/all/staff-module-options.partial.html",controller:"StaffModuleOptionController"},"stats-area@root.staff":{templateUrl:"/webapp/management/staff/all/staff-module-stats.partial.html",controller:"StaffModuleStatsController"}}}),e.state("root.staff.cards",{url:"/cards",resolve:{rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){var t=e.Firstname+" "+e.Surname;return t},SubTitle:function(e){var t="";return t+=e.TownCity},LogoUrl:function(e){return e._ImageUrl},Group:function(e){return e.Active.toString()}}}],rNavTo:function(){return"root.staff.viewer.dashboard"}},views:{"view-area@root.staff":{templateUrl:"/e9_components/layouts/module/module-cards.partial.html",controller:"ModuleCardsController"}}}),e.state("root.staff.table",{url:"/table",resolve:{rNavTo:function(){return"root.staff.viewer.dashboard"},rSchema:function(){return"Staff"},rColumns:function(){return null}},views:{"options-area@root.staff":{templateUrl:"/webapp/management/staff/all/staff-module-table-options.partial.html",controller:"StaffModuleOptionController"},"view-area@root.staff":{templateUrl:"/e9_components/layouts/module/module-paged-table.partial.html",controller:"ModulePagedTableController"}}}),o.test("staff.viewer")&&(e.state("root.staff.viewer",{url:"/{Id:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}}","default":"root.staff.viewer.dashboard",viewerType:"Staff",permission:"View Staff",resolve:{rTabs:["$stateParams",function(e){var t=[{heading:"Dashboard",allow:!0,route:"root.staff.viewer.dashboard",params:{staffId:e.Id}},{heading:"Info",route:"root.staff.viewer.info",allow:!0,params:{staffId:e.Id}},{heading:"User",route:"root.staff.viewer.user",params:{staffId:e.Id}},{heading:"Documents",route:"root.staff.viewer.documents",params:{staffId:e.Id}},{heading:"Notes",route:"root.staff.viewer.notes",params:{staffId:e.Id}}];return t.filter(function(e){return e.allow||o.test(e.route.substring(5))})}],rData:["Model","$stateParams",function(e,t){return e.Staff.query().where("Id","==","guid'"+t.Id+"'").trackingEnabled().execute()}],rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){return e._Fullname},SubTitle:function(e){return e.TownCity},LogoUrl:function(e){return e._ImageUrl}}}]},views:{"content-wrapper@root":{controller:"ModuleItemViewController",templateUrl:"/e9_components/layouts/module/module-item.layout.html"}}}),e.state("root.staff.viewer.dashboard",{url:"/dashboard",viewerType:"Staff",templateUrl:"/webapp/management/staff/item/staff-item-dashboard.partial.html",controller:"StaffItemDashboardController"}),o.test("staff.viewer.documents")&&e.state("root.staff.viewer.documents",{url:"/documents",viewerType:"Staff",permission:"Staff - Documents",controller:"ModuleDocumentsController",templateUrl:"/e9_components/layouts/module/module-documents.layout.html",resolve:{rDocuments:["$stateParams","Model","$q",function(e,t,r){return t.Document.query().where("OwnerType eq 'Staff'").where("OwnerId eq guid'"+e.Id+"'").include("DocumentType").trackingEnabled().execute()}],rConfig:["$stateParams",function(e){return{type:"Staff",id:e.Id}}]}}),e.state("root.staff.viewer.info",{url:"/info",viewerType:"Staff",templateUrl:"/webapp/management/staff/item/staff-item-info.partial.html",controller:"StaffItemInfoController",resolve:{rCustomRoles:["Model",function(e){return e.StaffRole.query().execute()}]}}),o.test("staff.viewer.notes")&&e.state("root.staff.viewer.notes",{url:"/notes",viewerType:"Notes",permission:"Staff - Notes",controller:"StaffItemNotesController",templateUrl:"/webapp/management/staff/item/staff-item-notes.partial.html",resolve:{rNotes:["$stateParams","Model","$q",function(e,t,r){return t.Note.query().where("OwnerType eq 'STAFF'").where("OwnerId eq guid'"+e.Id+"'").execute()}],rStaffs:["Model",function(e){return e.Staff.query().select("Id, Firstname, Surname").parseAs(function(e){this.Name=e.Firstname+" "+e.Surname,this.Id=e.Id}).execute()}],rUsers:["Model",function(e){return e.User.query().include("Claims").execute()}]}}),o.test("staff.viewer.user")&&e.state("root.staff.viewer.user",{url:"/user",controller:"StaffItemUserController",templateUrl:"/webapp/management/staff/item/staff-item-user.partial.html",permission:"Staff - User",resolve:{rUser:["$http","$stateParams","$config","$q",function(e,t,r,o){var a=o.defer();return e.get(r.API_ENDPOINT+"api/account/UserForOwner?ownerType=StaffId&OwnerId="+t.Id).then(function(e){a.resolve(e.data)},function(e){a.resolve({Message:"User Not Found"})}),a.promise}]}})),o.test("staff","W")&&e.state("root.staff.create",{url:"/create",views:{"content-wrapper@root":{controller:"StaffItemCreateController",templateUrl:"/webapp/management/staff/item/staff-item-info.partial.html",resolve:{rCustomRoles:["Model",function(e){return e.StaffRole.query().execute()}]}}}}),t.registerMenuItem({state:"root.staff.cards",icon:"supervisor_account",title:"Staff"}))}var o=t.module("cab9.staff",[]);o.config(r),r.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider","$permissions"]}(window,angular);;;;
!function(t){function e(t,e,a){function o(){t.showSearch=!t.showSearch,t.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):t.searchTerm.$=""}function l(){e.open({template:'<div class="modal-header"><button class="close" type="button" ng-click="$close()"><i class="material-icons">clear</i></button><h3 class="modal-title">Staff Stats</h3></div><div class="modal-body"><div ng-include="\'/webapp/management/staff/all/staff-module-stats.partial.html\'"></div></div>',controller:"StaffModuleStatsController",size:"sm",resolve:{rData:function(){return a}}}).result.then(function(t){})}function n(){e.open({templateUrl:"/webapp/management/staff/modals/staff-types-modal.partial.html",controller:"StaffTypesModalController",size:"lg",resolve:{rData:["Model","$stateParams","LookupCache",function(t,e,a){return t.StaffType.query().execute().trackingEnabled().then(function(t){return a.StaffType=t,a.StaffType.$updated=new moment,a.StaffType})}]}}).result.then(function(t){})}t.toggleSearch=o,t.showStatsModal=l,t.openStaffTypeModal=n}var a=t.module("cab9.staff");a.controller("StaffModuleOptionController",e),e.$inject=["$scope","$modal","rData"]}(angular);;;;
!function(t){function e(t,e,n,r,a,f){var o=(new moment).subtract(2,"week");t.recentStaff=f.filter(function(t){return new moment(t.CreationTime).isAfter(o)}),t.quickStats={total:f.length,active:f.filter(function(t){return t.Active}).length,recent:t.recentStaff.length},t.Staff=[]}var n=t.module("cab9.staff");n.controller("StaffModuleStatsController",e),e.$inject=["$scope","$UI","Model","$config","$http","rData"]}(angular);;;;
!function(t){function o(t,o,a,e,n,f){function s(){var a=[];a.push(t.staff.$save()),f.all(a).then(function(){swal({title:"Staff Saved.",text:"New Staff has been added.",type:"success",confirmButtonColor:n.COLOURS.brandSecondary}),o.go("root.staff.cards",null,{reload:!0})},function(){alert("Error"),console.log(arguments)})}function l(){o.go("root.staff.cards")}t.customRoles=e,t.staff=new a.Staff,t.displayMode="CREATE",t.saveEdits=s,t.cancelEditing=l}var a=t.module("cab9.staff");a.controller("StaffItemCreateController",o),o.$inject=["$scope","$state","Model","rCustomRoles","$UI","$q"]}(angular);;;;
!function(e){function t(e,t,f,n,a,c){function l(){e.newStaffType=new n.StaffType}function s(t){e.selected=t}function u(t){t.$patch().success(function(){swal("Success","Staff Type Updated","success"),r()}),e.selected=null}function o(){e.newStaffType.Name.length>0&&e.newStaffType.$save().success(function(){swal("Success","Staff Type Saved","success"),e.newStaffType=null,r()}).error(function(){swal({title:"Error Occured",type:"error"})})}function p(t){t.$rollback(),e.selected=null}function y(){e.newStaffType=null}function S(e){e.$delete().success(r)}function r(){n.StaffType.query().trackingEnabled().execute().then(function(t){c.StaffType=t,c.StaffType.$updated=new moment,e.staffTypes=t})}e.staffTypes=f,e.selected=null,e.newStaffType=null,e.selectStaffType=s,e.updateStaffType=u,e.cancelUpdate=p,e.deleteStaffType=S,e.createNewStaffType=l,e.cancelSave=y,e.saveStaffType=o}var f=e.module("cab9.staff");f.controller("StaffTypesModalController",t),t.$inject=["$scope","$modal","rData","Model","$q","LookupCache"]}(angular);;;;
!function(o){function t(o,t,n,a,c){}var n=o.module("cab9.staff");n.controller("StaffItemDashboardController",t),t.$inject=["$scope","$UI","$config","$http","$q"]}(angular);;;;
!function(t){function a(t,a,e,n,o,s,f,c,r){function i(){s.openPicker({type:"Staff",id:t.staff.Id,searchTerm:t.staff.Firstname+" "+t.staff.Surname}).then(function(a){t.staff.ImageUrl=a,d()},function(t){})}function l(){t.displayMode="EDIT"}function d(){t.saving=!0;var e=[];e.push(t.staff.$patch()),a.all(e).then(function(){swal({title:"Staff Saved.",text:"Changes have been updated.",type:"success",confirmButtonColor:f.COLOURS.brandSecondary}),t.displayMode="VIEW",t.$emit("ITEM_UPDATED",t.staff)},function(){alert("Error"),console.log(arguments)})}function u(){t.staff.$rollback(!0),t.displayMode="VIEW"}t.staff=n[0],t.accessors=c,t.customRoles=o,t.displayMode="VIEW",t.chooseImage=i,t.startEditing=l,t.saveEdits=d,t.cancelEditing=u,t.state=r.$current.name.substring(5)}var e=t.module("cab9.staff");e.controller("StaffItemInfoController",a),a.$inject=["$scope","$q","Model","rData","rCustomRoles","ImageUpload","$UI","rAccessors","$state"]}(angular);;;;
!function(e){function t(e,t,o,r,n,l,c,a,i,u,s){function d(t){var o=e.notes.indexOf(t),n=r.open({templateUrl:"/webapp/common/modals/notes.modal.html",controller:"NoteEditController",size:"lg",resolve:{rNote:function(){return new c.Note(t)}}});n.result.then(function(t){c.Note.query().where("Id","==","guid'"+t.Id+"'").trackingEnabled().execute().then(function(t){e.notes[o]=t[0]},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:i.COLOURS.brandSecondary})})},function(){})}function f(){var t=r.open({templateUrl:"/webapp/common/modals/notes.modal.html",controller:"NoteCreateController",size:"lg",resolve:{rOwner:function(){return"STAFF"}}});t.result.then(function(t){c.Note.query().where("Id","==","guid'"+t.Id+"'").execute().then(function(t){e.notes.push(t[0])},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:i.COLOURS.brandSecondary})})})}function m(t){swal({title:"Are you sure?",text:"Note will be deleted",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){var o=e.notes.indexOf(t);new c.Note(t).$delete().then(function(t){swal({title:"Note Deleted.",text:"Note has been deleted.",type:"success",confirmButtonColor:i.COLOURS.brandSecondary}),e.notes.splice(o,1)})},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:i.COLOURS.brandSecondary})})}function p(e){var t=null,o=s.filter(function(t){return t.Id==e})[0];if(o)switch(o.UserType){case"Staff ":var r=o.Claims.filter(function(e){return"StaffId"==e.ClaimType})[0];if(r){var n=u.filter(function(e){return e.Id==r.ClaimValue})[0];t=n?n.Name:null}}return t}e.notes=t,e.displayMode="VIEW",e.addNote=f,e.editNote=d,e.deleteNote=m,e.getUserName=p}var o=e.module("cab9.staff");o.controller("StaffItemNotesController",t),t.$inject=["$scope","rNotes","$state","$modal","$stateParams","$q","Model","$config","$UI","rStaffs","rUsers"]}(angular);;;;
!function(e){function t(t,r,n,a,o,l,f,s,i,u){function c(){var e=f.open({templateUrl:"/webapp/common/modals/user/modal.html",controller:"UserModalController",resolve:{rUser:function(){return{Id:t.User.Id,UserName:t.User.UserName,Email:t.User.Email}},rClaim:function(){return{type:"Staff",value:t.staff._id}},rStaffRole:function(){return t.staff.StaffRole},resetPassword:function(){return!0}}});e.result.then(function(e){t.User=e},function(){})}function m(){swal({title:"Are you sure?",text:"User Account will be deleted!",type:"warning",showCancelButton:!0,confirmButtonColor:o.COLOURS.brandSecondary,confirmButtonText:"Confirm Delete!",closeOnConfirm:!0},function(){l["delete"](a.API_ENDPOINT+"api/accountUser?UserName="+t.User.UserName).then(function(e){t.User=null},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:o.COLOURS.brandSecondary})})})}function d(){function e(e){return!!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e)}if(t.staff.Email&&t.staff.Firstname&&t.staff.Firstname.trim().length>0&&e(t.staff.Email)){var r=f.open({templateUrl:"/webapp/common/modals/user/modal.html",controller:"UserModalController",resolve:{rUser:function(){return{UserName:t.staff.Email,Email:t.staff.Email,ImageUrl:t.staff.ImageUrl,StaffId:t.staff.Id,Name:t.staff._Fullname}},rClaim:function(){return{type:"Staff",value:t.staff._id}},rStaffRole:function(){return t.staff.StaffRole},resetPassword:function(){return!1}}});r.result.then(function(e){t.User=e},function(){})}else swal({title:"Staff details(email,firstname) Invalid",text:"Please add details correctly",type:"warning",confirmButtonColor:o.COLOURS.brandSecondary})}function U(){function e(e){return!!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e)}if(t.staff.Email&&t.staff.Firstname&&t.staff.Firstname.trim().length>0&&e(t.staff.Email)){var r=f.open({templateUrl:"/webapp/common/modals/user/link-modal.html",controller:"LinkUserModalController",resolve:{rData:function(){return{ClientId:t.staff.ClientId,StaffId:t.staff.Id}}}});r.result.then(function(e){t.User=e},function(){})}else swal({title:"Staff details(email,firstname) Invalid",text:"Please add details correctly",type:"warning",confirmButtonColor:o.COLOURS.brandSecondary})}"User Not Found"==i.Message?t.User=null:t.User=e.copy(i),t.staff=u[0],t.displayMode="VIEW",t.openUserModal=d,t.openLinkUserModal=U,t.deleteUserAccount=m,t.resetPassword=c}var r=e.module("cab9.staff");r.controller("StaffItemUserController",t),t.$inject=["$scope","$state","$q","$config","$UI","$http","$modal","Model","rUser","rData"]}(angular);;;;
!function(e,n){function o(e,n,o,t){t.test("upcoming")&&(e.state("root.upcoming",{url:"upcoming",views:{"content-wrapper@root":{controller:"UpcomingController",templateUrl:"/webapp/management/upcoming/upcoming.partial.html"}}}),n.registerMenuItem({state:"root.upcoming",icon:"icon-new-releases",title:"Upcoming"}))}function t(){}var i=n.module("cab9.upcoming",[]);i.config(o),i.run(t),o.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider","$permissions"],t.$inject=[]}(window,angular);;;;
!function(e,t){function r(t,r,n,i){i.test("invoices")&&(t.state("root.invoices",{url:"/invoices",searchText:"invoices billing",searchName:"Invoices",searchIcon:"receipt",views:{"content-wrapper@root":{templateUrl:"/webapp/management/invoicing/invoicing.partial.html",controller:"InvoicingSummaryController"}},permission:"Invoices",resolve:{}}),t.state("root.creditnotes",{url:"/creditnotes",searchText:"credit notes",searchName:"Credit Notes",searchIcon:"credit_card",views:{"content-wrapper@root":{templateUrl:"/webapp/management/invoicing/creditnotes/all/table.partial.html",controller:"CreditsModuleTableController"}},permission:"Credit Notes",resolve:{}}),i.test("card-transactions.viewer")&&t.state("root.card-transactions",{url:"/card-transactions",searchText:"card transactions",searchName:"Card Transactions",searchIcon:"receipt",views:{"content-wrapper@root":{templateUrl:"/webapp/common/views/cardtransactions/partial.html",controller:"InvoiceCardTransactionsController"}},permission:"Card Transactions",resolve:{}}),i.test("creditnotes.viewer")&&t.state("root.creditnotes.viewer",{url:"/{Id:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}}",permission:"View Credit Note",views:{"content-wrapper@root":{templateUrl:"/webapp/management/invoicing/creditnotes/item/creditnote-viewer.partial.html",controller:"CreditNoteItemEditController"}},resolve:{rCredit:["Model","$stateParams",function(e,t){return e.CreditNote.query().include("Client").include("Tax").include("Tax/TaxComponents").where("Id","==","guid'"+t.Id+"'").trackingEnabled().execute()}],rTaxes:["Model",function(e){return e.Tax.query().include("TaxComponents").execute()}]}}),i.test("invoices.viewer")&&t.state("root.invoices.viewer",{url:"/{Id:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}}",permission:"View Invoice",views:{"content-wrapper@root":{templateUrl:"/webapp/management/invoicing/invoices/item/invoice-viewer.partial.html",controller:"InvoiceItemEditController"}},resolve:{rCompany:["Model",function(e){return e.Company.query().select("DefaultInvoiceDueDateOffset").execute()}],rInvoice:["Model","$stateParams",function(e,t){return e.Invoice.query().include("Client").where("Id","==","guid'"+t.Id+"'").trackingEnabled().execute()}],InvoiceDetails:["Model","$stateParams","rInvoice",function(e,t,r){return e.InvoiceDetail.query().include("Tax/TaxComponents").where("InvoiceId","==","guid'"+t.Id+"'").trackingEnabled().execute().then(function(e){r[0].InvoiceDetails=e})}],rPayments:["Model","$stateParams",function(e,t){return e.Payment.query().where("InvoiceId","==","guid'"+t.Id+"'").execute()}],rTaxes:["Model",function(e){return e.Tax.query().include("TaxType").include("TaxComponents").execute()}]}}),i.test("invoices","W")&&t.state("root.invoices.create",{url:"/create",views:{"content-wrapper@root":{templateUrl:"/webapp/management/invoicing/invoices/item/invoice-generate.partial.html",controller:"InvoiceItemCreateController"}},params:{data:null},resolve:{rClients:["Model",function(t){return t.Client.query().select("Id,Name,AccountNo,ImageUrl,ClientType/Name").include("ClientType").parseAs(function(t){this.Id=t.Id,this.Name=t.Name,this.Description=t.ClientType.Name,this.ImageUrl=e.formatImage(t.ImageUrl,t.Name)}).execute()}],rTaxes:["Model",function(e){return e.Tax.query().include("TaxType").include("TaxComponents").execute()}]}}),r.registerMenuItem({icon:"receipt",title:"Invoicing",subMenus:[{state:"root.invoices",icon:"receipt",title:"Client Invoices"},{state:"root.creditnotes",icon:"receipt",title:"Credit Notes"},{state:"root.card-transactions",icon:"credit_card",title:"Card Transactions"}]}))}function n(){}var i=t.module("cab9.invoices",[]);i.config(r),i.run(n),r.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider","$permissions"],n.$inject=[]}(window,angular);;;;
!function(e,t){function n(n,r,o,i,a,c,u,d,s,l,m){function f(){var e=!0;return t.forEach(n.currentPeriod.allInvoices,function(t){return t.$selected||v(t)||!n.bulkMode||!t.$bulk?void 0:(e=!1,!1)}),e}function P(){t.forEach(n.currentPeriod.allInvoices,function(e){e.$selected=!v(e)&&n.bulkMode&&e.$bulk})}function p(){var e=m.open({templateUrl:"/webapp/management/invoicing/invoices/modals/new-invoice/partial.html",controller:"NewInvoiceInitController",keyboard:!1,backdrop:"static",size:"lg",resolve:{rClients:["Model",function(e){return e.Client.query().select("Id,Name,AccountNo,ImageUrl,InvoicePeriod,ClientTypeId,ClientType/Name").include("ClientType").parseAs(function(e){this.Id=e.Id,this.Name=e.Name,this.AccountNo=e.AccountNo,this.InvoicePeriod=e.InvoicePeriod,this.Description=e.ClientType.Name,this.ClientTypeId=e.ClientTypeId,this.ImageUrl=formatUrl(e.ImageUrl,e.Name)}).execute()}]}});e.result.then(function(e){},function(){})}function h(t){e.open("/webapp/common/modals/bookings/edit-booking/window.html#?id="+t.Id+"&clientId="+t.Client.Id,"EDIT:"+t.Id,"height=870,width=1000,left=0,top=0")}function I(e){r.put(o.API_ENDPOINT+"api/Invoice/approvebooking",{},{params:{bookingId:e.Id,invoiceId:e.Invoice.Id}}).success(function(t){var r=n.currentPeriod.attentionRequired.indexOf(e);n.currentPeriod.attentionRequired.splice(r,1)})}function v(e){return n.currentPeriod.undergeneration.filter(function(t){return t.InvoiceId==e.Id}).length>0}function k(e){r.put(o.API_ENDPOINT+"api/Invoice/updatebooking",{},{params:{bookingId:e.Id,invoiceId:e.Invoice.Id,cost:e.InvoiceCost}}).success(function(t){var r=n.currentPeriod.attentionRequired.indexOf(e);n.currentPeriod.attentionRequired.splice(r,1)})}function y(){n.graphLoading=!0,n.paymentsGraph={options:{series:{bars:{show:"true"},shadowSize:0,stack:!0,highlightColor:"#4D629E"},bars:{align:"center",fill:1,barWidth:.8,lineWidth:1,fillColor:{colors:[{opacity:1},{opacity:.5}]}},legend:{show:!1},grid:{hoverable:!0,clickable:!0,tickColor:"#1b3952",borderWidth:.2,horizontalLines:!1,backgroundColor:{colors:["#fff","#eee"]}},xaxis:{tickFormatter:function(e,t){return"W"+e},tickLength:0,minTickSize:1},tooltip:!0,tooltipOpts:{content:function(e,t,n,r,e){return content="Week "+r.series.details[r.dataIndex].Week+", Year "+r.series.details[r.dataIndex].Year,content+="<br/>Billed Out: "+r.series.details[r.dataIndex].BilledOut,content+="<br/>Bonuses Paid: "+r.series.details[r.dataIndex].BonusesPaid,content+="<br/>Invoiced In: "+r.series.details[r.dataIndex].InvoicedIn,content+="<br/>Net: %y",content},defaultTheme:!1},yaxis:{min:0,position:"right",minTickSize:1,show:!0,tickFormatter:function(e,t){return e>999?(e/1e3).toFixed(1).toLocaleString()+"k":e},tickColor:"#ECECE9"}},data:[]},x.success(function(e){n.graphLoading=!1;for(var e=e,t={label:"Payments",data:[],details:[],color:"#455674"},r={label:"Payments",data:[],details:[],color:"#a88adc"},o=0;o<e.length;o++)e[o].Week==n.currentPeriod.week&&e[o].Year==n.currentPeriod.year?(r.details.push(e[o]),r.data.push([e[o].Week,e[o].Net])):(t.details.push(e[o]),t.data.push([e[o].Week,e[o].Net]));n.paymentsGraph.data=[],n.paymentsGraph.data.push(t),n.paymentsGraph.data.push(r)})}function b(e,a){n.loading=!0;var c=new moment(e);"Week"==a?(n.currentPeriod.from=c.startOf("isoweek").format(),n.currentPeriod.to=c.clone().endOf("isoweek").format(),n.currentPeriod.gen=c.clone().endOf("isoweek").add(2,"days").format(),n.currentPeriod.week=c.isoWeek()):(n.currentPeriod.from=c.startOf("month").format(),n.currentPeriod.to=c.clone().endOf("month").format(),n.currentPeriod.gen=c.clone().endOf("month").add(2,"days").format(),n.currentPeriod.week=null),n.currentPeriod.year=c.year(),n.currentPeriod.month=c.month()+1,n.currentPeriod.weeks=[],n.currentPeriod.type=a;var u=new moment(c.clone().startOf("month")),d=new moment(c.clone().endOf("month"));for(n.currentPeriod.thisMonth={weekStart:u.format(),type:"Month",title:"All",subtitle:u.format("MMMM YYYY")},u=u.startOf("isoweek");u.isBefore(d)&&u.isBefore(new moment);){var s=u.clone().startOf("isoweek");n.currentPeriod.weeks.push({weekStart:s.format(),type:"Week",title:"Week: "+s.isoWeek(),subtitle:"WS: "+s.format("DD/MM/YYYY")}),u=u.add(7,"days")}n.currentPeriod.stats={},B&&(i.cancel(B),B=null),B=i(function(){var i=(new moment(e),[]),a=r.get(o.API_ENDPOINT+"api/Invoice/generated",{params:{week:n.currentPeriod.week,month:n.currentPeriod.month,year:n.currentPeriod.year}});i.push(a),a.success(function(e){n.currentPeriod.invoices={},n.currentPeriod.allInvoices=[],n.currentPeriod.invoices[new moment(n.currentPeriod.from).format("MMM")]=[],t.forEach(e,function(e){e.Balance=e.InvoiceAmount-e.PaymentsTotal,n.currentPeriod.allInvoices.push(e),e.Week?(n.currentPeriod.invoices["Week "+e.Week]||(n.currentPeriod.invoices["Week "+e.Week]=[]),n.currentPeriod.invoices["Week "+e.Week].push(e)):n.currentPeriod.invoices[new moment(n.currentPeriod.from).format("MMM")].push(e)})});var c=r.get(o.API_ENDPOINT+"api/Invoice/undergeneration",{});i.push(c),c.success(function(e){n.currentPeriod.undergeneration=e});var u=r.get(o.API_ENDPOINT+"api/Invoice/eligable",{params:{from:n.currentPeriod.from,to:n.currentPeriod.to,week:n.currentPeriod.week,month:n.currentPeriod.month,year:n.currentPeriod.year,type:n.currentPeriod.type}});i.push(u),u.success(function(e){n.currentPeriod.eligable=e});var d=r.get(o.API_ENDPOINT+"api/Invoice/attentionRequired",{params:{week:n.currentPeriod.week,month:n.currentPeriod.month,year:n.currentPeriod.year}});i.push(d),d.success(function(e){n.currentPeriod.attentionRequired=e});var s=r.get(o.API_ENDPOINT+"api/Invoice/extrapayments",{params:{from:n.currentPeriod.from,to:n.currentPeriod.to}});i.push(s),s.success(function(e){n.currentPeriod.extraPayments=e,t.forEach(e,function(e){e.Balance=e.InvoiceAmount-e.PaymentsTotal})}),l.all(i).then(function(){n.loading=!1})},500)}function g(){b(moment(n.currentPeriod.from).add(1,"month"),"Month")}function w(){b(moment(n.currentPeriod.from).subtract(1,"month"),"Month")}function N(){return n.currentPeriod.eligable.filter(function(e){return e.$checked}).length}function E(){n.allClientsSelected=!n.allClientsSelected;for(var e=0;e<n.currentPeriod.eligable.length;e++)n.currentPeriod.eligable[e].$checked=n.allClientsSelected}function C(){var e=0;t.forEach(n.currentPeriod.eligable,function(t){t.$checked&&!v(t)&&(t.$checked=!1,t.$status="Generating",e++,r.post(o.API_ENDPOINT+"api/Invoice/autoGenerate",{},{params:{from:n.currentPeriod.from,to:n.currentPeriod.to,year:n.currentPeriod.year,month:n.currentPeriod.month,week:n.currentPeriod.week,clientId:t.Id}}).success(function(e){t.$status="Ready"}).error(function(e){t.$status="Failed"}))}),swal("Invoices Queued","Invoices have been queued for "+e+" selected Client(s)","success")}function O(e,t){r.get(o.API_ENDPOINT+"api/Invoice/approve",{params:{invoiceId:e.Id}}).success(function(n){e.Status="Approved",void 0==t&&swal("Payment Approved","Payment has been approved and will be emailed to Client.","success")})}function A(e,r){function o(e){return"Draft"==e.Status&&0==e.RequiresAttention&&0==n.currentPeriod.undergeneration.filter(function(t){return t.InvoiceId==e.Id}).length}function i(e){return"Approved"==e.Status&&0==n.currentPeriod.undergeneration.filter(function(t){return t.InvoiceId==e.Id}).length}function a(e){return 0==e.PaymentsTotal&&0==n.currentPeriod.undergeneration.filter(function(t){return t.InvoiceId==e.Id}).length}if(r){n.manualBulkMode=e;var c=null;"APPROVE"==e&&(n.manualBulkText="Approve",c=o),"SEND"==e&&(n.manualBulkText="Send to Client",c=i),"CANCEL"==e&&(n.manualBulkText="Cancel",c=a)}else{n.bulkMode=e;var c=null;"APPROVE"==e&&(n.bulkText="Approve",c=o),"SEND"==e&&(n.bulkText="Send to Client",c=i),"CANCEL"==e&&(n.bulkText="Cancel",c=a)}r?t.forEach(n.currentPeriod.extraPayments,function(e){e.$bulk=c(e)}):t.forEach(n.currentPeriod.allInvoices,function(e){e.$bulk=c(e)})}function S(e){e?(n.manualBulkMode=null,t.forEach(n.currentPeriod.extraPayments,function(e){e.$bulk=!1,e.$selected=!1})):(n.bulkMode=null,t.forEach(n.currentPeriod.allInvoices,function(e){e.$bulk=!1,e.$selected=!1}))}function T(e){if(e){var i=n.currentPeriod.extraPayments.filter(function(e){return e.$selected});if("APPROVE"==n.manualBulkMode&&t.forEach(i,O),"SEND"==n.manualBulkMode){var a=i.map(function(e){return e.Id});r.post(o.API_ENDPOINT+"api/invoice/bulksend",a).then(function(){swal("Success","Emails have been queued and Invoices will be emailed shortly.","success")})}"CANCEL"==n.manualBulkMode&&t.forEach(i,D)}else{var i=n.currentPeriod.allInvoices.filter(function(e){return e.$selected});if("APPROVE"==n.bulkMode&&t.forEach(i,O),"SEND"==n.bulkMode){var a=i.map(function(e){return e.Id});r.post(o.API_ENDPOINT+"api/invoice/bulksend",a).then(function(){swal("Success","Emails have been queued and Invoices will be emailed shortly.","success")})}"CANCEL"==n.bulkMode&&t.forEach(i,D)}S(e)}function M(e,t){r.post(o.API_ENDPOINT+"api/Invoice/regenerate",{},{params:{paymentId:e.Id,useStored:!0,recalcBonus:!0}}).success(function(e){b(n.currentPeriod.to,n.currentPeriod.type),void 0==t&&swal("Invoice Queued","Invoice has been queued for re-calculation.","success")})}function D(e,t){r["delete"](o.API_ENDPOINT+"api/Invoice",{params:{id:e.Id}}).success(function(e){b(n.currentPeriod.to,n.currentPeriod.type),void 0==t&&swal("Invoice Cancelled","Invoice has been removed","success")})}function $(e,t){r.get(o.API_ENDPOINT+"api/Invoice/autoSettlePayment",{params:{paymentId:e.Id,method:"BACS"}}).success(function(e){b(n.currentPeriod.to,n.currentPeriod.type),void 0==t&&swal("Payment Settled","BACS payments have been added.","success")})}var x=null;n.currentPeriod={from:null,to:null,year:null,week:null,stats:{},attentionRequired:[],invoices:[],allInvoices:[],eligable:[],extraPayments:[],undergeneration:[]},n.selected={all:f,toggleAll:P},n.openPaymentModal=p,x=r.get(o.API_ENDPOINT+"api/Invoice/periods",{params:{max:52}}),n.tab={current:"GENERATED"},n.searchTerm={},n.payment={},n.estimateSearchTerm={},n.bulkMode=null,n.gotoPeriod=b,n.forward=g,n.back=w,n.lastWeek=moment().subtract(7,"days").startOf("isoweek").format(),n.currentWeek=moment().startOf("isoweek").format(),n.lastMonth=moment().subtract(1,"month").startOf("month").format(),n.currentMonth=moment().startOf("month").format(),n.today=moment(),n.formatUrl=formatUrl,n.allClientsSelected=!1,n.selectAllClients=E,n.getSelectedClientsCount=N,n.autoGenerate=C,n.approvePayment=O,n.reGeneratePayment=M,n.autoSettlePayment=$,n.cancelPayment=D,n.approvePrice=I,n.savePrice=k,n.hasProcessing=v,n.startBulkMode=A,n.cancelBulkMode=S,n.finishBulkMode=T,n.openBooking=h,n.generateGraph=y,n.pieOptions={series:{pie:{show:!0,innerRadius:.6,combine:{color:"#999",threshold:.03},label:{threshold:.03}}},colors:[u.COLOURS.brandPrimary,u.COLOURS.brandSecondary],tooltip:{show:!0,shifts:{x:25,y:0},defaultTheme:!1},grid:{}},n.adjustmentsData=[],n.expensesData=[],n.paymentsData=[];var B=null;b(moment().tz("Europe/London").subtract(1,"month"),"Month"),n.$on("SIGNALR_updateInvoiceGeneration",function(e){b(n.currentPeriod.to,n.currentPeriod.type)}),n.exportSummary=function(){var e="week="+n.currentPeriod.week+"&year="+n.currentPeriod.year;r.get(o.API_ENDPOINT+"api/invoice/Summary?"+e).then(function(e){d.download(e.data,"InvoiceSummary.csv")},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:u.COLOURS.brandSecondary})})}}var r=t.module("cab9.invoices");r.controller("InvoicingSummaryController",n),n.$inject=["$scope","$http","$config","$timeout","Model","$state","$UI","CSV","$filter","$q","$modal"]}(window,angular);;;;
!function(){function e(e,t,n,o,r){function a(){e.showSearch=!0}function c(){var n=t.open({templateUrl:"/webapp/management/invoicing/creditnotes/modals/new-creditnote/partial.html",controller:"NewCreditNoteController",keyboard:!1,backdrop:"static",size:"lg",resolve:{rClients:["Model",function(e){return e.Client.query().select("Id,Name,ImageUrl,ClientType/Name,AccountNo").include("ClientType").parseAs(function(e){this.Id=e.Id,this.Name=e.Name,this.AccountNo=e.AccountNo,this.Description=e.ClientType.Name,this.ImageUrl=formatUrl(e.ImageUrl,e.Name)}).execute()}],rTaxes:["Model",function(e){return e.Tax.query().include("TaxComponents").execute()}]}});n.result.then(function(t){i&&r.cancel(i),i=r(function(){o.CreditNote.query().include("Client").include("Tax").include("Tax/TaxComponents").filter("TaxDate","ge","datetimeoffset'"+e.selected.from.format()+"'").filter("TaxDate","le","datetimeoffset'"+e.selected.to.format()+"'").orderBy("Reference").execute().then(function(t){e.credits=t,i=null})},500)},function(){})}function a(){e.showSearch=!e.showSearch,e.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):e.searchTerm.$=""}e.credits=[],e.searchTerm={},e.toggleSearch=a,e.showSearch=!1,e.openPaymentModal=c,e.start=(new moment).subtract(2,"year"),e.end=(new moment).add(1,"year");var i=null;e.paging={currentPage:1,totalItems:0,maxPerPage:25},e.selected={from:(new moment).startOf("day"),to:(new moment).endOf("day"),span:"day"},e.toggleSearch=a,e.$watchGroup(["selected.span","selected.from.format()","selected.to.format()"],function(t,n){i&&r.cancel(i),i=r(function(){o.CreditNote.query().include("Client").include("Tax").include("Tax/TaxComponents").filter("TaxDate","ge","datetimeoffset'"+e.selected.from.format()+"'").filter("TaxDate","le","datetimeoffset'"+e.selected.to.format()+"'").orderBy("Reference").execute().then(function(t){e.credits=t,i=null})},500)}),e.viewItem=function(e){n.go("root.creditnotes.viewer",{Id:e.Id})}}var t=angular.module("cab9.invoices");t.controller("CreditsModuleTableController",e),e.$inject=["$scope","$modal","$state","Model","$timeout"]}();;;;
!function(e){function t(e,t,a,r,o,n,c,s,d){function i(){var t=new moment("2000-01-01T00:00:00Z"),a=new moment(e.creditNote.TaxDate);t.isAfter(a)&&(e.creditNote.TaxDate=a.add(100,"years").toDate()),e.creditNote.$save().then(function(e){swal("Saved!","New Credit note has been saved, Reference: "+e.data.Reference+".","success"),c.close()},function(){swal("Error!","An error has occured.","error")})}e.creditNote=new o.CreditNote,e.taxes=d,e.creditNote.TaxId=e.COMPANY.DefaultTaxId,e.clients=s,e.displayMode="CREATE",e.save=i}var a=e.module("cab9.invoices");a.controller("NewCreditNoteController",t),t.$inject=["$scope","$state","$UI","$q","Model","$stateParams","$modalInstance","rClients","rTaxes"]}(angular);;;;
!function(){function e(e,t,o,i,n,r,a,c,d,l,s,u,m,N,p,f,C,$){function I(){e.displayMode="EDIT"}function E(){e.creditNote.$patch(!0).success(function(t){e.displayMode="VIEW",l.CreditNote.query().include("Client").where("Id","==","guid'"+s.Id+"'").trackingEnabled().execute().then(function(t){e.creditNote=t[0]}),swal({title:"Credit Note Updated.",text:"Credit Note has been updated.",type:"success",confirmButtonColor:r.COLOURS.brandSecondary})}).error(function(e){var t=null;e&&"INVALID REFERENCE"==e.Message&&(t="Reference already exists!"),swal({title:"Error Occured",text:t,type:"error"})})}function x(){e.creditNote.$rollback(!1),e.displayMode="VIEW"}function A(){e.creditNote.Status="Paid",e.creditNote.$patch()}function y(){u.open({templateUrl:"/webapp/common/modals/email-to-sent.modal.html",controller:["$scope","emailAddress","$modalInstance",function(e,t,o){null!=t&&(e.email=t),e.markSent="Unsent"==e.creditNote,e.sendEmail=function(){o.close({email:e.email,markSent:e.markSent})}}],resolve:{emailAddress:function(){return e.creditNote.Client.BillingEmail||e.creditNote.Client.Email}}}).result.then(function(t){null!=t.email&&C.post(p.API_ENDPOINT+"api/email",{Type:"ClientCreditNoteConfirmation",CreditId:e.creditNote.Id,ClientId:e.creditNote.ClientId,EmailId:t.email}).success(function(){m.success("Email Sent"),t.markSent&&(e.creditNote.Status="Sent",e.creditNote.$patch())})})}function g(){swal({title:"Are you sure?",text:"This Credit Note will be deleted permanentaly",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},function(){e.creditNote.$delete().success(function(){a.go("root.creditnotes",null,{reload:!0})})})}function h(){f.open(p.API_ENDPOINT+"api/CreditNotes/pdf?creditId="+e.creditNote.Id,"_blank")}e.creditNote=t[0],e.taxes=$,e.creditNote.$taxRate=e.creditNote.Tax.TaxComponents.reduce(function(e,t){return e+t.Rate/100},0),e.creditNote.$taxAmount=e.creditNote.Amount*e.creditNote.$taxRate,e.creditNote.$totalAmount=e.creditNote.Amount+e.creditNote.$taxAmount,e.displayMode="VIEW",e.opened={},e.accessors={LogoUrl:function(t){return e.COMPANY?e.COMPANY._ImageUrl:""}},e.exportReceipt=h,e.emailTo=y,e.startEditing=I,e.saveEdits=E,e.cancelEditing=x,e.deleteInvoice=g,e.markPaid=A}var t=angular.module("cab9.invoices");t.controller("CreditNoteItemEditController",e),e.$inject=["$scope","rCredit","$filter","$timeout","Localisation","$UI","$state","$q","$parse","Model","$stateParams","$modal","Notification","Auth","$config","$window","$http","rTaxes"]}();;;;
!function(){function e(e,t,n,i,o,l,r){function a(){e.bulkMode=!0}function s(){f(!1),e.bulkMode=!1}function c(){l.post(r.API_ENDPOINT+"api/invoice/bulksend",e.selectedRows).then(function(){swal("Success","Emails have been queued and Invoices will be emailed shortly.","success"),s()})}function f(t){angular.forEach(e.invoices,function(n){if(n.Client.BillingEmail){n.$selected=t;var i=e.selectedRows.indexOf(n.Id);i>-1&&!n.$selected?e.selectedRows.splice(i,1):i==-1&&n.$selected&&e.selectedRows.push(n.Id)}})}function u(t){t.$selected=!t.$selected;var n=e.selectedRows.indexOf(t.Id);n>-1&&!t.$selected?e.selectedRows.splice(n,1):n==-1&&t.$selected&&e.selectedRows.push(t.Id)}function d(){return e.invoices.some(function(e){return e.$selected})}function m(){return e.invoices.every(function(e){return!e.Client.BillingEmail||e.$selected})}function g(){v(1)}function p(){t.open({templateUrl:"/webapp/management/invoicing/invoices/modals/filter.modal.partial.html",controller:["$scope","rFilter","$modalInstance",function(e,t,n){function i(t){t&&(e.loadingClients=!0,l.get(r.API_ENDPOINT+"api/Clients/Search",{params:{searchText:t,lite:!0}}).then(function(t){e.clients=[];for(var n=0;n<t.data.length;n++){var i=t.data[n];e.clients.push({Id:i.Id,Name:"("+i.AccountNo+") "+i.Name,Description:i.ClientType&&i.ClientType.Name?i.ClientType.Name:""})}e.loadingClients=!1}))}function o(t,n){e.filterOptions[n]=[t]}function a(){n.close(e.filterOptions)}e.filterOptions=angular.copy(t),e.clients=e.filterOptions.Clients,e.searchClients=i,e.saveSelected=o,setTimeout(function(){$("#daterangepicker_bookings").daterangepicker({locale:{format:"DD/MM/YYYY"},autoApply:!0,startDate:moment(e.filterOptions.date.from).startOf("day"),endDate:moment(e.filterOptions.date.to).endOf("day"),opens:"right",parentEl:"#time-controls",ranges:{Today:[moment().startOf("day"),moment().endOf("day")],"This Week":[moment().startOf("isoweek"),moment().endOf("isoweek")],"This Month":[moment().startOf("month"),moment().endOf("month")]},alwaysShowCalendars:!0}),$("#daterangepicker_bookings").on("apply.daterangepicker",function(t,n){e.filterOptions.date.selectedPeriod=n.chosenLabel,e.filterOptions.date.from=n.startDate.toISOString(),e.filterOptions.date.to=n.endDate.toISOString(),"Custom Range"==e.filterOptions.date.selectedPeriod&&(e.filterOptions.date.selectedPeriod+=" ("+moment(e.filterOptions.date.from).format("DD/MM/YYYY")+" - "+moment(e.filterOptions.date.to).format("DD/MM/YYYY")+")"),e.$apply()})},100),e.datePickers={from:!1,to:!1},e.openDatePicker=function(t,n){e.datePickers[n]=!e.datePickers[n],event.preventDefault(),event.stopPropagation()},e.confirmFilters=a}],resolve:{rFilter:function(){return e.filter}},size:"lg"}).result.then(function(t){e.filter=t})}function h(){var e=t.open({templateUrl:"/webapp/management/invoicing/invoices/modals/new-invoice/partial.html",controller:"NewInvoiceInitController",keyboard:!1,backdrop:"static",size:"lg",resolve:{rClients:["Model",function(e){return e.Client.query().select("Id,Name,AccountNo,ImageUrl,InvoicePeriod,ClientTypeId,ClientType/Name").include("ClientType").parseAs(function(e){this.Id=e.Id,this.Name=e.Name,this.AccountNo=e.AccountNo,this.InvoicePeriod=e.InvoicePeriod,this.Description=e.ClientType.Name,this.ClientTypeId=e.ClientTypeId,this.ImageUrl=formatUrl(e.ImageUrl,e.Name)}).execute()}]}});e.result.then(function(e){},function(){})}function I(){e.showSearch=!e.showSearch,e.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):e.searchTerm.$=""}function v(t){e.paging.currentPage=t,e.loading=!0;var n=new moment(e.filter.date.from),o=new moment(e.filter.date.to),l=i.Invoice.query().include("Payments,Client").select("Id,Reference,Client/BillingEmail,Client/Name,Client/AccountNo,Status,TotalAmount,NoOfBookings,CreationTime,DueDate").filter("InvoiceType","eq","'Client'").skip(e.paging.resultsPerPage*(e.paging.currentPage-1)).top(e.paging.resultsPerPage).orderBy("DueDate");if(e.searchTerm.$.length>0)l.where("substringof('"+e.searchTerm.$+"', Reference) or substringof('"+e.searchTerm.$+"', Client/Name) or substringof('"+e.searchTerm.$+"', Client/AccountNo)");else{l.filter("DueDate","ge","datetimeoffset'"+n.format()+"'").filter("DueDate","le","datetimeoffset'"+o.format()+"'"),e.filter.ClientId&&l.filter("ClientId","==","guid'"+e.filter.ClientId+"'"),e.filter.Amount.from&&l.filter("TotalAmount","ge",e.filter.Amount.from),e.filter.Amount.to&&l.filter("TotalAmount","le",e.filter.Amount.to);var r="";if(e.filter.Status)for(var a=Object.keys(e.filter.Status),s=0;s<a.length;s++)e.filter.Status[a[s]]&&(r+=r.length>0?" or ":"(",r+="Status eq '"+a[s]+"'");r.length>0?r+=")":r="1 eq 1",l.where(r)}l.execute().then(function(t){e.invoices=t,e.selectedRows.length>0&&(t=t.map(function(t){return e.selectedRows.indexOf(t.Id)>-1&&(t.$selected=!0),t})),e.loading=!1},function(t){e.loading=!1,swal("Error","Please try again or contact admin","error")})}e.invoices=[],e.searchTerm={$:""},e.toggleSearch=I,e.filterInvoices=g,e.showSearch=!1,e.loading=!0,e.openPaymentModal=h,e.bulkMode=!1,e.selectedRows=[],e.startBulk=a,e.cancelBulk=s,e.submitBulk=c,e.selectAll=f,e.anySelected=d,e.allSelected=m,e.toggleRowSelection=u;e.paging={currentPage:1,resultsPerPage:20,totalResults:null,maxPages:null},e.setPage=v,e.showFilterModal=p,e.filter={date:{from:moment().subtract(7,"days").startOf("isoweek"),to:moment().subtract(7,"days").endOf("isoweek"),span:"week",selectedPeriod:"This Week"},Amount:{from:null,to:null},ClientId:null,Clients:[],Status:{Unsent:!0,Unpaid:!0,Paid:!1}},e.$on("SIGNALR_updateInvoiceStatus",function(t,n){var i=n[0],o=e.invoices.filter(function(e){return e.Id==i.Id})[0];o&&(o.Status=i.Status),e.$apply()}),e.$watchGroup(["filter.date.from.valueOf()","filter.date.to.valueOf()","searchTerm.$","filter.ClientId","filter.Status.Unsent","filter.Status.Unpaid","filter.Status.Paid","filter.Amount.from","filter.Amount.to"],function(t,n){e.loading=!0,e.selectedRows.length=0;var o=new moment(e.filter.date.from),l=new moment(e.filter.date.to),r=i.Invoice.query().filter("InvoiceType","eq","'Client'").select("Id").parseAs(function(e){this.Id=e.Id});if(e.searchTerm.$.length>0)r.where("substringof('"+e.searchTerm.$+"', Reference) or substringof('"+e.searchTerm.$+"', Client/Name) or substringof('"+e.searchTerm.$+"', Client/AccountNo)");else{r.filter("DueDate","ge","datetimeoffset'"+o.format()+"'").filter("DueDate","le","datetimeoffset'"+l.format()+"'"),e.filter.ClientId&&r.filter("ClientId","==","guid'"+e.filter.ClientId+"'"),e.filter.Amount.from&&r.filter("TotalAmount","ge",e.filter.Amount.from),e.filter.Amount.to&&r.filter("TotalAmount","le",e.filter.Amount.to);var a="";if(e.filter.Status)for(var s=Object.keys(e.filter.Status),c=0;c<s.length;c++)e.filter.Status[s[c]]&&(a+=a.length>0?" or ":"(",a+="Status eq '"+s[c]+"'");a.length>0?a+=")":a="1 eq 1",r.where(a)}r.execute().then(function(t){e.paging.totalResults=t.length,e.paging.maxPages=Math.ceil(e.paging.totalResults/e.paging.resultsPerPage),v(1)})}),e.viewItem=function(e){n.go("root.invoices.viewer",{Id:e.Id})}}var t=angular.module("cab9.invoices");t.controller("InvoicesModuleTableController",e),e.$inject=["$scope","$modal","$state","Model","$timeout","$http","$config"]}();;;;
!function(){function e(e,n,t,o,i,c,r,a,s,l,u,d,f){function g(){var t={From:e.range.From,To:e.range.To,ClientIds:e.range.ClientIds};d.post(f.API_ENDPOINT+"api/Invoice/Previews",t).success(function(o){angular.forEach(o,function(o){var i=e.clients.filter(function(e){return e.Id==o.ClientId})[0],r=[];angular.forEach(o.Bookings,function(e){e=new n.Booking(e),e.BookingStops=c("orderBy")(e.BookingStops,"StopOrder"),e.$selected=!0,e.$commit(),r.push(e)}),angular.forEach(o.Adjustments,function(e){e.$selected=!0});var a=new n.Invoice;a.InvoiceSplitValue=o.SplitValue,a.InvoiceSplitField=o.SplitField,a.InvoiceGroupField=o.GroupField,a.Bookings=r,a.Adjustments=o.Adjustments,a.ClientId=o.ClientId,a.Client=i,a.PaymentInstructions=e.COMPANY.DefaultInvoicePaymentInstructions,a.$allSelected=!0,a.$allAdjustmentsSelected=!0,a.DueDate=new moment(t.To).subtract(12,"hours").toDate(),[].push.apply(e.invoices,[a])}),e.fetching=!1}).error(function(e){swal("Error","Something didn't work, please check the details and try again.","error")})}function v(){l.go("root.invoices")}function m(n,t){var o=e.taxes.filter(function(e){return e.Id==n})[0];t.Tax=o}function I(e,n){"Bookings"==n?(e.$allSelected=!e.$allSelected,angular.forEach(e.Bookings,function(n){e.$allSelected?n.$selected=!0:n.$selected=!1})):"Adjustments"==n&&(e.$allAdjustmentsSelected=!e.$allAdjustmentsSelected,angular.forEach(e.Adjustments,function(n){e.$allAdjustmentsSelected?n.$selected=!0:n.$selected=!1}))}function p(n,t){var o=0;return angular.forEach(e.getSelectedBookings(n),function(e){o+=parseFloat(e[t])}),o}function $(n){var t=0;return angular.forEach(e.getSelectedBookings(n),function(e){var n=0;n=(e.InvoiceCost+e.WaitingCost+e.ExtrasCost-e.Discount)*e.Tax._TaxAmount,t+=n}),t}function S(n){var t=angular.copy(n);t.ClientId&&(t.InvoiceType="Client"),t.Reference||(t.Reference="AUTO"),t.Bookings=e.getSelectedBookings(n),t.Adjustments=e.getSelectedAdjustments(n),t.$save().success(function(t){u.success("Invoice Saved");var o=e.invoices.indexOf(n);e.invoices.splice(o,1),0===e.invoices.length&&l.go("root.invoices",null,{reload:!0})}).error(function(e){var n=null;e&&"INVALID REFERENCE"==e.Message&&(n="Reference already exists!"),swal({title:"Error Occured",text:n,type:"error"})})}function h(n){var t=e.invoices.indexOf(n);e.invoices.splice(t,1)}if(!o.data)return void l.go("root.invoices");e.taxes=i,e.opened={},e.currency=r.currency().getCurrent().Prepend,e.invoices=[],e.selectedClient=null,e.fetching=!0,e.data=!0,e.clients=t;new Date;e.range={From:o.data.PaymentFrom,To:o.data.PaymentTo,ClientIds:o.data.clientIds},g(),e.fetchBookings=g,e.cancelEditing=v,e.setTax=m,e.toggleSelectAll=I,e.BookingsTotal=p,e.TaxesTotal=$,e.cancelInvoice=h,e.confirmInvoice=S,e.expand=function(n){e.selectedClient=n},e.round=function(e){return Math.round(100*e)/100},e.getSelectedBookings=function(e){var n=[];return angular.forEach(e.Bookings,function(e){e.$selected&&n.push(e)}),n},e.getSelectedAdjustments=function(e){var n=[];return angular.forEach(e.Adjustments,function(e){e.$selected&&n.push(e)}),n}}var n=angular.module("cab9.invoices");n.controller("InvoiceItemCreateController",e),e.$inject=["$scope","Model","rClients","$stateParams","rTaxes","$filter","Localisation","$q","$UI","$state","Notification","$http","$config"]}();;;;
!function(){function e(e,n,o,t,i,a,c,r,u,s,l,d,v,f,m,g,I,p,k){function T(e){p.post(g.API_ENDPOINT+"api/Invoice/setInvoiceCost",null,{params:{bookingId:e.Id,cost:e.InvoiceCost}}).then(function(e){r.go(r.current.name,r.current.params,{reload:!0})})}function h(){var n=e.invoice.Bookings.filter(function(e){return e.$selected});p.post(g.API_ENDPOINT+"api/Invoice/removeBookings",n.map(function(e){return e.Id})).then(function(){for(var o=0;o<n.length;o++){var t=n[o],i=e.invoice.Bookings.indexOf(t);e.invoice.Bookings.splice(i,1)}l.Invoice.query().include("Client").where("Id","==","guid'"+d.Id+"'").trackingEnabled().execute().then(function(n){var o=n[0];o.Bookings=e.invoice.Bookings,e.invoice=o,e.invoice.InvoiceDetails||(e.invoice.InvoiceDetails=[]),e.invoice.$commit()}),e.days=[],B()})}function B(){if(e.invoice.Bookings=t("orderBy")(e.invoice.Bookings,"BookedDateTime"),e.invoice.$commit(),e.invoice.InvoiceGroupField){var n=null;switch(e.invoice.InvoiceGroupField){case"Passenger":n=s("LeadPassenger.Firstname + ' ' + LeadPassenger.Surname");break;case"Booker":n=s("ClientStaff.Firstname + ' ' + ClientStaff.Surname");break;case"Reference":n=s("Reference");break;default:n=function(n){var o=n.BookingValidations.filter(function(n){return n.ClientReferenceReferenceName==e.invoice.InvoiceGroupField})[0];return o?o.Value:"None"}}angular.forEach(e.invoice.Bookings,function(o){var t=n(o),i=e.days.filter(function(n){return n.date==e.invoice.InvoiceGroupField+": "+t})[0];i?i.bookings.push(o):e.days.push({date:e.invoice.InvoiceGroupField+": "+t,bookings:[o]})})}else angular.forEach(e.invoice.Bookings,function(n){var o=t("companyDate")(new moment(n.BookedDateTime),"DD/MM/YYYY"),i=e.days.filter(function(e){return e.date==o})[0];i?i.bookings.push(n):e.days.push({date:o,bookings:[n]})});angular.forEach(e.days,function(e){e.InvoiceCost=e.bookings.reduce(function(e,n){return e+=n.InvoiceCost},0),e.WaitingCost=e.bookings.reduce(function(e,n){return e+=n.WaitingCost},0),e.ExtrasCost=e.bookings.reduce(function(e,n){return e+=n.ExtrasCost},0),e.AdjustmentTotal=e.bookings.reduce(function(e,n){return e+=n.AdjustmentTotal},0),e.Discount=e.bookings.reduce(function(e,n){return e+=n.Discount},0),e.TaxAmount=e.bookings.reduce(function(e,n){return e+=n.Tax?(n.AdjustmentTotal+n.InvoiceCost-n.Discount+n.WaitingCost)*n.Tax._TaxAmount+n.$ExtrasTax+n.$AdjustTax:0},0),e.TotalAmount=e.InvoiceCost+e.AdjustmentTotal-e.Discount+e.TaxAmount+e.ExtrasCost+e.WaitingCost})}function x(){v.open({templateUrl:"/webapp/common/modals/email-to-sent.modal.html",controller:["$scope","emailAddress","$modalInstance",function(e,n,o){null!=n&&(e.email=n),e.markSent=!0,e.sendEmail=function(){o.close({email:e.email,markSent:e.markSent})}}],resolve:{emailAddress:function(){return e.invoice.Client.BillingEmail||e.invoice.Client.Email}}}).result.then(function(n){null!=n.email&&p.post(g.API_ENDPOINT+"api/email",{Type:"ClientInvoiceConfirmation",InvoiceId:e.invoice.Id,ClientId:e.invoice.ClientId,EmailId:n.email}).success(function(){var o=new l.Invoice({Id:e.invoice.Id,Status:"Something"});f.success("Email Sent"),n.markSent&&(o.Status="Sent",o.$patch())})})}function y(){e.displayMode="EDIT"}function E(){var n=angular.copy(e.invoice.Bookings);e.invoice.Bookings.length=0,e.invoice.$patch(!0).success(function(o){e.invoice.Bookings=n,e.fetchingBookings=!1,swal({title:"Invoice Updated.",text:"Invoice has been updated.",type:"success",confirmButtonColor:c.COLOURS.brandSecondary}),e.displayMode="VIEW"}).error(function(o){var t=null;e.invoice.Bookings=n,e.fetchingBookings=!1,o&&"INVALID REFERENCE"==o.Message&&(t="Reference already exists!"),swal({title:"Error Occured",text:t,type:"error"})})}function C(){var n=0;return angular.forEach(e.payments,function(e){n+=parseFloat(e.AmountPaid)}),n}function A(){swal({title:"Are you sure?",text:"This invoice will be deleted permanentaly",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},function(){e.invoice.$delete().success(function(){r.go("root.invoices",null,{reload:!0})})})}function D(){e.invoice.$rollback(!1),e.displayMode="VIEW"}function P(){e.invoice.Bookings.length!=savedBookings.length&&(e.invoice.Bookings=[],[].push.apply(e.invoice.Bookings,savedBookings),angular.forEach(e.invoice.Bookings,function(e){e.$selected=!0})),l.Booking.query().filter("BookedDateTime","ge","datetimeoffset'"+new moment(e.range.From).startOf("day").format()+"'").filter("BookedDateTime","le","datetimeoffset'"+new moment(e.range.To).endOf("day").format()+"'").filter("BookingStatus","==","'Completed'").filter("InvoiceId","==",null).filter("ClientId","==","guid'"+e.invoice.ClientId+"'").include("LeadPassenger, BookingStops, Tax/TaxComponents").orderBy("BookedDateTime").execute().then(function(n){angular.forEach(n,function(e){e.BookingStops=t("orderBy")(e.BookingStops,"StopOrder"),e.$commit()}),[].push.apply(e.invoice.Bookings,n)})}function S(n,o){o.Tax=e.taxes.filter(function(e){return e.Id==n})[0]}function $(n,o){e.opened[o]=!0,n.preventDefault(),n.stopPropagation()}function w(){return e.invoice.Bookings.some(function(e){return e.$selected})}function b(){return e.invoice.Bookings.every(function(e){return e.$selected})}function N(){var n=e.allSelected();angular.forEach(e.invoice.Bookings,function(e){e.$selected=!n})}function O(){var n=0,o=e.getSelectedBookings();return angular.forEach(o,function(e){n+=(e.InvoiceCost+e.WaitingCost+e.ExtrasCost+e.AdjustmentTotal-e.Discount)*(1+e.Tax._TaxAmount)}),n}function _(){var n=0;return angular.forEach(e.getSelectedBookings(),function(e){var o=0;o=""==e.Discount||null==e.Discount?e.Tax?e.InvoiceCost*e.Tax._TaxAmount:0:e.Tax?(e.InvoiceCost-e.Discount)*e.Tax._TaxAmount:0,n+=o}),angular.forEach(e.invoice.InvoiceDetails,function(e){var o=0;e.UnitPrice&&e.Quantity&&(o=e.Tax?e.UnitPrice*e.Quantity*e.Tax._TaxAmount:0),n+=o}),n}function j(){var n=v.open({templateUrl:"/webapp/management/invoicing/invoices/modals/payments-modal.partial.html",controller:"PaymentsModalCtrl",size:"lg",windowClass:"invoice-payment",resolve:{rInvoiceSummary:function(){var n={InvoiceRef:e.invoice.Reference,SubTotal:e.invoice.SubTotal-H(),TaxAmount:e.invoice.TaxAmount,TotalAmount:e.invoice.TotalAmount};return n},rInvoice:function(){return e.invoice},rPayments:["Model",function(e){return e.Payment.query().trackingEnabled().where("InvoiceId","==","guid'"+d.Id+"'").execute()}]}});n.result.then(function(){u.all([n,o]).then(function(){f.success("Invoice Refreshed")});var n=l.Payment.query().where("InvoiceId","==","guid'"+d.Id+"'").execute().then(function(n){e.payments=n}),o=l.Invoice.query().select("Status").where("Id","==","guid'"+d.Id+"'").execute().then(function(n){e.invoice.Status=n[0].Status})},function(){})}function M(){e.invoice.$patch(!0).success(function(e){})}function R(){p({method:"POST",url:g.API_ENDPOINT+"/api/invoice/markpaid?invoiceId="+d.Id}).then(function(n){swal("Success","Invoice is marked as paid.","success"),e.invoice.Status="Paid"},function(e){swal("Error","There was an error marking the invoice as paid.","error")})}function U(){I.open(g.API_ENDPOINT+"api/Invoice/pdf?invoiceId="+e.invoice.Id,"_blank")}function F(){I.open(g.API_ENDPOINT+"api/Invoice/excel?invoiceId="+e.invoice.Id,"_blank")}function W(e){var n=0,o=0;return e.UnitPrice&&e.Quantity&&(o=e.UnitPrice*e.Quantity,n=o+(e.Tax?e.Tax._TaxAmount*o:0)),n}function L(){e.newItem=new l.InvoiceDetail,e.newItem.Quantity=1,e.newItem.UnitPrice=0,e.newItem.InvoiceId=e.invoice.Id,e.invoice.InvoiceDetails.push(e.newItem)}function Q(n){var o=e.invoice.InvoiceDetails.indexOf(n);e.invoice.InvoiceDetails.splice(o,1)}function Y(){var n=0,o=e.getSelectedBookings();return angular.forEach(o,function(e){n+=e.WaitingCost}),n}function q(){var n=0,o=e.getSelectedBookings();return angular.forEach(o,function(e){n+=e.InvoiceCost}),n}function G(){var n=0;return angular.forEach(e.invoice.InvoiceDetails,function(e){e.UnitPrice&&e.Quantity&&(n+=e.UnitPrice*e.Quantity)}),n}function V(){var n=0,o=e.getSelectedBookings();return angular.forEach(o,function(e){n+=e.ExtrasCost}),n}function z(){var n=0,o=e.getSelectedBookings();return angular.forEach(o,function(e){n+=e.AdjustmentTotal}),n}function J(){var n=0,o=e.getSelectedBookings();return angular.forEach(o,function(e){n+=(e.InvoiceCost+e.WaitingCost+e.ExtrasCost+e.AdjustmentTotal-e.Discount)*e.Tax._TaxAmount}),n}function H(n){var o=0;return angular.forEach(e.invoice.Adjustments,function(e){var t=(e.ClientAdjustment||e.ClientPricingModelAdjustment).Type;"Debit"==t&&(o=o+e.Amount-(n?0:e.TaxAmount)),"Credit"==t&&(o-=e.Amount-(n?0:e.TaxAmount))}),o}e.invoice=n[0],e.invoice.Bookings=[];var K={};angular.forEach(i,function(e){e.$rate=e.TaxComponents.reduce(function(e,n){return e+n.Rate/100},0),K[e.Id]=e.$rate}),e.fetchingBookings=!0,p({method:"GET",url:g.API_ENDPOINT+"/api/invoice/bookings?invoiceId="+e.invoice.Id}).then(function(n){e.invoice.Bookings=n.data,e.fetchingBookings=!1},function(n){e.fetchingBookings=!1}),e.invoice.$commit(),e.displayMode="VIEW",e.payments=o,e.days=[],e.taxes=i,e.currency=a.currency().getCurrent()&&a.currency().getCurrent().Prepend||"�",e.opened={},e.invoice.InvoiceDetails||(e.invoice.InvoiceDetails=[]),e.invoice.$dueDate=moment(e.invoice.DueDate).add(k[0].DefaultInvoiceDueDateOffset||30,"days").toDate(),e.accessors={LogoUrl:function(n){return e.COMPANY?e.COMPANY._ImageUrl:""}};new Date;e.range={From:(new moment).subtract(1,"month").toDate(),To:(new moment).toDate()},e.saveBookingEdit=T,e.startEditing=y,e.saveEdits=E,e.cancelEditing=D,e.fetchBookings=P,e.setTax=S,e.openCalendar=$,e.toggleSelectAll=N,e.BookingsTotal=O,e.TaxesTotal=_,B(),e.logPayments=j,e.markStatus=M,e.markAsPaid=R,e.calculatePaidAmount=C,e.exportReceipt=U,e.exportReceiptExcel=F,e.emailTo=x,e.allSelected=b,e.anySelected=w,e.deleteInvoice=A,e.calculateExtrasCost=W,e.addExtras=L,e.deleteItem=Q,e.BExtrasTotal=V,e.ExtrasTotal=G,e.AdjustmentsTotal=H,e.BAdjustmentsTotal=z,e.WaitingTotal=Y,e.BTaxesTotal=J,e.JourneyTotal=q,e.removeBookings=h,e.round=function(e){return Math.round(100*e)/100},e.getSelectedBookings=function(){var n=[];return angular.forEach(e.invoice.Bookings,function(e){e.$selected&&n.push(e)}),n}}var n=angular.module("cab9.invoices");n.controller("InvoiceItemEditController",e),e.$inject=["$scope","rInvoice","rPayments","$filter","rTaxes","Localisation","$UI","$state","$q","$parse","Model","$stateParams","$modal","Notification","Auth","$config","$window","$http","rCompany"]}();;;;
!function(e){function t(t,n,l,o,a,r,c,m,s){function d(){return t.clients.filter(function(e){return e.$checked}).length}function u(e){return!(e.ClientTypeId!=t.selected.ClientType&&t.selected.ClientType||e.InvoicePeriod!==t.selected.BillingPeriod&&t.selected.BillingPeriod)}function y(e,n){t.opened[n]=!0,e.preventDefault(),e.stopPropagation()}function p(){if(t.allClientsSelected=!t.allClientsSelected,t.selected.ClientType)for(i=0,len=t.clients.length;i<len;i++)t.clients[i].ClientTypeId==t.selected.ClientType&&(t.clients[i].$checked=t.allClientsSelected);else t.clients=t.clients.map(function(e){return e.$checked=t.allClientsSelected,e})}function f(){var e=[];for(i=0,len=t.clients.length;i<len;i++)t.clients[i].$checked&&e.push(t.clients[i].Id);c.close(),null==t.payment.PaymentFrom&&(t.payment.PaymentFrom=(new moment).subtract(1,"year").startOf("isoweek").toDate()),n.go("root.invoices.create",{data:{PaymentFrom:h(t.payment.PaymentFrom).format(),PaymentTo:h(t.payment.PaymentTo).format(),clientIds:e}})}function h(e){var t=moment.tz(e,s.timeZone().getTimeZone());return t}t.clients=m.map(function(e){return e.$checked=!1,e}),t.allDriverSelected=!1,t.clientFilter=u,t.getSelectedCount=d,t.$watchGroup(["payment.PaymentTo","payment.PaymentFrom"],function(){var n=h(null!=t.payment.PaymentFrom?t.payment.PaymentFrom:(new moment).subtract(1,"year").startOf("isoweek")).format(),l=h(t.payment.PaymentTo).format();a.Booking.query().select("Id,ClientId,LocalId").where("BookedDateTime ge datetimeoffset'"+n+"'").where("BookedDateTime le datetimeoffset'"+l+"'").where("InvoiceId eq null").where("ClientId ne null").where("(BookingStatus eq 'Completed' or BookingStatus eq 'COA')").where("PaymentMethod eq 'OnAccount'").where("Dispute eq false").execute().then(function(n){e.forEach(t.clients,function(e){e.$bookings=n.filter(function(t){return t.ClientId==e.Id}).length})})}),a.ClientType.query().execute().then(function(e){t.clientTypes=e},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:l.COLOURS.brandSecondary})}),t.billingPeriods=["Daily","Weekly","BiWeekly","Monthly"],t.selected={ClientIds:null,BillingPeriod:null,ClientType:null},t.opened={},t.payment=new a.DriverPayment,t.payment.PaymentFrom=null,t.payment.PaymentTo=(new moment).subtract(1,"month").endOf("month").toDate(),t.payment.Driver=null,t.payment.PaymentModel=null,t.payment.Bill=new a.Bill,t.payment.Bill.DueDate=(new moment).add(1,"month").toDate(),t.payment.Invoice=new a.Invoice,t.payment.Invoice.DueDate=(new moment).add(1,"month").toDate(),t.payment.Invoice.InvoiceType="Driver",t.payment.Invoice.PaymentInstructions=t.COMPANY.DefaultInvoicePaymentInstructions,t.openCalendar=y,t.selectAllClients=p,t.proceed=f}var n=e.module("cab9.invoices");n.controller("NewInvoiceInitController",t),t.$inject=["$scope","$state","$UI","$q","Model","$stateParams","$modalInstance","rClients","Localisation"]}(angular);;;;
!function(){function e(e,n,t,a,c,r,o,i,m){function s(){e.newPayment=new r.Payment,e.newPayment.InvoiceId=o.Id}function l(n){n.TransactionId?swal("Edit Not Authorised","This payment is linked to a card transaction and cannot be edited.","error"):e.selected=n}function d(n,t){var a=parseFloat(e.invoice.TotalAmount.toFixed(2));return a-e.calculatePaidAmount()-t<0||!n.PaymentDate||!n.Reference||!n.AmountPaid||n.AmountPaid<=0||!n.PaymentType}function u(){e.fetchingClientCards=!0,e.cardPaymentForm=!0,r.PaymentCard.query().where("ClientId eq guid'"+e.invoice.ClientId+"'").where("Active eq true").execute().then(function(n){e.fetchingClientCards=!1,e.clientCards=n})}function y(){e.cardPaymentForm=!1}function P(){e.paymentParams.collectingPayment=!0,e.paymentParams.PaymentCard&&e.paymentParams.Amount>0?c({method:"POST",url:m.API_ENDPOINT+"api/Invoice/TakePayment?invoiceId="+e.invoice.Id+"&paymentCardId="+e.paymentParams.PaymentCard.Id+"&amount="+e.paymentParams.Amount}).then(function(n){swal("Payment Successful","Payment has been taken successfully using the selected card.","success"),e.cardPaymentForm=!1,C(),e.paymentParams.collectingPayment=!1,e.paymentParams={}},function(n){swal("Payment Error","An error occurred while collecting payment. "+n.data.Message,"error"),e.paymentParams.collectingPayment=!1}):(swal("Payment Error","Please make sure that a card is selected and payment amount is more than £0.00.","error"),e.paymentParams.collectingPayment=!1)}function p(n){n.TransactionId?swal("Edit Not Authorised","This payment is linked to a card transaction and cannot be edited.","error"):n.PaymentDate&&n.AmountPaid>0&&n.PaymentType&&(n.$patch().success(function(){swal("Success","Payment Updated","success"),C()}),e.selected=null)}function f(){e.newPayment.PaymentDate&&e.newPayment.AmountPaid>0&&e.newPayment.PaymentType&&e.newPayment.$save().success(function(){e.newPayment=null,C()}).error(function(){swal({title:"Error Occured",type:"error"})})}function w(n){n.$rollback(),e.selected=null}function h(){e.newPayment=null}function A(e){swal({title:"Are you sure?",text:"This payment will be deleted permanentaly",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){e.TransactionId?swal("Deletion Not Authorised","This payment is linked to a card transaction and cannot be deleted.","error"):(e.$delete().success(C),swal("Deleted","This payment has been deleted.","success"))})}function C(){r.Payment.query().where("InvoiceId","==","guid'"+o.Id+"'").execute().then(function(n){e.payments=n})}function I(e){e.preventDefault(),e.stopPropagation()}function T(){var n=0;return angular.forEach(e.payments,function(e){n+=parseFloat(e.AmountPaid)}),n}e.payments=t,e.summary=n,e.invoice=a,e.opened={},e.CARD_PAYMENTS_ENABLED=m.CARD_PAYMENTS_ENABLED,e.selected=null,e.newPayment=null,e.clientCards=null,e.paymentParams={},e.checkPaymentValidity=d,e.selectPayment=l,e.updatePayment=p,e.cancelUpdate=w,e.deletePayment=A,e.createNewPayment=s,e.createNewCreditCardPayment=u,e.cancelNewCardPayment=y,e.takeInvoiceCardPayment=P,e.cancelSave=h,e.savePayment=f,e.openCalendar=I,e.calculatePaidAmount=T,e.paymentTypes=null,e.paymentTypes=(new r.Payment).$$schema.PaymentType["enum"]}var n=angular.module("cab9.invoices");n.controller("PaymentsModalCtrl",e),e.$inject=["$scope","rInvoiceSummary","rPayments","rInvoice","$http","Model","$stateParams","$modal","$config"]}();;;;
!function(e,t){function r(e,t,r,a,n,i,s,o,l,u,d){function c(t){e.drivers.length=0,t&&n.Driver.query().where("substringof('"+t+"', concat(concat(Firstname, ' '), Surname)) or substringof('"+t+"', Callsign)").select("Id,Firstname,Surname,Callsign,SupplierNo").include("DriverType").execute().then(function(t){[].push.apply(e.drivers,t)})}function f(){t.get(r.API_ENDPOINT+"api/invoice/driver/count",{params:{from:e.filters.from,to:e.filters.to,driverId:e.filters.driverId,status:e.filters.status}}).then(function(t){e.paging.totalItems=t.data})}function m(a){e.results=null;var n=(a-1)*e.paging.maxPerPage;t.get(r.API_ENDPOINT+"api/invoice/driver",{params:{from:e.filters.from,to:e.filters.to,driverId:e.filters.driverId,status:e.filters.status,top:e.paging.maxPerPage,skip:n}}).then(function(t){e.results=t.data})}e.results=null,e.paging={currentPage:1,totalItems:1e4,maxPerPage:30},e.open={},e.filters={from:(new moment).subtract(28,"days").startOf("day").toDate(),to:(new moment).endOf("day").toDate(),driverId:null,status:null},e.drivers=[],e.statuses=[{Id:null,Name:"All Statuses"},{Id:0,Name:"Draft"},{Id:1,Name:"Approved"},{Id:2,Name:"Pending"},{Id:3,Name:"Settled"}],e.searchDrivers=c,e.$watch("filters",function(){f(),m(1)},!0),e.$watch("paging.currentPage",m)}var a=t.module("cab9.invoices");a.controller("DriverInvoiceTableController",r),r.$inject=["$scope","$http","$config","$timeout","Model","$state","$UI","CSV","$filter","$q","$modal"]}(window,angular);;;;
!function(e,t){function r(e,t,r,n){n.test("driverpayments")&&(e.state("root.driverpayments",{url:"/driverpayments",permission:"Driver Payments",views:{"content-wrapper@root":{templateUrl:"/webapp/management/driver-payments-new/driver-payments.partial.html",controller:"DriverPaymentsSummaryController"}},resolve:{}}),n.test("driverpayments.viewer")&&(e.state("root.driverpayments.viewer",{url:"/{Id:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}}",permission:"View Payment",views:{"content-wrapper@root":{templateUrl:"/webapp/management/driver-payments/item/driver-payments-viewer.partial.html",controller:"DriverPaymentsItemController"}},resolve:{rDPayment:["Model","$stateParams",function(e,t){return e.DriverPayment.query().include("Driver","PaymentModel","Invoice/Payments","Bill/BillPayments").where("Id","==","guid'"+t.Id+"'").trackingEnabled().execute()}],rTaxes:["Model",function(e){return e.Tax.query().execute()}],rBookings:["Model","$stateParams","rDPayment",function(e,t,r){return e.Booking.query().include("LeadPassenger, BookingStops, VehicleType, Client").where("DriverPaymentId","==","guid'"+t.Id+"'").execute().then(function(e){r[0].Bookings=e})}],rAdjustments:["Model","$stateParams",function(e,t){return e.DriverPaymentAdjustment.query().where("DriverPaymentId","==","guid'"+t.Id+"'").include("DriverPaymentModelAdjustment,DriverAdjustment").trackingEnabled().execute()}],rDrivers:["Model",function(e){return e.Driver.query().select("Id,Firstname,Surname,Callsign,ImageUrl, Address1, Address2, TownCity, Postcode, DriverType/Name").include("DriverType/DefaultDriverPaymentModel").include("DefaultDriverPaymentModel").parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname+" ("+e.Callsign+")",this.Description=e.DriverType.Name,this.ImageUrl=o(e.ImageUrl,e.Callsign),this.Address1=e.Address1,this.Address2=e.Address2,this.TownCity=e.TownCity,this.Postcode=e.Postcode}).execute()}],rTabs:[function(){var e=[{heading:"Summary",allow:!0,route:"root.driverpayments.viewer.summary"},{heading:"Pay to Driver",route:"root.driverpayments.viewer.bill"},{heading:"Collect From Driver",route:"root.driverpayments.viewer.invoice"},{heading:"Payments",route:"root.driverpayments.viewer.payments"}];return e.filter(function(e){return e.allow||n.test(e.route.substring(5))})}]}}),e.state("root.driverpayments.viewer.summary",{url:"/summary",templateUrl:"/webapp/management/driver-payments/item/driver-payment-summary.partial.html"}),e.state("root.driverpayments.viewer.invoice",{url:"/invoice",templateUrl:"/webapp/management/driver-payments/item/driver-payment-invoice.partial.html"}),e.state("root.driverpayments.viewer.adjustment",{url:"/adjustment",templateUrl:"/webapp/management/driver-payments/item/adjustments/partial.html",controller:"DriverPaymentsViewAdjustmentsController",resolve:{rAdjustments:["Model","rDPayment",function(e,t){return e.DriverPaymentAdjustment.query().where("DriverPaymentId","==","guid'"+t[0].Id+"'").include("DriverPaymentModelAdjustment,DriverAdjustment").trackingEnabled().execute()}]}}),e.state("root.driverpayments.viewer.payments",{url:"/payments",templateUrl:"/webapp/management/driver-payments/item/driver-payment-payments.partial.html",controller:"DriverPaymentPaymentsController",resolve:{rDInvoicePayments:["Model","rDPayment",function(e,t){return t[0].InvoiceId?e.Payment.query().where("InvoiceId","==","guid'"+t[0].InvoiceId+"'").trackingEnabled().execute():null}],rBillPayments:["Model","rDPayment",function(e,t){return t[0].BillId?e.BillPayment.query().where("BillId","==","guid'"+t[0].BillId+"'").trackingEnabled().execute():null}],rDriverId:["rDPayment",function(e){return e[0].DriverId}]}}),e.state("root.driverpayments.viewer.bill",{url:"/bill",templateUrl:"/webapp/management/driver-payments/item/driver-payment-bill.partial.html"})),n.test("driverpayments","W")&&(e.state("root.driverpayments.create",{url:"/create",views:{"content-wrapper@root":{templateUrl:"/webapp/management/driver-payments/item/driver-payments-viewer.partial.html",controller:"DriverPaymentsCreateController"}},params:{data:null},resolve:{rTabs:[function(){var e=[{heading:"Summary",route:"root.driverpayments.create.summary"},{heading:"Receivables",route:"root.driverpayments.create.invoice"},{heading:"Payables",route:"root.driverpayments.create.bill"},{heading:"Adjustments",route:"root.driverpayments.create.adjustment"}];return e}],rDrivers:["Model",function(e){return e.Driver.query().select("Id,Firstname,Surname,Callsign,ImageUrl, Address1, Address2, TownCity, Postcode, DriverType, DefaultDriverPaymentModel").include("DriverType/DefaultDriverPaymentModel").include("DefaultDriverPaymentModel").parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname+" ("+e.Callsign+")",this.Description=e.DriverType.Name,this.ImageUrl=o(e.ImageUrl,e.Callsign),this.Address1=e.Address1,this.Address2=e.Address2,this.TownCity=e.TownCity,this.Postcode=e.Postcode,this.DefaultDriverPaymentModel=e.DefaultDriverPaymentModel,this.DriverType=e.DriverType}).execute()}]}}),e.state("root.driverpayments.create.summary",{url:"/summary",templateUrl:"/webapp/management/driver-payments/item/driver-payment-summary.partial.html"}),e.state("root.driverpayments.create.invoice",{url:"/invoice",templateUrl:"/webapp/management/driver-payments/item/driver-payment-invoice.partial.html"}),e.state("root.driverpayments.create.bill",{url:"/bill",templateUrl:"/webapp/management/driver-payments/item/driver-payment-bill.partial.html"}),e.state("root.driverpayments.create.adjustment",{url:"/adjustment",templateUrl:"/webapp/management/driver-payments/item/adjustments/partial.html",controller:"DriverPaymentsCreateAdjustmentsController"})),t.registerMenuItem({state:"root.driverpayments",icon:"offline_pin",title:"Driver Payments"}),r.registerSchema("DriverPaymentGenOptions","",{From:{type:moment},To:{type:moment,required:!0},Dispute:{type:Boolean}}))}function n(){}function a(r,n,a,s,l,u,m,c,p,y,v){function P(){var e=!0;return t.forEach(r.currentPeriod.payments,function(t){!t.$selected&&!w(t)&&r.bulkMode&&t.$bulk&&(e=!1)}),e}function f(){P()?t.forEach(r.currentPeriod.payments,function(e){e.$selected=!1}):t.forEach(r.currentPeriod.payments,function(e){e.$selected=!w(e)&&r.bulkMode&&e.$bulk})}function h(){r.showSearch=!r.showSearch,r.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):r.searchTerm.$=""}function D(){1==r.collectionsOnly?(r.currentPeriod.payments=r.allPayments,r.collectionsOnly=!1):(r.currentPeriod.payments=r.currentPeriod.payments.filter(function(e){return e.Balance<0}),r.collectionsOnly=!0)}function g(t){e.open("/webapp/common/modals/bookings/edit-booking/window.html#?id="+t.Id+"&clientId="+t.Client.Id,"EDIT:"+t.Id,"height=870,width=1000,left=0,top=0")}function I(e){n.put(a.API_ENDPOINT+"api/DriverPayments/approvebooking",{},{params:{bookingId:e.Id,driverPaymentId:e.DriverPayment.Id}}).success(function(t){var n=r.currentPeriod.attentionRequired.indexOf(e);r.currentPeriod.attentionRequired.splice(n,1)})}function w(e){return r.currentPeriod.undergeneration.filter(function(t){return t.DriverId==e.Id}).length>0}function b(e){n.put(a.API_ENDPOINT+"api/DriverPayments/updatebooking",{},{params:{bookingId:e.Id,driverPaymentId:e.DriverPayment.Id,commission:e.ManualCommission}}).success(function(t){var n=r.currentPeriod.attentionRequired.indexOf(e);r.currentPeriod.attentionRequired.splice(n,1),swal("Price Approved","Payment is now scheduled for re-calculation.","success")})}function k(){r.graphLoading=!0,r.paymentsGraph={options:{series:{bars:{show:"true"},shadowSize:0,stack:!0,highlightColor:"#4D629E"},bars:{align:"center",fill:1,barWidth:.8,lineWidth:1,fillColor:{colors:[{opacity:1},{opacity:.5}]}},legend:{show:!1},grid:{hoverable:!0,clickable:!0,tickColor:"#1b3952",borderWidth:.2,horizontalLines:!1,backgroundColor:{colors:["#fff","#eee"]}},xaxis:{tickFormatter:function(e,t){return"W"+e},tickLength:0,minTickSize:1},tooltip:!0,tooltipOpts:{content:function(e,t,r,n,e){return content="Week "+n.series.details[n.dataIndex].Week+", Year "+n.series.details[n.dataIndex].Year,content+="<br/>Billed Out: "+n.series.details[n.dataIndex].BilledOut,content+="<br/>Bonuses Paid: "+n.series.details[n.dataIndex].BonusesPaid,content+="<br/>Invoiced In: "+n.series.details[n.dataIndex].InvoicedIn,content+="<br/>Net: %y",content},defaultTheme:!1},yaxis:{min:0,position:"right",minTickSize:1,show:!0,tickFormatter:function(e,t){return e>999?(e/1e3).toFixed(1).toLocaleString()+"k":e},tickColor:"#ECECE9"}},data:[]},L.success(function(e){r.graphLoading=!1;for(var e=e,t={label:"Payments",data:[],details:[],color:"#455674"},n={label:"Payments",data:[],details:[],color:"#a88adc"},a=0;a<e.length;a++)e[a].Week==r.currentPeriod.week&&e[a].Year==r.currentPeriod.year?(n.details.push(e[a]),n.data.push([e[a].Week,e[a].Net])):(t.details.push(e[a]),t.data.push([e[a].Week,e[a].Net]));r.paymentsGraph.data=[],r.paymentsGraph.data.push(t),r.paymentsGraph.data.push(n)})}function A(e){r.loading=!0;var i=new moment(e);r.currentPeriod.from=i.startOf("isoweek").format(),r.currentPeriod.to=i.clone().endOf("isoweek").format(),r.currentPeriod.gen=i.clone().endOf("isoweek").add(2,"days").format(),r.currentPeriod.year=i.isoWeekYear(),r.currentPeriod.week=i.isoWeek(),r.currentPeriod.stats={},G&&(s.cancel(G),G=null),G=s(function(){var i=(new moment(e),[]),o=n.get(a.API_ENDPOINT+"api/DriverPayments/generatedpayments",{params:{week:r.currentPeriod.week,year:r.currentPeriod.year}});o.success(function(e){r.currentPeriod.payments=[],t.forEach(e,function(e){e.Balance=e.BillAmount+e.BonusAmount-e.InvoiceAmount+e.InvoicePayments-e.BillPayments,r.currentPeriod.payments.push(e),r.allPayments.push(e)})});var s=n.get(a.API_ENDPOINT+"api/DriverPayments/undergeneration",{});s.success(function(e){r.currentPeriod.undergeneration=e});var l=n.get(a.API_ENDPOINT+"api/DriverPayments/eligabledrivers",{params:{from:r.currentPeriod.from,to:r.currentPeriod.to}});l.success(function(e){r.currentPeriod.eligabledrivers=e});var d=n.get(a.API_ENDPOINT+"api/DriverPayments/attentionRequired",{params:{week:r.currentPeriod.week,year:r.currentPeriod.year,from:r.currentPeriod.from,to:r.currentPeriod.to}});d.success(function(e){r.currentPeriod.attentionRequired=e});var u=n.get(a.API_ENDPOINT+"api/DriverPayments/extrapayments",{params:{from:r.currentPeriod.from,to:r.currentPeriod.to}});u.success(function(e){r.currentPeriod.extraPayments=e,t.forEach(e,function(e){e.Balance=e.BillAmount+e.BonusAmount-e.InvoiceAmount})});var m=n.get(a.API_ENDPOINT+"api/DriverPayments/stats",{params:{week:r.currentPeriod.week,year:r.currentPeriod.year}});i.push(m),m.success(function(e){r.currentPeriod.stats=e,n.get(a.API_ENDPOINT+"api/DriverPayments/breakdowns",{params:{week:r.currentPeriod.week,year:r.currentPeriod.year}}).success(function(n){t.extend(e,n),r.adjustmentsData=[],t.forEach(n.driverAdjustments,function(e){r.adjustmentsData.push({label:e.Key,data:e.Value})}),r.expensesData=[],t.forEach(n.expenses,function(e){r.expensesData.push({label:e.Key,data:e.Value})}),r.paymentsData=[],t.forEach(n.paymentBreakdown,function(e){r.paymentsData.push({label:e.Key,data:e.Value})})})}),y.all(i).then(function(){r.loading=!1}),k()},500)}function T(){A(moment(r.currentPeriod.from).add(7,"days"))}function E(){A(moment(r.currentPeriod.from).subtract(7,"days"))}function C(){return r.currentPeriod.eligabledrivers.filter(function(e){return e.$checked}).length}function S(){r.allDriverSelected=!r.allDriverSelected;for(var e=0;e<r.currentPeriod.eligabledrivers.length;e++)r.currentPeriod.eligabledrivers[e].$checked=r.allDriverSelected}function N(){var e=r.currentPeriod.eligabledrivers.filter(function(e){return e.$checked&&!w(e)}),i={From:null,To:new moment(r.currentPeriod.to).toDate(),Dispute:!0};v.open({templateUrl:"/webapp/management/driver-payments/all/auto-generate.modal.html",controller:["$scope","$modalInstance",function(t,r){t.viewMode="EDIT",t.count=e.length,t.result=i,t.confirm=function(){r.close(t.result)}}]}).result.then(function(o){t.forEach(e,function(t){t.$checked=!1,t.$status="Generating",n.post(a.API_ENDPOINT+"api/DriverPayments/autoGenerate",{},{params:{from:i.From?new moment(i.From).startOf("day").format():(new moment).subtract(1,"year").startOf("day").format(),to:new moment(i.To).endOf("day").format(),year:r.currentPeriod.year,week:r.currentPeriod.week,driverId:t.Id,dispute:i.Dispute}}).success(function(e){t.$status="Ready"}).error(function(e){t.$status="Failed"}),swal("Payments Queued","Payments have been queued for "+e.length+" selected Drivers","success")})})}function O(){r.payment=new l.DriverPayment,r.payment.PaymentFrom=null,r.payment.PaymentTo=(new moment).subtract(1,"week").endOf("isoweek").toDate(),r.payment.Driver=null,r.payment.PaymentModel=null,r.opened={},r.payment.Bill=new l.Bill,r.payment.Bill.DueDate=(new moment).add(1,"month").toDate(),r.payment.Invoice=new l.Invoice,r.payment.Invoice.DueDate=(new moment).add(1,"month").toDate(),r.payment.Invoice.InvoiceType="Driver",r.payment.Invoice.PaymentInstructions=r.COMPANY.DefaultInvoicePaymentInstructions;var e=[];for(i=0,len=r.currentPeriod.eligabledrivers.length;i<len;i++)r.currentPeriod.eligabledrivers[i].$checked&&!w(d)&&e.push(r.currentPeriod.eligabledrivers[i].Id);null==r.payment.PaymentFrom&&(r.payment.PaymentFrom=(new moment).subtract(1,"year").startOf("isoweek").toDate()),u.go("root.driverpayments.create",{data:{payment:r.payment,driverIds:e}})}function B(e,t){n.get(a.API_ENDPOINT+"api/DriverPayments/approvePayment",{params:{paymentId:e.Id}}).success(function(r){e.Status="Approved",void 0==t&&swal("Payment Approved","Payment has been approved and will be emailed to Driver.","success")})}function x(e){function n(e){return"Draft"==e.Status&&0==e.RequiresAttention&&0==r.currentPeriod.undergeneration.filter(function(t){return t.DriverPaymentId==e.Id}).length}function a(e){return"Approved"==e.Status&&e.Balance>0&&0==r.currentPeriod.undergeneration.filter(function(t){return t.DriverPaymentId==e.Id}).length}function i(e){return("Settled"==e.Status||"Approved"==e.Status)&&0==r.currentPeriod.undergeneration.filter(function(t){return t.DriverPaymentId==e.Id}).length}function o(e){return 0==e.BillPayments&&0==e.InvoicePayments&&0==r.currentPeriod.undergeneration.filter(function(t){return t.DriverPaymentId==e.Id}).length}function s(e){return 0==r.currentPeriod.undergeneration.filter(function(t){return t.DriverPaymentId==e.Id}).length}r.bulkMode=e;var l=null;"APPROVE"==e&&(r.bulkText="Approve",l=n),"BACS"==e&&(r.bulkText="Auto-Settle BACS",l=a),"REGEN"==e&&(r.bulkText="Recalculate",l=s),"CANCEL"==e&&(r.bulkText="Cancel",l=o),"EMAIL"==e&&(r.bulkText="Email",l=i),t.forEach(r.currentPeriod.payments,function(e){e.$bulk=l(e)})}function M(){r.bulkMode=null,t.forEach(r.currentPeriod.payments,function(e){e.$bulk=!1,e.$selected=!1})}function U(){var e=r.currentPeriod.payments.filter(function(e){return e.$selected});"APPROVE"==r.bulkMode&&t.forEach(e,B),"BACS"==r.bulkMode&&t.forEach(e,F),"REGEN"==r.bulkMode&&t.forEach(e,j),"EMAIL"==r.bulkMode&&_(e),"CANCEL"==r.bulkMode&&swal({title:"Are you sure?",text:"These payments will be deleted and cannot be recovered.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Confirm",closeOnConfirm:!1},function(){swal("Payments Cancelled","Payment cancellation is initiated. They will be cancelled in a few moments.","success"),t.forEach(e,R)}),M()}function j(e,t){n.post(a.API_ENDPOINT+"api/DriverPayments/regenerate",{},{params:{paymentId:e.Id,useStored:!0,recalcBonus:!0}}).success(function(e){A(r.currentPeriod.to),void 0==t&&swal("Payment Queued","Payment has been queued for re-calculation.","success")})}function R(e,t){n["delete"](a.API_ENDPOINT+"api/DriverPayments",{params:{id:e.Id}}).success(function(e){A(r.currentPeriod.to)})}function _(e){var t=e.map(function(e){return e.Id});n.post(a.API_ENDPOINT+"api/DriverPayments/EmailPayments",t).success(function(e){A(r.currentPeriod.to)})}function q(e,t){swal({title:"Are you sure?",text:"This payment will be deleted and cannot be recovered.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Confirm",closeOnConfirm:!1},function(){swal("Payment Cancelled","Payment cancellation is initiated. It will be cancelled in a few moments.","success"),n["delete"](a.API_ENDPOINT+"api/DriverPayments",{params:{id:e.Id}}).success(function(e){A(r.currentPeriod.to)})})}function F(e,t){n.get(a.API_ENDPOINT+"api/DriverPayments/autoSettlePayment",{params:{paymentId:e.Id,method:"BACS"}}).success(function(e){A(r.currentPeriod.to),void 0==t&&swal("Payment Settled","BACS payments have been added.","success")})}var L=null;r.currentPeriod={from:null,to:null,year:null,week:null,stats:{},attentionRequired:[],payments:[],eligabledrivers:[],extraPayments:[],undergeneration:[]},r.selected={all:P,toggleAll:f},L=n.get(a.API_ENDPOINT+"api/DriverPayments/periods",{params:{max:52}}),r.tab={current:"SUMMARY"},r.searchTerm={},r.payment={},r.estimateSearchTerm={},r.bulkMode=null,r.gotoPeriod=A,r.forward=T,r.back=E,r.lastWeek=moment().subtract(7,"days").startOf("isoweek").format(),r.currentWeek=moment().startOf("isoweek").format(),r.today=moment(),r.formatUrl=o,r.allDriverSelected=!1,r.selectAllDrivers=S,r.getSelectedDriversCount=C,r.autoGenerate=N,r.preview=O,r.approvePayment=B,r.reGeneratePayment=j,r.autoSettlePayment=F,r.cancelPayment=q,r.approvePrice=I,r.savePrice=b,r.hasProcessing=w,r.startBulkMode=x,r.cancelBulkMode=M,r.finishBulkMode=U,r.openBooking=g,r.generateGraph=k,r.toggleCollections=D,r.toggleSearch=h,r.allPayments=[],r.collectionsOnly=!1,r.pieOptions={series:{pie:{show:!0,innerRadius:.6,combine:{color:"#999",threshold:.03},label:{threshold:.03}}},colors:[m.COLOURS.brandPrimary,m.COLOURS.brandSecondary],tooltip:{show:!0,shifts:{x:25,y:0},defaultTheme:!1},grid:{}},r.adjustmentsData=[],r.expensesData=[],r.paymentsData=[];var G=null;A(moment().tz("Europe/London").subtract(7,"days")),r.$on("SIGNALR_updatePaymentGeneration",function(e){A(r.currentPeriod.to)}),k(),r.exportSummary=function(){var e="week="+r.currentPeriod.week+"&year="+r.currentPeriod.year;n.get(a.API_ENDPOINT+"api/driverpayments/Summary?"+e).then(function(e){c.download(e.data,"PaymentSummary.csv")},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:m.COLOURS.brandSecondary})})}}function o(e,t){return e?"http"==e.slice(0,4)?e:$config.RESOURCE_ENDPOINT+e:$config.API_ENDPOINT+"api/imagegen?text="+t}var s=t.module("cab9.driverpayments",[]);s.config(r),s.run(n),s.controller("DriverPaymentsSummaryController",a),r.$inject=["$stateProvider","MenuServiceProvider","ModelProvider","$permissions"],n.$inject=[],a.$inject=["$scope","$http","$config","$timeout","Model","$state","$UI","CSV","$filter","$q","$modal"]}(window,angular);;;;
!function(n,r){return}(window,angular);;;;
!function(){function e(e,t,r,o,n,a,i,s,l,m){function f(){e.showSearch=!e.showSearch,e.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):e.searchTerm.$=""}function d(){t.open({templateUrl:"/webapp/management/driver-payments/modal/filter.modal.partial.html",controller:["$scope","rFilter","$modalInstance","rDrivers",function(e,t,r,o){function n(){r.close(e.filterOptions)}e.filterOptions=angular.copy(t),e.drivers=o,setTimeout(function(){$("#daterangepicker_bookings").daterangepicker({locale:{format:"DD/MM/YYYY"},autoApply:!0,startDate:moment(e.filterOptions.date.from).startOf("day"),endDate:moment(e.filterOptions.date.to).endOf("day"),opens:"right",parentEl:"#time-controls",ranges:{"This Week":[moment().startOf("isoweek"),moment().endOf("isoweek")],"Last Week":[moment().subtract(7,"days").startOf("isoweek"),moment().subtract(7,"days").endOf("isoweek")],"This Month":[moment().startOf("month"),moment().endOf("month")]},alwaysShowCalendars:!0}),$("#daterangepicker_bookings").on("apply.daterangepicker",function(t,r){e.filterOptions.date.selectedPeriod=r.chosenLabel,e.filterOptions.date.from=r.startDate.toISOString(),e.filterOptions.date.to=r.endDate.toISOString(),"Custom Range"==e.filterOptions.date.selectedPeriod&&(e.filterOptions.date.selectedPeriod+=" ("+moment(e.filterOptions.date.from).format("DD/MM/YYYY")+" - "+moment(e.filterOptions.date.to).format("DD/MM/YYYY")+")"),e.$apply()})},100),e.datePickers={from:!1,to:!1},e.openDatePicker=function(t,r){e.datePickers[r]=!e.datePickers[r],event.preventDefault(),event.stopPropagation()},e.confirmFilters=n}],resolve:{rFilter:function(){return e.filter},rDrivers:function(){return r.Driver.query().select("Id,Firstname,Surname,Callsign,DriverType/Name").include("DriverType").parseAs(function(e){this.Id=e.Id,this.Name="("+e.Callsign+") "+e.Firstname+" "+e.Surname,this.Description=e.DriverType.Name}).execute()}},size:"lg"}).result.then(function(t){e.filter=t})}function u(){c(1)}function c(t){e.paging.currentPage=t,e.loading=!0;var o=new moment(e.filter.date.from),n=new moment(e.filter.date.to).add(2,"hours"),a=r.DriverPayment.query().include("Driver,Bill,Invoice").skip(e.paging.resultsPerPage*(e.paging.currentPage-1)).top(e.paging.resultsPerPage).orderBy("PaymentTo");if(e.searchTerm.$.length>0)a.where("substringof('"+e.searchTerm.$+"', Driver/Surname) or substringof('"+e.searchTerm.$+"', Driver/Firstname) or substringof('"+e.searchTerm.$+"', Driver/Callsign)");else{a.filter("PaymentTo","ge","datetimeoffset'"+o.format()+"'").filter("PaymentTo","le","datetimeoffset'"+n.format()+"'"),e.filter.DriverId&&a.filter("DriverId","==","guid'"+e.filter.DriverId+"'"),e.filter.Amount.from&&a.filter("TotalAmount","ge",e.filter.Amount.from),e.filter.Amount.to&&a.filter("TotalAmount","le",e.filter.Amount.to);var i="";if(e.filter.Status)for(var s=Object.keys(e.filter.Status),l=0;l<s.length;l++)e.filter.Status[s[l]]&&(i+=i.length>0?" or ":"(",i+="Status eq '"+s[l]+"'");i.length>0?i+=")":i="1 eq 1",a.where(i)}a.execute().then(function(t){e.payments=t,e.loading=!1},function(t){e.loading=!1,swal("Error","Please try again or contact admin","error")})}function p(){var e=t.open({templateUrl:"/webapp/management/driver-payments/modal/new-payment/partial.html",controller:"NewPaymentInitController",keyboard:!1,backdrop:"static",size:"lg",resolve:{rDrivers:["Model",function(e){return e.Driver.query().select("Id,Firstname,Surname,Callsign,ImageUrl,DriverTypeId,DriverType/Name").include("DriverType/DefaultDriverPaymentModel").include("DefaultDriverPaymentModel").parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname+" ("+e.Callsign+")",this.Description=e.DriverType.Name,this.DriverTypeId=e.DriverTypeId,this.ImageUrl=formatUrl(e.ImageUrl,e.Callsign)}).execute()}]}});e.result.then(function(e){},function(){})}function g(e){var t=moment.tz(e,m.timeZone().getTimeZone());return t}e.payments=[],e.searchTerm={$:""},e.toggleSearch=f,e.filterPayments=u,e.showSearch=!1,e.loading=!0,e.openPaymentModal=p;var y=null;e.paging={currentPage:1,resultsPerPage:20,totalResults:null,maxPages:null},e.setPage=c,e.showFilterModal=d,e.filter={date:{from:moment().subtract(7,"days").startOf("isoweek"),to:moment().subtract(7,"days").endOf("isoweek"),span:"week",selectedPeriod:"Last Week"},Amount:{from:null,to:null},DriverId:null,Status:{Draft:!0,Approved:!0,Settled:!1}},e.$watchGroup(["filter.date.from.valueOf()","filter.date.to.valueOf()","searchTerm.$","filter.DriverId","filter.Status.Unsent","filter.Status.Unpaid","filter.Status.Paid","filter.Amount.from","filter.Amount.to"],function(t,o){e.loading=!0;var n=new moment(e.filter.date.from),a=new moment(e.filter.date.to).add(2,"hours"),i=r.DriverPayment.query().include("Driver,Bill,Invoice").select("Id").parseAs(function(e){this.Id=e.Id});if(e.searchTerm.$.length>0)i.where("substringof('"+e.searchTerm.$+"', Driver/Surname) or substringof('"+e.searchTerm.$+"', Driver/Firstname) or substringof('"+e.searchTerm.$+"', Driver/Callsign)");else{i.filter("PaymentTo","ge","datetimeoffset'"+n.format()+"'").filter("PaymentTo","le","datetimeoffset'"+a.format()+"'"),e.filter.DriverId&&i.filter("DriverId","==","guid'"+e.filter.DriverId+"'"),e.filter.Amount.from&&i.filter("TotalAmount","ge",e.filter.Amount.from),e.filter.Amount.to&&i.filter("TotalAmount","le",e.filter.Amount.to);var s="";if(e.filter.Status)for(var l=Object.keys(e.filter.Status),m=0;m<l.length;m++)e.filter.Status[l[m]]&&(s+=s.length>0?" or ":"(",s+="Status eq '"+l[m]+"'");s.length>0?s+=")":s="1 eq 1",i.where(s)}i.execute().then(function(t){e.paging.totalResults=t.length,e.paging.maxPages=Math.ceil(e.paging.totalResults/e.paging.resultsPerPage),c(1)})}),e.exportSummary=function(){t.open({templateUrl:"/webapp/management/driver-payments/modal/export-summary.partial.html",controller:["$scope","$modalInstance","rDrivers",function(e,t,r){e.drivers=r,e.options={driverId:null,period:{from:(new moment).subtract(7,"days").startOf("isoweek"),to:(new moment).subtract(7,"days").endOf("isoweek"),summary:"Last Week"}},e.proceed=function(){t.close(e.options)},setTimeout(function(){$("#daterangepicker_bookings").daterangepicker({locale:{format:"DD/MM/YYYY"},autoApply:!0,startDate:e.options.period.from,endDate:e.options.period.to,opens:"bottom",ranges:{Today:[moment().startOf("day"),moment().endOf("day")],"This Week":[moment().startOf("isoweek"),moment().endOf("isoweek")],"Last Week":[moment().subtract(7,"days").startOf("isoweek"),moment().subtract(7,"days").endOf("isoweek")],"This Month":[moment().startOf("month"),moment().endOf("month")]},alwaysShowCalendars:!0}),$("#daterangepicker_bookings").on("apply.daterangepicker",function(t,r){e.options.period.summary=r.chosenLabel,e.options.period.from=new moment(r.startDate),e.options.period.to=new moment(r.endDate),"Custom Range"==e.options.period.summary&&(e.options.period.summary=e.options.period.from.format("DD/MM/YYYY")+"-"+e.options.period.to.format("DD/MM/YYYY")),e.$apply()})},100)}],keyboard:!1,backdrop:"static",resolve:{rDrivers:["Model",function(e){return e.Driver.query().select("Id,Firstname,Surname,Callsign,ImageUrl").parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname+" ("+e.Callsign+")",this.ImageUrl=formatUrl(e.ImageUrl,e.Callsign)}).execute()}]}}).result.then(function(e){var t="from="+g(e.period.from.startOf("day")).utc().format("YYYY-MM-DDTHH:mm")+"Z&to="+g(e.period.to.endOf("day")).add(1,"hour").utc().format("YYYY-MM-DDTHH:mm")+"Z&driverId="+e.driverId;a.get(i.API_ENDPOINT+"api/driverpayments/Summary?"+t).then(function(e){l.download(e.data,"PaymentSummary.csv")},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:s.COLOURS.brandSecondary})})})},e.$watch("selected",function(t,o){t&&o&&(y&&n.cancel(y),y=n(function(){r.DriverPayment.query().include("Driver").include("PaymentModel").include("Invoice").include("Bill").filter("CreationTime","ge","datetimeoffset'"+e.selected.from.format()+"'").filter("CreationTime","le","datetimeoffset'"+e.selected.to.format()+"'").execute().then(function(t){e.payments=t,y=null})},250))},!0),e.viewItem=function(e){o.go("root.driverpayments.viewer.summary",{Id:e.Id})}}var t=angular.module("cab9.driverpayments");t.controller("DriverPaymentsTableController",e),e.$inject=["$scope","$modal","Model","$state","$timeout","$http","$config","$UI","CSV","Localisation"]}();;;;
!function(){function e(e,n,t,o,i,a,r,l,c,s,d,m,u,p,y,g,f,I){function v(n){e.creating.adjustment={Type:"invoice"==n?"Debit":"Credit",TaxId:e.taxes[1].Id}}function B(){var n=new l.DriverAdjustment({DriverId:e.payment.DriverId,Type:e.creating.adjustment.Type,Amount:e.creating.adjustment.Amount,Reference:e.creating.adjustment.Reference,Recurring:"OneOff",AmountType:"Fixed",Approved:!0,Settled:!0,TaxId:e.creating.adjustment.TaxId});n.$save().then(function(n){var t=n.data.Id,o=new l.DriverPaymentAdjustment({DriverPaymentId:e.payment.Id,DriverAdjustmentId:t,Type:e.creating.adjustment.Type,Amount:e.creating.adjustment.Amount,Reference:e.creating.adjustment.Reference,TaxId:e.creating.adjustment.TaxId});o.$save().then(function(){swal({title:"Adjustment Added",type:"success",text:"Adjustment has been added, page will refresh to reflect changes"},function(){location.reload()})})})}function k(){e.creating.adjustment=null}function h(n){e.editing.adjustment&&D(),e.editing.adjustment=n}function D(){e.editing.adjustment.$rollback(),e.editing.adjustment=null}function P(e){e.$delete().then(function(){location.reload()})}function T(){e.editing.adjustment.$patch().then(function(){location.reload()})}function E(){e.displayMode="EDIT"}function A(n,t){e.opened[t]=!0,n.preventDefault(),n.stopPropagation()}function S(e){"Invoice"==e&&r.go("root.driverpayments.viewer.invoice"),"Bill"==e&&r.go("root.driverpayments.viewer.bill")}function $(){e.selectedItem={InvoiceBookings:[],BillBookings:[]};for(var n=0;n<e.payment.Bookings.length;n++)e.payment.Bookings[n].CompanyCommission>0&&e.selectedItem.InvoiceBookings.push({Booking:new l.Booking(e.payment.Bookings[n]),Total:e.payment.Bookings[n].CompanyCommission}),e.payment.Bookings[n].DriverCommission>0&&e.selectedItem.BillBookings.push({Booking:new l.Booking(e.payment.Bookings[n]),Total:e.payment.Bookings[n].DriverCommission})}function C(){swal({title:"Are you sure?",text:"Are you sure you want to delete this Driver Payment?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",closeOnConfirm:!1},function(n){n&&e.payment.$delete(!0).then(function(){swal({title:"Driver Payment Deleted.",text:"Driver Payment has been removed.",type:"success",confirmButtonColor:s.COLOURS.brandSecondary}),r.go("root.driverpayments",{reload:!0})})})}function j(t,o){t.Booking.$patch().then(function(o){({From:e.payment.PaymentFrom,To:e.payment.PaymentTo,DriverIds:[t.Booking.DriverId]});l.DriverPayment.query().include("Driver","PaymentModel","Invoice/Payments","Bill/BillPayments","Bookings/LeadPassenger, Bookings/BookingStops, Bookings/Vehicle").where("Id","==","guid'"+n.Id+"'").trackingEnabled().execute().then(function(n){e.payment=n[0],$(),e.fareUpdated=!1},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:s.COLOURS.brandSecondary})})},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:s.COLOURS.brandSecondary})})}function w(n){if(!e.selectedItem)return 0;var t=0,o=[];return"Invoice"==n&&(o=e.selectedItem.InvoiceBookings),"Bill"==n&&(o=e.selectedItem.BillBookings),angular.forEach(o,function(e){t+=e.Booking.ActualCost}),t}function O(n){return e.payment.Driver.VATRegistered?.2*(e.payment.Bill.BookingsSubTotal+e.payment.Bill.WaitingSubTotal):0}function b(n){if(!e.selectedItem)return 0;var t=0;return"Invoice"==n&&e.selectedItem.InvoiceBookings.forEach(function(e){t+=e.Total}),"Bill"==n&&e.selectedItem.BillBookings.forEach(function(e){t+=e.Total}),t}function x(e){y.open({templateUrl:"/webapp/common/modals/bookings/driver-payment-calculation/partial.html",controller:"BookingDriverPaymentCalculationController",resolve:{rBooking:function(){return e}}})}function R(n){var t=[];return"Invoice"==n&&e.selectedItem.InvoiceBookings.forEach(function(e){e.Booking.$selected&&t.push(e)}),"Bill"==n&&e.selectedItem.BillBookings.forEach(function(e){e.Booking.$selected&&t.push(e)}),t}function N(n){"Invoice"==n&&(e.allInvoiceSelected=!e.allInvoiceSelected,angular.forEach(e.selectedItem.InvoiceBookings,function(n){e.allInvoiceSelected?n.$selected=!0:n.$selected=!1})),"Bill"==n&&(e.allBillsSelected=!e.allBillsSelected,angular.forEach(e.selectedItem.BillBookings,function(n){e.allBillsSelected?n.$selected=!0:n.$selected=!1}))}function U(){var n=[];e.payment.Bookings=[],e.payment.Driver=null,e.payment.PaymentMethod=null,e.payment.Bill&&(e.payment.Bill.Reference||(e.payment.Bill.Reference="AUTO"),e.payment.Bill.Id&&Object.keys(e.payment.Bill.$$changedValues).length>0&&n.push(e.payment.Bill.$patch())),e.payment.Invoice&&(e.payment.Invoice.Reference||(e.payment.Invoice.Reference="AUTO"),e.payment.Invoice.Id&&Object.keys(e.payment.Invoice.$$changedValues).length>0&&n.push(e.payment.Invoice.$patch(!0))),e.InvoiceBookings.forEach(function(n){n.$selected&&e.payment.Bookings.push(n)}),e.BillBookings.forEach(function(n){n.$selected&&e.payment.Bookings.push(n)}),n.push(e.payment.$patch(!0)),m.all(n).then(function(){swal({title:"Driver Payment Saved.",text:"Driver Payment has been updated.",type:"success",confirmButtonColor:s.COLOURS.brandSecondary}),r.go(r.current,{Id:e.payment.Id},{reload:!0})},function(n){var t=null;n&&"INVALID REFERENCE"==n.data.Message&&(t="Reference already exists!"),swal({title:"Error Occured",text:t,type:"error"}),r.go(r.current,{Id:e.payment.Id},{reload:!0})})}function M(){e.payment=o[0],$(),e.displayMode="VIEW"}function _(){e.InvoiceBookings=[],e.BillBookings=[],e.payment.Bookings.forEach(function(n){"Cash"==n.PaymentMethod?e.InvoiceBookings.push(n):"Cash"!=n.PaymentMethod&&e.BillBookings.push(n)})}function L(e,n){return e?"http"==e.slice(0,4)?e:d.RESOURCE_ENDPOINT+e:d.API_ENDPOINT+"api/imagegen?text="+n}function V(){p.open(d.API_ENDPOINT+"api/DriverPayments/pdf?paymentId="+e.payment.Id,"_blank")}function F(){p.open(d.API_ENDPOINT+"api/DriverPayments/invoicepdf?driverInvoiceId="+e.payment.Invoice.Id,"_blank")}function q(o){var i=[];"Invoice"==o&&(i=e.selectedItem.InvoiceBookings),"Bill"==o&&(i=e.selectedItem.BillBookings);var a=i.filter(function(e){return e.$selected}).map(function(e){return e.Booking.Id});t.post(d.API_ENDPOINT+"api/driverpayments/recalculate",a).then(function(t){l.DriverPayment.query().include("Driver","PaymentModel","Invoice/Payments","Bill/BillPayments","Bookings/LeadPassenger, Bookings/BookingStops, Bookings/VehicleType, Bookings/Client").where("Id","==","guid'"+n.Id+"'").trackingEnabled().execute().then(function(n){e.payment=n[0],$()},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:s.COLOURS.brandSecondary})})})}function W(n){var o=[];"Invoice"==n&&(o=e.selectedItem.InvoiceBookings),"Bill"==n&&(o=e.selectedItem.BillBookings);var i=[];angular.forEach(o,function(e){e.$selected&&i.push(t.post(d.API_ENDPOINT+"api/driverpayments/RemoveBooking?bookingId="+e.Booking.Id))}),m.all(i).then(function(){window.location.reload()})}function Y(){y.open({templateUrl:"/webapp/common/modals/email-to-sent.modal.html",controller:["$scope","emailAddress","$modalInstance",function(e,n,t){null!=n&&(e.email=n),e.markSent=!0,e.sendEmail=function(){t.close({email:e.email,markSent:e.markSent})}}],resolve:{emailAddress:function(){return e.payment.Driver.Email}}}).result.then(function(n){null!=n.email&&t.post(d.API_ENDPOINT+"api/email",{Type:"DriverPaymentConfirmation",PaymentId:e.payment.Id,DriverId:e.payment.DriverId,EmailId:n.email}).success(function(){if(f.success("Email Sent"),n.markSent){var t=new l.DriverPayment({Id:e.payment.Id});t.Status="Unpaid",t.$patch().then(function(){e.payment.Status="Unpaid"})}})})}e.payment=o[0],e.drivers=i,e.adjustments=g,e.taxes=I,e.billAdjustments=g.filter(function(e){return"Credit"==e.Type&&!e.BookingId}),e.invoiceAdjustments=g.filter(function(e){return"Debit"==e.Type&&!e.BookingId}),$(),e.displayMode="VIEW",e.tabDefs=a,e.payment.Driver&&(e.payment.Driver.ImageUrl=L(e.payment.Driver.ImageUrl,e.payment.Driver.Callsign)),e.opened={},e.editing={adjustment:null},_(),e.remove=C,e.showBreakdown=x,e.editMode=E,e.openCalendar=A,e.details=S,e.BookingsTotal=w,e.TaxTotal=O,e.calculateDue=b,e.toggleSelectAll=N,e.Save=U,e.Cancel=M,e.getSelectedBookings=R,e.exportInvoice=V,e.exportCompanyInvoice=F,e.updateBooking=j,e.recalculate=q,e.removeBookings=W,e.emailTo=Y,e.creating={},e.addAdjustment=v,e.startEditAdjustment=h,e.cancelEditAdjustment=D,e.removeAdjustment=P,e.saveEditAdjustment=T,e.saveNewAdjustment=B,e.cancelNewAdjustment=k}var n=angular.module("cab9.driverpayments");n.controller("DriverPaymentsItemController",e),e.$inject=["$scope","$stateParams","$http","rDPayment","rDrivers","rTabs","$state","Model","$filter","$UI","$config","$q","Auth","$window","$modal","rAdjustments","Notification","rTaxes"]}();;;;
!function(){function e(e,t,o,n,r,l,s,a,c,d,m,u,g,v){function I(e){n.open({templateUrl:"/webapp/common/modals/bookings/driver-payment-calculation/partial.html",controller:"BookingDriverPaymentCalculationController",resolve:{rBooking:function(){return e}}})}function B(e,t){t?window.open("/webapp/common/modals/bookings/reuse-booking/window.html#?id="+e.Id+"&clientId="+e.ClientId+"&repeat=true","_blank","height=870,width=1000,left=0,top=0"):a.get(d.API_ENDPOINT+"api/bookings/RequestLock",{params:{bookingId:e.Id}}).success(function(t){"LockGranted"==t.status?window.open("/webapp/common/modals/bookings/edit-booking/window.html#?id="+e.Id+"&clientId="+e.ClientId,"_blank","height=870,width=1000,left=0,top=0"):swal("Booking Locked!","This booking is currently being edited by: "+t.user,"error")}).error(function(){swal("Error!","Unknown error occured.","error")})}function f(t,o){t.Booking.$patch().then(function(o){var n={From:e.selected.From,To:e.selected.To,DriverIds:[t.Booking.DriverId]};a.post(d.API_ENDPOINT+"api/driverpayments/previews",n).then(function(o){var n=h(t.Booking.DriverId,o.data.NewPayments,o.data.ExistingPayments);for(i=0,len=e.data.length;i<len;i++)if(e.data[i].Driver.Id==t.Booking.DriverId){e.data[i]=n;break}e.selectedItem=n})},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:g.COLOURS.brandSecondary})})}function p(e){"Invoice"==e&&m.go("root.driverpayments.create.invoice"),"Bill"==e&&m.go("root.driverpayments.create.bill")}function k(t){e.selectedItem=t}function y(){e.fetching=!0,a.post(d.API_ENDPOINT+"api/driverpayments/previews",e.selected).then(function(t){e.data=[];var o=t.data.NewPayments,n=t.data.ExistingPayments;for(var i in o)e.data.push(h(i,o,n));m.go("root.driverpayments.create.summary"),e.fetching=!1})}function h(t,o,n){e.data||(e.data=[]),o[t].InvoiceBookings=o[t].InvoiceBookings.map(function(e){return e.Booking=new l.Booking(e.Booking),e.Booking.$selected=!0,e}),o[t].BillBookings=o[t].BillBookings.map(function(e){return e.Booking=new l.Booking(e.Booking),e.Booking.$selected=!0,e}),o[t].Adjustments=o[t].Adjustments.map(function(e){var t=new l.DriverPaymentAdjustment(e);return t.$selected=!0,t});var i=o[t];return i.conflicts=n.filter(function(e){return e.DriverId==t}),i.Driver=e.drivers.filter(function(e){return e.Id==t})[0],i}function D(t){if(!e.selectedItem)return 0;var o=0,n=[];return"Invoice"==t&&(n=e.selectedItem.InvoiceBookings),"Bill"==t&&(n=e.selectedItem.BillBookings),angular.forEach(n,function(e){o+=e.Booking.ActualCost}),o}function w(t){if(!e.selectedItem)return 0;var o=0;return"Invoice"==t&&e.selectedItem.InvoiceBookings.forEach(function(e){o=o+e.Booking.JourneyCommission+e.Booking.ExtrasCommission+e.Booking.WaitingCommission}),"Bill"==t&&e.selectedItem.BillBookings.forEach(function(e){o=o+e.Booking.JourneyCommission+e.Booking.ExtrasCommission+e.Booking.WaitingCommission}),o}function $(t){var o=[];return"Invoice"==t&&e.selectedItem.InvoiceBookings.forEach(function(e){e.Booking.$selected&&o.push(e)}),"Bill"==t&&e.selectedItem.BillBookings.forEach(function(e){e.Booking.$selected&&o.push(e)}),o}function C(t){if("Invoice"==t)for(e.allInvoiceSelected=!e.allInvoiceSelected,i=0,len=e.selectedItem.InvoiceBookings.length;i<len;i++)e.allInvoiceSelected?e.selectedItem.InvoiceBookings[i].Booking.$selected=!0:e.selectedItem.InvoiceBookings[i].Booking.$selected=!1;if("Bill"==t)for(e.allBillsSelected=!e.allBillsSelected,i=0,len=e.selectedItem.BillBookings.length;i<len;i++)e.allBillsSelected?e.selectedItem.BillBookings[i].Booking.$selected=!0:e.selectedItem.BillBookings[i].Booking.$selected=!1;if("Adjustment"==t)for(e.allAdjustmentsSelected=!e.allAdjustmentsSelected,i=0,len=e.selectedItem.Adjustments.length;i<len;i++)e.selectedItem.Adjustments[i].$selected=e.allAdjustmentsSelected}function P(){var t=[];for(i=0,len=e.selectedItem.InvoiceBookings.length;i<len;i++)e.selectedItem.InvoiceBookings[i].Booking.$selected&&t.push(e.selectedItem.InvoiceBookings[i].Booking);var o=[];for(i=0,len=e.selectedItem.BillBookings.length;i<len;i++)e.selectedItem.BillBookings[i].Booking.$selected&&o.push(e.selectedItem.BillBookings[i].Booking);var n=[];for(i=0,len=e.selectedItem.Adjustments.length;i<len;i++)e.selectedItem.Adjustments[i].$selected&&n.push(e.selectedItem.Adjustments[i]);return 0==t.length&&0==o.length?void swal({title:"No bookings selected.",text:"Please tick the bookings you would like to make payment for.",type:"warning",confirmButtonColor:g.COLOURS.brandSecondary}):void swal({title:"Are you sure?",text:"Payment would be created.",type:"warning",showCancelButton:!0,confirmButtonColor:g.COLOURS.brandPrimary,confirmButtonText:"Confirm!",showLoaderOnConfirm:!0,closeOnConfirm:!1},function(){e.payment.DriverId=e.selectedItem.Driver.Id,e.payment.PaymentModelId=e.selectedItem.Driver.DefaultDriverPaymentModel?e.selectedItem.Driver.DefaultDriverPaymentModel.Id:e.selectedItem.Driver.DriverType&&e.selectedItem.Driver.DriverType.DefaultDriverPaymentModel?e.selectedItem.Driver.DriverType.DefaultDriverPaymentModel.Id:e.COMPANY.DefaultDriverPaymentModel.Id,e.payment.Bill.Reference||(e.payment.Bill.Reference="AUTO"),e.payment.Invoice.Reference||(e.payment.Invoice.Reference="AUTO"),e.payment.Bookings=[],e.payment.Bookings=t,e.payment.Invoice.DriverId=e.selectedItem.Driver.Id,e.payment.Bill.DriverId=e.selectedItem.Driver.Id,Array.prototype.push.apply(e.payment.Bookings,o),e.payment.Adjustments=n,e.payment.Driver=null,e.payment.PaymentModel=null,e.payment.$save().success(function(t){swal({title:"Driver Payment Saved.",text:"Driver Payment has been added.",type:"success",confirmButtonColor:g.COLOURS.brandSecondary,showLoaderOnConfirm:!0});var o=e.data.indexOf(e.selectedItem);e.data.splice(o,1),e.selectedItem=null,0==e.data.length&&m.go("root.driverpayments",null,{reload:!0})}).error(function(e){var t=null;e&&"INVALID REFERENCE"==e.Message&&(t="Reference already exists!"),swal({title:"Error Occured",text:t,type:"error"})})})}function b(){m.go("root.driverpayments",null,{reload:!0})}return v.data?(e.payment=v.data.payment,e.selected={DriverIds:v.data.driverIds,From:v.data.payment.PaymentFrom,To:v.data.payment.PaymentTo},y(),e.drivers=r,e.tabDefs=s,e.displayMode="CREATE",e.allInvoiceSelected=!0,e.allBillsSelected=!0,e.allAdjustmentsSelected=!0,e.InvoiceBookings=[],e.BillBookings=[],e.updateBooking=f,e.expand=k,e.details=p,e.fetchBookings=y,e.openEditWindow=B,e.BookingsTotal=D,e.calculateDue=w,e.getSelectedBookings=$,e.toggleSelectAll=C,e.save=P,e.Cancel=b,void(e.showBreakdown=I)):void m.go("root.driverpayments")}var t=angular.module("cab9.driverpayments");t.controller("DriverPaymentsCreateController",e);var o=function(){this.$get=["$window","$location","$rootScope",function(e,t,o){function n(){}return n}]};t.provider("$anchorScroll",o),e.$inject=["$scope","$rootScope","$anchorScroll","$modal","rDrivers","Model","rTabs","$http","$filter","$config","$state","$q","$UI","$stateParams"]}();;;;
!function(){function e(e,n,t,a,l,c,i,m){function r(n){return e.payment.Driver.VATRegistered?.2*(e.payment.Bill.BookingsSubTotal+e.payment.Bill.WaitingSubTotal):0}function o(){e.fetchingDriverCards=!0,e.cardPaymentForm=!0,c.get(m.API_ENDPOINT+"api/Payments/getcardsfordriver?driverId="+e.driverId).then(function(n){e.fetchingDriverCards=!1,e.driverCards=n.data})}function y(){e.cardPaymentForm=!1}function s(){e.paymentParams.collectingPayment=!0,e.paymentParams.PaymentCard&&e.paymentParams.Amount>0?c({method:"POST",url:m.API_ENDPOINT+"api/Invoice/TakePayment?invoiceId="+e.payment.InvoiceId+"&paymentCardId="+e.paymentParams.PaymentCard.Id+"&amount="+e.paymentParams.Amount}).then(function(n){swal("Payment Successful","Payment has been taken successfully using the selected card.","success"),e.cardPaymentForm=!1,w("Invoice"),w("Bill"),e.paymentParams.collectingPayment=!1,e.paymentParams={}},function(n){swal("Payment Error","An error occurred while collecting payment. "+n.data.Message,"error"),e.paymentParams.collectingPayment=!1}):(swal("Payment Error","Please make sure that a card is selected and payment amount is more than £0.00.","error"),e.paymentParams.collectingPayment=!1)}function u(){var n=e.payment.Invoice.TotalAmount-h("Invoice"),a=e.payment.Bill.TotalAmount+(e.payment.BonusAmount?e.payment.BonusAmount:0)-h("Bill");if(n!=a){var l=new t.Payment;l.InvoiceId=e.payment.InvoiceId,l.PaymentDate=(new moment).format(),l.PaymentType="Other",l.Reference="Balance Transfer";var c=new t.BillPayment;c.BillId=e.payment.BillId,c.PaymentDate=(new moment).format(),c.PaymentType="Other",c.Reference="Balance Transfer",n>a?(l.AmountPaid=a,c.Amount=a):(l.AmountPaid=n,c.Amount=n),c.$save().then(function(){l.$save().then(function(){w("Invoice"),w("Bill")})})}}function P(n){"Invoice"==n&&(e.newInPayment=new t.Payment,e.newInPayment.InvoiceId=e.payment.InvoiceId),"Bill"==n&&(e.newBillPayment=new t.BillPayment,e.newBillPayment.BillId=e.payment.BillId)}function d(n,t){"Invoice"==n&&(e.InSelected=t),"Bill"==n&&(e.BillSelected=t)}function p(n,t){"Invoice"==n&&t.PaymentDate&&t.AmountPaid>0&&t.PaymentType&&(t.$patch().success(function(){swal("Success","Payment Updated","success"),w(n)}),e.selected=null),"Bill"==n&&t.PaymentDate&&t.Amount>0&&t.PaymentType&&(t.$patch().success(function(){swal("Success","Payment Updated","success"),w()}),e.selected=null)}function I(n){"Invoice"==n&&e.newInPayment.PaymentDate&&e.newInPayment.AmountPaid>0&&e.newInPayment.PaymentType&&e.newInPayment.$save().success(function(){swal("Success","Invoice Payment Saved.","success"),e.newInPayment=null,w(n)}).error(function(){swal({title:"Error Occured",type:"error"})}),"Bill"==n&&e.newBillPayment.PaymentDate&&e.newBillPayment.Amount>0&&e.newBillPayment.PaymentType&&e.newBillPayment.$save().success(function(){swal("Success","Bill Payment Saved.","success"),e.newBillPayment=null,w(n)}).error(function(){swal({title:"Error Occured",type:"error"})})}function f(n,t){t.$rollback(),"Invoice"==n&&(e.InSelected=null),"Bill"==n&&(e.BillSelected=null)}function v(n){"Invoice"==n&&(e.newInPayment=null),"Bill"==n&&(e.newBillPayment=null)}function B(e,n){swal({title:"Are you sure?",text:"This invoice will be deleted permanentaly",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},function(){n.$delete().success(function(){w(e)})})}function w(n){"Invoice"==n&&t.Payment.query().where("InvoiceId","==","guid'"+e.payment.InvoiceId+"'").trackingEnabled().execute().then(function(n){e.invoicePayments=n}),"Bill"==n&&t.BillPayment.query().where("BillId","==","guid'"+e.payment.BillId+"'").trackingEnabled().execute().then(function(n){e.billPayments=n})}function A(e){e.preventDefault(),e.stopPropagation()}function h(n){var t=0;return"Invoice"==n&&angular.forEach(e.invoicePayments,function(e){t+=parseFloat(e.AmountPaid)}),"Bill"==n&&angular.forEach(e.billPayments,function(e){t+=parseFloat(e.Amount)}),t}e.invoicePayments=a,e.billPayments=l,e.driverId=i,e.CARD_PAYMENTS_ENABLED=m.CARD_PAYMENTS_ENABLED,e.opened={},e.openedDt={},e.paymentParams={},e.InSelected=null,e.BillSelected=null,e.newInPayment=null,e.newBillPayment=null,e.clientCards=null,e.selectPayment=d,e.updatePayment=p,e.cancelUpdate=f,e.deletePayment=B,e.createNewPayment=P,e.cancelSave=v,e.TaxTotal=r,e.savePayment=I,e.openCalendar=A,e.calculatePaidAmount=h,e.InPaymentTypes=(new t.Payment).$$schema.PaymentType["enum"],e.BillPaymentTypes=(new t.BillPayment).$$schema.PaymentType["enum"],e.transferBalance=u,e.createNewCreditCardPayment=o,e.takeInvoiceCardPayment=s,e.cancelNewCardPayment=y}var n=angular.module("cab9.driverpayments");n.controller("DriverPaymentPaymentsController",e),e.$inject=["$scope","$q","Model","rDInvoicePayments","rBillPayments","$http","rDriverId","$config"]}();;;;
!function(){function t(t,e,n,o,r,s,a,d,l){t.adjustments=n,t.displayMode="VIEW"}var e=angular.module("cab9.driverpayments");e.controller("DriverPaymentsViewAdjustmentsController",t),t.$inject=["$scope","$modal","rAdjustments","Model","$http","$config","$state","$q","$UI"]}();;;;
!function(){function e(e,t,n,r,a,l,d,u,s){function o(){e.allSelected=!e.allSelected,e.adjustments=e.adjustments.map(function(t){return t.$selected=e.allSelected,t})}function m(n){var a=e.adjustments.indexOf(n),l=t.open({templateUrl:"/webapp/common/views/drivers/adjustments/modal/modal.html",controller:"DriverItemAdjustmentEditController",size:"lg",resolve:{rAdjustment:function(){return r.DriverPaymentAdjustment.query().where("Id eq guid'"+n.Id+"'").trackingEnabled().execute()},rTaxes:function(){return r.Tax.query().execute()}}});l.result.then(function(t){t.data.$recurring=!1,e.adjustments[a]=t.data},function(){})}function c(){var n=t.open({templateUrl:"/webapp/common/views/drivers/adjustments/modal/modal.html",controller:"DriverItemAdjustmentCreateController",resolve:{rDriverId:function(){return e.selectedItem.Driver.Id},rTaxes:function(){return r.Tax.query().execute()}}});n.result.then(function(t){e.adjustments||(e.adjustments=[]),t.data.$recurring=!1,e.adjustments.push(t.data)},function(){})}e.add=c,e.toggleAll=o,e.allSelected=!0,e.adjustments=e.selectedItem.Adjustments,e.displayMode="CREATE",e.openAdjustmentEdit=m}var t=angular.module("cab9.driverpayments");t.controller("DriverPaymentsCreateAdjustmentsController",e),e.$inject=["$scope","$modal","$anchorScroll","Model","$http","$config","$state","$q","$UI"]}();;;;
!function(e){function t(t,r,n,o,a,l,m,c){function d(){return t.drivers.filter(function(e){return e.$checked}).length}function u(e){return e.DriverTypeId==t.selected.DriverType||!t.selected.DriverType}function s(e,r){t.opened[r]=!0,e.preventDefault(),e.stopPropagation()}function y(){if(t.allDriverSelected=!t.allDriverSelected,t.selected.DriverType)for(i=0,len=t.drivers.length;i<len;i++)t.drivers[i].DriverTypeId==t.selected.DriverType&&(t.drivers[i].$checked=t.allDriverSelected);else t.drivers=t.drivers.map(function(e){return e.$checked=t.allDriverSelected,e})}function v(){var e=[];for(i=0,len=t.drivers.length;i<len;i++)t.drivers[i].$checked&&e.push(t.drivers[i].Id);m.close(),null==t.payment.PaymentFrom&&(t.payment.PaymentFrom=(new moment).subtract(1,"year").startOf("isoweek").toDate()),r.go("root.driverpayments.create",{data:{payment:t.payment,driverIds:e}})}t.drivers=c.map(function(e){return e.$checked=!1,e}),t.allDriverSelected=!1,t.selectAllDrivers=y,t.getSelectedDriversCount=d,t.driverFilter=u,t.$watchGroup(["payment.PaymentTo","payment.PaymentFrom"],function(){var r=null!=t.payment.PaymentFrom?new moment(t.payment.PaymentFrom).format():(new moment).subtract(1,"year").startOf("isoweek").format(),n=new moment(t.payment.PaymentTo).format();a.Booking.query().select("Id,DriverId").where("BookedDateTime ge datetimeoffset'"+r+"'").where("BookedDateTime le datetimeoffset'"+n+"'").where("DriverPaymentId eq null").where("DriverId ne null").where("BookingStatus eq 'Completed' or BookingStatus eq 'COA'").execute().then(function(r){e.forEach(t.drivers,function(e){e.$bookings=r.filter(function(t){return t.DriverId==e.Id}).length})})}),a.DriverType.query().execute().then(function(e){t.driverTypes=e},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:n.COLOURS.brandSecondary})}),t.payment=new a.DriverPayment,t.payment.PaymentFrom=null,t.payment.PaymentTo=(new moment).subtract(1,"week").endOf("isoweek").toDate(),t.payment.Driver=null,t.payment.PaymentModel=null,t.selected={DriverIds:null,DriverType:null},t.opened={},t.payment.Bill=new a.Bill,t.payment.Bill.DueDate=(new moment).add(1,"month").toDate(),t.payment.Invoice=new a.Invoice,t.payment.Invoice.DueDate=(new moment).add(1,"month").toDate(),t.payment.Invoice.InvoiceType="Driver",t.payment.Invoice.PaymentInstructions=t.COMPANY.DefaultInvoicePaymentInstructions,t.openCalendar=s,t.proceed=v}var r=e.module("cab9.common");r.controller("NewPaymentInitController",t),t.$inject=["$scope","$state","$UI","$q","Model","$stateParams","$modalInstance","rDrivers"]}(angular);;;;
!function(e){function t(t,o,r,n,l,s,d,c,a,u,f,p,m){function h(){t.addNew=!1,t.newfixed=null}function I(){t.addNew=!0,t.newfixed=new s.DriverPaymentModelFixed,t.newfixed.DriverPaymentModelId=t.item.Id}function g(o){function r(o){o.Amount=parseFloat(o.Amount),f.post(p.API_ENDPOINT+"api/DriverPayments/addNewDriverFixed",o).then(function(o){t.addNew=!1,t.disabled=!1,o.data.Amount=o.data.Amount.toFixed(2),t.fixeds.push(o.data),t.newfixed=null,e.forEach(t.fixeds,function(e){var o=e.VehicleTypes.map(function(e){return new s.VehicleTypeInDriverPaymentFixed(e)});e.VehicleTypes.length=0,[].push.apply(e.VehicleTypes,o),e["delete"]=!1,null!=e.FromId?e.$SelectedFrom=t.zones.find(function(t){return t.Id==e.FromId}):e.$SelectedFrom=e.FromPostcode,null!=e.ToId?e.$SelectedTo=t.zones.find(function(t){return t.Id==e.ToId}):e.$SelectedTo=e.ToPostcode})},function(){t.disabled=!1,console.log("Error occured")})}return null==o.FromId&&(null==o.FromPostcode||o.FromPostcode.length<2)?void swal("Error","Please select either a From Zone or enter a valid Postcode Prefix","error"):null==o.ToId&&(null==o.ToPostcode||o.ToPostcode.length<2)?void swal("Error","Please select either a To Zone or enter a valid Postcode Prefix","error"):void r(o)}function P(){for(i=0;i<t.fixeds.length;i++)t.fixeds[i]["delete"]=!1;t.showDeleteCheckbox=!1}function x(o){t.disabled=!0,null!=o.Id&&void 0!=o.Id&&f.post(p.API_ENDPOINT+"api/DriverPayments/updateDriverfixed",o).then(function(){t.disabled=!1,e.forEach(t.fixeds,function(e){e["delete"]=!1,null!=e.FromId?e.$SelectedFrom=t.zones.find(function(t){return t.Id==e.FromId}):e.$SelectedFrom=e.FromPostcode,null!=e.ToId?e.$SelectedTo=t.zones.find(function(t){return t.Id==e.ToId}):e.$SelectedTo=e.ToPostcode})},function(){t.disabled=!1,console.log("Error occured")})}function y(){m.open({templateUrl:"/webapp/management/settings/driverpayments/fixed/import.modal.html",controller:["$scope","$config","$q","Auth","$http","$state","$modalInstance",function(e,t,o,r,i,n,s){function d(){function t(t){e["import"].status="File Uploaded!",e["import"].filename=t.FileName,e["import"].preview=t.Rows,e["import"].stage="VALIDATE",e["import"].hasErrors=t.Rows.filter(function(e){return e.Errors.length>0}).length>0,e["import"].hasWarnings=t.Rows.filter(function(e){return e.Warnings.length>0}).length>0,e["import"].hasErrors||e["import"].hasWarnings?e["import"].hasErrors?swal({type:"error",title:"Error validating file",text:"Would you like to view the errors?",showCancelButton:!0,confirmButtonText:"Yes, show me the errors."},function(){s.close(),n.go("root.settings.import.driver-prices",{progress:e["import"]})}):e["import"].hasWarnings&&swal({type:"error",title:"Warnings validating file",text:"Would you like to view the warnings?",showCancelButton:!0,confirmButtonText:"Yes, show me the warnings.",cancelButtonText:"No, continue with upload."},function(t){t?(s.close(),n.go("root.settings.import.driver-prices",{progress:e["import"]})):c().then(function(){s.close()})}):c().then(function(){s.close()})}function o(){e["import"].status="Error Uploading",swal("Error","Import Failed.","error")}function r(t){e["import"].percent=t,100==t&&(e["import"].percent=null,e["import"].status="Processing")}if(e["import"].file&&!u){if(!e["import"].file.name.endsWith(".csv"))return void swal("Upload Error","CSV files only, file should end with '.csv'.","error");u=!0,e["import"].status="Uploading "+e["import"].file.name,a(e["import"].file).then(t,o,r)}}function c(){if(!e["import"].pressed)return e["import"].pressed=!0,i.post(t.API_ENDPOINT+"api/Import/DriverFixed/Confirm",{filename:e["import"].filename,modelId:e["import"].modelId}).then(function(){swal("Import Success","rows imported successfully","success"),e["import"]={stage:"UPLOAD",clientId:null,file:null,status:"",percent:0,preview:null}},function(){swal("Import Error","An error occured during import","error")})}function a(i){var n=o.defer(),l=new FormData;l.append("file",i);var s=new XMLHttpRequest;return s.upload.onprogress=function(t){e.$apply(function(){t.lengthComputable&&n.notify(Math.round(t.loaded/t.total*100))})},s.onload=function(e){4==e.target.readyState&&(200==e.target.status?n.resolve(JSON.parse(e.target.response)):n.reject(e.target.responseText))},s.onerror=function(e){n.reject(e)},s.onabort=function(e){n.reject(e)},s.open("POST",t.API_ENDPOINT+"api/Import/DriverFixed/Valdate?modelId="+e["import"].modelId,!0),s.setRequestHeader("Authorization","Bearer "+r.getSession().access_token),s.setRequestHeader("Accept-Type","application/json"),s.send(l),n.promise}e["import"]={stage:"UPLOAD",modelId:l.Id,file:null,status:"",percent:0,preview:null};var u=!1;e.validateFile=d,e.importFile=c,e.decrement=function(){console.log("Hey!")}}]}).result.then(function(){T()})}function v(){var e=t.fixeds.filter(function(e){return 1==e["delete"]});t.showDeleteCheckbox=!t.showDeleteCheckbox,e.length>0&&swal({title:"Are you sure?",text:"You will not be able to recover selected fixed pricing.",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},function(){f.post(p.API_ENDPOINT+"api/DriverPayments/deleteSelectedDriverFixed",e).then(function(){t.fixeds=t.fixeds.filter(function(e){return 0==e["delete"]}),t.showDeleteCheckbox=!1,swal("Deleted Successfully","Fixed Prices deleted successfully.","success")},function(){t.showDeleteCheckbox=!0,swal("Delete Error","An error occured","error")})})}function T(){var e=s.DriverPaymentModelFixed.query().select("Id").parseAs(function(e){this.Id=e.Id}).filter("DriverPaymentModelId","eq","guid'"+l.Id+"'");t.filters.fromZone&&""!=t.filters.fromZone&&e.filter("FromId eq guid'"+t.filters.fromZone+"'"),t.filters.toZone&&""!=t.filters.toZone&&e.filter("ToId eq guid'"+t.filters.toZone+"'"),t.filters.fromPostcode&&""!=t.filters.fromPostcode&&e.filter("FromPostcode eq'"+t.filters.fromPostcode+"'"),t.filters.toPostcode&&""!=t.filters.toPostcode&&e.filter("ToPostcode eq '"+t.filters.toPostcode+"'"),e.execute().then(function(e){t.paging.totalResults=e.length,t.paging.maxPages=Math.ceil(t.paging.totalResults/t.paging.resultsPerPage),w(1)},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:o.COLOURS.brandSecondary})}),t.showFilters=!1}function w(r){t.paging.currentPage=r;var i="api/DriverPayments/FetchDriverFixedDetails?driverPaymentModelId="+l.Id+"&count=200&pageNum="+r;t.filters.fromZone&&""!=t.filters.fromZone&&(i=i+"&FromId="+t.filters.fromZone),t.filters.toZone&&""!=t.filters.toZone&&(i=i+"&ToId="+t.filters.toZone),t.filters.fromPostcode&&""!=t.filters.fromPostcode&&(i=i+"&FromPostcode="+t.filters.fromPostcode),t.filters.toPostcode&&""!=t.filters.toPostcode&&(i=i+"&ToPostcode="+t.filters.toPostcode),f.get(p.API_ENDPOINT+i).then(function(o){t.fixeds=o.data,o.data.length>0&&(t.fixeds=o.data.map(function(e){return new s.DriverPaymentModelFixed(e)}),e.forEach(t.fixeds,function(e){var o=e.VehicleTypes.map(function(e){return new s.VehicleTypeInDriverPaymentFixed(e)});e.VehicleTypes.length=0,[].push.apply(e.VehicleTypes,o),e["delete"]=!1,null!=e.FromId?e.$SelectedFrom=t.zones.find(function(t){return t.Id==e.FromId}):e.$SelectedFrom=e.FromPostcode,null!=e.ToId?e.$SelectedTo=t.zones.find(function(t){return t.Id==e.ToId}):e.$SelectedTo=e.ToPostcode}))},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:o.COLOURS.brandSecondary})})}function F(e){var o=[];o.push(t.fixeds[e]),swal({title:"Are you sure?",text:"You will not be able to recover this fixed pricing!",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},function(){f.post(p.API_ENDPOINT+"api/DriverPayments/deleteSelectedDriverFixed",o).then(function(){t.fixeds.splice(e,1),swal("Deleted Successfully","Fixed Prices deleted successfully","success")},function(){swal("Delete Error","An error occured","error")})})}function D(e,t){if(void 0!=e&&null!=e.VehicleTypes){var o=e.VehicleTypes.filter(function(e){return e.VehicleTypeId==t.Id})[0];return o?o.FixedPayment.toFixed(2):null}}function S(e,t,o){if(void 0!=e&&null!=e.VehicleTypes&&void 0!=e.Id){e.VehicleTypes=e.VehicleTypes||[];var r=e.VehicleTypes.filter(function(e){return e.VehicleTypeId==t.Id})[0];if(r)r.FixedPayment=parseFloat(o);else if(o){var i=new s.VehicleTypeInDriverPaymentFixed;i.VehicleTypeId=t.Id,i.DriverPaymentModelId=e.Id,i.FixedPayment=parseFloat(o),e.VehicleTypes.push(i)}x(e)}else if(void 0==e.Id){var i=new s.VehicleTypeInDriverPaymentFixed;i.VehicleTypeId=t.Id,i.DriverPaymentModelId=e.Id,i.FixedPrice=parseFloat(o),void 0==e.VehicleTypes&&(e.VehicleTypes=[]);var n,l=e.VehicleTypes.find(function(e,o){return e.VehicleTypeId==t.Id});if(void 0==l)e.VehicleTypes.push(i);else{var n=e.VehicleTypes.indexOf(l);e.VehicleTypes[n].FixedPrice=parseFloat(o)}}}for(t.paging={currentPage:1,resultsPerPage:10,totalResults:null,maxPages:null},t.paging.totalResults=d.length,t.paging.maxPages=Math.ceil(t.paging.totalResults/t.paging.resultsPerPage),t.setPage=w,t.filter=T,t.fixeds=c,t.zones=u,i=0;i<t.fixeds.length;i++)void 0==t.fixeds[i].Amount&&null==t.fixeds[i].Amount||(t.fixeds[i].Amount=t.fixeds[i].Amount.toFixed(2)),t.fixeds[i]["delete"]=!1,null!=t.fixeds[i].FromId?t.fixeds[i].$SelectedFrom=t.zones.find(function(e){return e.Id==t.fixeds[i].FromId}):t.fixeds[i].$SelectedFrom=t.fixeds[i].FromPostcode,null!=t.fixeds[i].ToId?t.fixeds[i].$SelectedTo=t.zones.find(function(e){return e.Id==t.fixeds[i].ToId}):t.fixeds[i].$SelectedTo=t.fixeds[i].ToPostcode;t.vehicleTypes=a,t.currentlyEditing=null,t.currentlyCreating=null,t.startNew=I,t.remove=F,t.getVehicleTypeCost=D,t.setVehicleTypeCost=S,t.startImport=y,t.deleteSelected=v,t.cancelDelete=P,t.cancelNewEdit=h,t.saveChanges=x,t.saveNew=g,t.showDeleteCheckbox=!1,t.addNew=!1,t.selectedDropdownItem=null,t.dropdownItems=[],t.dropdownItems=t.zones,t.prices=[],t._pindex=0,t.zones.unshift({Id:null,Name:"Custom Postcode -"}),t.filters={fromZone:null,toZone:null,fromPostcode:null,toPostcode:null},t.filterObjectList=function(e){var o=r.defer(),i=e.toLowerCase(),n=t.dropdownItems.filter(function(e){var t=0===e.Name.toLowerCase().indexOf(i);return t});return o.resolve(n),o.promise}}var o=e.module("cab9.settings");o.controller("SettingsDriverPaymentFixedController",t),t.$inject=["$scope","$UI","$q","$state","$stateParams","Model","rFixedCount","rFixeds","rVehicleTypes","rZones","$http","$config","$modal"]}(angular);;;;
!function(e,r){function t(e,r,t,o){o.test("reports")&&(e.state("root.reports",{url:"/reports",permission:"Reports",views:{"content-wrapper@root":{templateUrl:"/webapp/management/reports/all/reports.partial.html",controller:"ReportsController"}},resolve:{rDrivers:["Model",function(e){return[]}],rClients:["Model",function(e){return[]}],rPassengers:["Model",function(e){return[]}],rVehicleTypes:["Model",function(e){return e.VehicleType.query().execute()}],rVehicleClasses:["Model",function(e){return e.VehicleClass.query().execute()}],rCurrencies:["Model",function(e){return e.Currency.query().execute()}]}}),r.registerMenuItem({state:"root.reports",icon:"assessment",title:"Reports"}))}function o(){}var n=r.module("cab9.report",[]);n.config(t),n.run(o),t.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider","$permissions"],o.$inject=[]}(window,angular);;;;
!function(e){function t(e,t,r,n,o,i,l,c){function s(r){var i=t.open({templateUrl:"/webapp/management/vehicles/item/vehicle-type/vehicletype-edit.modal.html",backdrop:"static",controller:["$scope","$modalInstance","$http","$config","Model","rItem","rTaxes",function(e,t,r,n,i,s,a){function p(e,t){var r=o.defer(),i=new FormData;i.append("file",e),i.append("vehicletype",JSON.stringify(t));var s=new XMLHttpRequest;return s.upload.onprogress=function(e){c.$apply(function(){e.lengthComputable&&r.notify(Math.round(e.loaded/e.total*100))})},s.onload=function(e){4==e.target.readyState&&(200==e.target.status?r.resolve(JSON.parse(e.target.response)):r.reject(e.target.responseText))},s.onerror=function(e){r.reject(e)},s.onabort=function(e){r.reject(e)},s.open("POST",n.API_ENDPOINT+"api/VehicleTypes/Update"),s.setRequestHeader("Authorization","Bearer "+l.getSession().access_token),s.setRequestHeader("Accept-Type","application/json"),s.send(i),r.promise}e.item=s,e.Mode="EDIT",e.taxes=a,e["import"]={file:null};e.save=function(){if(void 0!=e["import"].file){if(!e["import"].file.name.endsWith(".jpg")&&!e["import"].file.name.endsWith(".png"))return void swal("Upload Error","image files only, file should end with '.jpg' or '.png'.","error");p(e["import"].file,e.item).then(function(r){e.item.$isDelete=!1,t.close(r),swal("Edited","Vehicle Type Saved.","success")},function(e){swal({title:"An Error Occured!",text:"Vehicle Type has not been Saved.",type:"error"})},function(e){})}else e.item.$update().success(function(){swal("Edited","Vehicle Type Saved.","success"),t.close(e.item,!1)}).error(function(){swal({title:"Error Occured",type:"error"})})},e["delete"]=function(){swal({title:"Are you sure?",text:"Vehicle Type will be deleted",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){e.deleting=!0,e.item.$delete().success(function(){e.item.$isDelete=!0,swal("Deleted","Vehicle Type Deleted.","success"),t.close(e.item)}).error(function(){swal({title:"Error Occured",type:"error"})})},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:$UI.COLOURS.brandSecondary})})},e.close=function(){e.item.$rollback(),t.close()}}],resolve:{rItem:function(){return e.vehicleTypes.find(function(e){return e.Id==r})},rTaxes:function(){return n.Tax.query().execute()}}});i.result.then(function(t){null!=t&&(t.$isDelete?e.vehicleTypes=e.vehicleTypes.filter(function(e){return e.Id!=t.Id}):(e.vehicleTypes=e.vehicleTypes.filter(function(e){return e.Id!=t.Id}),t.ImageUrl&&("http"==t.ImageUrl.slice(0,4)?t._ImageUrl=t.ImageUrl:t._ImageUrl=window.resourceEndpoint+t.ImageUrl),e.vehicleTypes.push(t),e.vehicleTypes.sort(function(e,t){return e.Priority-t.Priority})))})}function a(){var r=t.open({templateUrl:"/webapp/management/vehicles/item/vehicle-type/vehicletype-edit.modal.html",backdrop:"static",controller:["$scope","$modalInstance","$http","$config","Model","rItem",function(e,t,r,n,i,s){function a(e,t){var r=o.defer(),i=new FormData;i.append("file",e),i.append("vehicletype",JSON.stringify(t));var s=new XMLHttpRequest;return s.upload.onprogress=function(e){c.$apply(function(){e.lengthComputable&&r.notify(Math.round(e.loaded/e.total*100))})},s.onload=function(e){4==e.target.readyState&&(200==e.target.status?r.resolve(JSON.parse(e.target.response)):r.reject(e.target.responseText))},s.onerror=function(e){r.reject(e)},s.onabort=function(e){r.reject(e)},s.open("POST",n.API_ENDPOINT+"api/VehicleTypes/Update"),s.setRequestHeader("Authorization","Bearer "+l.getSession().access_token),s.setRequestHeader("Accept-Type","application/json"),s.send(i),r.promise}e.item=s,e.Mode="CREATE",e["import"]={file:null};e.save=function(){if(e.item.TenantId=l.getSession().TenantId,void 0!=e["import"].file){if(!e["import"].file.name.endsWith(".jpg")&&!e["import"].file.name.endsWith(".png"))return void swal("Upload Error","image files only, file should end with '.jpg' or '.png'.","error");a(e["import"].file,e.item).then(function(e){t.close(e),swal("Saved","Vehicle Type Saved.","success")},function(e){swal({title:"An Error Occured!",text:"Vehicle Type has not been Added.",type:"error"})},function(e){})}else e.item.$save().success(function(){swal("Saved","Vehicle Type Saved.","success"),t.close(e.item)}).error(function(){swal({title:"Error Occured",type:"error"})})},e.close=function(){e.item.$rollback(),t.close()}}],resolve:{rItem:function(){return new n.VehicleType}}});r.result.then(function(t){null!=t&&(t.ImageUrl&&("http"==t.ImageUrl.slice(0,4)?t._ImageUrl=t.ImageUrl:t._ImageUrl=window.resourceEndpoint+t.ImageUrl),e.vehicleTypes.push(t),e.vehicleTypes.sort(function(e,t){return e.Priority-t.Priority}))})}e.vehicleTypes=r,e.saveVehicleType=a,e.EditVehicleType=s}var r=e.module("cab9.vehicles");r.controller("vehicleTypesController",t),t.$inject=["$scope","$modal","rData","Model","$q","LookupCache","Auth","$rootScope"]}(angular);;;;
!function(){function e(e,t,n,r,s,i,a,o,c,l,u){function h(t){e.fetchedDrivers.length=0,t&&o.Driver.query().where("substringof('"+t+"', concat(concat(Firstname, ' '), Surname)) or substringof('"+t+"', Callsign)").select("Id,Firstname,Surname,Callsign,ImageUrl,DriverType").include("DriverType").parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname+" ("+e.Callsign+")",this.Description=e.DriverType.Name,this.ImageUrl=window.formatImage(e.ImageUrl,e.Callsign)}).execute().then(function(t){[].push.apply(e.fetchedDrivers,t)})}function m(t){e.fetchedClients.length=0,t&&o.Client.query().where("substringof('"+t+"', Name) or substringof('"+t+"', AccountNo)").select("Id,AccountNo,Name,ImageUrl,ClientType/Name").include("ClientType").parseAs(function(e){this.Id=e.Id,this.Name=e.Name+"("+e.AccountNo+")",this.Description=e.ClientType.Name,this.ImageUrl=window.formatImage(e.ImageUrl,e.Name)}).execute().then(function(t){[].push.apply(e.fetchedClients,t)})}function d(t){e.fetchedPassengers.length=0,t&&o.Passenger.query().include("Client").where("substringof('"+t+"', concat(concat(Firstname, ' '), Surname))").select("Id,Firstname,Surname,Client/Name").top(50).parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname,this.Description=e.Client&&e.Client.Name,this.ImageUrl=window.formatImage(e.ImageUrl,e.Firstname)}).execute().then(function(t){[].push.apply(e.fetchedPassengers,t)})}function f(){var e="";for(var t in c.filters)c.filters.hasOwnProperty(t)&&c.filters[t]&&("From"==t||"To"==t?e+="&"+t+"="+c.filters[t]:c.filters[t].length>0&&(e+="DriverIds"==t||"ClientIds"==t||"PassengerIds"==t||"VehicleTypeIds"==t||"VehicleClassIds"==t||"CurrencyIds"==t?"&"+t+"="+c.filters[t].map(function(e){return"'"+e.replace(/ /g,"")+"'"})+"&":t+"="+c.filters[t]+"&"));window.open("/print-reports.html#?t="+c.$$access_token+e,"_blank","width=600,height=800;")}function p(){var e=l.getQuery();e=e.substr(0,e.length-1),console.log(e);var t=u.getSession();currentRequest=window.open($config.API_ENDPOINT+"api/reports/excel?TenantId="+t.TenantId+"&"+e)}e.drivers=t,e.clients=n,e.passengers=r,e.currencies=s,e.vehicleTypes=i,e.vehicleClasses=a,e.printReport=f,e.paymentTypes=[],(new o.Booking).$$schema.PaymentMethod["enum"].forEach(function(t,n){e.paymentTypes.push({Id:n,Name:t})}),e.bookingSources=[],(new o.Booking).$$schema.BookingSource["enum"].forEach(function(t,n){e.bookingSources.push({Id:n,Name:t})}),e.opened={},c.filters.From=moment().subtract(30,"days").format("YYYY-MM-DD"),c.filters.To=moment().subtract(1,"days").format("YYYY-MM-DD"),e.PeriodLength=[{id:"dd",value:"Days"},{id:"ww",value:"Week"},{id:"mm",value:"Months"},{id:"qq",value:"Quarters"},{id:"yy",value:"Years"}],e.openCalendar=function(t,n){e.opened[n]=!0,t.preventDefault(),t.stopPropagation()},e.fetchData=function(){e.fetched=!0,c.$broadcast("fetchData")},e.fetchedDrivers=[],e.searchDrivers=h,e.fetchedClients=[],e.searchClients=m,e.fetchedPassengers=[],e.searchPassengers=d,e.downloadExcel=p}var t=angular.module("cab9.report");t.controller("ReportsController",e),e.$inject=["$scope","rDrivers","rClients","rPassengers","rCurrencies","rVehicleTypes","rVehicleClasses","Model","$rootScope","reports","Auth"]}();;;;
!function(t){function e(e,i,n,o){function u(e,i){function n(t){var e='<a ui-sref="'+t.state+'" style="color:white;width:100%;display:inline-block;"><i class="'+t.icon+'"></i>'+t.title+"</a>";return e}e.menu=i,t.forEach(i,function(t){t.$html=n(t)})}if(o.test("utilities")){var s=[],l="";e.state("root.utilities",{url:"/utilities",permission:"Utilities Module",resolve:{rMenu:[function(){return[]}]},views:{"content-wrapper@root":{templateUrl:"/webapp/management/utilities/utilities.layout.html"}}}),n.when("/utilities","/utilities/documents"),o.test("utilities.documents")&&(l="root.utilities.documents",e.state("root.utilities.documents",{url:"/documents",permission:"Documents",resolve:{rDocuments:["Model",function(t){return t.Document.query().include("DocumentType").execute()}],rDocumentTypes:["Model",function(t){return t.DocumentType.query().execute()}]},views:{"utilities-content@root.utilities":{controller:"DocumentsController",templateUrl:"/webapp/management/utilities/documents/all/partial.html"},"options-area@root.utilities.documents":{templateUrl:"/webapp/management/utilities/documents/all/options.partial.html",controller:"DocumentsOptionsController"}}}),s.push({title:"Documents",state:"root.utilities.documents",icon:"settings_input_component"})),i.registerMenuItem({state:l,icon:"build",title:"Utilities",subMenus:s.filter(function(t){return t.state.substring(5)})}),u.$inject=["$scope","rMenu"]}}var i=t.module("cab9.utilities",[]);i.config(e),e.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider","$permissions"]}(angular);;;;
!function(e){function t(t,n,r,o,s,u){function a(){t.filters.filterBy&&t.filters.filterId&&(t.documents=o.filter(function(e){return e.OwnerType==t.filters.filterBy&&e.OwnerId==t.filters.filterId}),m())}function m(){for(t.groups=[{title:"Expired Last Week",data:[]},{title:"Expiring in One Week",data:[]},{title:"Expiring in Two Weeks",data:[]},{title:"Expiring in One Month",data:[]},{title:"Not Expiring soon",data:[]},{title:"Expired before One Week",data:[]}],i=0,len=t.documents.length;i<len;i++)t.documents[i].ExpiryDate&&(moment(t.documents[i].ExpiryDate).isBefore(moment())?(t.documents[i].$expired=!0,moment(t.documents[i].ExpiryDate).isBefore(moment().subtract(1,"weeks"))?t.groups[5].data.push(t.documents[i]):t.groups[0].data.push(t.documents[i])):moment(t.documents[i].ExpiryDate).isBefore(moment().add(1,"weeks"))?t.groups[1].data.push(t.documents[i]):moment(t.documents[i].ExpiryDate).isBefore(moment().add(2,"weeks"))?t.groups[2].data.push(t.documents[i]):moment(t.documents[i].ExpiryDate).isBefore(moment().add(1,"months"))?t.groups[3].data.push(t.documents[i]):t.groups[4].data.push(t.documents[i]));d()}function d(){c&&(c.masonry("destroy"),c=null),setTimeout(function(){c=$(".grid").masonry({itemSelector:".grid-item",columnWidth:280})},10)}t.documents=e.copy(o),t.searchTerm={},t.documentTypes=s;var c=null;t.setupGrid=d,t.filter=a,t.filters={filterBy:null,filterId:null};var l=[];l.push(u.Driver.query().select("Id,Firstname,Surname").execute()),l.push(u.Staff.query().select("Id,Firstname,Surname").execute()),l.push(u.Client.query().select("Id,Name").execute()),l.push(u.Vehicle.query().select("Id,Registration").execute()),n.all(l).then(function(e){t.Drivers=e[0],t.Staff=e[1],t.Clients=e[2],t.Vehicles=e[3]},function(e){swal({title:"Some Error Occured.",text:"Some error has occured.",type:"error",confirmButtonColor:$UI.COLOURS.brandSecondary})}),m(),setTimeout(function(){d()},500)}var n=e.module("cab9.utilities");n.controller("DocumentsController",t),t.$inject=["$scope","$q","$state","rDocuments","rDocumentTypes","Model"]}(angular);;;;
!function(e){function o(e){function o(){e.showSearch=!e.showSearch,e.showSearch?setTimeout(function(){$("#searchTerm").focus(),e.$parent.setupGrid()},500):e.searchTerm.$=""}e.toggleSearch=o}var c=e.module("cab9.utilities");c.controller("DocumentsOptionsController",o),o.$inject=["$scope"]}(angular);;;;
!function(o,e){function n(o,e,n){o.state("root.conversations",{url:"/conversations",views:{"content-wrapper@root":{controller:"DashboardController",templateUrl:"/webapp/management/conversations/conversations.partial.html"}}}),e.registerMenuItem({state:"root.conversations",icon:"dashboard",title:"Conversations"})}function r(){}var t=e.module("cab9.conversations",[]);t.config(n),t.run(r),n.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider"],r.$inject=[]}(window,angular);;;;
!function(r){function e(r,e,t,o){if(o.test("workshare")){r.state("root.workshare",{url:"/workshare",permission:"Workshare",resolve:{rMenu:[function(){return[]}]},views:{"content-wrapper@root":{templateUrl:"/webapp/management/workshare/partial.html",controller:"WorkshareController"}}}),o.test("workshare.requests")&&r.state("root.workshare.requests",{url:"/requests",permission:"Workshare - Requests",views:{"workshare-content@root.workshare":{templateUrl:"/webapp/management/workshare/requests/partial.html",controller:"WorkshareRequestsController"}}}),o.test("workshare.company")&&(r.state("root.workshare.company",{url:"/company",permission:"Workshare - Company",resolve:{rTabs:[function(){return[{heading:"Profile",route:"root.workshare.company.profile"},{heading:"Live Drivers",route:"root.workshare.company.live-drivers"},{heading:"Coverage Area",route:"root.workshare.company.coverage-area"},{heading:"Fleet",route:"root.workshare.company.fleet"},{heading:"Documents",route:"root.workshare.company.documents"},{heading:"Manage Partners",route:"root.workshare.company.partners"}]}],rCompany:["Model","Auth",function(r,e){return r.Company.query().filter("Id eq guid'"+e.getSession().TenantId+"'").select("Id, Name, LogoUrl, Address1, Address2, Area, TownCity, County, Postcode, Country").trackingEnabled().execute()}],rCompanyProfile:["$http","$config","Model",function(r,e,t){return r({method:"GET",url:e.API_ENDPOINT+"api/partners/profile"}).then(function(r){return r.data?new t.CompanyProfile(r.data):null},function(r){swal("Error",r.ExceptionMessage,"error")})}]},views:{"workshare-content@root.workshare":{templateUrl:"/webapp/management/workshare/company/partial.html",controller:"WorkshareCompanyController"}}}),r.state("root.workshare.company.profile",{url:"/profile",templateUrl:"/webapp/management/workshare/company/profile/partial.html",controller:"WorkshareCompanyProfileController"}),r.state("root.workshare.company.coverage-area",{url:"/coverage-area",templateUrl:"/webapp/management/workshare/company/coverage-area/partial.html",controller:"WorkshareCompanyCoverageAreaController"}),r.state("root.workshare.company.live-drivers",{url:"/live-drivers",templateUrl:"/webapp/management/workshare/company/live-drivers/partial.html",controller:"WorkshareLiveDriversController"}),r.state("root.workshare.company.fleet",{url:"/fleet",templateUrl:"/webapp/management/workshare/company/fleet/partial.html",controller:"WorkshareCompanyFleetController"}),r.state("root.workshare.company.partners",{url:"/partners",templateUrl:"/webapp/management/workshare/company/partners/partial.html",controller:"WorkshareCompanyPartnersController"}),r.state("root.workshare.company.documents",{url:"/documents",views:{"@root.workshare.company":{controller:"WorkshareCompanyDocumentsController",templateUrl:"/webapp/management/workshare/company/document/partial.html"},"document-window@root.workshare.company.documents":{controller:"ModuleDocumentsController",templateUrl:"/e9_components/layouts/module/module-documents.layout.html",resolve:{rDocuments:["Auth","Model",function(r,e){return e.Document.query().where("OwnerType eq 'Company'").where("OwnerId eq guid'"+r.getSession().TenantId+"'").include("DocumentType").trackingEnabled().execute()}],rDocumentTypes:["$http","$config",function(r,e){return r({method:"GET",url:e.API_ENDPOINT+"api/partners/documentTypes"})}],rConfig:["Auth","rDocumentTypes",function(r,e){return{docTypes:e.data,onlyActive:!0,type:"Company",id:r.getSession().TenantId}}]}}}})),o.test("workshare.discover-partner")&&r.state("root.workshare.discover-partner",{url:"/discover-partner",permission:"Workshare - Partners",views:{"workshare-content@root.workshare":{templateUrl:"/webapp/management/workshare/discover-partner/partial.html",controller:"WorkshareDiscoverPartnerController"}},resolve:{rCompany:["Model","Auth",function(r,e){return r.Company.query().filter("Id eq guid'"+e.getSession().TenantId+"'").select("Id, Name, LogoUrl, Address1, Address2, Area, TownCity, County, Postcode, Country, BaseLatitude, BaseLongitude").trackingEnabled().execute()}]}}),o.test("workshare.partner")&&r.state("root.workshare.partner",{url:"/partner/:Id",permission:"Workshare - Partners","default":"root.workshare.partner.details",views:{"workshare-content@root.workshare":{templateUrl:"/webapp/management/workshare/discover-partner/item/partial.html",controller:"WorksharePartnerController"}},resolve:{rTabs:[function(){return[{heading:"Details",route:"root.workshare.partner.details"},{heading:"Pricing",route:"root.workshare.partner.pricing"},{heading:"Coverage",route:"root.workshare.partner.live"},{heading:"Fleet",route:"root.workshare.partner.fleet"},{heading:"Documents",route:"root.workshare.partner.documents"}]}],rCompanyProfile:["$http","$config","$stateParams",function(r,e,t){return r({method:"GET",url:e.API_ENDPOINT+"api/partners/{tenantId}/profile?tenantId="+t.Id}).then(function(r){return r.data},function(r){swal("Error",r.ExceptionMessage,"error")})}]}}),o.test("workshare.partner.details")&&r.state("root.workshare.partner.details",{url:"/details",permission:"Workshare - Partners",views:{"tab-content@root.workshare.partner":{templateUrl:"/webapp/management/workshare/discover-partner/item/details/partial.html",controller:"WorksharePartnerDetailsController"}},resolve:{}}),o.test("workshare.partner.pricing")&&r.state("root.workshare.partner.pricing",{url:"/pricing",permission:"Workshare - Partners",views:{"tab-content@root.workshare.partner":{templateUrl:"/webapp/management/workshare/discover-partner/item/pricing/partial.html",controller:"WorksharePartnerpricingController"}},resolve:{}}),o.test("workshare.partner.live")&&r.state("root.workshare.partner.live",{url:"/live",permission:"Workshare - Partners",views:{"tab-content@root.workshare.partner":{templateUrl:"/webapp/management/workshare/discover-partner/item/live/partial.html",controller:"WorksharePartnerLiveController"}},resolve:{rProfile:["$http","$config","Model",function(r,e,t){return r({method:"GET",url:e.API_ENDPOINT+"api/partners/profile"}).then(function(r){return r.data?new t.CompanyProfile(r.data):null},function(r){swal("Error",r.ExceptionMessage,"error")})}]}}),o.test("workshare.partner.fleet")&&r.state("root.workshare.partner.fleet",{url:"/fleet",permission:"Workshare - Partners",views:{"tab-content@root.workshare.partner":{templateUrl:"/webapp/management/workshare/discover-partner/item/fleet/partial.html",controller:"WorksharePartnerFleetController"}}}),o.test("workshare.partner.documents")&&r.state("root.workshare.partner.documents",{url:"/documents",permission:"Workshare - Partners",views:{"tab-content@root.workshare.partner":{templateUrl:"/webapp/management/workshare/discover-partner/item/documents/partial.html",controller:"WorksharePartnerDocumentsController"}}});var a=[{title:"Company Profile",state:"root.workshare.company.profile",icon:"icon-lock"},{title:"Discover Partners",state:"root.workshare.discover-partner",icon:"icon-lock"},{title:"Partner Requests",state:"root.workshare.requests",icon:"icon-lock"}];a=a.filter(function(r){return r.allow||o.test(r.state.substring(5))}),e.registerMenuItem({state:a.length>0?null:"root.workshare.company",icon:"share",title:"Workshare",subMenus:a})}}function t(e,t){function o(r){var e='<a ui-sref="'+r.state+'" ui-sref-opts="{reload: true}" style="color:white;width:100%;display:inline-block;"><i class="'+r.icon+'"></i>'+r.title+"</a>";return e}e.menu=t,r.forEach(t,function(r){r.$html=o(r)})}var o=r.module("cab9.workshare",[]);o.config(e),o.controller("WorkshareController",t),e.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider","$permissions"],t.$inject=["$scope","rMenu"]}(angular);;;;
!function(e,t){function n(e,n,r,i,o,a,s,c,u,l,d,g,p,m){if(p.nationalMode=!0,p.defaultCountry="gb",n.enabled(!1),l.setEndpoint(e.SIGNALR_ENDPOINT+"signalr/hubs"),l.setHub("locationHub"),item=localStorage.getItem("AUTH_TKN"))try{var f=t.fromJson(item);l.setQueryValue("token",f.access_token)}catch(v){console.log(v)}l.registerEvent("updateDriverLocation"),l.registerEvent("updateDriverStatus"),l.registerEvent("updateDriverShifts"),l.registerEvent("updatePartnerDriverLocations"),l.registerEvent("updateBookingStatus"),l.registerEvent("updateBookingOffer"),l.registerEvent("updateBooking"),l.registerEvent("newMessage"),l.registerEvent("sendDriverETA"),l.registerEvent("bookingResponded"),l.registerEvent("updatePaymentGeneration"),l.registerEvent("updateInvoiceGeneration"),l.registerEvent("updateInvoiceStatus"),l.registerEvent("dispatchRecommendations"),l.registerEvent("dispatchWarnings"),l.registerEvent("newExpenseNotification"),l.registerEvent("approvedExpenseNotification"),l.registerEvent("declinedExpenseNotification"),l.registerEvent("deletedExpenseNotification"),l.registerEvent("bookingDriverAck"),l.registerEvent("ringing"),l.registerEvent("hungUp"),l.registerEvent("answered"),u.showWeeks=!1,u.showButtonBar=!1,m.decorator("ColorPickerOptions",["$delegate",function(e){var n=t.copy(e);return n.round=!1,n.alpha=!1,n.format="hexString",n.restrictToFormat=!0,n}]),s.setGlobalLoggingLevel(5),s.addProvider("ConsoleLoggingProvider"),s.hideCatagory("APP RUN"),i.otherwise("/"),i.when("","/"),r.state("root",{"abstract":!0,onEnter:function(){setTimeout(function(){jQuery(".animation-root").removeClass("animation-root")},1e3)},views:{layout:{templateUrl:"/e9_components/layouts/structure/page.layout.html"},"sidebar-left@root":{templateUrl:"/webapp/layout/sidebar-left/sidebar-left.partial.html",controller:"SidebarController"},"quick-nav@root":{templateUrl:"/webapp/layout/quick-nav/quick-nav.partial.html",controller:"QuickNavController"},"topbar@root":{templateUrl:"/webapp/layout/topbar/topbar.partial.html",controller:"TopBarController"},"sidebar-right@root":{templateUrl:"/webapp/layout/sidebar-right/sidebar-right.partial.html"}},resolve:{rColumns:function(){return null}}}),g.setOptions({delay:3e3,startTop:20,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"right",positionY:"top"})}function r(t,n,r,i,a,s,c,u,l,d,g,p,m,f,v,E,C){function b(){var e=i.createLogger("ROUTER"),a=E.currency(),l=a.currencies(),m=null;r.$on("$stateChangeStart",function(t,n,i,o,a){t.defaultPrevented||(e.debug("$stateChangeStart triggered"),m=c(function(){r.loading=!0},500))}),r.$on("$stateNotFound",function(t,n,i,o){e.warning("$stateNotFound triggered"),u.go("root"),r.loading=!1}),r.$on("$stateChangeSuccess",function(t,n,i,o,s){e.debug("$stateChangeSuccess triggered"),a.getCurrent()&&r.COMPANY&&a.getCurrent().Id!=r.COMPANY.DefaultCurrencyId&&a.setCurrent(r.COMPANY.DefaultCurrencyId),m&&(c.cancel(m),m=null),r.loading=!1}),r.$on("$stateChangeError",function(t,n,r,i,o,a){e.warning("$stateChangeError triggered"),e.debug("Route Error: Redirecting to Dashboard"),e.debug(a),console.log(a),u.go("root")}),r.$on("$viewContentLoading",function(t,n,r){e.debug("$viewContentLoading triggered")}),r.$on("$viewContentLoaded",function(t,n,r){e.debug("$viewContentLoaded triggered"),$("html,body").animate({scrollTop:0},0,function(){})}),f.get(d.API_ENDPOINT+"api/payments/ispaymentenabled").then(function(e){1==e.data.CreditCardPaymentsActive&&(d.CARD_PAYMENTS_ENABLED=!0,r.CARD_PAYMENTS_ENABLED=!0)}),g.AUTH_TKN&&(n.setQueryValue("token",g.AUTH_TKN.access_token),h(),s.Company.query().include("DefaultDriverPaymentModel").include("DefaultTax").include("DefaultTax/TaxComponents").filter("Id eq guid'"+p.getSession().TenantId+"'").execute().then(function(e){r.COMPANY=e[0],r.COMPANY.$defaultTaxRate=r.COMPANY.DefaultTax.TaxComponents.reduce(function(e,t){return e+t.Rate/100},0),r.COMPANY.EnableBidding=!1,r.COMPANY.EnableAuctionBidding=!1,f.get(d.API_ENDPOINT+"api/Bid/companybiddingdetails").then(function(e){e.data&&(r.COMPANY.EnableBidding=!!e.data.EnableBidding&&e.data.EnableBidding,r.COMPANY.EnableAuctionBidding=!!e.data.EnableAuctionBidding&&e.data.EnableAuctionBidding)}),l.then(function(t){a.setCurrent(e[0].DefaultCurrencyId),o=a.getCurrent().Prepend}),e[0].DefaultLocale?C.set(e[0].DefaultLocale):C.set(d.DEFAULT_LOCALE),e[0].DefaultTimezone&&(moment.tz.setDefault(e[0].DefaultTimezone),E.timeZone().setTimeZone(e[0].DefaultTimezone)),E.useMetric(e[0].UseMetric)}),r.EXPIRES=g.AUTH_TKN[".expires"],r.EXPIRING_SOON=function(){return(new moment).isAfter(new moment(new Date(g.AUTH_TKN[".expires"])).subtract(20,"minutes"))}),r.$on(t.LOGIN_SUCCESS,function(e,t){n.setQueryValue("token",t.access_token),h(),s.Company.query().filter("Id eq guid'"+t.TenantId+"'").execute().then(function(e){r.COMPANY=e[0]})}),n.start().then(function(){e.info("SignalR Started")})}function h(){s.DriverType.query().execute().then(function(e){l.DriverType=e,l.DriverType.$updated=new moment}),s.VehicleType.query().execute().then(function(e){l.VehicleType=e.sort(function(e,t){return(e.Priority||99)-(t.Priority||99)}),l.VehicleType.$updated=new moment}),s.VehicleClass.query().execute().then(function(e){l.VehicleClass=e,l.VehicleClass.$updated=new moment}),s.ClientType.query().execute().then(function(e){l.ClientType=e,l.ClientType.$updated=new moment})}i.createLogger("APP RUN");r.$$p=v,r.COMPANY={},r.quickNavAvailable=!0,r.filters={From:null,To:null,DriverIds:[],ClientIds:[],PassengerIds:[],VehicleTypeIds:[],VehicleClassIds:[],CurrencyIds:[],PaymentMethods:null,BookingSources:null,PeriodLength:""},b(),r.API_ENDPOINT=d.API_ENDPOINT,r.RESOURCE_ENDPOINT=d.RESOURCE_ENDPOINT,p.getSession().Claims&&p.getSession().Claims.StaffId&&(r.STAFF_ID=p.getSession().Claims.StaffId[0]),r.formatImage=function(t,n){return t?"http"==t.slice(0,4)?t:"api/"==t.slice(0,4)?e.endpoint+t:e.resourceEndpoint+t:e.endpoint+"api/imagegen?text="+n}}var i=t.module("cab9.permissions",["ui.router"]);i.constant("$permissions",{role:null,permissions:[],test:function(e,t){var n=!1;void 0==t&&(t="R");var r=this.permissions.filter(function(t){return t.hasOwnProperty(e)})[0],i=this.permissions.indexOf(r);return i!=-1&&(n=this.permissions[i][e][t]),this.permissions.indexOf("superadmin")!=-1||n}}),i.config(["$permissions",function(t){t.role=e.$$permissions,t.permissions=JSON.parse(e.$$permissions.Permissions)}]),i.run(["$rootScope","$permissions",function(e,t){e.PERMISSIONS=t}]);var o="£",a=t.module("cab9",["cab9.permissions","cab9.common","cab9.dashboard","cab9.dispatch","cab9.bookings","cab9.clients","cab9.drivers","cab9.vehicles","cab9.staff","cab9.passengers","cab9.invoices","cab9.driverpayments","cab9.report","cab9.settings","cab9.settings.exports","cab9.settings.import","cab9.workshare","rzModule","color.picker"]);a.config(n),a.run(r),a.constant("$UI",{COLOURS:{brandPrimary:"#455674",brandSecondary:"#A88ADC",menuLight:"#2B303B",menuDark:"#21252D",blue:"#008FFB",red:"#F55753",orange:"#e67e22",yellow:"#F8D053",cyan:"#10CFBD",sky:"#48B0F7",green:"#64c458",purple:"#6D5CAE",brandGrey:"#3B4752",darkGrey:"#2B303B",lightGrey:"rgba(100,100,100,0.1)",grey:"#788195",lighterGrey:"rgba(0,0,0,0.2)",light:"#EFEFEF",dark:"#111111",grey:"#999999"}}),n.$inject=["$config","$sceProvider","$stateProvider","$urlRouterProvider","$compileProvider","MenuServiceProvider","LoggerProvider","ModelProvider","datepickerConfig","SignalRProvider","$permissions","NotificationProvider","ipnConfig","$provide"],r.$inject=["AUTH_EVENTS","SignalR","$rootScope","Logger","$modal","Model","$timeout","$state","LookupCache","$config","$localStorage","Auth","ViewerCache","$http","$permissions","Localisation","tmhDynamicLocale"];var s=t.module("cab9.config",[]);s.constant("$config",e.$config)}(window,angular);;;;
!function(e){function o(e,o,r,n,i,t,l){function c(){e.newProfile=null}function a(){e.newProfile=new t.CompanyProfile}function d(){e.loading=!0,e.newProfile.$save().then(function(e){swal({title:"Company Profile Saved",text:"Profile save successfully",type:"success",confirmButtonColor:i.COLOURS.brandSecondary}),o.go("root.workshare.company.profile",null,{reload:!0})},function(o){e.loading=!1,swal({title:"Some Error Occurred.",text:"Some error has occurred.",type:"error",confirmButtonColor:i.COLOURS.brandSecondary})})}e.companyProfile=n,e.tabDefs=r,e.startCreate=a,e.cancelCreate=c,e.saveProfile=d,e.newProfile=null,e.loading=!1,e.pricingModels=[],t.PricingModel.query().filter("TenantId eq guid'"+l.getSession().TenantId+"'").trackingEnabled().execute().then(function(o){e.pricingModels=o},function(e){swal({title:"Error Fetching Pricing Models",text:"Some error has occurred.",type:"error",confirmButtonColor:i.COLOURS.brandSecondary})}),e.$watch("newProfile.PricingModelId",function(){e.pricingModel=e.pricingModels.find(function(o){return o.Id==e.newProfile.PricingModelId})})}var r=e.module("cab9.workshare");r.controller("WorkshareCompanyController",o),o.$inject=["$scope","$state","rTabs","rCompanyProfile","$UI","Model","Auth"]}(angular);;;;
!function(o){function e(o,e,n,r,i,c,t,l){function a(){o.companyProfile||(o.companyProfile=new e.CompanyProfile),o.viewMode="EDIT"}function d(){o.companyProfile.Id?o.companyProfile.$rollback(!1):o.companyProfile=null,o.viewMode="VIEW"}function p(){n.put(i.API_ENDPOINT+"api/partners/profile?profileId="+o.companyProfile.Id,o.companyProfile).success(function(e){swal({title:"Profile updated",text:"Company Profile has been updated",type:"success"}),o.viewMode="VIEW"}).error(function(o){swal("Error",o.ExceptionMessage,"error")})}o.company=c[0],o.companyProfile=t,o.companyProfile||$state.go("root.workshare.company"),e.PricingModel.query().filter("TenantId eq guid'"+l.getSession().TenantId+"'").select("Id, Name").trackingEnabled().execute().then(function(e){o.pricingModels=e,o.pricingModel=o.pricingModels.find(function(e){return e.Id==o.companyProfile.PricingModelId})},function(o){swal({title:"Error Fetching Pricing Models",text:"Some error has occurred.",type:"error",confirmButtonColor:r.COLOURS.brandSecondary})}),o.viewMode="VIEW",o.startEdit=a,o.cancelEdit=d,o.saveEdits=p,o.$watch("companyProfile.PricingModelId",function(e){o.pricingModel=null,e&&o.pricingModels&&(o.pricingModel=o.pricingModels.find(function(o){return o.Id==e}))})}var n=o.module("cab9.workshare");n.controller("WorkshareCompanyProfileController",e),e.$inject=["$scope","Model","$http","$UI","$config","rCompany","rCompanyProfile","Auth"]}(angular);;;;
!function(e){function o(e,o,a,r,n,t,g,l){function c(){var o=new google.maps.LatLngBounds;if(e.configPolygons=[],e.coverageAreas&&e.coverageAreas.length>0)for(i=0;i<e.coverageAreas.length;i++){var a={id:y++,path:google.maps.geometry.encoding.decodePath(e.coverageAreas[i]).map(function(e){return{latitude:e.lat(),longitude:e.lng()}}),rawPath:e.coverageAreas[i],editable:!1,draggable:!1,stroke:{color:"black",weight:5,opacity:.8,zIndex:1e5},zIndex:1e5,fit:!1};e.configPolygons.push(a)}if(e.configPolygons.length>0){for(i=0;i<e.configPolygons.length;i++){var r=e.configPolygons[i];for(j=0;j<r.path.length;j++)o.extend(new google.maps.LatLng(r.path[j].latitude,r.path[j].longitude))}e.mapBounds={northeast:{latitude:o.getNorthEast().lat(),longitude:o.getNorthEast().lng()},southwest:{latitude:o.getSouthWest().lat(),longitude:o.getSouthWest().lng()}}}e.map={center:{latitude:e.COMPANY.BaseLatitude||51.471507,longitude:e.COMPANY.BaseLongitude||-.487904},zoom:9,contol:{}},e.mapSetup=!0,e.$apply()}function d(o){e.selectedCoverageArea||A&&(A.stroke.color="black",A.fit=!1,A.editable=!1,A.index=o)}function s(o){e.selectedCoverageArea||(A&&(A.stroke.color="black",A.fit=!1,A.editable=!1,A.index=o),A=e.configPolygons[o],A.stroke.color="green",A.fit=!1,A.editable=!0,A.index=o)}function u(o){e.selectedCoverageArea=e.configPolygons[o];var a=new google.maps.LatLngBounds;for(j=0;j<e.selectedCoverageArea.path.length;j++)a.extend(new google.maps.LatLng(e.selectedCoverageArea.path[j].latitude,e.selectedCoverageArea.path[j].longitude));e.mapBounds={northeast:{latitude:a.getNorthEast().lat(),longitude:a.getNorthEast().lng()},southwest:{latitude:a.getSouthWest().lat(),longitude:a.getSouthWest().lng()}},e.selectedCoverageAreaMode="EDIT",C("green",!0,!0,o)}function p(){e.currentCompleteHandler&&e.currentCompleteHandler.remove(),e.configPolygons&&e.configPolygons.length>0&&(e.configPolygons.length=0),e.selectedCoverageArea=null,e.selectedCoverageAreaMode=null,e.drawingManager.options.drawingMode=null,e.drawingManager.instance.setDrawingMode(null),setTimeout(function(){c()})}function f(){e.coverageAreas[e.selectedCoverageArea.index]=google.maps.geometry.encoding.encodePath(e.selectedCoverageArea.path.map(function(e){return new google.maps.LatLng(e.latitude,e.longitude)})),e.selectedCoverageAreaMode="VIEW",C("black",!1,!1),e.companyProfile.CoverageArea=e.coverageAreas.join(),a.put(n.API_ENDPOINT+"api/partners/profile?profileId="+e.companyProfile.Id,e.companyProfile).success(function(o){e.selectedCoverageArea=null,l.success("Coverage Area Modified"),setTimeout(function(){c()})}).error(function(e){swal({title:"Error updating coverage area",text:"Some error has occurred.",type:"error",confirmButtonColor:r.COLOURS.brandSecondary})})}function v(o){swal({title:"Are you sure?",text:"Coverage Area will be deleted",type:"warning",showCancelButton:!0,confirmButtonColor:r.COLOURS.brandPrimary,confirmButtonText:"Confirm",closeOnConfirm:!0},function(){e.coverageAreas.splice(o,1),e.configPolygons.splice(o,1),c(),e.companyProfile.CoverageArea=e.coverageAreas.join(),a.put(n.API_ENDPOINT+"api/partners/profile?profileId="+e.companyProfile.Id,e.companyProfile).success(function(e){l.success("Coverage Area Deleted")}).error(function(e){swal({title:"Error deleting coverage area",text:"Some error has occurred.",type:"error",confirmButtonColor:r.COLOURS.brandSecondary})})})}function m(){e.selectedCoverageAreaMode="CREATE",e.drawingManager.options.drawingMode=google.maps.drawing.OverlayType.POLYGON,e.drawingManager.instance.setDrawingMode(google.maps.drawing.OverlayType.POLYGON),e.currentCompleteHandler=google.maps.event.addListener(e.drawingManager.instance,"overlaycomplete",function(o){if(o.type==google.maps.drawing.OverlayType.POLYGON){o.overlay.setMap(null);var t=google.maps.geometry.encoding.encodePath(o.overlay.getPath()),g={id:y++,path:google.maps.geometry.encoding.decodePath(t).map(function(e){return{latitude:e.lat(),longitude:e.lng()}}),rawPath:t,editable:!1,draggable:!0,stroke:{color:"black",weight:5,opacity:.8},$CoverageArea:e.selectedCoverageArea};e.selectedCoverageArea=g,e.configPolygons.push(g),e.drawingManager.options.drawingMode=null,e.drawingManager.instance.setDrawingMode(null),e.currentCompleteHandler.remove(),e.coverageAreas.push(t),e.selectedCoverageAreaMode="VIEW",e.$apply(),e.coverageAreas.length>0&&(e.companyProfile.CoverageArea=e.coverageAreas.join()),a.put(n.API_ENDPOINT+"api/partners/profile?profileId="+e.companyProfile.Id,e.companyProfile).success(function(o){e.selectedCoverageArea=null,g=null,l.success("Coverage Area Added")}).error(function(e){swal({title:"Error adding coverage area",text:"Some error has occurred.",type:"error",confirmButtonColor:r.COLOURS.brandSecondary})})}})}function C(o,a,r,n){e.selectedCoverageArea.stroke.color=o,e.selectedCoverageArea.fit=a,e.selectedCoverageArea.editable=r,e.selectedCoverageArea.index=n}e.company=t[0],e.companyProfile=g;var A=null;e.companyProfile&&e.companyProfile.CoverageArea&&(e.coverageAreas=e.companyProfile.CoverageArea.split(",")),e.coverageAreas||(e.coverageAreas=[]);var y=1e5;e.configPolygons=[],e.viewMode="VIEW",e.startEditCoverageArea=u,e.highlightCoverageArea=s,e.cancelEditCoverageArea=p,e.removeHighlightCoverageArea=d,e.updateCoverageArea=f,e.deleteCoverageArea=v,e.addNewCoverageArea=m,e.drawingManager={control:{},instance:null,options:{drawingMode:null,drawingControl:!1,drawingControlOptions:{drawingModes:[google.maps.drawing.OverlayType.RECTANGLE,google.maps.drawing.OverlayType.CIRCLE,google.maps.drawing.OverlayType.POLYGON]}}},e.mapBounds=new google.maps.LatLngBounds,setTimeout(function(){c()}),e.$watch(function(){return!!e.drawingManager.control.getDrawingManager},function(o){o&&(e.drawingManager.instance=e.drawingManager.control.getDrawingManager())})}var a=e.module("cab9.workshare");a.controller("WorkshareCompanyCoverageAreaController",o),o.$inject=["$scope","Model","$http","$UI","$config","rCompany","rCompanyProfile","Notification"]}(angular);;;;
!function(e){function r(e,r,o,i,n,l){function t(n){var l=n?"Request will be Cancelled.":"Live driver feature will be "+(e.companyProfile.ShowLiveDrivers?"enabled":"disbaled")+" in 12 hours",t=n?"Request Cancelled.":"Live driver feature "+(e.companyProfile.ShowLiveDrivers?"enabled":"disbaled");swal({title:"Are you sure?",text:l,type:"warning",showCancelButton:!0,confirmButtonText:"Confirm",closeOnConfirm:!1,closeOnCancel:!1},function(l){l?o.put(i.API_ENDPOINT+"api/partners/profile/toggle-live-drivers?cancelRequest="+n).success(function(o){r.reload(),swal({title:"Success",text:t,type:"success"}),e.viewMode="VIEW"}).error(function(e){swal("Error",e.ExceptionMessage,"error")}):(e.companyProfile.ShowLiveDrivers=!e.companyProfile.ShowLiveDrivers,e.$apply(),swal.close())})}e.company=n[0],e.companyProfile=l,e.toggleLiveDrivers=t}var o=e.module("cab9.workshare");o.controller("WorkshareLiveDriversController",r),r.$inject=["$scope","$state","$http","$config","rCompany","rCompanyProfile"]}(angular);;;;
!function(e){function r(r,o,l,c,n){function s(){l.get(c.API_ENDPOINT+"api/partners/profile/service?profileId="+r.companyProfile.Id).success(function(e){for(i=0,len=e.length;i<len;i++)for(j=0,leng=r.services.length;j<leng;j++)if(e[i].WorkshareLevelsOfServiceId==r.services[j].Id){r.services[j].Id=e[i].Id,r.services[j].WorkshareLevelsOfServiceId=e[i].WorkshareLevelsOfServiceId,r.services[j].VehicleTypeId=e[i].VehicleTypeId,r.services[j]._VehicleTypeId=e[i].VehicleTypeId;break}r.loading=!1}).error(function(e){r.loading=!1,swal("Error",e.ExceptionMessage,"error")})}function a(e,i){if(e.$loading=!0,e.$tick=!1,e.VehicleTypeId&&!e._VehicleTypeId){if(!e.VehicleTypeId)return;l["delete"](c.API_ENDPOINT+"api/partners/profile/service?serviceId="+e.Id).success(function(r){p(e),e.Id=e.WorkshareLevelsOfServiceId,delete e._VehicleTypeId,delete e.VehicleTypeId}).error(function(r){e.$loading=!1,swal("Error",r.ExceptionMessage,"error")})}else!e.VehicleTypeId&&e._VehicleTypeId?l.post(c.API_ENDPOINT+"api/partners/profile/service",{CompanyProfileId:r.companyProfile.Id,WorkshareLevelsOfServiceId:e.Id,VehicleTypeId:e._VehicleTypeId}).success(function(r){p(e),e.Id=r.Id,e.WorkshareLevelsOfServiceId=r.WorkshareLevelsOfServiceId,e.VehicleTypeId=e._VehicleTypeId}).error(function(r){e.$loading=!1,swal("Error",r.ExceptionMessage,"error")}):l.put(c.API_ENDPOINT+"api/partners/profile/service?serviceId="+e.Id,{CompanyProfileId:r.companyProfile.Id,WorkshareLevelsOfServiceId:e.WorkshareLevelsOfServiceId,VehicleTypeId:e._VehicleTypeId}).success(function(r){p(e),e.WorkshareLevelsOfServiceId=r.WorkshareLevelsOfServiceId,e.VehicleTypeId=e._VehicleTypeId}).error(function(r){e.$loading=!1,swal("Error",r.ExceptionMessage,"error")})}function p(e){e.$loading=!1,e.$tick=!0,setTimeout(function(){e.$tick=!1,r.$apply()},2e3)}function d(){if(r.companyProfile&&r.companyProfile.AllowedServices){var i=r.companyProfile.AllowedServices.replaceAll(" ","").split(",");i.indexOf("Standard")>-1&&(r.companyProfile.$AllowStandard=!0),i.indexOf("Executive")>-1&&(r.companyProfile.$AllowExecutive=!0),i.indexOf("MPV")>-1&&(r.companyProfile.$AllowMPV=!0),i.indexOf("Premium")>-1&&(r.companyProfile.$AllowPremium=!0),i.indexOf("Estate")>-1&&(r.companyProfile.$AllowEstate=!0)}u=e.copy(r.companyProfile)}function t(){r.companyProfile||(r.companyProfile=new o.CompanyProfile),r.viewMode="EDIT"}function f(){r.companyProfile=u,d(),r.viewMode="VIEW"}function I(){var e=[];r.companyProfile.$AllowStandard&&e.push("Standard"),r.companyProfile.$AllowExecutive&&e.push("Executive"),r.companyProfile.$AllowMPV&&e.push("MPV"),r.companyProfile.$AllowPremium&&e.push("Premium"),r.companyProfile.$AllowEstate&&e.push("Estate"),r.companyProfile.AllowedServices=e.join(","),l.put(c.API_ENDPOINT+"api/partners/profile?profileId="+r.companyProfile.Id,r.companyProfile).success(function(e){swal({title:"Profile updated",text:"Company Profile has been updated",type:"success"}),r.viewMode="VIEW"}).error(function(e){swal("Error",e.ExceptionMessage,"error")})}r.companyProfile=n,r.viewMode="VIEW",r.startEdit=t,r.cancelEdit=f,r.updateAddService=a,r.saveEdits=I,o.VehicleType.query().execute().then(function(e){r.vehicleTypes=e},function(e){swal("Error Fetching VehicleTypes",e.ExceptionMessage,"error")}),r.loading=!0,l.get(c.API_ENDPOINT+"api/partners/services").success(function(e){r.services=e,s()}).error(function(e){r.loading=!1,swal("Error",e.ExceptionMessage,"error")});var u=null;d()}var o=e.module("cab9.workshare");o.controller("WorkshareCompanyFleetController",r),r.$inject=["$scope","Model","$http","$config","rCompanyProfile"]}(angular);;;;
!function(o){function n(o){}var r=o.module("cab9.workshare");r.controller("WorkshareCompanyDocumentsController",n),n.$inject=["$scope"]}(angular);;;;
!function(e){function t(t,r,n){function a(a,c){swal({title:"Are you sure?",text:"Partnership will be removed. You will not be able to send/receive bookings to/from the company.",type:"warning",showCancelButton:!0,confirmButtonText:a.Active?"Activate":"Deactivate",closeOnConfirm:!1,closeOnCancel:!1},function(e){return e?void(a.Active?r.put(n.API_ENDPOINT+"api/partners/activate?partnerTenantId="+a.TenantId).success(function(e){swal({title:"Partner updated",text:" Workshare partnership activated",type:"success"})}).error(function(e){swal("Error",e.ExceptionMessage,"error")}):r.put(n.API_ENDPOINT+"api/partners/deactivate?partnerTenantId="+a.TenantId).success(function(e){swal({title:"Partner updated",text:" Workshare partnership de-activated",type:"success"})}).error(function(e){swal("Error",e.ExceptionMessage,"error")})):(a.Active=!a.Active,t.$apply(),void swal.close())},function(r){t.registeredPartners[c].Active=e.copy(o)[c].Active})}var o=[];t.fetching=!0,r({method:"GET",url:n.API_ENDPOINT+"api/partners/linked"}).then(function(r){t.fetching=!1,o=r.data,t.registeredPartners=e.copy(o)},function(e){t.fetching=!1,swal("Get Linked Partners",e.data.ExceptionMessage,"error")}),t.changePartnerStatus=a}var r=e.module("cab9.workshare");r.controller("WorkshareCompanyPartnersController",t),t.$inject=["$scope","$http","$config"]}(angular);;;;
!function(e){function r(e,r,t,n,i,a,s,o){function l(){e.markers.length=0,e.partners.map(function(r){marker={id:r.Id,name:r.Name,alreadyPartner:r.AlreadyPartner,coords:{latitude:r.BaseLatitude,longitude:r.BaseLongitude},mapOptions:{icon:{url:"/includes/images/car1.png",scaledSize:new google.maps.Size(32,42)},title:r.Name,zIndex:google.maps.Marker.MAX_ZINDEX+1},distance:r.Distance||0},e.markers.push(marker)})}function d(e){t.go("root.workshare.partner.details",{Id:e})}function c(){s.open({templateUrl:"/webapp/management/workshare/discover-partner/modals/partial.html",controller:"WorkshareFilterModalController",size:"lg",resolve:{rFilter:function(){return e.filters}}}).result.then(function(r){e.fetching=!0,e.filters=r;var t={};e.filters.addressFinder&&e.filters.addressFinder.latitude&&(t.latitude=e.filters.addressFinder.latitude,t.longitude=e.filters.addressFinder.longitude,t.distance=e.filters.miles),e.filters.minDrivers>0&&(t.minDrivers=e.filters.minDrivers),e.filters.services&&e.filters.services.length>0&&(t.services=e.filters.services.join(",")),n.get(i.API_ENDPOINT+"api/partners/all",{params:t}).success(function(r){e.partners=[],e.partners=r,e.map.center.latitude=e.filters.addressFinder.latitude||e.company.BaseLatitude,e.map.center.longitude=e.filters.addressFinder.longitude||e.company.BaseLongitude,e.map.zoom=7,l(),e.fetching=!1}).error(function(r){e.fetching=!1,swal("Get All Partners",r.data.ExceptionMessage,"error")})})}function u(e){return e?"http"==e.slice(0,4)?e:window.resourceEndpoint+e:window.endpoint+"api/imagegen?text="+(this.Name||"").replace(/ /g,"+")}e.company=a[0],e.markers=[],e.searchTerm={$:""},e.showSearch=!1,e.partnerDetails=d,e.showFilterModal=c,e.formatImage=u,e.fetching=!0,e.height=window.innerHeight,$(window).resize(function(){e.height=window.innerHeight,e.$apply()}),n({method:"GET",url:i.API_ENDPOINT+"api/partners/all"}).then(function(r){e.fetching=!1,e.partners=r.data,l()},function(r){e.fetching=!1,swal("Get All Partners",r.data.ExceptionMessage,"error")}),e.map={center:{latitude:e.company.BaseLatitude||54.3781,longitude:e.company.BaseLongitude||-1.536},zoom:6},e.filters={addressFinder:{latitude:null,longitude:null},services:[],minDrivers:0,miles:50},e.onMarkerClick=function(r,t){e.searchTerm.$=t.name}}var t=e.module("cab9.workshare");t.controller("WorkshareDiscoverPartnerController",r),r.$inject=["$scope","Model","$state","$http","$config","rCompany","$modal","$timeout"]}(angular);;;;
!function(e){function t(e,t,r,o,n,s,i){function a(){e.showReject=!1,$("#reject-box").attr("style","display: none"),y&&y.destroy()}function c(){swal({title:"Are you sure?",text:"Request will be deleted.",type:"warning",showCancelButton:!0,confirmButtonText:"Delete",closeOnConfirm:!0},function(){o["delete"](n.API_ENDPOINT+"api/partners/request?partnerRequestId="+e.companyProfile.RequestId).success(function(e){swal({title:"Deleted",text:"Partner Request Deleted",type:"success"}),t.reload()}).error(function(e){swal({title:"Error",text:e.ExceptionMessage,type:"error"})})})}function l(){swal({title:"Are you sure?",text:"You will not be able to accept the request later.",type:"warning",showCancelButton:!0,confirmButtonText:"Reject",closeOnConfirm:!0},function(){e.showRejectLoader=!0,o.put(n.API_ENDPOINT+"api/partners/reject-request?partnerRequestId="+e.companyProfile.PartnerRequestId+"&reasonForRejection="+e.reject.Reason).success(function(t){swal({title:"Partner Request Rejected",text:"Partner request has been successfully rejected.",type:"success"}),e.showRejectLoader=!1,e.companyProfile.PartnerRequestStatus="Rejected",$("#reject-box").attr("style","display: none"),y&&y.destroy()}).error(function(t){e.showRejectLoader=!1,swal({title:"Error",text:t.ExceptionMessage,type:"error"})})})}function u(){e.showRejectLoader=!0,o.put(n.API_ENDPOINT+"api/partners/accept-request?partnerRequestId="+e.companyProfile.PartnerRequestId).success(function(e){swal({title:"Partner Request Accepted",text:"Partner request has been successfully Accepted.",type:"success"}),t.reload()}).error(function(t){e.showRejectLoader=!1,swal({title:"Error",text:t.ExceptionMessage,type:"error"})})}function p(t,r){e.showReject=!0,e.editposition={attachment:"top left",targetAttachment:"top right",targetOffset:"0 10px"},$("#reject-box").attr("style","display: block"),e.editposition.element="#reject-box",e.editposition.target="#reject-request-btn",y=new Tether(e.editposition)}function d(){swal({title:"Are you sure?",text:"A request will be sent to the partner to Accept/Reject.",type:"warning",showCancelButton:!0,confirmButtonText:"Send",closeOnConfirm:!0},function(){o.post(n.API_ENDPOINT+"api/partners/request",{PartnerDriverVisibilityConfig:e.addPartnerObj.PartnerDriverVisibilityConfig.Value,PartnerTenantId:e.companyProfile.TenantId}).success(function(e){swal({title:"Partnership Requests Sent",text:"Partner has been notified.",type:"success"}),t.reload()}).error(function(e){swal({title:"Error",text:e.ExceptionMessage,type:"error"})})})}function f(e){var t="";return t+=e.Address1?e.Address1+"\n":"",t+=e.Address2?e.Address2+"\n":"",t+=e.Area?e.Area+"\n":"",t+=e.TownCity?e.TownCity+"\n":"",t+=e.Postcode?e.Postcode+"\n":"",t+=e.County?e.County+"\n":"",t+=e.Country?e.Country:""}e.companyProfile=new i.CompanyProfile(s),e.companyProfile.Website=e.companyProfile.Website.indexOf("http:")==-1?"http://"+e.companyProfile.Website:e.companyProfile.Website,e.showReject=!1,e.fullAddress=f(e.companyProfile),e.showRejectLoader=!1,e.addPartner=d,e.showRejectBox=p,e.acceptRequest=u,e.cancelReject=a,e.removeRequest=c,e.reject={Reason:""},e.fetchingProfile=!0,e.myProfile=null,o.get(n.API_ENDPOINT+"api/partners/profile").success(function(t){e.myProfile=t,e.fetchingProfile=!1}).error(function(t){e.fetchingProfile=!1}),e.tabDefs=r,e.rejectRequest=l;var y;e.driverVisibilityOptions=[{Value:"Select Driver Visibility",Description:"Select Driver Visibility"},{Value:"All",Description:"Allow partner to show all of online drivers to their clients"},{Value:"Available",Description:"Allow partner to show all your available drivers to their clients"},{Value:"Limited",Description:"Only show drivers who are on a shared booking"}],e.addPartnerObj={PartnerDriverVisibilityConfig:e.driverVisibilityOptions[0],PartnerTenantId:e.companyProfile.TenantId}}var r=e.module("cab9.workshare");r.controller("WorksharePartnerController",t),t.$inject=["$scope","$state","rTabs","$http","$config","rCompanyProfile","Model"]}(angular);;;;
!function(e){function o(e,o){function t(){var o=new google.maps.LatLngBounds;if(e.configPolygons=[],e.coverageAreas&&e.coverageAreas.length>0)for(i=0;i<e.coverageAreas.length;i++){var t={id:a++,path:google.maps.geometry.encoding.decodePath(e.coverageAreas[i]).map(function(e){return{latitude:e.lat(),longitude:e.lng()}}),rawPath:e.coverageAreas[i],editable:!1,draggable:!1,stroke:{color:"black",weight:5,opacity:.8,zIndex:1e5},zIndex:1e5,fit:!1};e.configPolygons.push(t)}if(e.configPolygons.length>0){for(i=0;i<e.configPolygons.length;i++){var n=e.configPolygons[i];for(j=0;j<n.path.length;j++)o.extend(new google.maps.LatLng(n.path[j].latitude,n.path[j].longitude))}e.mapBounds={northeast:{latitude:o.getNorthEast().lat(),longitude:o.getNorthEast().lng()},southwest:{latitude:o.getSouthWest().lat(),longitude:o.getSouthWest().lng()}}}e.map={center:{latitude:e.companyProfile.BaseLatitude||51.471507,longitude:e.companyProfile.BaseLongitude||-.487904},zoom:8,contol:{}},e.mapSetup=!0,e.$apply()}e.companyProfile=o,e.companyProfile.CoverageArea&&(e.coverageAreas=e.companyProfile.CoverageArea.split(",")),e.configPolygons=[];var a=1e5;e.mapBounds=new google.maps.LatLngBounds,setTimeout(function(){t()})}var t=e.module("cab9.workshare");t.controller("WorksharePartnerDetailsController",o),o.$inject=["$scope","rCompanyProfile"]}(angular);;;;
!function(e){function o(o,n,t,r,s,a){function c(e){o.activeTab=e}function g(){r.get(a.API_ENDPOINT+"api/partners/"+o.companyProfile.TenantId+"/pricingmodel",{params:{pricingModelId:o.companyProfile.PricingModelId}}).success(function(n){o.pricingModel=n,o.vehicleOverrides=n.VehicleTypePricings.map(function(e){return e.Name=o.services.find(function(o){return o.VehicleTypeId==e.VehicleTypeId}).VehicleTypeName,e._Steps=e.FarePerMileSteps?JSON.parse(e.FarePerMileSteps):[],e}),o.steps=o.pricingModel.FarePerMileSteps?JSON.parse(o.pricingModel.FarePerMileSteps):[],o.peakDates=o.pricingModel.PeakDateBands?JSON.parse(o.pricingModel.PeakDateBands):[],o.peakDates&&e.forEach(o.peakDates,function(e){e.startTime=new moment(e.start).format("HH:mm"),e.endTime=new moment(e.end).format("HH:mm")}),o.fetching=!1}).error(function(e){o.fetching=!1,swal("Pricing Model",e.ExceptionMessage,"error")})}function l(){o.services=o.services.map(function(e){return e.$fetching=!0,e}),d(0)}function d(e){var n=o.selectedBooking;n.VehicleTypeId=o.services[e].VehicleTypeId,r.post(a.API_ENDPOINT+"api/partners/"+o.companyProfile.TenantId+"/quote",n).success(function(n){return n.Error?void swal("Error",n.ErrorMessage,"error"):(o.distance||(o.distance=Number(n.EstimatedDistance.toFixed(1))),o.services[e].$fare=Number(n.FinalCost.toFixed(2)),o.services[e].$fetching=!1,void(e<o.services.length-1&&d(e+1)))}).error(function(n){o.services[e].$fare="Error Fetching Quote",o.services[e].$fetching=!1,e<o.services.length&&d(e+1)})}function p(){var e=new t.BookingStop;o.selectedBooking.BookingStops.push(e)}function f(e,o){var n=o.indexOf(e);return n<=0?0:(o[n-1].max>=e.max&&(e.max=o[n-1].max+1),o[n-1].max)}o.viewMode="EDIT",o.activeTab="Default",o.vehicleOverrides=[],o.distance=null,o.companyProfile.CoverageArea&&(o.coverageAreas=o.companyProfile.CoverageArea.split(",")),o.fetching=!0,r.get(a.API_ENDPOINT+"api/partners/profile/service?profileId="+o.companyProfile.Id).success(function(e){o.services=e,g()}).error(function(e){o.fetching=!1,swal("Error",e.ExceptionMessage,"error")}),o.addStop=p,o.getAllQuotes=l,o.setActiveTab=c,o.getPreviousStep=f,o.polygons=[];if(o.quote=null,o.coverageAreas&&o.coverageAreas.length>0)for(i=0;i<o.coverageAreas.length;i++){var m=new google.maps.Polygon({paths:google.maps.geometry.encoding.decodePath(o.coverageAreas[i])});o.polygons.push(m)}o.selectedBooking=new t.Booking,o.selectedBooking.BookingStops.length=0,o.selectedBooking.BookingStops.push(new t.BookingStop),o.selectedBooking.BookingStops.push(new t.BookingStop),o.selectedBooking.TaxId=o.companyProfile.DefaultTaxId,o.selectedBooking.VehicleTypeId=n.defaultVehicleType,o.selectedBooking.VehicleClassId=n.defaultVehicleClass,o.selectedBooking.PricingModelId=o.companyProfile.PricingModelId,o.selectedBooking.TenantId=o.companyProfile.TenantId,o.selectedBooking.Status="Incoming",o.selectedBooking.BookedDateTime=new moment.tz(o.selectedBooking.Time,s.timeZone().getTimeZone()).format();var u=new moment.tz(s.timeZone().getTimeZone());o.selectedBooking.BookedDateTime=u.toDate(),o.selectedBooking.Time=u.startOf("minute").add(15,"minutes").toDate(),o.$watch("selectedBooking.BookingStops",function(){var e=!0,n=!0;if(0==o.polygons.length)return void(n=!1);if(o.selectedBooking.BookingStops[0].Latitude&&o.selectedBooking.BookingStops[1].Latitude){if(o.selectedBooking.BookingStops[0].Latitude&&o.selectedBooking.BookingStops[1].Latitude){e=!1;for(var i=0;i<o.polygons.length;i++){if(google.maps.geometry.poly.containsLocation(new google.maps.LatLng(o.selectedBooking.BookingStops[0].Latitude,o.selectedBooking.BookingStops[0].Longitude),o.polygons[i])){e=!0;break}if(!google.maps.geometry.poly.containsLocation(new google.maps.LatLng(o.selectedBooking.BookingStops[1].Latitude,o.selectedBooking.BookingStops[1].Longitude),o.polygons[i])){e=!0;break}}}}else n=!1;e||(swal("Coverage Area","Booking stop is outside of the coverage area","warning"),o.selectedBooking.canQuote=!1),n&&(o.selectedBooking.$canQuote=!0)},!0)}var n=e.module("cab9.workshare");n.controller("WorksharePartnerpricingController",o),o.$inject=["$scope","$tenantConfig","Model","$http","Localisation","$config"]}(angular);;;;
!function(e){function t(t,o,a,n,r,i){function s(){a({url:o.API_ENDPOINT+"api/partners/"+t.companyProfile.TenantId+"/bookings",method:"GET"}).then(function(e){t.bookingStops=e.data,t.companyProfile.ShowLiveDrivers&&t.profile.ShowLiveDrivers?l():p(),t.fetching=!1},function(e){t.fetching=!1,swal("Get Partner Locations",e.data.ExceptionMessage,"error")})}function l(){t.drivers.length=0,a({url:o.API_ENDPOINT+"api/partners/"+t.companyProfile.TenantId+"/driver-locations",method:"GET"}).then(function(e){t.drivers=e.data,p()},function(e){swal("Get Partner Locations",e.data.ExceptionMessage,"error")})}function p(){t.markers=[];var o=new google.maps.LatLngBounds;e.forEach(t.drivers,function(e){marker={id:e.Id,coords:{latitude:e.LastKnownLatitude,longitude:e.LastKnownLongitude},mapOptions:{icon:{url:"/includes/images/car1.png",scaledSize:new google.maps.Size(32,42)},title:t.companyProfile.Name,zIndex:google.maps.Marker.MAX_ZINDEX+1}},o.extend(new google.maps.LatLng(e.LastKnownLatitude,e.LastKnownLongitude)),t.markers.push(marker)}),t.mapBounds={northeast:{latitude:o.getNorthEast().lat(),longitude:o.getNorthEast().lng()},southwest:{latitude:o.getSouthWest().lat(),longitude:o.getSouthWest().lng()}},t.map={center:{latitude:t.companyProfile.BaseLatitude||54.3781,longitude:t.companyProfile.BaseLongitude||-1.536},zoom:9,heatLayerCallback:function(e){new g(e)},showHeat:!0,styles:[{featureType:"water",elementType:"geometry",stylers:[{color:"#193341"}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#2c5a71"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#29768a"},{lightness:-37}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#406d80"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#406d80"}]},{elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#3e606f"},{weight:2},{gamma:.84}]},{elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"administrative",elementType:"geometry",stylers:[{weight:.6},{color:"#1a3541"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#2c5a71"}]}]}}function g(o){var a=[];e.forEach(t.bookingStops,function(e){var t=new google.maps.LatLng(e.Latitude,e.Longitude);a.push({location:t,weight:1})});var n=new google.maps.MVCArray(a);o.setData(n),o.setOptions({dissipating:!0,radius:50,opacity:.75})}t.companyProfile=r,t.profile=i,t.mapBounds=new google.maps.LatLngBounds,t.drivers=[],t.fetching=!0,s()}var o=e.module("cab9.workshare");o.controller("WorksharePartnerLiveController",t),t.$inject=["$scope","$config","$http","$timeout","rCompanyProfile","rProfile"]}(angular);;;;
!function(e){function a(e,a,t,r){function n(r){e.paging.currentPage=r||1,t.get(a.API_ENDPOINT+"api/partners/{tenantId}/fleet",{params:{tenantId:e.companyProfile.TenantId,pageNumber:r||1,records:e.paging.resultsPerPage}}).success(function(a){e.paging.totalResults=a.Count,e.paging.maxPages=Math.ceil(e.paging.totalResults/e.paging.resultsPerPage),e.fleetDetails=a.FleetDetails}).error(function(e){swal("Error",e.data.ExceptionMessage,"error")})}e.companyProfile=r,e.getFleetDetails=n,e.paging={currentPage:1,resultsPerPage:20,totalResults:null,maxPages:null,loading:!0},n(1)}var t=e.module("cab9.workshare");t.controller("WorksharePartnerFleetController",a),a.$inject=["$scope","$config","$http","rCompanyProfile"]}(angular);;;;
!function(e){function n(e,n,o,t,r,i){function c(){o.Document.query().where("OwnerType eq 'Company'").where("OwnerId eq guid'"+e.companyProfile.TenantId+"'").include("DocumentType").trackingEnabled().execute().then(function(n){e.documents=n.filter(function(e){return e.Active})})}function u(e){return"api"==e.substring(0,3)?window.endpoint+e:window.resourceEndpoint+e}function a(e){window.open(n.RESOURCE_ENDPOINT+e.FilePath,"_blank")}e.companyProfile=i,c(),e.previewDocument=a,e.getImagePath=u}var o=e.module("cab9.workshare");o.controller("WorksharePartnerDocumentsController",n),n.$inject=["$scope","$config","Model","$http","$timeout","rCompanyProfile"]}(angular);;;;
!function(e){function r(r,n,t,i){function o(){t.close(r.filterOptions)}r.filterOptions=e.copy(n),r.filterOptions.addressFinder={latitude:null,longitude:null},r.confirmFilters=o,i.get($config.API_ENDPOINT+"api/partners/services").success(function(e){r.services=e}).error(function(e){swal("Error",e.ExceptionMessage,"error")}),r.$on("address_changed",function(e,n){r.filterOptions.addressFinder.latitude=n.latitude,r.filterOptions.addressFinder.longitude=n.longitude})}var n=e.module("cab9.workshare");n.controller("WorkshareFilterModalController",r),r.$inject=["$scope","rFilter","$modalInstance","$http"]}(angular);;;;
!function(e){function t(e,t,r,n){function s(){e.selectedRequest=null,$("#reject-box").attr("style","display: none"),p&&p.destroy()}function o(s){e.fetching=!0,e.apiRequest=e.apiRequest||{},e.apiRequest.Type=s,t.get(r.API_ENDPOINT+"api/partners/requests?type="+s.toLowerCase()).then(function(t){e.fetching=!1,e.requests=t.data},function(t){e.fetching=!1,swal({title:"Some Error Occurred.",text:"Some error has occurred.",type:"error",confirmButtonColor:n.COLOURS.brandSecondary})})}function c(e){swal({title:"Are you sure?",text:"Request will be deleted.",type:"warning",showCancelButton:!0,confirmButtonText:"Delete",closeOnConfirm:!0},function(){t["delete"](r.API_ENDPOINT+"api/partners/request?partnerRequestId="+e.Id).success(function(e){swal({title:"Deleted",text:"Partner Request Deleted",type:"success"}),o("Sent")}).error(function(e){swal({title:"Error",text:e.ExceptionMessage,type:"error"})})})}function i(n,s){swal({title:"Are you sure?",text:"You will be be able to send/receive bookings to/from the company.",type:"warning",showCancelButton:!0,confirmButtonText:"Send",closeOnConfirm:!0},function(){e.loading=!0,t.put(r.API_ENDPOINT+"api/partners/accept-request?partnerRequestId="+n.Id).success(function(t){swal({title:"Partner Added",text:"Partner has been successfully added.",type:"success"}),e.loading=!1,o("Received")}).error(function(t){e.loading=!1,swal({title:"Error",text:t.ExceptionMessage,type:"error"})})})}function a(e){swal({title:"Are you sure?",text:"A request will be sent to the partner to Accept/Reject.",type:"warning",showCancelButton:!0,confirmButtonText:"Send",closeOnConfirm:!0},function(){t.post(r.API_ENDPOINT+"api/partners/request",{PartnerDriverVisibilityConfig:null,PartnerTenantId:e.PartnerTenantId}).success(function(e){swal({title:"Successful",text:"Partnership request sent.",type:"success"}),o("Received")}).error(function(e){swal({title:"Error",text:e.ExceptionMessage,type:"error"})})})}function u(t,r){e.selectedRequest=t,d=r,e.editposition={attachment:"top left",targetAttachment:"top left",targetOffset:"30px 0"},$("#reject-box").attr("style","display: block"),e.editposition.element="#reject-box",e.editposition.target="#accept-"+t.Id,p=new Tether(e.editposition)}function l(n){swal({title:"Are you sure?",text:"You will not be able to accept the request later.",type:"warning",showCancelButton:!0,confirmButtonText:"Reject",closeOnConfirm:!0},function(){e.loading=!0,t.put(r.API_ENDPOINT+"api/partners/reject-request?partnerRequestId="+e.selectedRequest.Id+"&reasonForRejection="+e.rejectReason).success(function(t){swal({title:"Partner Request Rejected",text:"Partner request has been successfully rejected.",type:"success"}),e.loading=!1,e.selectedRequest=null,$("#reject-box").attr("style","display: none"),p&&p.destroy(),e.requests.splice(d,1)}).error(function(t){e.loading=!1,swal({title:"Error",text:t.ExceptionMessage,type:"error"})})})}o("Received"),e.fetchRequests=o,e.removeRequest=c,e.acceptRequest=i,e.rejectRequest=l,e.showRejectBox=u,e.addPartner=a,e.cancelReject=s,e.rejectReason="",e.selectedRequest=null;var p=null,d=null;e.$on("$destroy",function(){$("#reject-box").remove()})}var r=e.module("cab9.workshare");r.controller("WorkshareRequestsController",t),t.$inject=["$scope","$http","$config","$UI"]}(angular);;;;