!function(e,t){function i(t,i,r,n,a,d,l,s,o,y){i.enabled(!1),o.setEndpoint(t.API_ENDPOINT+"signalr/hubs"),o.setHub("locationHub"),o.setQueryValue("token",""),o.registerEvent("updateDriverLocation"),s.showWeeks=!1,s.showButtonBar=!1,d.setGlobalLoggingLevel(5),d.addProvider("ConsoleLoggingProvider"),d.hideCatagory("APP RUN"),r.state("root",{url:"","abstract":!1,onEnter:function(){setTimeout(function(){jQuery(".animation-root").removeClass("animation-root")},1e3)},views:{layout:{templateUrl:"/e9_components/layouts/structure/page.layout.html"},"sidebar-left@root":{templateUrl:"/webapp/layout/sidebar-left/sidebar-left.partial.html",controller:"SidebarController"},"topbar@root":{templateUrl:"/webapp/layout/topbar/topbar.partial.html",controller:"TopBarController"},"sidebar-right@root":{templateUrl:"/webapp/layout/sidebar-right/sidebar-right.partial.html"}}}),y.setOptions({delay:3e3,startTop:20,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"right",positionY:"top"}),l.registerSchema("Driver","api/drivers",{Id:{type:String,editable:!1,required:!0,validators:[],table:{visible:!1}},TenantId:{type:String,editable:!1,hidden:!0},DriverTypeId:{type:String,required:!0,displayField:"DriverType.Name",table:{hidden:!0}},DriverType:{type:"DriverType",ref:"DriverType",refBy:"DriverTypeId",table:{hidden:!0}},Firstname:{type:String,required:!0,table:{hidden:!0}},Surname:{type:String,required:!0,table:{hidden:!0}},_Fullname:{type:String,calculated:function(){return this.Firstname+" "+this.Surname},display:"Full Name"},Callsign:{type:String,required:!0},Nationality:{type:String,table:{visible:!1}},DateOfBirth:{type:moment,displayFilters:" | date:'shortDate'",table:{visible:!1}},Address1:{type:String,table:{hidden:!0}},Address2:{type:String,table:{hidden:!0}},Area:{type:String,table:{hidden:!0}},TownCity:{type:String,display:"Town/City"},County:{type:String,table:{hidden:!0}},Postcode:{type:String,table:{hidden:!0}},Country:{type:String,table:{hidden:!0}},_FullAddress:{type:String,calculated:function(){var e="";return e+=this.Address1?this.Address1+"\n":"",e+=this.Address2?this.Address2+"\n":"",e+=this.Area?this.Area+"\n":"",e+=this.TownCity?this.TownCity+"\n":"",e+=this.Postcode?this.Postcode+"\n":"",e+=this.County?this.County+"\n":"",e+=this.Country?this.Country:""},table:{visible:!1},display:"Full Address"},Phone:{type:String,table:{visible:!1}},Mobile:{type:String},Fax:{type:String,table:{visible:!1}},Email:{type:String},StartDate:{type:moment,displayFilters:" | date:'shortDate'",defaultValue:(new moment).toDate(),table:{visible:!1}},EndDate:{type:moment,displayFilters:" | date:'shortDate'",required:!1,table:{visible:!1}},Active:{type:Boolean,defaultValue:!0,table:{hidden:!0}},ImageUrl:{type:String,required:!0,table:{hidden:!0}},DriverTags:{type:["DriverTag"],ref:"DriverTag",refType:"OneToMany",defaultValue:[],table:{hidden:!0}},CreationTime:{type:moment,hidden:!0},_ImageUrl:{type:String,hidden:!0,calculated:function(){return e.formatImage(this.ImageUrl,this.Callsign.replace(/ /g,"+"))}}}),l.registerSchema("DriverType","api/drivertypes",{Id:{type:String,editable:!1,hidden:!0},TenantId:{type:String,editable:!1,hidden:!0},Name:{type:String,required:!0},Description:{type:String}}),l.registerSchema("DriverTag","api/drivertags",{Id:{type:String,editable:!1,hidden:!0},TenantId:{type:String,editable:!1,hidden:!0},Name:{type:String,required:!0},Description:{type:String},Drivers:{type:["Driver"],ref:"Driver",refType:"OneToMany",defaultValue:[],table:{hidden:!0}}}),l.registerSchema("Company","api/companies",{Id:{type:String,editable:!1,hidden:!0},Name:{type:String},PricingModelId:{type:String,display:"Default Pricing Model",displayField:"_PricingModelName"},PricingModel:{type:"PricingModel"},LogoUrl:{type:String},Address1:{type:String},Address2:{type:String},Area:{type:String},TownCity:{type:String,display:"Town/City"},County:{type:String},Postcode:{type:String},Country:{type:String},_FullAddress:{type:String,calculated:function(){var e="";return e+=this.Address1?this.Address1+"\n":"",e+=this.Address2?this.Address2+"\n":"",e+=this.Area?this.Area+"\n":"",e+=this.TownCity?this.TownCity+"\n":"",e+=this.Postcode?this.Postcode+"\n":"",e+=this.County?this.County+"\n":"",e+=this.Country?this.Country:""},display:"Address"},BillingAddress1:{type:String},BillingAddress2:{type:String},BillingArea:{type:String},BillingTownCity:{type:String,display:"Town/City"},BillingCounty:{type:String},BillingPostcode:{type:String},BillingCountry:{type:String},_FullBillingAddress:{type:String,calculated:function(){var e="";return e+=this.BillingAddress1?this.BillingAddress1+"\n":"",e+=this.BillingAddress2?this.BillingAddress2+"\n":"",e+=this.BillingArea?this.BillingArea+"\n":"",e+=this.BillingTownCity?this.BillingTownCity+"\n":"",e+=this.BillingPostcode?this.BillingPostcode+"\n":"",e+=this.BillingCounty?this.BillingCounty+"\n":"",e+=this.BillingCountry?this.BillingCountry:""},display:"Billing Address"},Phone:{type:String},Mobile:{type:String},Fax:{type:String},Email:{type:String},Website:{type:String},BaseLatitude:{type:Number},BaseLongitude:{type:Number},BaseZoom:{type:Number},UseSMTP:{type:Boolean},SMTPServer:{type:String},SMTPEmail:{type:String},SMTPUsername:{type:String},SMTPPassword:{type:String},SMTPPort:{type:Number},SMTPSecure:{type:Boolean},MailgunDomain:{type:String},MailgunKey:{type:String},MailgunFromEmail:{type:String},_PricingModelName:{type:String,calculated:function(){return this.PricingModel&&this.PricingModel.Name}},_ImageUrl:{type:String,hidden:!0,calculated:function(){return e.formatImage(this.LogoUrl,this.Name.replace(/ /g,"+"))}},DefaultCurrencyId:{type:String,editable:!1,display:"Default Currency"},DefaultCurrency:{type:"Currency",ref:"Currency",refBy:"DefaultCurrencyId"},DefaultLocale:{type:String,display:"Locale"},DefaultTimezone:{type:String,display:"Timezone"},UseMetric:{type:Boolean,defaultValue:!1},ChauffeurModeActive:{type:Boolean},BankName:{type:String,display:"Bank Name"},AccountNumber:{type:String,display:"Account Number"},SortCode:{type:String,display:"Sort Code"},IBAN:{type:String,display:"IBAN Number"},BIC:{type:String,display:"BIC Code"},DefaultInvoicePaymentInstructions:{type:String,textarea:4,display:"Default Payment Advice"},DefaultTaxId:{type:String,display:"Default Tax",displayField:"_DefaultTax"},DefaultTax:{type:"Tax"}}),l.registerSchema("Vehicle","api/vehicles",{Id:{type:String,editable:!1,hidden:!0},TenantId:{type:String,editable:!1,hidden:!0},VehicleClassId:{type:String,required:!0,displayField:"Class.Name",table:{hidden:!0}},Class:{type:"VehicleClass",ref:"VehicleClass",refBy:"VehicleClassId",table:{hidden:!0}},VehicleTypeId:{type:String,required:!0,displayField:"Type.Name",table:{hidden:!0}},Type:{type:"VehicleType",ref:"VehicleType",refBy:"VehicleTypeId",table:{hidden:!0}},Make:{type:String,required:!0,table:{visible:!1}},Model:{type:String,required:!0,table:{visible:!1}},Colour:{type:String,required:!0,table:{visible:!1}},RegYear:{type:String,required:!0,table:{visible:!1}},_Description:{type:String,calculated:function(){return this.Colour+" "+this.Make+" "+this.Model},display:"Description"},Registration:{type:String,required:!0,display:"Registration No."},Description:{type:String},Pax:{type:Number,defaultValue:4,table:{hidden:!0},display:"Max. Passengers"},Bax:{type:Number,defaultValue:1,table:{hidden:!0},display:"Max. Baggage"},Wheelchairs:{type:Number,defaultValue:0,table:{hidden:!0},display:"Max. Wheelchairs"},StartDate:{type:moment,required:!1,defaultValue:(new moment).toDate(),displayFilters:" | date:'shortDate'",table:{visible:!1}},EndDate:{type:moment,required:!1,displayFilters:" | date:'shortDate'",table:{visible:!1}},Active:{type:Boolean,defaultValue:!0,table:{hidden:!0}},ImageUrl:{type:String,table:{hidden:!0}},DriverId:{type:String,displayField:"Driver._Fullname",table:{hidden:!0}},Driver:{type:"Driver",ref:"Driver",refBy:"DriverId",table:{hidden:!0}},VehicleTags:{type:["VehicleTag"],ref:"VehicleTag",refType:"OneToMany",defaultValue:[],table:{hidden:!0}},CreationTime:{type:moment,hidden:!0},ScoreOverall:{type:Number,table:{hidden:!0}},ScoreBooking:{type:Number,table:{hidden:!0}},ScoreRevenue:{type:Number,table:{hidden:!0}},_ImageUrl:{type:String,hidden:!0,calculated:function(){return t.API_ENDPOINT+"api/imagegen?type=plate&text="+this.Registration.replace(/ /g,"+")}}}),l.registerSchema("VehicleType","api/vehicletypes",{Id:{type:String,editable:!1,hidden:!0},TenantId:{type:String,editable:!1,hidden:!0},Name:{type:String,required:!0},Description:{type:String},Vehicles:{type:["Vehicle"],ref:"Vehicle",refType:"OneToMany",defaultValue:[],table:{hidden:!0}}}),l.registerSchema("VehicleClass","api/vehicleclasses",{Id:{type:String,editable:!1,hidden:!0},TenantId:{type:String,editable:!1,hidden:!0},Name:{type:String,required:!0},Description:{type:String},Vehicles:{type:["Vehicle"],ref:"Vehicle",refType:"OneToMany",defaultValue:[],table:{hidden:!0}}}),l.registerSchema("VehicleTag","api/vehicletags",{Id:{type:String,editable:!1,hidden:!0},TenantId:{type:String,editable:!1,hidden:!0},Name:{type:String,required:!0},Description:{type:String},Vehicles:{type:["Vehicle"],ref:"Vehicle",refType:"OneToMany",defaultValue:[],table:{hidden:!0}}}),l.registerSchema("Document","api/documents",{Id:{type:String,editable:!1,hidden:!0},Name:{type:String,required:!0},DocumentTypeId:{type:String,required:!0,displayField:"DocumentType.Name",table:{hidden:!0}},DocumentType:{type:"DocumentType",ref:"DocumentType",refBy:"DocumentTypeId",table:{hidden:!0}},IssuedBy:{type:String},IssueDate:{type:moment,required:!1,displayFilters:" | date:'dd/MM/yyyy'",table:{visible:!1}},ExpiryDate:{type:moment,required:!1,displayFilters:" | date:'dd/MM/yyyy'",table:{visible:!1}},FileType:{type:String},FilePath:{type:String},ThumbnailPath:{type:String},OwnerType:{type:String},OwnerId:{type:String,editable:!1,hidden:!0}}),l.registerSchema("DocumentType","api/documenttypes",{Id:{type:String,editable:!1,hidden:!0},TenantId:{type:String,editable:!1,hidden:!0},Name:{type:String,required:!0},Description:{type:String}}),l.registerSchema("Client","api/clients",{Id:{type:String,editable:!1,hidden:!0},TenantId:{type:String,editable:!1,hidden:!0},ClientTypeId:{type:String,required:!0,displayField:"ClientType.Name",table:{hidden:!0}},ClientType:{type:"ClientType",ref:"ClientType",refBy:"ClientTypeId",table:{hidden:!0}},Name:{type:String,required:!0},Address1:{type:String,table:{hidden:!0}},Address2:{type:String,table:{hidden:!0}},Area:{type:String,table:{hidden:!0}},TownCity:{type:String,display:"Town/City"},County:{type:String,table:{hidden:!0}},Postcode:{type:String,table:{hidden:!0}},Country:{type:String,table:{hidden:!0}},_FullAddress:{type:String,calculated:function(){var e="";return e+=this.Address1?this.Address1+"\n":"",e+=this.Address2?this.Address2+"\n":"",e+=this.Area?this.Area+"\n":"",e+=this.TownCity?this.TownCity+"\n":"",e+=this.Postcode?this.Postcode+"\n":"",e+=this.County?this.County+"\n":"",e+=this.Country?this.Country:""},table:{visible:!1},display:"Full Address"},BillingAddress1:{type:String,table:{hidden:!0},display:"Billing Address1"},BillingAddress2:{type:String,table:{hidden:!0},display:"Billing Address2"},BillingArea:{type:String,table:{hidden:!0},display:"Area"},BillingTownCity:{type:String,table:{hidden:!0},display:"TownCity"},BillingCounty:{type:String,table:{hidden:!0},display:"County"},BillingPostcode:{type:String,table:{hidden:!0},display:"PostCode"},BillingCountry:{type:String,table:{hidden:!0},display:"Country"},_FullBillingAddress:{type:String,calculated:function(){var e="";return e+=this.BillingAddress1?this.BillingAddress1+"\n":"",e+=this.BillingAddress2?this.BillingAddress2+"\n":"",e+=this.BillingArea?this.BillingArea+"\n":"",e+=this.BillingTownCity?this.BillingTownCity+"\n":"",e+=this.BillingPostcode?this.BillingPostcode+"\n":"",e+=this.BillingCounty?this.BillingCounty+"\n":"",e+=this.BillingCountry?this.BillingCountry:""},table:{hidden:!0},display:"Full Billing Address"},Phone:{type:String,table:{visible:!1}},Mobile:{type:String},Fax:{type:String},Email:{type:String},StartDate:{type:moment,displayFilters:" | date:'shortDate'",defaultValue:(new moment).toDate(),table:{visible:!1}},EndDate:{type:moment,displayFilters:" | date:'shortDate'",table:{visible:!1}},Active:{type:Boolean,defaultValue:!0,table:{hidden:!0}},ImageUrl:{type:String,table:{hidden:!0}},ClientTags:{type:["ClientTag"],ref:"ClientTag",refType:"OneToMany",defaultValue:[],table:{hidden:!0}},Passengers:{type:["Passenger"],ref:"Passenger",refType:"OneToMany",defaultValue:[],table:{hidden:!0}},CreationTime:{type:moment,hidden:!0},_ImageUrl:{type:String,hidden:!0,calculated:function(){return this.ImageUrl?"http"==this.ImageUrl.slice(0,4)?this.ImageUrl:t.API_ENDPOINT+this.ImageUrl:t.API_ENDPOINT+"api/imagegen?text="+this.Name.replace(/ /g,"+")}},DefaultCurrencyId:{type:String,display:"Default Currency"},DefaultCurrency:{type:"Currency",ref:"Currency",refBy:"DefaultCurrencyId"}}),l.registerSchema("ClientType","api/clienttypes",{Id:{type:String,editable:!1,hidden:!0},TenantId:{type:String,editable:!1,hidden:!0},Name:{type:String,required:!0},Description:{type:String},Clients:{type:["Client"],ref:"Client",refType:"OneToMany",defaultValue:[],table:{hidden:!0}}}),l.registerSchema("ClientTag","api/clienttags",{Id:{type:String,editable:!1,hidden:!0},TenantId:{type:String,editable:!1,hidden:!0},Name:{type:String,required:!0},Description:{type:String},Clients:{type:["Client"],ref:"Client",refType:"OneToMany",defaultValue:[],table:{hidden:!0}}}),l.registerSchema("Passenger","api/passengers",{Id:{type:String,editable:!1,hidden:!0},TenantId:{type:String,editable:!1,hidden:!0},Firstname:{type:String,required:!0,table:{hidden:!0}},Surname:{type:String,required:!0,table:{hidden:!0}},_Fullname:{type:String,calculated:function(){return this.Firstname+" "+this.Surname},display:"Full Name"},ClientId:{type:String,displayField:"Client.Name",table:{hidden:!0}},Client:{type:"Client",ref:"Client",refBy:"ClientId",table:{hidden:!0}},DateOfBirth:{type:moment,displayFilters:" | date:'shortDate'",table:{visible:!1}},_ClientName:{type:String,calculated:function(){if(this.ClientId&&this.Client)return this.Client.Name},display:"Client Name"},HomeAddress1:{type:String,table:{hidden:!0}},HomeAddress2:{type:String,table:{hidden:!0}},HomeArea:{type:String,table:{hidden:!0}},HomeTownCity:{type:String,table:{hidden:!0}},HomeCounty:{type:String,table:{hidden:!0}},HomePostcode:{type:String,table:{hidden:!0}},HomeCountry:{type:String,table:{hidden:!0}},_FullHomeAddress:{type:String,calculated:function(){var e="";return e+=this.HomeAddress1?this.HomeAddress1+"\n":"",e+=this.HomeAddress2?this.HomeAddress2+"\n":"",e+=this.HomeArea?this.HomeArea+"\n":"",e+=this.HomeTownCity?this.HomeTownCity+"\n":"",e+=this.HomePostcode?this.HomePostcode+"\n":"",e+=this.HomeCounty?this.HomeCounty+"\n":"",e+=this.HomeCountry?this.HomeCountry:""},table:{visible:!1},display:"Full Home Address"},WorkAddress1:{type:String,table:{hidden:!0}},WorkAddress2:{type:String,table:{hidden:!0}},WorkArea:{type:String,table:{hidden:!0}},WorkTownCity:{type:String,table:{hidden:!0}},WorkCounty:{type:String,table:{hidden:!0}},WorkPostcode:{type:String,table:{hidden:!0}},WorkCountry:{type:String,table:{hidden:!0}},_FullWorkAddress:{type:String,calculated:function(){var e="";return e+=this.WorkAddress1?this.WorkAddress1+"\n":"",e+=this.WorkAddress2?this.WorkAddress2+"\n":"",e+=this.WorkArea?this.WorkArea+"\n":"",e+=this.WorkTownCity?this.WorkTownCity+"\n":"",e+=this.WorkPostcode?this.WorkPostcode+"\n":"",e+=this.WorkCounty?this.WorkCounty+"\n":"",e+=this.WorkCountry?this.WorkCountry:""},table:{visible:!1},display:"Full Work Address"},Phone:{type:String,table:{visible:!1}},Mobile:{type:String},Fax:{type:String},Email:{type:String},Active:{type:Boolean,defaultValue:!0,table:{hidden:!0}},ImageUrl:{type:String,table:{hidden:!0}},PassengerTags:{type:["PassengerTag"],ref:"PassengerTag",refType:"OneToMany",defaultValue:[],table:{hidden:!0}},CreationTime:{type:moment,hidden:!0},_ImageUrl:{type:String,hidden:!0,calculated:function(){return e.formatImage(this.ImageUrl,this.Firstname.replace(/ /g,"+"))}}}),l.registerSchema("PassengerTag","api/passengertags",{Id:{type:String,editable:!1,hidden:!0},TenantId:{type:String,editable:!1,hidden:!0},Name:{type:String,required:!0},Description:{type:String},Passengers:{type:["Passenger"],ref:"Passenger",refType:"OneToMany",defaultValue:[],table:{hidden:!0}}}),l.registerSchema("Booking","api/bookings",{Id:{type:String,editable:!1,hidden:!0},LocalId:{type:Number,editable:!1},TenantId:{type:String,editable:!1,hidden:!0},BookingStatus:{type:String,"enum":["Cancelled","Provisional","Confirmed","Allocated","Completed"]},BookedDateTime:{type:moment,required:!1,displayFilters:" | TZConvert | date:'shortDate'",table:{visible:!1}},DriverOnRouteDateTime:{type:moment,displayFilters:" | date:'dd/MM/yyyy'",table:{visible:!1}},DriverArrivedDateTime:{type:moment,required:!1,displayFilters:" | date:'dd/MM/yyyy'",table:{visible:!1}},POBDateTime:{type:moment,required:!1,displayFilters:" | date:'dd/MM/yyyy'",table:{visible:!1}},JobClearDateTime:{type:moment,required:!1,displayFilters:" | date:'dd/MM/yyyy'",table:{visible:!1}},ClientId:{type:String,required:!1,displayField:"Client.Name",table:{hidden:!0}},Client:{type:"Client",ref:"Client",refBy:"ClientId",table:{hidden:!0}},BookingSource:{type:String},VehicleClassId:{type:String,required:!0,table:{hidden:!0}},VehicleTypeId:{type:String,required:!0,table:{hidden:!0}},Pax:{type:Number,table:{hidden:!0},display:"Max. Passengers"},Bax:{type:Number,table:{hidden:!0},display:"Max. Baggage"},AsDirected:{type:Boolean,table:{hidden:!0}},LeadPassengerId:{type:String,required:!1,displayField:"LeadPassenger._Fullname",table:{hidden:!0}},LeadPassenger:{type:"Passenger",ref:"Passenger",refBy:"LeadPassengerId",table:{hidden:!0}},DriverShiftId:{type:String,required:!1,displayField:"DriverShift.Id",table:{hidden:!0}},DriverShift:{type:"DriverShift",ref:"DriverShift",refBy:"DriverShiftId",table:{hidden:!0}},DriverId:{type:String,required:!1,displayField:"_DriverSummary",table:{hidden:!0}},Driver:{type:"Driver",ref:"Driver",refBy:"DriverId",table:{hidden:!0}},VehicleId:{type:String,required:!1,displayField:"_VehicleSummary",table:{hidden:!0}},Vehicle:{type:"Vehicle",ref:"Vehicle",refBy:"VehicleId",table:{hidden:!0}},PartnerId:{type:String,required:!1,table:{hidden:!0}},EncodedRoute:{type:String},PassengerNotes:{type:String,table:{visible:!1}},DriverNotes:{type:String,table:{visible:!1}},OfficeNotes:{type:String,table:{visible:!1}},JobCron:{type:String},AutoDispatch:{type:Boolean,table:{visible:!1}},EstimatedDistance:{type:Number,table:{hidden:!0}},EstimatedDuration:{type:Number,table:{hidden:!0}},EstimatedCost:{type:Number,prepend:{text:"{{symbol || current.Prepend}}"},table:{hidden:!0}},ActualCost:{type:Number,table:{hidden:!0},prepend:{text:"{{symbol || current.Prepend}}"}},DriverCost:{type:Number,table:{hidden:!0},prepend:{text:"{{symbol || current.Prepend}}"}},InvoiceCost:{type:Number,table:{hidden:!0},prepend:{text:"{{symbol || current.Prepend}}"}},InvoiceId:{type:String,table:{hidden:!0}},Time:{type:String,inputType:"time",displayField:"_Time",table:{hidden:!0}},ImageUrl:{type:String,table:{hidden:!0}},PricingModelId:{type:String},ChauffeurMode:{type:Boolean},EstimatedMins:{type:Number},_ImageUrl:{type:String,hidden:!0,calculated:function(){if(this.ImageUrl)return"http"==this.ImageUrl.slice(0,4)?this.ImageUrl:e.resourceEndpoint+this.ImageUrl;var i=t.GMAPS_STATIC_URL+"&markers="+encodeURIComponent("shadow:false|scale:2|icon:http://d1a3f4spazzrp4.cloudfront.net/receipt-new/marker-start@2x.png|"+(this._FromCoords||this._FromSummary))+"&markers="+encodeURIComponent("shadow:false|scale:2|icon:http://d1a3f4spazzrp4.cloudfront.net/receipt-new/marker-finish@2x.png|"+(this._ToCoords||this._ToSummary));return i}},_Time:{type:String,calculated:function(){return new moment(this.Time).format("HH:mm")},table:{hidden:!0}},_LeadPassenger:{type:String,table:{hidden:!0}},_LeadPassengerNumber:{type:String,table:{hidden:!0}},DriverTags:{type:["DriverTag"],ref:"DriverTag",refType:"OneToMany",defaultValue:[],table:{hidden:!0}},Passengers:{type:["Passenger"],ref:"Passenger",refType:"OneToMany",defaultValue:[],table:{hidden:!0}},BookingStops:{type:["BookingStop"],ref:"BookingStop",refType:"OneToMany",defaultValue:[],table:{hidden:!0}},VehicleTags:{type:["VehicleTag"],ref:"VehicleTag",refType:"OneToMany",defaultValue:[],table:{hidden:!0}},BookingRequirements:{type:["BookingRequirement"],ref:"BookingRequirement",refType:"OneToMany",defaultValue:[],table:{hidden:!0}},_FromCoords:{type:String,calculated:function(){if(this.BookingStops&&this.BookingStops.length){var e=this.BookingStops[0];if(e.Latitude&&e.Longitude)return e.Latitude+","+e.Longitude}}},_ToCoords:{type:String,calculated:function(){if(this.BookingStops&&this.BookingStops.length){var e=this.BookingStops[this.BookingStops.length-1];if(e.Latitude&&e.Longitude)return e.Latitude+","+e.Longitude}}},_FromSummary:{type:String,calculated:function(){if(this.BookingStops&&this.BookingStops.length){var e=this.BookingStops[0],t="";return e.Address1.length>1&&(t+=e.Address1),e.TownCity?(t.length>0&&(t+=", "),t+=e.TownCity):e.Area&&(t.length>0&&(t+=", "),t+=e.Area),e.County&&0==t.length&&(t+=e.County),e.Postcode&&(t.length>0&&(t+=", "),t+=e.Postcode),t}}},_ToSummary:{type:String,calculated:function(){if(this.BookingStops&&this.BookingStops.length){var e=this.BookingStops[this.BookingStops.length-1],t="";return e.Address1.length>1&&(t+=e.Address1),e.TownCity?(t.length>0&&(t+=", "),t+=e.TownCity):e.Area&&(t.length>0&&(t+=", "),t+=e.Area),e.County&&0==t.length&&(t+=e.County),e.Postcode&&(t.length>0&&(t+=", "),t+=e.Postcode),t}return"As Directed"}},_ClientName:{type:String,display:"Client",calculated:function(){return this.Client&&this.Client.Name}},_VehicleReg:{type:String,display:"Vehicle",calculated:function(){return this.Vehicle&&this.Vehicle.Registration}},_DriverSummary:{type:String,display:"Driver",calculated:function(){return this.Driver&&this.Driver.Firstname+" "+this.Driver.Surname+" ("+this.Driver.Callsign+")"}},_VehicleSummary:{type:String,display:"Vehicle",calculated:function(){return this.Vehicle&&this.Vehicle.Colour+" "+this.Vehicle.Make+" "+this.Vehicle.Model+" ("+this.Vehicle.Registration+")"}},_LeadPassengerName:{type:String,display:"Lead Passenger",calculated:function(){if(this.LeadPassenger)return this.LeadPassenger.Firstname+" "+this.LeadPassenger.Surname}},_WaitTime:{type:Number,calculated:function(){var e=0;if(this.BookingStops)for(var t=0;t<this.BookingStops.length;t++)t.WaitTime&&(e+=t.WaitTime);return e}},_WaitTimeCharges:{type:Number,calculated:function(){var e=0;return this.BookingStops&&(e=this.BookingStops[0]&&this.BookingStops[0].WaitTimeChargable),e}},CurrencyId:{type:String},Currency:{type:"Currency",ref:"Currency",refBy:"CurrencyId"},CurrencyRate:{type:Number},ChaffuerMode:{type:Boolean},TaxId:{type:String,display:"VAT",displayField:"Tax.Name",required:!0},Tax:{type:"Tax",ref:"Tax",refBy:"TaxId"},Discount:{type:Number,append:{text:"%",click:"discount.type = 'percent';"},prepend:{text:"{{symbol || current.Prepend}}",click:"discount.type = 'amount';"}}}),l.registerSchema("DriverShift","api/drivershifts",{Id:{type:String,editable:!1,hidden:!0},TenantId:{type:String,editable:!1,hidden:!0},StartTime:{type:moment,required:!1,displayFilters:" | date:'HH:mm'",table:{visible:!1}},EndTime:{type:moment,required:!1,displayFilters:" | date:'HH:mm'",table:{visible:!1}},DriverId:{type:String,required:!0,displayField:"Driver._Fullname",table:{hidden:!0}},Driver:{type:"Driver",ref:"Driver",refBy:"DriverId",table:{hidden:!0}},VehicleId:{type:String,required:!0,displayField:"Vehicle._Description",table:{hidden:!0}},Vehicle:{type:"Vehicle",ref:"Vehicle",refBy:"VehicleId",table:{hidden:!0}},BookingRequirements:{type:["BookingRequirement"],ref:"BookingRequirement",refType:"OneToMany",defaultValue:[],table:{hidden:!0}},EncodedRoute:{type:String}}),l.registerSchema("BookingStop","api/bookingstops",{Id:{type:String,editable:!1,hidden:!0},TenantId:{type:String,editable:!1,hidden:!0},StopSummary:{type:String},Type:{type:String,"enum":["PickUp","Via","StopAndWait","DropOff"]},StopOrder:{type:Number,required:!1},WaitTime:{type:Number,required:!1},WaitTimeChargable:{type:Number,required:!1},Address1:{type:String,required:!0,table:{hidden:!0}},Address2:{type:String,required:!0,table:{hidden:!0}},Area:{type:String,required:!0,table:{hidden:!0}},TownCity:{type:String,required:!0,table:{hidden:!0}},County:{type:String,required:!0,table:{hidden:!0}},Postcode:{type:String,required:!0,table:{hidden:!0}},Country:{type:String,required:!0,table:{hidden:!0}},_FullAddress:{type:String,calculated:function(){var e="";return e+=this.Address1?this.Address1+"\n":"",e+=this.Address2?this.Address2+"\n":"",e+=this.Area?this.Area+"\n":"",e+=this.TownCity?this.TownCity+"\n":"",e+=this.Postcode?this.Postcode+"\n":"",e+=this.County?this.County+"\n":"",e+=this.Country?this.Country:""},display:"Full Address"},Latitude:{type:Number,required:!1},Longitude:{type:Number,required:!1},latitude:{type:Number,calculated:function(){return this.Latitude}},longitude:{type:Number,calculated:function(){return this.Longitude}},Note:{type:String},BookingId:{type:String,required:!0,displayField:"Booking.Id",table:{hidden:!0}},Booking:{type:"Booking",ref:"Booking",refBy:"BookingId",table:{hidden:!0}},_WaitingTimeCharges:{type:Number,calculated:function(){return this.WaitTimeChargable&&this.WaitTime?this.WaitTimeChargable*this.WaitTime:0}}}),l.registerSchema("BookingRequirement","api/bookingrequirements",{Id:{type:String,editable:!1,hidden:!0},TenantId:{type:String,editable:!1,hidden:!0},Name:{type:String,required:!0},Description:{type:String},Bookings:{type:["Booking"],ref:"Booking",refType:"OneToMany",defaultValue:[],table:{hidden:!0}},DriverShifts:{type:["DriverShift"],ref:"DriverShift",refType:"OneToMany",defaultValue:[],table:{hidden:!0}}}),l.registerSchema("ChangePassword","",{UserName:{type:String,required:!0},CurrentPassword:{type:String,required:!0,inputType:"password"},NewPassword:{type:String,required:!0,inputType:"password"},NewPasswordRepeat:{type:String,required:!0,inputType:"password"}}),l.registerSchema("User","api/account",{Id:{type:String,editable:!1,hidden:!0},UserName:{type:String},Email:{type:String},Claims:{type:["Claim"],ref:"Claim",refType:"OneToMany",defaultValue:[],table:{hidden:!0}},AccessFailedCount:{type:Number,table:{hidden:!0}},LockoutEnabled:{type:Boolean,table:{visible:!1}},LockoutEndDateUtc:{type:moment,table:{hidden:!0}},PhoneNumber:{type:String},UserType:{type:String,calculated:function(){for(var e="",t=0;t<this.Claims.length;t++)"DriverId"==this.Claims[t].ClaimType?e+="Driver ":"ClientId"==this.Claims[t].ClaimType?e+="Client ":"PassengerId"==this.Claims[t].ClaimType?e+="Passenger ":"StaffId"==this.Claims[t].ClaimType&&(e+="Staff ");return e},display:"User Type"}}),l.registerSchema("Claim","",{Id:{type:String,editable:!1,hidden:!0},ClaimType:{type:String},ClaimValue:{type:String},UserId:{type:String}}),l.registerSchema("Currency","api/Currencies",{Id:{type:String,editable:!1,hidden:!0},Name:{type:String},Short:{type:String},Prepend:{type:String},Append:{type:String},CurrentRate:{type:Number}}),l.registerSchema("Tax","api/taxes",{Id:{type:String,editable:!1,hidden:!0},TenantId:{type:String,editable:!1,hidden:!0},Name:{type:String,required:!0},TaxTypeId:{type:String,display:"Tax Type",displayField:"TaxType.Name",table:{hidden:!0}},TaxType:{type:"TaxType",ref:"TaxType",refBy:"TaxTypeId",table:{hidden:!0}},_TaxType:{type:String,calculated:function(){return this.TaxType?this.TaxType.Name:""},display:"Tax Type"},Description:{type:String,table:{visible:!1}},TaxComponents:{type:["TaxComponent"],ref:"TaxComponent",refType:"OneToMany",defaultValue:[],table:{hidden:!0}},_TaxRate:{type:String,display:"Rate",calculated:function(){var e=0;if(this.TaxComponents)for(var t=0;t<this.TaxComponents.length;t++)e+=this.TaxComponents[t].Rate;return e+"%"}},_TaxAmount:{type:Number,table:{hidden:!0},calculated:function(){var e=0;if(this.TaxComponents)for(var t=0;t<this.TaxComponents.length;t++)e+=this.TaxComponents[t].Rate/100;return e}}}),l.registerSchema("TaxType","api/TaxTypes",{Id:{type:String,editable:!1,hidden:!0},Name:{type:String},Description:{type:String}}),l.registerSchema("TaxComponent","api/TaxComponents",{Id:{type:String,editable:!1,hidden:!0},Name:{type:String,table:{visible:!1},display:"Component"},TaxId:{type:String,display:"Tax",displayField:"Tax.Name",table:{hidden:!0}},Tax:{type:"Tax",ref:"Tax",refBy:"TaxId",table:{hidden:!0}},Rate:{type:Number},Description:{type:String,table:{visible:!1}}}),l.registerSchema("Invoice","api/invoice",{Id:{type:String,editable:!1,hidden:!0},TenantId:{type:String,editable:!1,hidden:!0},InvoiceType:{type:String,table:{visible:!1}},Reference:{type:String},ClientId:{type:String,displayField:"Client.Name",table:{hidden:!0},display:"Client"},Client:{type:"Client",ref:"Client",refBy:"ClientId",table:{hidden:!0}},_Client:{type:String,calculated:function(){return this.Client?this.Client.Name:""},display:"Client"},DriverId:{type:String,displayField:"Driver._Fullname",table:{hidden:!0}},Driver:{type:"Driver",ref:"Driver",refBy:"DriverId",table:{hidden:!0}},Discount:{type:Number,table:{visible:!1}},Notes:{type:String,table:{visible:!1}},SubTotal:{type:Number,table:{visible:!1}},TaxAmount:{type:Number,table:{visible:!1}},CreationTime:{type:moment,display:"Creation Date",displayFilters:" | TZConvert | date:'shortDate'"},DueDate:{type:moment,display:"Due Date",required:!0,displayFilters:" | TZConvert | date:'shortDate'"},Bookings:{type:["Booking"],ref:"Booking",refType:"OneToMany",defaultValue:[],table:{hidden:!0}},NoOfBookings:{type:Number,display:"Bookings"},Status:{type:String,"enum":["Unsent","Unpaid","Paid"]},TotalAmount:{type:Number,display:"Amount Due",binding:function(e){return currencyIcon+e.TotalAmount.toFixed(2)}},PaymentInstructions:{type:String,textarea:4,display:"Payment Instructions"}})}function r(e,t,i,r,n,a,d,l,s,o,y,p,u,g,h){function c(){var n=r.createLogger("ROUTER"),s=g.currency(),u=s.currencies(),c=null;i.$on("$stateChangeStart",function(e,t,r,a,l){e.defaultPrevented||(n.debug("$stateChangeStart triggered"),c=d(function(){i.loading=!0},500))}),i.$on("$stateNotFound",function(e,t,r,a){n.warning("$stateNotFound triggered"),l.go("root"),i.loading=!1}),i.$on("$stateChangeSuccess",function(e,t,r,a,l){n.debug("$stateChangeSuccess triggered"),c&&(d.cancel(c),c=null),i.loading=!1}),i.$on("$stateChangeError",function(e,t,i,r,a,d){n.warning("$stateChangeError triggered"),n.debug("Route Error: Redirecting to Dashboard"),n.debug(d),l.go("root.bookings")}),i.$on("$viewContentLoading",function(e,t,i){n.debug("$viewContentLoading triggered")}),i.$on("$viewContentLoaded",function(e,t,i){n.debug("$viewContentLoaded triggered")}),y.AUTH_TKN&&(t.setQueryValue("token",y.AUTH_TKN.access_token),m(),S(),a.Company.query().filter("Id eq guid'"+p.getSession().TenantId+"'").execute().then(function(e){i.COMPANY=e[0],u.then(function(t){s.setCurrent(e[0].DefaultCurrencyId),currencyIcon=s.getCurrent().Prepend}),e[0].DefaultLocale?h.set(e[0].DefaultLocale):h.set(o.DEFAULT_LOCALE),e[0].DefaultTimezone&&(moment.tz.setDefault(e[0].DefaultTimezone),g.timeZone().setTimeZone(e[0].DefaultTimezone)),g.useMetric(e[0].UseMetric)}),p.getSession().Claims.DriverId&&p.getSession().Claims.DriverId[0]&&(i.DRIVERID=p.getSession().Claims.DriverId[0])),i.$on(e.LOGIN_SUCCESS,function(e,r){t.setQueryValue("token",r.access_token),m(),S(),a.Company.query().filter("Id eq guid'"+r.TenantId+"'").execute().then(function(e){i.COMPANY=e[0]})}),t.start().then(function(){n.info("SignalR Started")})}function m(){a.DriverType.query().execute().then(function(e){s.DriverType=e,s.DriverType.$updated=new moment}),a.VehicleType.query().execute().then(function(e){s.VehicleType=e,s.VehicleType.$updated=new moment;
}),a.VehicleClass.query().execute().then(function(e){s.VehicleClass=e,s.VehicleClass.$updated=new moment}),a.ClientType.query().execute().then(function(e){s.ClientType=e,s.ClientType.$updated=new moment})}function S(){a.Driver.query().select("Id,Firstname,Surname").parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname}).execute().then(function(e){u.Driver=e}),a.Client.query().select("Id,Name").execute().then(function(e){u.Client=e}),a.Passenger.query().select("Id,Firstname,Surname").parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname}).execute().then(function(e){u.Passenger=e}),a.Vehicle.query().select("Id,Registration").parseAs(function(e){this.Id=e.Id,this.Name=e.Registration}).execute().then(function(e){u.Vehicle=e})}r.createLogger("APP RUN");i.COMPANY={},i.DRIVERID=null,c(),i.API_ENDPOINT=o.API_ENDPOINT}var n=t.module("cab9.driver",["ngMessages","ngAnimate","ngLocale","ui.router","ui.router.tabs","ui.bootstrap","ui.select","ui-notification","angular.filter","angular-flot","uiGmapgoogle-maps","google.places","tmh.dynamicLocale","framework.services.auth.persist","framework.services.menu","framework.services.data","framework.services.logging","framework.services.storage","framework.services.images","framework.services.csv","framework.services.google","framework.services.signalr","framework.directives.utils","framework.directives.UI","framework.services.currency","framework.filters.utility","framework.UI.structure","framework.UI.breadcrumb","framework.UI.module","framework.UI","framework.module.documents","cab9.layout","cab9.driver.bookings","cab9.driver.vehicles","cab9.driver.settings"]);n.config(i),n.run(r),n.constant("$tenantConfig",{defaultVehicleType:"80e4cd2c-411e-41e0-9939-679ef65797cc",defaultVehicleClass:"80e4cd2c-411e-41e0-9939-679ef65797cc",officeLocation:{latitude:51.471507,longitude:-.487904}}),e.$config={API_ENDPOINT:e.endpoint,RESOURCE_ENDPOINT:e.resourceEndpoint,GMAPS_STATIC_URL:"https://maps.googleapis.com/maps/api/staticmap?size=249x249&style=feature:landscape|visibility:off&style=feature:poi|visibility:off&style=feature:transit|visibility:off&style=feature:road.highway|element:geometry|lightness:39&style=feature:road.local|element:geometry|gamma:1.45&style=feature:road|element:labels|gamma:1.22&style=feature:administrative|visibility:off&style=feature:administrative.locality|visibility:on&style=feature:landscape.natural|visibility:on&scale=2",LOGIN_URL:"/index.html",DEFAULT_LOCALE:"en-gb"},n.constant("$config",e.$config),n.constant("$UI",{COLOURS:{brandPrimary:"#2AA2AB",brandSecondary:"#3D799B",menuLight:"#2B303B",menuDark:"#21252D",blue:"#032b5a",red:"#F55753",yellow:"#F8D053",cyan:"#10CFBD",sky:"#48B0F7",green:"#64c458",purple:"#6D5CAE",brandGrey:"#3B4752",darkGrey:"#2B303B",lightGrey:"rgba(100,100,100,0.1)",grey:"#788195",lighterGrey:"rgba(0,0,0,0.2)"}}),n.constant("LookupCache",{}),n.constant("ViewerCache",{}),i.$inject=["$config","$sceProvider","$stateProvider","$compileProvider","MenuServiceProvider","LoggerProvider","ModelProvider","datepickerConfig","SignalRProvider","NotificationProvider"],r.$inject=["AUTH_EVENTS","SignalR","$rootScope","Logger","$modal","Model","$timeout","$state","LookupCache","$config","$localStorage","Auth","ViewerCache","Localisation","tmhDynamicLocale"]}(window,angular);;;;
!function(o){function e(o,e,n){n.when("/","/bookings"),n.when("","/bookings"),o.state("root.bookings",{url:"/bookings",views:{"content-wrapper@root":{controller:"BookingsTableController",templateUrl:"/webapp/driver/bookings/bookings-table.partial.html"}}}),e.registerMenuItem({state:"root.bookings",icon:"icon-calendar2",title:"Bookings"})}function n(){}var r=o.module("cab9.driver.bookings",[]);r.config(e),r.run(n),e.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider"],n.$inject=[]}(angular);;;;
!function(e){function o(o,t,r,n,i,a,f){function l(e){if(e.length>0){for(var t={date:e[0].BookedDateTime,bookings:[]},r=0;r<e.length;r++){var n=e[r];n.BookingStops=i("orderBy")(n.BookingStops,"StopOrder"),n.$commit(),new moment(n.BookedDateTime).format("DD/MM/YYYY")==new moment(t.date).format("DD/MM/YYYY")?t.bookings.push(n):(o.bookingGroups.push(t),t={date:n.BookedDateTime,bookings:[]},t.bookings.push(n))}o.bookingGroups.push(t)}}function s(){var e=new moment(o.filter.date.from),t=new moment(o.filter.date.to);o.filterSummary=o.fetchStatus,e.format("DD/MM/YYYY")==t.format("DD/MM/YYYY")?o.filterSummary+=" Bookings for "+i("date")(e.toDate(),"shortDate"):(console.log,o.filterSummary+=" Bookings from "+i("date")(e.toDate(),"shortDate")+" to "+i("date")(t.toDate(),"shortDate"))}function m(){a.open({templateUrl:"/webapp/driver/bookings/modals/filter.modal.partial.html",controller:["$scope","rFilter","$modalInstance",function(o,t,r){function n(){r.close(o.filterOptions)}o.filterOptions=e.copy(t),o.datePickers={from:!1,to:!1},o.openDatePicker=function(e,t){o.datePickers[t]=!o.datePickers[t],event.preventDefault(),event.stopPropagation()},o.confirmFilters=n}],resolve:{rFilter:function(){return o.filter}}}).result.then(function(e){o.filter=e})}o.searchTerm={},o.filter={date:{from:new Date((new moment).startOf("day")),to:new Date((new moment).add(3,"months"))},ShowCompletedBookings:!1},o.bookingGroups=[],o.showFilterModal=m,o.$watchGroup(["filter","searchTerm.$"],function(e,r){if(o.bookingGroups.length=0,o.fetchStatus="Fetching",e[1])o.filterSummary="Searching Bookings for : '"+e[1]+"'",f.get(n.API_ENDPOINT+"api/search",{params:{searchText:e[1]}}).success(function(r){var n=[];[].push.apply(n,r.map(function(e){return new t.Booking(e)})),l(n),o.filterSummary="Showing Bookings for : '"+e[1]+"'"});else{s();var i=null;i=o.filter.ShowCompletedBookings?"==":"!=";var a=t.Booking.query().filter("BookedDateTime","ge","datetimeoffset'"+new moment(o.filter.date.from).startOf("day").format()+"'").filter("BookedDateTime","le","datetimeoffset'"+new moment(o.filter.date.to).endOf("day").format()+"'").filter("BookingStatus",i,"'Completed'").filter("DriverId","==","guid'"+o.DRIVERID+"'").include("LeadPassenger, Client, BookingStops, Driver, Vehicle, Currency").orderBy("BookedDateTime");a.top(20),a.execute().then(function(e){l(e),o.fetchStatus="Showing "+e.length,s()})}})}var t=e.module("cab9.driver.bookings");t.controller("BookingsTableController",o),o.$inject=["$scope","Model","$q","$config","$filter","$modal","$http"]}(angular);;;;
!function(){function e(e,o,i,n,r,t){e.getLocation=function(o){var n=[],r=new google.maps.DirectionsService,t={origin:o._FromSummary,destination:o._ToSummary,waypoints:n,optimizeWaypoints:!0,travelMode:google.maps.TravelMode.DRIVING};r.route(t,function(n,r){r==google.maps.DirectionsStatus.OK&&(staticMapUrl=encodeURI(i.GMAPS_STATIC_URL+"&markers=shadow:false|scale:2|icon:http://d1a3f4spazzrp4.cloudfront.net/receipt-new/marker-start@2x.png|"+o._FromSummary+"&markers=shadow:false|scale:2|icon:http://d1a3f4spazzrp4.cloudfront.net/receipt-new/marker-finish@2x.png|"+o._ToSummary+"&path=weight:5|color:0x2dbae4ff|enc:"+n.routes[0].overview_polyline),e.booking.mapUrl=staticMapUrl),e.$apply()})},e.emailTo=function(e){var r=o.open({templateUrl:"/webapp/shared/modals/email-to.modal.html",controller:["$scope","emailAddress","$modalInstance",function(e,o,i){null!=o&&(e.email=o),e.sendEmail=function(){i.close(e.email)}}],resolve:{emailAddress:function(){var o=null;return o=e.Driver?e.Driver.Email:null}}});r.result.then(function(o){null!=o&&(swal("You will receive the email soon.."),n.post(i.API_ENDPOINT+"api/email",{Type:"DriverConfirmation",BookingId:e.Id,DriverId:e.DriverId,EmailId:o}).success(function(){t.success("Email Sent")}))})},e.stopSummary=function(e){return e.Address1+" "+e.Area+", "+e.TownCity+", "+e.Postcode}}var o=angular.module("cab9.driver.bookings");o.directive("bookingStrip",function(){return{restrict:"E",templateUrl:"/webapp/driver/bookings/booking-strip.template.html",scope:{booking:"="},controller:e,link:function(e,o,i){e.$expanded=!1}}}),e.$inject=["$scope","$modal","$config","$http","Model","Notification"]}();;;;
!function(e){function r(e,r,t){t.when("/vehicles","/vehicles/cards"),e.state("root.vehicles",{url:"/vehicles","abstract":!0,"default":"root.vehicles.cards",resolve:{rData:["Model","Auth",function(e,r){return e.Vehicle.query().filter("DriverId eq guid'"+r.getSession().Claims.DriverId[0]+"'").include("Type").include("Class").include("Driver").include("VehicleTags").execute()}]},views:{"content-wrapper@root":{templateUrl:"/e9_components/layouts/module/module-base.layout.html",controller:["$scope","rData",function(e,r){e.searchTerm={}}]},"options-area@root.vehicles":{templateUrl:"/webapp/driver/vehicles/all/vehicles-module-options.partial.html",controller:"VehiclesModuleOptionsController"}}}),e.state("root.vehicles.cards",{url:"/cards",resolve:{rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){var r="";return r+=e.Make+" "+e.Model},SubTitle:function(e){var r=e.Colour+" "+e.Class.Name;return r},LogoUrl:function(e){return e._ImageUrl},Group:function(e){return e.Type.Name}}}],rNavTo:function(){return"root.vehicles.viewer.dashboard"}},views:{"view-area@root.vehicles":{templateUrl:"/webapp/shared/views/numplate/module-number-plate-secondary.partial.html",controller:"ModuleNumPlateSecondaryController"}}}),e.state("root.vehicles.table",{url:"/table",hasHelp:"/webapp/driver/vehicles/all/vehicles-help.modal.html",resolve:{rNavTo:function(){return"root.vehicles.viewer.dashboard"},rSchema:function(){return"Vehicle"}},views:{"view-area@root.vehicles":{templateUrl:"/e9_components/layouts/module/module-table.partial.html",controller:"ModuleTableController"}}}),e.state("root.vehicles.viewer",{url:"/{Id:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}}","default":"root.vehicles.viewer.dashboard",viewerType:"Vehicle",resolve:{rTabs:["$stateParams",function(e){return[{heading:"Dashboard",route:"root.vehicles.viewer.dashboard",params:{vehicleId:e.Id}},{heading:"Info",route:"root.vehicles.viewer.info",params:{vehicleId:e.Id}},{heading:"Documents",route:"root.vehicles.viewer.documents",params:{vehicleId:e.Id}}]}],rData:["Model","$stateParams",function(e,r){return e.Vehicle.query().where("Id","==","guid'"+r.Id+"'").include("Type").include("Class").include("Driver").include("Driver/DriverTags").include("VehicleTags").execute()}],rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){return e._Description},SubTitle:function(e){return e.Type.Name},LogoUrl:function(e){return e._ImageUrl}}}]},views:{"content-wrapper@root":{controller:"ModuleItemViewController",templateUrl:"/e9_components/layouts/module/module-item.layout.html"}}}),e.state("root.vehicles.viewer.dashboard",{url:"/dashboard",viewerType:"Vehicle",templateUrl:"/webapp/driver/vehicles/item/vehicle-item-dashboard.partial.html",controller:"VehicleItemDashboardController"}),e.state("root.vehicles.viewer.info",{url:"/info",viewerType:"Vehicle",templateUrl:"/webapp/driver/vehicles/item/vehicle-item-info.partial.html",controller:"VehicleItemInfoController",resolve:{rVehicleTypes:["LookupCache","Model",function(e,r){return e.VehicleType&&e.VehicleType.$updated.isAfter((new moment).subtract(10,"minutes"))?e.VehicleType:r.VehicleType.query().execute().then(function(r){return e.VehicleType=r,e.VehicleType.$updated=new moment,e.VehicleType})}],rVehicleClasses:["LookupCache","Model",function(e,r){return e.VehicleClass&&e.VehicleClass.$updated.isAfter((new moment).subtract(10,"minutes"))?e.VehicleClass:r.VehicleClass.query().execute().then(function(r){return e.VehicleClass=r,e.VehicleClass.$updated=new moment,e.VehicleClass})}],rVehicleTags:["Model",function(e){return e.VehicleTag.query().execute()}],rDrivers:["Model",function(e){return e.Driver.query().select("Id,Firstname,Surname,Callsign,ImageUrl,DriverType/Name").include("DriverType").parseAs(function(e){this.Id=e.Id,this.Name=e.Firstname+" "+e.Surname+" ("+e.Callsign+")",this.Description=e.DriverType.Name,this.ImageUrl=window.formatImage(e.ImageUrl,e.Callsign)}).execute()}]}}),e.state("root.vehicles.viewer.documents",{url:"/documents",viewerType:"Vehicle",controller:"ModuleDocumentsController",templateUrl:"/e9_components/layouts/module/module-documents.layout.html",resolve:{rDocuments:["$stateParams","Model","$q",function(e,r,t){return r.Document.query().where("OwnerType eq 'Vehicle'").where("OwnerId eq guid'"+e.Id+"'").include("DocumentType").execute()}],rConfig:["$stateParams",function(e){return{type:"Vehicle",id:e.Id}}]}}),r.registerMenuItem({state:"root.vehicles.cards",icon:"icon-drive-eta",title:"Vehicles"})}function t(){}var l=e.module("cab9.driver.vehicles",[]);l.config(r),l.run(t),r.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider"],t.$inject=[]}(angular);;;;
!function(e){function o(e,o){function c(){e.showSearch=!e.showSearch,e.showSearch?setTimeout(function(){$("#searchTerm").focus()},500):e.searchTerm.$=""}e.toggleSearch=c}var c=e.module("cab9.driver.vehicles");c.controller("VehiclesModuleOptionsController",o),o.$inject=["$scope","$modal"]}(angular);;;;
!function(e){function i(i,c,l,a,n,h,s,o,t){function r(){i.displayMode="EDIT"}function d(){i.vehicle.$rollback(!0),i.displayMode="VIEW"}function v(){var a=[];if(e.isDefined(i.vehicle.$$changedValues.VehicleTags)){var n=i.vehicle.$$originalValues.VehicleTags.changes(i.vehicle.$$changedValues.VehicleTags,function(e,i){return e.Id==i.Id});e.forEach(n.removed,function(e){a.push(l.$dissociate("Vehicle","VehicleTags",i.vehicle.Id,e.Id))}),e.forEach(n.added,function(e){a.push(l.$associate("Vehicle","VehicleTags",i.vehicle.Id,e.Id))})}a.push(i.vehicle.$patch(!0)),c.all(a).then(function(){swal({title:"Vehicle Saved.",text:"Changes have been updated.",type:"success",confirmButtonColor:o.COLOURS.brandSecondary}),i.displayMode="VIEW",i.$emit("ITEM_UPDATED",i.vehicle)},function(){alert("Error"),console.log(arguments)})}i.vehicle=a[0],i.vehicleTypes=n,i.vehicleTags=h,i.vehicleClasses=s,i.displayMode="VIEW";for(var u=0;u<i.vehicle.VehicleTags.length;u++){var g=i.vehicle.VehicleTags[u],V=i.vehicleTags.filter(function(e){return e.Id==g.Id});1==V.length&&(i.vehicle.VehicleTags[u]=V[0])}i.startEditing=r,i.cancelEditing=d,i.saveEdits=v}var c=e.module("cab9.driver.vehicles");c.controller("VehicleItemInfoController",i),i.$inject=["$scope","$q","Model","rData","rVehicleTypes","rVehicleTags","rVehicleClasses","$UI","$config"]}(angular);;;;
!function(t){function a(t,a,e,o,s,i){t.quickStats={today:"-",week:"-",month:"-"},t.bookingGraph={options:{series:{lines:{show:!0,lineWidth:2,fill:!0,fillColor:{colors:[{opacity:.4},{opacity:.4}]}},points:{show:!0,lineWidth:2},shadowSize:0},grid:{hoverable:!0,clickable:!0,tickColor:"#eee",borderWidth:0},colors:[e.COLOURS.lighterGrey,e.COLOURS.brandPrimary],xaxis:{mode:"time",tickFormatter:function(t,a){var e=new Date(t);return e.getUTCDate()+"/"+(e.getUTCMonth()+1)},minTickSize:[1,"day"]},yaxis:{ticks:3,tickDecimals:0}},data:[]};var r=(s({url:o.API_ENDPOINT+"/api/stats",method:"GET",params:{vehicleId:t.item.Id,from:(new moment).startOf("isoweek").format(),to:(new moment).startOf("day").format(),totalsOnly:!0}}).success(function(a){t.quickStats.week=a.Totals.CountBookings}),s({url:o.API_ENDPOINT+"/api/stats",method:"GET",params:{vehicleId:t.item.Id,from:(new moment).startOf("month").format(),to:(new moment).startOf("day").format(),totalsOnly:!0}}).success(function(a){t.quickStats.month=a.Totals.CountBookings}),s({url:o.API_ENDPOINT+"/api/stats",method:"GET",params:{vehicleId:t.item.Id,from:(new moment).subtract(2,"weeks").startOf("day").format(),to:(new moment).startOf("day").format(),fillNulls:!0}})),n=s({url:o.API_ENDPOINT+"/api/stats",method:"GET",params:{from:(new moment).subtract(2,"weeks").startOf("day").format(),to:(new moment).startOf("day").format(),fillNulls:!0}});i.all([r,n]).then(function(a){var e=a[0].data,o=a[1].data,s={label:"Avg Vehicle",data:[]},i={label:t.item.Make+" "+t.item.Model,data:[]};t.bookingGraph.data.push(s),t.bookingGraph.data.push(i);for(var r=0;r<e.Periods.length;r++){var n=e.Periods[r];i.data.push([new moment(n.Date).valueOf(),n.CountBookings])}for(var r=0;r<o.Periods.length;r++){var l=o.Periods[r];s.data.push([new moment(l.Date).valueOf(),l.CountAssignedBookings/l.UniqueVehicles])}t.lastWeekData=a[0].data.Periods.reverse().slice(0,7),t.quickStats.today=t.lastWeekData[0].CountBookings},function(t){})}var e=t.module("cab9.driver.vehicles");e.controller("VehicleItemDashboardController",a),a.$inject=["$scope","$modal","$UI","$config","$http","$q"]}(angular);;;;
!function(e){function t(e,t,r){e.state("root.settings",{url:"/settings",resolve:{rMenu:[function(){return[]}]},views:{"content-wrapper@root":{templateUrl:"/webapp/driver/settings/settings.layout.html",controller:"SettingsController"}}}),r.when("/settings","/settings/profile"),e.state("root.settings.profile",{url:"/profile",views:{"settings-content@root.settings":{templateUrl:"/webapp/driver/settings/password/change-password.partial.html",controller:"SettingsPasswordController"},"profile-staff@root.settings.profile":{templateUrl:"/webapp/driver/settings/profile/profile.partial.html",controller:"SettingsProfileController",resolve:{rData:["Model","$stateParams","Auth","$q",function(e,t,r,n){var i=n.defer();return e.User.query().where("Id","==","'"+r.getSession().UserId+"'").include("Claims").execute().then(function(t){var r=t[0].Claims.filter(function(e){return"DriverId"==e.ClaimType})[0];r&&e.Driver.query().where("Id","==","guid'"+r.ClaimValue+"'").execute().then(function(e){i.resolve(e)})}),i.promise}],rAccessors:["$config",function(e){return{Id:function(e){return e.Id},Title:function(e){return e.Firstname+" "+e.Surname},SubTitle:function(e){return e.Callsign},LogoUrl:function(e){return e._ImageUrl}}}]}}}});var n=[{title:"Profile",state:"root.settings.profile",icon:"icon-lock"}];t.registerMenuItem({state:"root.settings.profile",icon:"icon-user-tie",title:"Settings",subMenus:n.filter(function(e){return e.state.substring(5)})})}function r(t,r){function n(e){var t='<a ui-sref="'+e.state+'" style="color:white;width:100%;display:inline-block;"><i class="'+e.icon+'"></i>'+e.title+"</a>";return t}t.menu=r,e.forEach(r,function(e){e.$html=n(e)})}var n=e.module("cab9.driver.settings",[]);n.config(t),n.controller("SettingsController",r),t.$inject=["$stateProvider","MenuServiceProvider","$urlRouterProvider"],r.$inject=["$scope","rMenu"]}(angular);;;;
!function(e){function r(e,r,n,o,i,t){function a(){n.openPicker({type:"Driver",id:e.driver.Id,searchTerm:e.driver._Fullname}).then(function(r){e.driver.ImageUrl=r,l()},function(e){})}function c(){e.displayMode="EDIT"}function d(){e.driver.$rollback(!0),e.displayMode="VIEW"}function l(){var n=[];n.push(e.driver.$patch()),r.all(n).then(function(){swal({title:"Profile Saved.",text:"Changes have been updated.",type:"success",confirmButtonColor:i.COLOURS.brandSecondary}),e.displayMode="VIEW"},function(){alert("Error"),console.log(arguments)})}e.driver=o[0],e.accessors=t,e.displayMode="VIEW",e.chooseImage=a,e.startEditing=c,e.cancelEditing=d,e.saveEdits=l}var n=e.module("cab9.driver.settings");n.controller("SettingsProfileController",r),r.$inject=["$scope","$q","ImageUpload","rData","$UI","rAccessors"]}(angular);;;;
!function(e){function t(e,t,s,n,o,r,i){function a(){e.viewMode="EDIT"}function c(){e.user={UserName:i.getSession().UserName},e.viewMode="VIEW"}function u(){t.put(s.API_ENDPOINT+"api/account",e.user).success(function(e){swal({title:"Password updated",text:"Try login using new password!",type:"success"},function(e){o.$broadcast(r.LOGOUT)})}).error(function(e){swal("Error","Something didn't work, please check input and try again","error")})}e.viewMode="VIEW",e.startEdit=a,e.cancelEdit=c,e.saveEdits=u,e.user={UserName:i.getSession().UserName}}var s=e.module("cab9.driver.settings");s.controller("SettingsPasswordController",t),t.$inject=["$scope","$http","$config","$state","$rootScope","AUTH_EVENTS","Auth"]}(angular);;;;
!function(e){function r(e,r,a,t,d,n,c,s,o,l,u,p){function f(r){e.view.current=r}function m(r,d){e.showLoader=!0,r.DefaultCard=d;var c=r.ExpirationMonth;e.cardList.some(function(e){return e.CardNumber.split(" ")[3]==r.CardNumber.split(" ")[3]})?(e.card.ExpirationMonth=c,e.showLoader=!1,e.card=null,swal("Error","Card details entered already exists. Please check saved cards.","error")):(r.ExpirationYear=r.ExpirationMonth.split("/")[1].trim().slice(-2),r.ExpirationMonth=r.ExpirationMonth.split("/")[0].trim(),r.Type=j(r.CardNumber),void 0!=u?r.ClientId=n.Id:void 0!=l&&(r.PassengerId=n.Id),a.post(t.API_ENDPOINT+"api/Payments/addcard",r).then(function(r){if(swal("Success","Card added successfully","success"),d)for(i=0;i<e.cardList.length;i++)e.cardList[i].DefaultCard=!1;e.cardList.push(r.data.Card),e.showLoader=!1,e.card=null},function(r){void 0!=r.data&&void 0!=r.data.Message?swal("Error",r.data.Message,"error"):swal("Error","Something didn't work, please try again","error"),e.card.ExpirationMonth=c,e.showLoader=!1}))}function h(r){swal({title:"Confirm Delete",text:"Are you sure you want to delete this card?",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm Delete!"},function(){a["delete"](t.API_ENDPOINT+"api/Payments/deletecard?cardId="+r).then(function(a){swal("Success","Card deleted successfully","success"),e.cardList=e.cardList.filter(function(e){return e.Id!=r})},function(e){void 0!=e.ExceptionMessage?swal("Error",e.ExceptionMessage,"error"):swal("Error","Something didn't work, please try again","error")})})}function w(r){swal({title:"Are you sure?",text:"Are you sure you want to make this card as default card?",type:"warning",showCancelButton:!0,confirmButtonText:"Confirm!"},function(){a.patch(t.API_ENDPOINT+"api/Payments/makedefault",r).then(function(a){for(swal("Success","Card made as your default card successfully","success"),i=0;i<e.cardList.length;i++)e.cardList[i].Id==r.Id?e.cardList[i].DefaultCard=!0:e.cardList[i].DefaultCard=!1},function(e){swal("Error","Something didn't work, please try again","error")})})}function j(e){var r=new RegExp("^4");return null!=e.match(r)?"visa":/^(5[1-5][0-9]{14}|2(22[1-9][0-9]{12}|2[3-9][0-9]{13}|[3-6][0-9]{14}|7[0-1][0-9]{13}|720[0-9]{12}))$/.test(e)?"mastercard":/^(5[1-5]\d{2})[\s\-]?(\d{4})[\s\-]?(\d{4})[\s\-]?(\d{4})$/.test(e)?"mastercard":(r=new RegExp("^3[47]"),null!=e.match(r)?"amex":(r=new RegExp("^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)"),null!=e.match(r)?"discover":(r=new RegExp("^36"),null!=e.match(r)?"diners":(r=new RegExp("^30[0-5]"),null!=e.match(r)?"diners-carteblanche":(r=new RegExp("^35(2[89]|[3-8][0-9])"),null!=e.match(r)?"jcb":(r=new RegExp("^(4026|417500|4508|4844|491(3|7))"),null!=e.match(r)?"visaelectron":(r=new RegExp("^(40117[8-9]|431274|438935|451416|457393|45763[1-2]|506(699|7[0-6][0-9]|77[0-8])|509d{3}|504175|627780|636297|636368|65003[1-3]|6500(3[5-9]|4[0-9]|5[0-1])|6504(0[5-9]|[1-3][0-9])|650(4[8-9][0-9]|5[0-2][0-9]|53[0-8])|6505(4[1-9]|[5-8][0-9]|9[0-8])|6507(0[0-9]|1[0-8])|65072[0-7]|6509(0[1-9]|1[0-9]|20)|6516(5[2-9]|[6-7][0-9])|6550([0-1][0-9]|2[1-9]|[3-4][0-9]|5[0-8]))"),null!=e.match(r)?"elo":(r=new RegExp("^(5018|5020|5038|6304|6759|6761|6763)[0-9]{8,15}$"),null!=e.match(r)?"maestro":""))))))))}function C(e){var r=e.toLowerCase().replace(/\s/g,"");return"mastercard"==r?"jp-card jp-card-identified jp-card-mastercard":"visa"==r?"jp-card jp-card-identified jp-card-visa":"visaelectron"==r?"jp-card jp-card-identified jp-card-visaelectron":"discover"==r?"jp-card jp-card-identified jp-card-discover":"amex"==r?"jp-card jp-card-identified jp-card-amex":"diners"==r||"diners-carteblanche"==r?"jp-card jp-card-identified jp-card-dinersclub":"jcb"==r?"jp-card jp-card-identified jp-card-jcb":"elo"==r?"jp-card jp-card-identified jp-card-elo":"maestro"==r?"jp-card jp-card-identified jp-card-maestro":"jp-card jp-card-identified"}e.showLoader=!1,e.cardList=s,e.view={current:"SAVED",switchTo:f},e.addCard=m,e.deleteCard=h,e.makeDefault=w,e.getCardTypeClass=C}var a=e.module("cab9.common");a.controller("ClientItemCreditCardController",r),r.$inject=["$scope","$state","$http","$config","Model","$stateParams","$q","rSavedCards","rData","rPassenger","rClient","CSV"]}(angular);;;;